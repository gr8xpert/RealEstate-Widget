{"version":3,"file":"realtysoft.es.js","sources":["../src/core/state.ts","../src/core/lru-cache.ts","../src/core/api.ts","../src/core/labels.ts","../src/core/analytics.ts","../src/core/toast.ts","../src/core/wishlist-manager.ts","../src/core/router.ts","../src/core/controller.ts","../src/components/base.ts","../src/components/search/location.ts","../src/components/search/listing-type.ts","../src/components/search/property-type.ts","../src/components/search/bedrooms.ts","../src/components/search/bathrooms.ts","../src/components/search/price.ts","../src/components/search/built-area.ts","../src/components/search/plot-size.ts","../src/components/search/features.ts","../src/components/search/reference.ts","../src/components/search/search-button.ts","../src/components/search/reset-button.ts","../src/components/search/ai-search-toggle.ts","../src/components/listing/property-grid.ts","../src/components/listing/property-carousel.ts","../src/components/listing/pagination.ts","../src/components/listing/sort.ts","../src/components/listing/results-count.ts","../src/components/listing/active-filters.ts","../src/components/listing/view-toggle.ts","../src/components/listing/map-view.ts","../src/components/listing/card/card-utils.ts","../src/components/listing/card/card-image.ts","../src/components/listing/card/card-price.ts","../src/components/listing/card/card-title.ts","../src/components/listing/card/card-location.ts","../src/components/listing/card/card-beds.ts","../src/components/listing/card/card-baths.ts","../src/components/listing/card/card-built.ts","../src/components/listing/card/card-plot.ts","../src/components/listing/card/card-ref.ts","../src/components/listing/card/card-type.ts","../src/components/listing/card/card-status.ts","../src/components/listing/card/card-wishlist.ts","../src/components/listing/card/card-link.ts","../src/components/listing/card/card-description.ts","../src/components/detail/back-button.ts","../src/components/detail/gallery.ts","../src/components/detail/features.ts","../src/components/detail/map.ts","../src/components/detail/inquiry-form.ts","../src/components/detail/wishlist.ts","../src/components/detail/share.ts","../src/components/detail/related.ts","../src/components/detail/info-table.ts","../src/components/detail/specs.ts","../src/components/detail/sizes.ts","../src/components/detail/taxes.ts","../src/components/detail/energy.ts","../src/components/detail/resources.ts","../src/components/detail/pdf-button.ts","../src/components/detail/video-embed.ts","../src/components/detail/detail.ts","../src/components/detail/property-detail-template.ts","../src/components/utility/wishlist-button.ts","../src/components/utility/wishlist-counter.ts","../src/components/utility/wishlist-header.ts","../src/components/utility/wishlist-empty.ts","../src/components/utility/wishlist-shared-banner.ts","../src/components/utility/wishlist-sort.ts","../src/components/utility/wishlist-actions.ts","../src/components/utility/wishlist-compare-btn.ts","../src/components/utility/wishlist-grid.ts","../src/components/utility/wishlist-modals.ts","../src/components/utility/wishlist-list.ts","../src/components/utility/language-selector.ts","../src/components/utility/share-buttons.ts","../src/index.ts"],"sourcesContent":["/**\r\n * RealtySoft Widget v3 - State Management\r\n * Central state store with pub/sub pattern\r\n */\r\n\r\nimport type {\r\n  FilterState,\r\n  LockedFilters,\r\n  ResultsState,\r\n  UIState,\r\n  AppState,\r\n  WidgetConfig,\r\n  Property,\r\n  Location,\r\n  PropertyType,\r\n  Feature,\r\n  SearchParams,\r\n  SubscriptionCallback,\r\n  UnsubscribeFunction,\r\n  RealtySoftStateModule,\r\n  MapState,\r\n} from '../types/index';\r\n\r\n// Type for subscribers map\r\ntype SubscribersMap = Record<string, SubscriptionCallback[]>;\r\n\r\nconst RealtySoftState: RealtySoftStateModule = (function () {\r\n  'use strict';\r\n\r\n  // Private state with proper typing\r\n  const state: AppState = {\r\n    // Search filters\r\n    filters: {\r\n      location: null,\r\n      locationName: '',\r\n      listingType: null,\r\n      propertyType: null,\r\n      propertyTypeName: '',\r\n      bedsMin: null,\r\n      bedsMax: null,\r\n      bathsMin: null,\r\n      bathsMax: null,\r\n      priceMin: null,\r\n      priceMax: null,\r\n      builtMin: null,\r\n      builtMax: null,\r\n      plotMin: null,\r\n      plotMax: null,\r\n      features: [],\r\n      ref: '',\r\n    },\r\n\r\n    // Locked filters (from data attributes)\r\n    lockedFilters: {},\r\n\r\n    // Results\r\n    results: {\r\n      properties: [],\r\n      total: 0,\r\n      page: 1,\r\n      perPage: 12,\r\n      totalPages: 0,\r\n    },\r\n\r\n    // Current property (detail page)\r\n    currentProperty: null,\r\n\r\n    // UI state\r\n    ui: {\r\n      view: 'grid',\r\n      sort: 'create_date_desc',\r\n      loading: true, // Start with loading true so components show loader on init\r\n      error: null,\r\n    },\r\n\r\n    // Map state\r\n    map: {\r\n      bounds: {\r\n        ne: null,\r\n        sw: null,\r\n      },\r\n      zoom: 10,\r\n      center: null,\r\n    },\r\n\r\n    // Wishlist\r\n    wishlist: [],\r\n\r\n    // Data from API\r\n    data: {\r\n      locations: [],\r\n      propertyTypes: [],\r\n      features: [],\r\n      labels: {},\r\n    },\r\n\r\n    // Config\r\n    config: {\r\n      apiKey: null,\r\n      apiUrl: null,\r\n      language: 'en_US',\r\n      ownerEmail: null,\r\n      privacyPolicyUrl: null,\r\n      features: [],\r\n      propertyPageSlug: 'property',\r\n      useWidgetPropertyTemplate: true,\r\n      useQueryParamUrls: false,\r\n      propertyUrlFormat: 'seo',\r\n      resultsPage: '',\r\n      defaultCountryCode: 'ES',\r\n      inquiryThankYouMessage: null,\r\n      inquiryThankYouUrl: null,\r\n    },\r\n  };\r\n\r\n  // Subscribers\r\n  const subscribers: SubscribersMap = {};\r\n\r\n  /**\r\n   * Get current state (immutable copy)\r\n   */\r\n  function getState(): AppState {\r\n    return JSON.parse(JSON.stringify(state));\r\n  }\r\n\r\n  /**\r\n   * Get specific state path\r\n   * @param path - Dot notation path (e.g., 'filters.location')\r\n   */\r\n  function get<T = unknown>(path: string): T {\r\n    const keys = path.split('.');\r\n    let value: unknown = state;\r\n\r\n    for (const key of keys) {\r\n      if (value === undefined || value === null) {\r\n        return undefined as T;\r\n      }\r\n      value = (value as Record<string, unknown>)[key];\r\n    }\r\n\r\n    // Return undefined directly if value doesn't exist\r\n    if (value === undefined) {\r\n      return undefined as T;\r\n    }\r\n\r\n    // Deep clone the value to prevent mutations\r\n    return JSON.parse(JSON.stringify(value)) as T;\r\n  }\r\n\r\n  /**\r\n   * Set state value\r\n   * @param path - Dot notation path\r\n   * @param value - New value\r\n   */\r\n  function set(path: string, value: unknown): void {\r\n    const keys = path.split('.');\r\n    let current: Record<string, unknown> = state as unknown as Record<string, unknown>;\r\n\r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      if (current[keys[i]] === undefined) {\r\n        current[keys[i]] = {};\r\n      }\r\n      current = current[keys[i]] as Record<string, unknown>;\r\n    }\r\n\r\n    const lastKey = keys[keys.length - 1];\r\n    const oldValue = current[lastKey];\r\n    current[lastKey] = value;\r\n\r\n    // Notify subscribers\r\n    notify(path, value, oldValue);\r\n  }\r\n\r\n  /**\r\n   * Update multiple values at once\r\n   * @param updates - Object with path:value pairs\r\n   */\r\n  function setMultiple(updates: Record<string, unknown>): void {\r\n    for (const [path, value] of Object.entries(updates)) {\r\n      set(path, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   * @param path - State path to watch (or '*' for all)\r\n   * @param callback - Function to call on change\r\n   * @returns Unsubscribe function\r\n   */\r\n  function subscribe<T = unknown>(\r\n    path: string,\r\n    callback: SubscriptionCallback<T>\r\n  ): UnsubscribeFunction {\r\n    if (!subscribers[path]) {\r\n      subscribers[path] = [];\r\n    }\r\n    subscribers[path].push(callback as SubscriptionCallback);\r\n\r\n    // Return unsubscribe function\r\n    return function unsubscribe(): void {\r\n      const index = subscribers[path].indexOf(callback as SubscriptionCallback);\r\n      if (index > -1) {\r\n        subscribers[path].splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Notify subscribers of state change\r\n   */\r\n  function notify(path: string, newValue: unknown, oldValue: unknown): void {\r\n    // Notify exact path subscribers\r\n    if (subscribers[path]) {\r\n      subscribers[path].forEach((cb) => cb(newValue, oldValue, path));\r\n    }\r\n\r\n    // Notify parent path subscribers\r\n    const parts = path.split('.');\r\n    for (let i = parts.length - 1; i > 0; i--) {\r\n      const parentPath = parts.slice(0, i).join('.');\r\n      if (subscribers[parentPath]) {\r\n        subscribers[parentPath].forEach((cb) => cb(get(parentPath), null, path));\r\n      }\r\n    }\r\n\r\n    // Notify wildcard subscribers\r\n    if (subscribers['*']) {\r\n      subscribers['*'].forEach((cb) => cb(newValue, oldValue, path));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset filters to defaults (respecting locked filters)\r\n   */\r\n  function resetFilters(): void {\r\n    const defaults: FilterState = {\r\n      location: null,\r\n      locationName: '',\r\n      listingType: null,\r\n      propertyType: null,\r\n      propertyTypeName: '',\r\n      bedsMin: null,\r\n      bedsMax: null,\r\n      bathsMin: null,\r\n      bathsMax: null,\r\n      priceMin: null,\r\n      priceMax: null,\r\n      builtMin: null,\r\n      builtMax: null,\r\n      plotMin: null,\r\n      plotMax: null,\r\n      features: [],\r\n      ref: '',\r\n    };\r\n\r\n    // Apply defaults but keep locked values\r\n    const locked = state.lockedFilters;\r\n\r\n    // Set each filter individually to notify all subscribers\r\n    for (const [key, defaultValue] of Object.entries(defaults)) {\r\n      const lockedValue = locked[key];\r\n      const value =\r\n        lockedValue !== null && lockedValue !== undefined ? lockedValue : defaultValue;\r\n      set('filters.' + key, value);\r\n    }\r\n\r\n    set('results.page', 1);\r\n  }\r\n\r\n  /**\r\n   * Set locked filters from data attributes\r\n   */\r\n  function setLockedFilters(locked: LockedFilters): void {\r\n    state.lockedFilters = { ...locked };\r\n\r\n    // Apply locked filters to current filters\r\n    for (const [key, value] of Object.entries(locked)) {\r\n      if (value !== null && value !== undefined) {\r\n        set(`filters.${key}`, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a filter is locked\r\n   */\r\n  function isFilterLocked(filterName: string): boolean {\r\n    return (\r\n      state.lockedFilters[filterName] !== undefined &&\r\n      state.lockedFilters[filterName] !== null\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Build search params from current filters\r\n   * Uses API parameter names expected by Inmolink/CRM API\r\n   */\r\n  function getSearchParams(): SearchParams {\r\n    const f = state.filters;\r\n    const params: Partial<SearchParams> = {};\r\n\r\n    // Location - API expects 'location_id'\r\n    if (f.location) {\r\n      params.location_id = Array.isArray(f.location)\r\n        ? f.location.join(',')\r\n        : f.location;\r\n    }\r\n\r\n    // Listing type - API expects 'listing_type'\r\n    if (f.listingType) {\r\n      params.listing_type = f.listingType;\r\n    }\r\n\r\n    // Property type - API expects 'type_id'\r\n    if (f.propertyType) {\r\n      params.type_id = Array.isArray(f.propertyType)\r\n        ? f.propertyType.join(',')\r\n        : f.propertyType;\r\n    }\r\n\r\n    // Bedrooms - API expects 'bedrooms_min', 'bedrooms_max'\r\n    if (f.bedsMin) params.bedrooms_min = f.bedsMin;\r\n    if (f.bedsMax) params.bedrooms_max = f.bedsMax;\r\n\r\n    // Bathrooms - API expects 'bathrooms_min', 'bathrooms_max'\r\n    if (f.bathsMin) params.bathrooms_min = f.bathsMin;\r\n    if (f.bathsMax) params.bathrooms_max = f.bathsMax;\r\n\r\n    // Price - API expects 'list_price_min', 'list_price_max'\r\n    if (f.priceMin) params.list_price_min = f.priceMin;\r\n    if (f.priceMax) params.list_price_max = f.priceMax;\r\n\r\n    // Built area - API expects 'build_size_min', 'build_size_max'\r\n    if (f.builtMin) params.build_size_min = f.builtMin;\r\n    if (f.builtMax) params.build_size_max = f.builtMax;\r\n\r\n    // Plot size - API expects 'plot_size_min', 'plot_size_max'\r\n    if (f.plotMin) params.plot_size_min = f.plotMin;\r\n    if (f.plotMax) params.plot_size_max = f.plotMax;\r\n\r\n    // Features - comma-separated IDs\r\n    if (f.features && f.features.length) {\r\n      params.features = f.features.join(',');\r\n    }\r\n\r\n    // Reference - API expects 'ref_no'\r\n    if (f.ref) params.ref_no = f.ref;\r\n\r\n    // Pagination and sorting\r\n    params.page = state.results.page;\r\n    params.limit = state.results.perPage;\r\n    params.order = state.ui.sort;\r\n\r\n    return params as SearchParams;\r\n  }\r\n\r\n  /**\r\n   * Wishlist management\r\n   */\r\n  function addToWishlist(propertyId: number): void {\r\n    if (!state.wishlist.includes(propertyId)) {\r\n      state.wishlist.push(propertyId);\r\n      saveWishlist();\r\n      notify('wishlist', state.wishlist, null);\r\n    }\r\n  }\r\n\r\n  function removeFromWishlist(propertyId: number): void {\r\n    const index = state.wishlist.indexOf(propertyId);\r\n    if (index > -1) {\r\n      state.wishlist.splice(index, 1);\r\n      saveWishlist();\r\n      notify('wishlist', state.wishlist, null);\r\n    }\r\n  }\r\n\r\n  function isInWishlist(propertyId: number): boolean {\r\n    return state.wishlist.includes(propertyId);\r\n  }\r\n\r\n  function loadWishlist(): void {\r\n    try {\r\n      const stored = localStorage.getItem('rs_wishlist');\r\n      if (stored) {\r\n        state.wishlist = JSON.parse(stored);\r\n      }\r\n    } catch (e) {\r\n      console.warn('Could not load wishlist from localStorage');\r\n    }\r\n  }\r\n\r\n  function saveWishlist(): void {\r\n    try {\r\n      localStorage.setItem('rs_wishlist', JSON.stringify(state.wishlist));\r\n    } catch (e) {\r\n      console.warn('Could not save wishlist to localStorage');\r\n    }\r\n  }\r\n\r\n  // Initialize wishlist from localStorage\r\n  loadWishlist();\r\n\r\n  // Public API\r\n  return {\r\n    getState,\r\n    get,\r\n    set,\r\n    setMultiple,\r\n    subscribe,\r\n    resetFilters,\r\n    setLockedFilters,\r\n    isFilterLocked,\r\n    getSearchParams,\r\n    addToWishlist,\r\n    removeFromWishlist,\r\n    isInWishlist,\r\n  };\r\n})();\r\n\r\n// Assign to window for backwards compatibility\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { RealtySoftState: RealtySoftStateModule }).RealtySoftState =\r\n    RealtySoftState;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoftState };\r\nexport default RealtySoftState;\r\n","/**\r\n * RealtySoft Widget v3 - LRU Cache\r\n * Generic in-memory LRU cache using doubly-linked list + Map for O(1) operations\r\n */\r\n\r\ninterface LRUNode<T> {\r\n  key: string;\r\n  value: T;\r\n  prev: LRUNode<T> | null;\r\n  next: LRUNode<T> | null;\r\n}\r\n\r\nexport class LRUCache<T> {\r\n  private capacity: number;\r\n  private map: Map<string, LRUNode<T>>;\r\n  private head: LRUNode<T> | null;\r\n  private tail: LRUNode<T> | null;\r\n\r\n  constructor(capacity: number) {\r\n    this.capacity = Math.max(1, capacity);\r\n    this.map = new Map();\r\n    this.head = null;\r\n    this.tail = null;\r\n  }\r\n\r\n  get size(): number {\r\n    return this.map.size;\r\n  }\r\n\r\n  get(key: string): T | undefined {\r\n    const node = this.map.get(key);\r\n    if (!node) return undefined;\r\n    this.moveToHead(node);\r\n    return node.value;\r\n  }\r\n\r\n  set(key: string, value: T): void {\r\n    const existing = this.map.get(key);\r\n    if (existing) {\r\n      existing.value = value;\r\n      this.moveToHead(existing);\r\n      return;\r\n    }\r\n\r\n    const node: LRUNode<T> = { key, value, prev: null, next: null };\r\n    this.map.set(key, node);\r\n    this.addToHead(node);\r\n\r\n    if (this.map.size > this.capacity) {\r\n      this.evict();\r\n    }\r\n  }\r\n\r\n  delete(key: string): boolean {\r\n    const node = this.map.get(key);\r\n    if (!node) return false;\r\n    this.removeNode(node);\r\n    this.map.delete(key);\r\n    return true;\r\n  }\r\n\r\n  clear(): void {\r\n    this.map.clear();\r\n    this.head = null;\r\n    this.tail = null;\r\n  }\r\n\r\n  has(key: string): boolean {\r\n    return this.map.has(key);\r\n  }\r\n\r\n  /**\r\n   * Iterate over all entries in the cache\r\n   */\r\n  forEach(callback: (value: T, key: string) => void): void {\r\n    this.map.forEach((node, key) => {\r\n      callback(node.value, key);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all keys in the cache\r\n   */\r\n  keys(): string[] {\r\n    return Array.from(this.map.keys());\r\n  }\r\n\r\n  private addToHead(node: LRUNode<T>): void {\r\n    node.prev = null;\r\n    node.next = this.head;\r\n    if (this.head) {\r\n      this.head.prev = node;\r\n    }\r\n    this.head = node;\r\n    if (!this.tail) {\r\n      this.tail = node;\r\n    }\r\n  }\r\n\r\n  private removeNode(node: LRUNode<T>): void {\r\n    if (node.prev) {\r\n      node.prev.next = node.next;\r\n    } else {\r\n      this.head = node.next;\r\n    }\r\n    if (node.next) {\r\n      node.next.prev = node.prev;\r\n    } else {\r\n      this.tail = node.prev;\r\n    }\r\n    node.prev = null;\r\n    node.next = null;\r\n  }\r\n\r\n  private moveToHead(node: LRUNode<T>): void {\r\n    if (this.head === node) return;\r\n    this.removeNode(node);\r\n    this.addToHead(node);\r\n  }\r\n\r\n  private evict(): void {\r\n    if (!this.tail) return;\r\n    const evicted = this.tail;\r\n    this.removeNode(evicted);\r\n    this.map.delete(evicted.key);\r\n  }\r\n}\r\n","/**\r\n * RealtySoft Widget v3 - API Service\r\n * Handles all API communication through proxy\r\n */\r\n\r\nimport type {\r\n  APIConfig,\r\n  APIResponse,\r\n  Location,\r\n  PropertyType,\r\n  Feature,\r\n  Property,\r\n  SearchParams,\r\n  InquiryData,\r\n  ImageWithSizes,\r\n  PropertyFeature,\r\n  PropertyAgent,\r\n  RealtySoftAPIModule,\r\n  CacheConfig,\r\n} from '../types/index';\r\n\r\nimport { LRUCache } from './lru-cache';\r\n\r\n// Cache entry interface\r\ninterface CacheEntry<T> {\r\n  data: T;\r\n  timestamp: number;\r\n}\r\n\r\n// Cache TTL category type\r\ntype CacheTTLCategory = 'locations' | 'propertyTypes' | 'features' | 'labels' | 'search' | 'property';\r\n\r\n// CacheManager interface\r\ninterface CacheManagerInterface {\r\n  CACHE_PREFIX: string;\r\n  get<T>(key: string, category?: CacheTTLCategory): T | null;\r\n  set<T>(key: string, data: T): void;\r\n  clear(key?: string): void;\r\n}\r\n\r\n// Raw property from API (before normalization)\r\ninterface RawProperty {\r\n  id: number;\r\n  title?: string;\r\n  name?: string;\r\n  headline?: string;\r\n  ref_no?: string;\r\n  ref?: string;\r\n  reference?: string;\r\n  unique_ref?: string;\r\n  unique_reference?: string;\r\n  external_ref?: string;\r\n  list_price?: number;\r\n  price?: number;\r\n  asking_price?: number;\r\n  price_on_request?: boolean;\r\n  hide_price?: boolean;\r\n  location_id?: { name?: string };\r\n  location?: { name?: string } | string;\r\n  city_id?: { name?: string };\r\n  municipality_id?: { name?: string };\r\n  address?: string;\r\n  street_address?: string;\r\n  postal_code?: string;\r\n  zipcode?: string;\r\n  zip?: string;\r\n  postcode?: string;\r\n  bedrooms?: number;\r\n  beds?: number;\r\n  bathrooms?: number;\r\n  baths?: number;\r\n  build_size?: number;\r\n  built_area?: number;\r\n  built?: number;\r\n  building_size?: number;\r\n  constructed_area?: number;\r\n  m2_pivienda?: number;\r\n  size?: number;\r\n  plot_size?: number;\r\n  plot?: number;\r\n  land_area?: number;\r\n  terrain_size?: number;\r\n  m2_parcela?: number;\r\n  terrace_size?: number;\r\n  terrace_area?: number;\r\n  terrace?: number;\r\n  m2_terraza?: number;\r\n  solarium_size?: number;\r\n  solarium_area?: number;\r\n  solarium?: number;\r\n  m2_solarium?: number;\r\n  garden_size?: number;\r\n  garden_area?: number;\r\n  garden?: number;\r\n  m2_jardin?: number;\r\n  usable_area?: number;\r\n  usable_size?: number;\r\n  useful_area?: number;\r\n  m2_utiles?: number;\r\n  images?: Array<string | RawImage>;\r\n  url?: string;\r\n  link?: string;\r\n  permalink?: string;\r\n  listing_type?: string;\r\n  listing_type_id?: { code?: string; name?: string };\r\n  status?: string;\r\n  listing_status?: string;\r\n  type_id?: { name?: string };\r\n  type?: { name?: string } | string;\r\n  property_type?: { name?: string };\r\n  is_featured?: boolean | number | string;\r\n  is_own?: boolean | number | string;\r\n  is_new?: boolean | number | string;\r\n  is_exclusive?: boolean | number | string;\r\n  desc?: string;\r\n  description?: string;\r\n  full_description?: string;\r\n  short_description?: string;\r\n  summary?: string;\r\n  features?: Array<string | RawFeature>;\r\n  amenities?: Array<string | RawFeature>;\r\n  agent?: RawAgent;\r\n  listing_agent?: RawAgent;\r\n  contact?: RawAgent;\r\n  user?: RawAgent;\r\n  latitude?: number;\r\n  lat?: number;\r\n  geo_lat?: number;\r\n  longitude?: number;\r\n  lng?: number;\r\n  lon?: number;\r\n  geo_lng?: number;\r\n  year_built?: number;\r\n  construction_year?: number;\r\n  built_year?: number;\r\n  community_fees_monthly?: number;\r\n  community_fees?: number;\r\n  comm_fees?: number;\r\n  community_cost?: number;\r\n  gastos_comunidad?: number;\r\n  monthly_community_fees?: number;\r\n  ibi_fees?: number;\r\n  ibi_tax?: number;\r\n  ibi?: number;\r\n  ibi_annual?: number;\r\n  ibi_yearly?: number;\r\n  basura_tax?: number;\r\n  basura_fees?: number;\r\n  garbage_tax?: number;\r\n  basura?: number;\r\n  waste_tax?: number;\r\n  energy_rating?: string;\r\n  energy_certificate?: {\r\n    rating?: string;\r\n    co2?: string;\r\n    image?: string;\r\n    consumption?: string;\r\n  };\r\n  energy_class?: string;\r\n  co2_rating?: string;\r\n  co2_emission?: string;\r\n  energy_certificate_image?: string;\r\n  energy_image?: string;\r\n  energy_consumption?: string;\r\n  video_url?: string;\r\n  video?: string;\r\n  youtube_url?: string;\r\n  virtual_tour_url?: string;\r\n  virtual_tour?: string;\r\n  tour_360?: string;\r\n  matterport_url?: string;\r\n  pdf_url?: string;\r\n  pdf?: string;\r\n  brochure_url?: string;\r\n  brochure?: string;\r\n  pdf_link?: string;\r\n  document_url?: string;\r\n  flyer_url?: string;\r\n  flyer?: string;\r\n  floor?: string;\r\n  floor_number?: string;\r\n  orientation?: string;\r\n  parking?: number;\r\n  parking_spaces?: number;\r\n  garage?: number;\r\n  pool?: boolean;\r\n  swimming_pool?: boolean;\r\n  furnished?: string;\r\n  furniture?: string;\r\n  condition?: string;\r\n  property_condition?: string;\r\n  views?: string;\r\n  view_type?: string;\r\n  created_at?: string;\r\n  date_added?: string;\r\n  listed_date?: string;\r\n  updated_at?: string;\r\n  date_modified?: string;\r\n  last_updated?: string;\r\n}\r\n\r\ninterface RawImage {\r\n  src?: string;\r\n  url?: string;\r\n  image_256?: string;\r\n  image_512?: string;\r\n  image_768?: string;\r\n  image_1024?: string;\r\n}\r\n\r\ninterface RawFeature {\r\n  name?: string;\r\n  label?: string;\r\n  title?: string;\r\n  attr_id?: { name?: string };\r\n  category?: string;\r\n}\r\n\r\ninterface RawAgent {\r\n  name?: string;\r\n  full_name?: string;\r\n  display_name?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  telephone?: string;\r\n  mobile?: string;\r\n  photo?: string;\r\n  avatar?: string;\r\n  image?: string;\r\n}\r\n\r\nconst RealtySoftAPI: RealtySoftAPIModule = (function () {\r\n  'use strict';\r\n\r\n  /**\r\n   * Default cache TTL values (in milliseconds)\r\n   */\r\n  const DEFAULT_CACHE_TTL: Record<CacheTTLCategory, number> = {\r\n    locations: 24 * 60 * 60 * 1000,     // 24 hours\r\n    propertyTypes: 24 * 60 * 60 * 1000, // 24 hours\r\n    features: 24 * 60 * 60 * 1000,      // 24 hours\r\n    labels: 24 * 60 * 60 * 1000,        // 24 hours\r\n    search: 24 * 60 * 60 * 1000,        // 24 hours\r\n    property: 60 * 60 * 1000,           // 1 hour\r\n  };\r\n\r\n  /**\r\n   * Cache configuration â€” updated via init()\r\n   */\r\n  let cacheConfig: CacheConfig = {};\r\n\r\n  /**\r\n   * L1 in-memory LRU cache (default 100 entries)\r\n   */\r\n  let memoryCache = new LRUCache<{ data: unknown; timestamp: number }>(100);\r\n\r\n  /**\r\n   * Resolve TTL for a given category, using user config with fallback to defaults\r\n   */\r\n  function resolveTTL(category: CacheTTLCategory): number {\r\n    const userValue = cacheConfig[category];\r\n    if (typeof userValue === 'number' && userValue >= 0) {\r\n      return userValue;\r\n    }\r\n    return DEFAULT_CACHE_TTL[category];\r\n  }\r\n\r\n  /**\r\n   * CacheManager - Two-layer caching:\r\n   *   L1: In-memory LRU cache (fast, no JSON.parse overhead)\r\n   *   L2: localStorage (persistent across page loads)\r\n   */\r\n  const CacheManager: CacheManagerInterface = {\r\n    CACHE_PREFIX: 'rs_cache_',\r\n\r\n    get<T>(key: string, category?: CacheTTLCategory): T | null {\r\n      if (cacheConfig.disabled) return null;\r\n      const ttl = category ? resolveTTL(category) : DEFAULT_CACHE_TTL.locations;\r\n      const fullKey = this.CACHE_PREFIX + key;\r\n\r\n      // L1: Check memory cache first\r\n      const memEntry = memoryCache.get(fullKey);\r\n      if (memEntry) {\r\n        if (Date.now() - memEntry.timestamp > ttl) {\r\n          memoryCache.delete(fullKey);\r\n        } else {\r\n          return memEntry.data as T;\r\n        }\r\n      }\r\n\r\n      // L2: Check localStorage\r\n      try {\r\n        const cached = localStorage.getItem(fullKey);\r\n        if (!cached) return null;\r\n        const { data, timestamp }: CacheEntry<T> = JSON.parse(cached);\r\n        if (Date.now() - timestamp > ttl) {\r\n          localStorage.removeItem(fullKey);\r\n          return null;\r\n        }\r\n        // Promote L2 hit to L1\r\n        memoryCache.set(fullKey, { data, timestamp });\r\n        return data;\r\n      } catch (e) {\r\n        console.warn('Cache read error:', e);\r\n        return null;\r\n      }\r\n    },\r\n\r\n    set<T>(key: string, data: T): void {\r\n      if (cacheConfig.disabled) return;\r\n      const fullKey = this.CACHE_PREFIX + key;\r\n      const timestamp = Date.now();\r\n\r\n      // L1: Always write to memory\r\n      memoryCache.set(fullKey, { data, timestamp });\r\n\r\n      // L2: Write to localStorage (non-fatal on failure)\r\n      try {\r\n        localStorage.setItem(fullKey, JSON.stringify({ data, timestamp }));\r\n      } catch (e) {\r\n        console.warn('Cache write error (localStorage):', e);\r\n      }\r\n    },\r\n\r\n    clear(key?: string): void {\r\n      try {\r\n        if (key) {\r\n          const fullKey = this.CACHE_PREFIX + key;\r\n          memoryCache.delete(fullKey);\r\n          localStorage.removeItem(fullKey);\r\n        } else {\r\n          // Clear all RS cache entries\r\n          memoryCache.clear();\r\n          Object.keys(localStorage)\r\n            .filter((k) => k.startsWith(this.CACHE_PREFIX))\r\n            .forEach((k) => localStorage.removeItem(k));\r\n        }\r\n      } catch (e) {\r\n        console.warn('Cache clear error:', e);\r\n      }\r\n    },\r\n  };\r\n\r\n  /**\r\n   * Simple hash function for cache keys\r\n   */\r\n  function hashString(str: string): string {\r\n    let hash = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n      const char = str.charCodeAt(i);\r\n      hash = (hash << 5) - hash + char;\r\n      hash = hash & hash;\r\n    }\r\n    return Math.abs(hash).toString(16);\r\n  }\r\n\r\n  // In-flight request deduplication - prevents duplicate concurrent API requests\r\n  const pendingRequests = new Map<string, Promise<unknown>>();\r\n\r\n  let config: APIConfig = {\r\n    proxyUrl: 'https://realtysoft.ai/propertymanager/php/api-proxy.php',\r\n    inquiryEndpoint: 'https://realtysoft.ai/propertymanager/php/send-inquiry.php',\r\n    apiKey: null,\r\n    apiUrl: null,\r\n    language: 'en_US',\r\n  };\r\n\r\n  /**\r\n   * Map language codes for API requests\r\n   * Some languages share the same API content (e.g., en_GB uses en_US)\r\n   */\r\n  const languageAliases: Record<string, string> = {\r\n    'en_GB': 'en_US',\r\n    'en_AU': 'en_US',\r\n    'en_CA': 'en_US',\r\n    // Add more aliases as needed\r\n  };\r\n\r\n  function getApiLanguage(lang: string): string {\r\n    return languageAliases[lang] || lang;\r\n  }\r\n\r\n  /**\r\n   * Initialize API with config\r\n   */\r\n  function init(options: Partial<APIConfig>): void {\r\n    config = { ...config, ...options };\r\n    // Reset cache config: use provided config or defaults\r\n    cacheConfig = options.cache ? { ...options.cache } : {};\r\n    const maxEntries = cacheConfig.maxCacheEntries ?? 100;\r\n    memoryCache = new LRUCache<{ data: unknown; timestamp: number }>(maxEntries);\r\n  }\r\n\r\n  /**\r\n   * Make API request through proxy\r\n   */\r\n  async function request<T>(\r\n    endpoint: string,\r\n    params: Record<string, unknown> = {},\r\n    method: string = 'GET',\r\n    options: { skipLang?: boolean } = {}\r\n  ): Promise<T> {\r\n    // Create request key for deduplication (endpoint + params hash)\r\n    const requestKey = endpoint + '_' + hashString(JSON.stringify(params)) + '_' + method;\r\n\r\n    // Return existing promise if same request is already in-flight\r\n    if (pendingRequests.has(requestKey)) {\r\n      console.log('[RealtySoft] Deduplicating request:', endpoint);\r\n      return pendingRequests.get(requestKey) as Promise<T>;\r\n    }\r\n\r\n    const url = new URL(config.proxyUrl, window.location.origin);\r\n\r\n    // Add endpoint to params\r\n    const requestParams: Record<string, unknown> = { ...params, _endpoint: endpoint };\r\n\r\n    // Add language unless skipped (use mapped language for API)\r\n    if (!options.skipLang) {\r\n      requestParams._lang = getApiLanguage(config.language);\r\n    }\r\n\r\n    // Add cache-busting timestamp to force fresh data from proxy/CDN\r\n    requestParams._t = Date.now();\r\n\r\n    if (method === 'GET') {\r\n      Object.keys(requestParams).forEach((key) => {\r\n        if (requestParams[key] !== null && requestParams[key] !== undefined) {\r\n          url.searchParams.append(key, String(requestParams[key]));\r\n        }\r\n      });\r\n    }\r\n\r\n    const fetchOptions: RequestInit = {\r\n      method,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Requested-With': 'XMLHttpRequest',\r\n      },\r\n    };\r\n\r\n    if (method === 'POST') {\r\n      fetchOptions.body = JSON.stringify(requestParams);\r\n    }\r\n\r\n    // Create the request promise\r\n    const requestPromise = (async (): Promise<T> => {\r\n      try {\r\n        const response = await fetch(url.toString(), fetchOptions);\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n          throw new Error(data.error);\r\n        }\r\n\r\n        return data as T;\r\n      } catch (error) {\r\n        console.error('API Error:', error);\r\n        throw error;\r\n      } finally {\r\n        // Clean up pending request after completion\r\n        pendingRequests.delete(requestKey);\r\n      }\r\n    })();\r\n\r\n    // Store the promise for deduplication\r\n    pendingRequests.set(requestKey, requestPromise);\r\n\r\n    return requestPromise;\r\n  }\r\n\r\n  /**\r\n   * Get locations (v1 endpoint, no language param)\r\n   */\r\n  async function getLocations(parentId: number | null = null): Promise<APIResponse<Location[]>> {\r\n    const cacheKey = 'locations' + (parentId ? '_' + parentId : '');\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<APIResponse<Location[]>>(cacheKey, 'locations');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Locations loaded from cache');\r\n      return cached;\r\n    }\r\n\r\n    // Fetch ALL locations in a single request with high limit\r\n    const params: Record<string, unknown> = { page: 1, limit: 1000 };\r\n    if (parentId) params.parent_id = parentId;\r\n\r\n    const response = await request<APIResponse<Location[]>>('v1/location', params, 'GET', {\r\n      skipLang: true,\r\n    });\r\n\r\n    // Deduplicate by ID\r\n    const seen = new Set<number>();\r\n    const uniqueData = (response.data || []).filter((loc) => {\r\n      if (seen.has(loc.id)) return false;\r\n      seen.add(loc.id);\r\n      return true;\r\n    });\r\n\r\n    const result: APIResponse<Location[]> = {\r\n      data: uniqueData,\r\n      count: response.count || uniqueData.length,\r\n    };\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Locations cached');\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get parent/top-level locations only\r\n   */\r\n  async function getParentLocations(): Promise<APIResponse<Location[]>> {\r\n    const cacheKey = 'parentLocations';\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<APIResponse<Location[]>>(cacheKey, 'locations');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Parent locations loaded from cache');\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<APIResponse<Location[]>>(\r\n      'v1/location',\r\n      { parent_id: 0 },\r\n      'GET',\r\n      { skipLang: true }\r\n    );\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Parent locations cached');\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get child locations for a specific parent\r\n   */\r\n  async function getChildLocations(parentId: number): Promise<APIResponse<Location[]>> {\r\n    const cacheKey = 'childLocations_' + parentId;\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<APIResponse<Location[]>>(cacheKey, 'locations');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Child locations loaded from cache for parent:', parentId);\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<APIResponse<Location[]>>(\r\n      'v1/location',\r\n      { parent_id: parentId },\r\n      'GET',\r\n      { skipLang: true }\r\n    );\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Child locations cached for parent:', parentId);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Search locations by term\r\n   */\r\n  async function searchLocations(term: string): Promise<APIResponse<Location[]>> {\r\n    return await request<APIResponse<Location[]>>('v1/search_location', { q: term });\r\n  }\r\n\r\n  /**\r\n   * Get relevant/related locations\r\n   */\r\n  async function getRelevantLocations(locationId: number): Promise<APIResponse<Location[]>> {\r\n    return await request<APIResponse<Location[]>>('v1/relevant_location', { id: locationId });\r\n  }\r\n\r\n  /**\r\n   * Get property types\r\n   */\r\n  async function getPropertyTypes(): Promise<APIResponse<PropertyType[]>> {\r\n    const cacheKey = 'propertyTypes_' + config.language;\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<APIResponse<PropertyType[]>>(cacheKey, 'propertyTypes');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Property types loaded from cache');\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<APIResponse<PropertyType[]>>('v1/property_types');\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Property types cached');\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get property features\r\n   */\r\n  async function getFeatures(): Promise<APIResponse<Feature[]>> {\r\n    const cacheKey = 'features_' + config.language;\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<APIResponse<Feature[]>>(cacheKey, 'features');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Features loaded from cache');\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<APIResponse<Feature[]>>('v1/property_features');\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Features cached');\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get UI labels for current language\r\n   */\r\n  async function getLabels(): Promise<Record<string, string>> {\r\n    const cacheKey = 'labels_' + config.language;\r\n\r\n    // Check cache first\r\n    const cached = CacheManager.get<Record<string, string>>(cacheKey, 'labels');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Labels loaded from cache');\r\n      return cached;\r\n    }\r\n\r\n    // Check for PHP-injected prefetch (started before widget loaded)\r\n    const prefetch = (window as any).__rsPrefetch;\r\n    let result: Record<string, string>;\r\n    if (prefetch?.labels && (!prefetch.lang || prefetch.lang === config.language)) {\r\n      const prefetched = await prefetch.labels;\r\n      delete prefetch.labels; // Consume once\r\n      if (prefetched) {\r\n        console.log('[RealtySoft] Labels loaded from PHP prefetch');\r\n        result = prefetched;\r\n      } else {\r\n        result = await request<Record<string, string>>('v1/plugin_labels');\r\n      }\r\n    } else {\r\n      result = await request<Record<string, string>>('v1/plugin_labels');\r\n    }\r\n\r\n    // Cache the result\r\n    CacheManager.set(cacheKey, result);\r\n    console.log('[RealtySoft] Labels cached');\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get all labels (without language filter) to detect available languages\r\n   */\r\n  async function getAllLabels(): Promise<unknown> {\r\n    const cacheKey = 'labels_all';\r\n\r\n    const cached = CacheManager.get<unknown>(cacheKey, 'labels');\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<unknown>('v1/plugin_labels', {}, 'GET', { skipLang: true });\r\n\r\n    CacheManager.set(cacheKey, result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get translated field value from property\r\n   * Checks for language-specific fields like title_es, description_es\r\n   * Falls back to default field if no translation exists\r\n   */\r\n  function getTranslatedField(\r\n    property: Record<string, unknown>,\r\n    fieldName: string,\r\n    fallbackFields: string[] = []\r\n  ): string {\r\n    // Get language code (e.g., 'es' from 'es_ES')\r\n    const langCode = config.language.split('_')[0];\r\n\r\n    // Try language-specific field first (e.g., title_es, description_es)\r\n    const langField = `${fieldName}_${langCode}`;\r\n    if (property[langField] && typeof property[langField] === 'string') {\r\n      return property[langField] as string;\r\n    }\r\n\r\n    // Try translations object (e.g., translations.es.title)\r\n    const translations = property.translations as Record<string, Record<string, string>> | undefined;\r\n    if (translations && translations[langCode] && translations[langCode][fieldName]) {\r\n      return translations[langCode][fieldName];\r\n    }\r\n\r\n    // Try full language code (e.g., title_es_ES)\r\n    const fullLangField = `${fieldName}_${config.language.replace('-', '_')}`;\r\n    if (property[fullLangField] && typeof property[fullLangField] === 'string') {\r\n      return property[fullLangField] as string;\r\n    }\r\n\r\n    // Fall back to default field and alternatives\r\n    const allFields = [fieldName, ...fallbackFields];\r\n    for (const field of allFields) {\r\n      if (property[field] && typeof property[field] === 'string') {\r\n        return property[field] as string;\r\n      }\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Normalize property data from API to expected format\r\n   */\r\n  function normalizeProperty(property: RawProperty | null): Property | null {\r\n    if (!property) return null;\r\n\r\n    // Cast to Record for dynamic field access\r\n    const propRecord = property as unknown as Record<string, unknown>;\r\n\r\n    // Extract images\r\n    let images: string[] = [];\r\n    let imagesFull: string[] = [];\r\n    let imagesWithSizes: ImageWithSizes[] = [];\r\n\r\n    if (property.images && Array.isArray(property.images)) {\r\n      images = property.images\r\n        .map((img) => {\r\n          if (typeof img === 'string') return img;\r\n          return (\r\n            img.image_256 || img.image_512 || img.image_768 || img.src || img.url || ''\r\n          );\r\n        })\r\n        .filter(Boolean);\r\n\r\n      imagesFull = property.images\r\n        .map((img) => {\r\n          if (typeof img === 'string') return img;\r\n          return (\r\n            img.image_1024 || img.image_768 || img.image_512 || img.src || img.url || ''\r\n          );\r\n        })\r\n        .filter(Boolean);\r\n\r\n      imagesWithSizes = property.images\r\n        .map((img): ImageWithSizes | null => {\r\n          if (typeof img === 'string') return { src: img, sizes: {} };\r\n          const src =\r\n            img.image_256 || img.image_512 || img.image_768 || img.src || img.url || '';\r\n          if (!src) return null;\r\n          return {\r\n            src,\r\n            sizes: {\r\n              256: img.image_256,\r\n              512: img.image_512,\r\n              768: img.image_768,\r\n              1024: img.image_1024,\r\n            },\r\n          };\r\n        })\r\n        .filter((img): img is ImageWithSizes => img !== null && !!img.src);\r\n    }\r\n\r\n    // Get language code for translation lookups\r\n    const langCode = config.language.split('_')[0];\r\n\r\n    // Helper to get translated name from an object with possible name_es, name_en etc.\r\n    const getTranslatedName = (obj: { name?: string; [key: string]: unknown } | null | undefined): string => {\r\n      if (!obj) return '';\r\n      const langName = obj[`name_${langCode}`];\r\n      if (typeof langName === 'string' && langName) return langName;\r\n      return obj.name || '';\r\n    };\r\n\r\n    // Extract location name with translation support\r\n    const locationName =\r\n      getTranslatedName(property.location_id as { name?: string }) ||\r\n      getTranslatedName(property.location as { name?: string }) ||\r\n      getTranslatedName(property.city_id) ||\r\n      getTranslatedName(property.municipality_id) ||\r\n      (typeof property.location === 'string' ? property.location : '') ||\r\n      property.address ||\r\n      '';\r\n\r\n    // Extract type name with translation support\r\n    const typeName =\r\n      getTranslatedName(property.type_id) ||\r\n      getTranslatedName(property.type as { name?: string }) ||\r\n      getTranslatedName(property.property_type) ||\r\n      (typeof property.type === 'string' ? property.type : '') ||\r\n      '';\r\n\r\n    // Determine listing type\r\n    const listingType =\r\n      property.listing_type || property.listing_type_id?.code || property.status || 'resale';\r\n\r\n    // Extract features with translation support\r\n    let features: PropertyFeature[] = [];\r\n    const rawFeatures = property.features || property.amenities;\r\n    if (rawFeatures && Array.isArray(rawFeatures)) {\r\n      features = rawFeatures\r\n        .map((f): PropertyFeature | null => {\r\n          if (typeof f === 'string') return { name: f, category: 'Features' };\r\n          if (!f || typeof f !== 'object') return null;\r\n\r\n          // Get feature name - check translated field first, then standard fields\r\n          const fRecord = f as Record<string, unknown>;\r\n          const translatedName = fRecord[`name_${langCode}`];\r\n          const name =\r\n            (typeof translatedName === 'string' && translatedName) ||\r\n            f.name ||\r\n            f.label ||\r\n            f.title ||\r\n            '';\r\n          if (!name) return null;\r\n\r\n          // Get category - check translated field first, then standard fields\r\n          const translatedCategory = fRecord[`category_${langCode}`];\r\n          const category =\r\n            (typeof translatedCategory === 'string' && translatedCategory) ||\r\n            f.attr_id?.name ||\r\n            f.category ||\r\n            'Features';\r\n\r\n          return { name, category };\r\n        })\r\n        .filter((f): f is PropertyFeature => f !== null);\r\n    }\r\n\r\n    // Extract agent info\r\n    const rawAgent = property.agent || property.listing_agent || property.contact || property.user;\r\n    const agent: PropertyAgent | null = rawAgent\r\n      ? {\r\n          name: rawAgent.name || rawAgent.full_name || rawAgent.display_name || '',\r\n          email: rawAgent.email || '',\r\n          phone: rawAgent.phone || rawAgent.telephone || rawAgent.mobile || '',\r\n          photo: rawAgent.photo || rawAgent.avatar || rawAgent.image || '',\r\n        }\r\n      : null;\r\n\r\n    const toBoolean = (val: boolean | number | string | undefined): boolean =>\r\n      val === true || val === 1 || val === '1';\r\n\r\n    // Get translated title and description\r\n    const title = getTranslatedField(propRecord, 'title', ['name', 'headline']);\r\n    const description = getTranslatedField(propRecord, 'description', ['desc', 'full_description']);\r\n    const shortDescription = getTranslatedField(propRecord, 'short_description', ['summary']);\r\n\r\n    return {\r\n      id: property.id,\r\n      title,\r\n      ref: property.ref_no || property.ref || property.reference || '',\r\n      unique_ref: property.unique_ref || property.unique_reference || property.external_ref || '',\r\n      price: property.list_price || property.price || property.asking_price || 0,\r\n      price_on_request: property.price_on_request || property.hide_price || false,\r\n      location: locationName,\r\n      postal_code:\r\n        property.postal_code || property.zipcode || property.zip || property.postcode || '',\r\n      address: property.address || property.street_address || '',\r\n      beds: property.bedrooms || property.beds || 0,\r\n      baths: property.bathrooms || property.baths || 0,\r\n      built_area:\r\n        property.build_size ||\r\n        property.built_area ||\r\n        property.built ||\r\n        property.building_size ||\r\n        property.constructed_area ||\r\n        property.m2_pivienda ||\r\n        property.size ||\r\n        0,\r\n      plot_size:\r\n        property.plot_size ||\r\n        property.plot ||\r\n        property.land_area ||\r\n        property.terrain_size ||\r\n        property.m2_parcela ||\r\n        0,\r\n      terrace_size:\r\n        property.terrace_size ||\r\n        property.terrace_area ||\r\n        (typeof property.terrace === 'number' ? property.terrace : 0) ||\r\n        property.m2_terraza ||\r\n        0,\r\n      solarium_size:\r\n        property.solarium_size ||\r\n        property.solarium_area ||\r\n        (typeof property.solarium === 'number' ? property.solarium : 0) ||\r\n        property.m2_solarium ||\r\n        0,\r\n      garden_size:\r\n        property.garden_size ||\r\n        property.garden_area ||\r\n        (typeof property.garden === 'number' ? property.garden : 0) ||\r\n        property.m2_jardin ||\r\n        0,\r\n      usable_area:\r\n        property.usable_area ||\r\n        property.usable_size ||\r\n        property.useful_area ||\r\n        property.m2_utiles ||\r\n        0,\r\n      images,\r\n      imagesFull,\r\n      imagesWithSizes,\r\n      total_images: property.images?.length || 0,\r\n      url: property.url || property.link || property.permalink || null,\r\n      listing_type: listingType,\r\n      status: property.status || property.listing_type_id?.name || property.listing_status || '',\r\n      type: typeName,\r\n      is_featured: toBoolean(property.is_featured),\r\n      is_own: toBoolean(property.is_own),\r\n      is_new: toBoolean(property.is_new),\r\n      is_exclusive: toBoolean(property.is_exclusive),\r\n      description,\r\n      short_description: shortDescription,\r\n      features,\r\n      agent,\r\n      latitude: property.latitude || property.lat || property.geo_lat || null,\r\n      longitude: property.longitude || property.lng || property.lon || property.geo_lng || null,\r\n      year_built: property.year_built || property.construction_year || property.built_year || null,\r\n      community_fees:\r\n        property.community_fees_monthly ||\r\n        property.community_fees ||\r\n        property.comm_fees ||\r\n        property.community_cost ||\r\n        property.gastos_comunidad ||\r\n        property.monthly_community_fees ||\r\n        null,\r\n      ibi_tax:\r\n        property.ibi_fees ||\r\n        property.ibi_tax ||\r\n        property.ibi ||\r\n        property.ibi_annual ||\r\n        property.ibi_yearly ||\r\n        null,\r\n      basura_tax:\r\n        property.basura_tax ||\r\n        property.basura_fees ||\r\n        property.garbage_tax ||\r\n        property.basura ||\r\n        property.waste_tax ||\r\n        null,\r\n      energy_rating:\r\n        property.energy_rating || property.energy_certificate?.rating || property.energy_class || '',\r\n      co2_rating: property.co2_rating || property.co2_emission || property.energy_certificate?.co2 || '',\r\n      energy_certificate_image:\r\n        property.energy_certificate_image ||\r\n        property.energy_certificate?.image ||\r\n        property.energy_image ||\r\n        '',\r\n      energy_consumption:\r\n        property.energy_consumption || property.energy_certificate?.consumption || '',\r\n      video_url: property.video_url || property.video || property.youtube_url || '',\r\n      virtual_tour_url:\r\n        property.virtual_tour_url ||\r\n        property.virtual_tour ||\r\n        property.tour_360 ||\r\n        property.matterport_url ||\r\n        '',\r\n      pdf_url:\r\n        property.pdf_url ||\r\n        property.pdf ||\r\n        property.brochure_url ||\r\n        property.brochure ||\r\n        property.pdf_link ||\r\n        property.document_url ||\r\n        property.flyer_url ||\r\n        property.flyer ||\r\n        '',\r\n      floor: property.floor || property.floor_number || '',\r\n      orientation: property.orientation || '',\r\n      parking: property.parking || property.parking_spaces || property.garage || 0,\r\n      pool: property.pool || property.swimming_pool || false,\r\n      furnished: property.furnished || property.furniture || '',\r\n      condition: property.condition || property.property_condition || '',\r\n      views: property.views || property.view_type || '',\r\n      created_at: property.created_at || property.date_added || property.listed_date || '',\r\n      updated_at: property.updated_at || property.date_modified || property.last_updated || '',\r\n      _original: property as unknown as Record<string, unknown>,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Normalize array of properties\r\n   */\r\n  function normalizeProperties(data: RawProperty[] | unknown): Property[] {\r\n    if (Array.isArray(data)) {\r\n      return data.map((p) => normalizeProperty(p)).filter((p): p is Property => p !== null);\r\n    }\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Search properties\r\n   */\r\n  async function searchProperties(\r\n    params: Partial<SearchParams>\r\n  ): Promise<APIResponse<Property[]>> {\r\n    // Include language in cache key to ensure language-specific results\r\n    const cacheKey = 'search_' + config.language + '_' + hashString(JSON.stringify(params));\r\n\r\n    // Check cache\r\n    const cached = CacheManager.get<APIResponse<Property[]>>(cacheKey, 'search');\r\n    if (cached) {\r\n      console.log('[RealtySoft] Search results from cache');\r\n      return cached;\r\n    }\r\n\r\n    const result = await request<APIResponse<RawProperty[]>>('v1/property', params);\r\n\r\n    const normalizedResult: APIResponse<Property[]> = {\r\n      ...result,\r\n      data: normalizeProperties(result.data),\r\n    };\r\n\r\n    // Cache each property individually\r\n    if (normalizedResult.data) {\r\n      normalizedResult.data.forEach((property) => {\r\n        if (property.id) {\r\n          cacheProperty(property);\r\n        }\r\n      });\r\n      // Cache search results\r\n      CacheManager.set(cacheKey, normalizedResult);\r\n      console.log('[RealtySoft] Search results cached');\r\n    }\r\n\r\n    return normalizedResult;\r\n  }\r\n\r\n  /**\r\n   * Cache a single property (language-specific)\r\n   */\r\n  function cacheProperty(property: Property): void {\r\n    if (!property || !property.id) return;\r\n    // Include language in cache key since property content is language-specific\r\n    const lang = config.language;\r\n    const key = 'property_' + lang + '_' + property.id;\r\n    CacheManager.set(key, property);\r\n    if (property.ref) {\r\n      const refKey = 'property_ref_' + lang + '_' + property.ref;\r\n      CacheManager.set(refKey, property);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cached property (language-specific)\r\n   */\r\n  function getCachedProperty(idOrRef: number | string, isRef: boolean = false): Property | null {\r\n    const lang = config.language;\r\n    const key = isRef ? 'property_ref_' + lang + '_' + idOrRef : 'property_' + lang + '_' + idOrRef;\r\n    return CacheManager.get<Property>(key, 'property');\r\n  }\r\n\r\n  /**\r\n   * Fetch property from API and cache it\r\n   */\r\n  async function fetchAndCacheProperty(\r\n    idOrRef: number | string,\r\n    isRef: boolean = false\r\n  ): Promise<{ data: Property; fromCache?: boolean }> {\r\n    let result: APIResponse<RawProperty[]>;\r\n\r\n    // Check for PHP-injected prefetch (started before widget loaded)\r\n    const prefetch = (window as any).__rsPrefetch;\r\n    const requestedRef = String(idOrRef).toLowerCase();\r\n    const prefetchRef = (prefetch?.ref || '').toLowerCase();\r\n\r\n    // RACE CONDITION FIX: Strict validation - prefetch ref must EXACTLY match requested ref (case-insensitive)\r\n    if (prefetch?.property && isRef && prefetchRef === requestedRef && prefetchRef !== '') {\r\n      const prefetched = await prefetch.property;\r\n      delete prefetch.property; // Consume once\r\n\r\n      // Double-check: validate the actual property data matches what we asked for\r\n      if (prefetched) {\r\n        const prefetchedData = prefetched as APIResponse<RawProperty[]>;\r\n        const propData = Array.isArray(prefetchedData.data) ? prefetchedData.data[0] : prefetchedData.data;\r\n        const actualRef = (propData?.ref || propData?.ref_no || propData?.reference || '').toLowerCase();\r\n\r\n        if (actualRef === requestedRef) {\r\n          console.log('[RealtySoft] Property loaded from PHP prefetch:', requestedRef);\r\n          result = prefetchedData;\r\n        } else {\r\n          console.warn('[RealtySoft] Prefetch data mismatch - expected:', requestedRef, 'got:', actualRef, '- fetching from API');\r\n          delete (window as any).__rsPrefetch; // Clear stale prefetch entirely\r\n          const params = isRef ? { ref_no: idOrRef } : { id: idOrRef };\r\n          result = await request<APIResponse<RawProperty[]>>('v1/property', params);\r\n        }\r\n      } else {\r\n        const params = isRef ? { ref_no: idOrRef } : { id: idOrRef };\r\n        result = await request<APIResponse<RawProperty[]>>('v1/property', params);\r\n      }\r\n    } else {\r\n      // Clear stale prefetch if ref doesn't match\r\n      if (prefetch?.property && isRef && prefetchRef !== requestedRef) {\r\n        console.log('[RealtySoft] Clearing stale prefetch - expected:', requestedRef, 'prefetch has:', prefetchRef);\r\n        delete (window as any).__rsPrefetch;\r\n      }\r\n      const params = isRef ? { ref_no: idOrRef } : { id: idOrRef };\r\n      result = await request<APIResponse<RawProperty[]>>('v1/property', params);\r\n    }\r\n\r\n    let property: Property | null = null;\r\n    if (result && result.data) {\r\n      if (Array.isArray(result.data) && result.data.length > 0) {\r\n        property = normalizeProperty(result.data[0]);\r\n      } else if (!Array.isArray(result.data)) {\r\n        property = normalizeProperty(result.data as unknown as RawProperty);\r\n      }\r\n    } else if (result && !result.data) {\r\n      property = normalizeProperty(result as unknown as RawProperty);\r\n    }\r\n\r\n    if (property) {\r\n      cacheProperty(property);\r\n      return { data: property };\r\n    }\r\n\r\n    throw new Error('Property not found');\r\n  }\r\n\r\n  /**\r\n   * Get single property details\r\n   */\r\n  async function getProperty(\r\n    id: number,\r\n    options: { forceRefresh?: boolean; skipBackgroundRefresh?: boolean } = {}\r\n  ): Promise<{ data: Property; fromCache?: boolean }> {\r\n    const cached = getCachedProperty(id);\r\n    if (cached && !options.forceRefresh) {\r\n      console.log('[RealtySoft] Property loaded from cache:', id);\r\n      if (!options.skipBackgroundRefresh) {\r\n        fetchAndCacheProperty(id, false).catch(() => {});\r\n      }\r\n      return { data: cached, fromCache: true };\r\n    }\r\n\r\n    return await fetchAndCacheProperty(id, false);\r\n  }\r\n\r\n  /**\r\n   * Get property by reference\r\n   */\r\n  async function getPropertyByRef(\r\n    ref: string,\r\n    options: { forceRefresh?: boolean; skipBackgroundRefresh?: boolean } = {}\r\n  ): Promise<{ data: Property; fromCache?: boolean }> {\r\n    const cached = getCachedProperty(ref, true);\r\n    if (cached && !options.forceRefresh) {\r\n      console.log('[RealtySoft] Property loaded from cache (ref):', ref);\r\n      if (!options.skipBackgroundRefresh) {\r\n        fetchAndCacheProperty(ref, true).catch(() => {});\r\n      }\r\n      return { data: cached, fromCache: true };\r\n    }\r\n\r\n    return await fetchAndCacheProperty(ref, true);\r\n  }\r\n\r\n  /**\r\n   * Prefetch property details\r\n   */\r\n  async function prefetchProperty(idOrRef: number | string, isRef: boolean = false): Promise<void> {\r\n    const cached = getCachedProperty(idOrRef, isRef);\r\n    if (cached) return;\r\n\r\n    try {\r\n      await fetchAndCacheProperty(idOrRef, isRef);\r\n      console.log('[RealtySoft] Prefetched property:', idOrRef);\r\n    } catch (e) {\r\n      // Silently ignore prefetch errors\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get related properties\r\n   */\r\n  async function getRelatedProperties(\r\n    propertyId: number,\r\n    limit: number = 6\r\n  ): Promise<APIResponse<Property[]>> {\r\n    const result = await request<APIResponse<RawProperty[]>>('v1/property', {\r\n      related_to: propertyId,\r\n      per_page: limit,\r\n    });\r\n\r\n    return {\r\n      ...result,\r\n      data: normalizeProperties(result.data),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Submit inquiry\r\n   */\r\n  async function submitInquiry(\r\n    data: InquiryData\r\n  ): Promise<{ success: boolean; message?: string }> {\r\n    const url =\r\n      config.inquiryEndpoint || 'https://realtysoft.ai/propertymanager/php/send-inquiry.php';\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Requested-With': 'XMLHttpRequest',\r\n      },\r\n      body: JSON.stringify(data),\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    if (!response.ok || result.success === false) {\r\n      const errorMsg = result.message || result.error || 'Failed to submit inquiry';\r\n      console.error('Inquiry error:', errorMsg);\r\n      throw new Error(errorMsg);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get wishlist properties\r\n   */\r\n  async function getWishlistProperties(ids: number[]): Promise<APIResponse<Property[]>> {\r\n    if (!ids.length) return { data: [], total: 0 };\r\n    const result = await request<APIResponse<RawProperty[]>>('v1/property', {\r\n      ids: ids.join(','),\r\n    });\r\n    return {\r\n      ...result,\r\n      data: normalizeProperties(result.data),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clear all language-dependent caches\r\n   * Used when language changes to force fresh translated data from API\r\n   */\r\n  function clearPropertyCache(): void {\r\n    const prefixes = [\r\n      'property_',\r\n      'property_ref_',\r\n      'search_',\r\n      'propertyTypes_',\r\n      'features_',\r\n      'labels_'\r\n    ];\r\n\r\n    // Clear from localStorage\r\n    try {\r\n      const keysToRemove: string[] = [];\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith(CacheManager.CACHE_PREFIX)) {\r\n          const cacheKey = key.slice(CacheManager.CACHE_PREFIX.length);\r\n          if (prefixes.some(prefix => cacheKey.startsWith(prefix))) {\r\n            keysToRemove.push(key);\r\n          }\r\n        }\r\n      }\r\n      keysToRemove.forEach(key => localStorage.removeItem(key));\r\n      console.log('[RealtySoft API] Cleared', keysToRemove.length, 'property cache entries from localStorage');\r\n    } catch (e) {\r\n      console.warn('[RealtySoft API] Error clearing property cache from localStorage:', e);\r\n    }\r\n\r\n    // Clear from in-memory LRU cache\r\n    // We need to iterate and remove matching entries\r\n    const memoryKeysToRemove: string[] = [];\r\n    memoryCache.forEach((_, key) => {\r\n      const cacheKey = key.startsWith(CacheManager.CACHE_PREFIX)\r\n        ? key.slice(CacheManager.CACHE_PREFIX.length)\r\n        : key;\r\n      if (prefixes.some(prefix => cacheKey.startsWith(prefix))) {\r\n        memoryKeysToRemove.push(key);\r\n      }\r\n    });\r\n    memoryKeysToRemove.forEach(key => memoryCache.delete(key));\r\n    console.log('[RealtySoft API] Cleared', memoryKeysToRemove.length, 'property cache entries from memory');\r\n  }\r\n\r\n  // Public API\r\n  return {\r\n    init,\r\n    request,\r\n    getLocations,\r\n    getParentLocations,\r\n    getChildLocations,\r\n    searchLocations,\r\n    getRelevantLocations,\r\n    getPropertyTypes,\r\n    getFeatures,\r\n    getLabels,\r\n    getAllLabels,\r\n    searchProperties,\r\n    getProperty,\r\n    getPropertyByRef,\r\n    getRelatedProperties,\r\n    submitInquiry,\r\n    getWishlistProperties,\r\n    prefetchProperty,\r\n    getCachedProperty,\r\n    cacheProperty,\r\n    clearCache: CacheManager.clear.bind(CacheManager),\r\n    clearPropertyCache,\r\n  };\r\n})();\r\n\r\n// Assign to window for backwards compatibility\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { RealtySoftAPI: RealtySoftAPIModule }).RealtySoftAPI = RealtySoftAPI;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoftAPI };\r\nexport default RealtySoftAPI;\r\n","/**\r\n * RealtySoft Widget v3 - Labels/i18n\r\n * Internationalization using labels from API\r\n */\r\n\r\nimport type { RealtySoftLabelsModule, LabelOverrides } from '../types/index';\r\n\r\n// Language code mapping type\r\ntype LanguageMap = Record<string, string>;\r\n\r\nconst RealtySoftLabels: RealtySoftLabelsModule = (function () {\r\n  'use strict';\r\n\r\n  // Default labels (fallback)\r\n  const defaults: Record<string, string> = {\r\n    // Search\r\n    search_location: 'Location',\r\n    search_location_placeholder: 'Search location...',\r\n    search_sublocation: 'Sub-location',\r\n    search_listing_type: 'Status',\r\n    search_listing_type_all: 'Status',\r\n    search_sale: 'ReSale',\r\n    search_rent: 'For Rent',\r\n    listing_type_sale: 'ReSale',\r\n    listing_type_new: 'New Development',\r\n    listing_type_long_rental: 'Long Term Rental',\r\n    listing_type_short_rental: 'Holiday Rental',\r\n    search_property_type: 'Property Type',\r\n    search_property_type_placeholder: 'Any property type',\r\n    search_bedrooms: 'Bedrooms',\r\n    search_bedrooms_any: 'Min Bed',\r\n    search_bedrooms_select: 'Select Bedrooms',\r\n    search_bedrooms_input: 'e.g., 3',\r\n    search_bathrooms: 'Bathrooms',\r\n    search_bathrooms_any: 'Min Bath',\r\n    search_bathrooms_select: 'Select Bathrooms',\r\n    search_bathrooms_input: 'e.g., 2',\r\n    search_price: 'Price',\r\n    search_price_min: 'Min Price',\r\n    search_price_max: 'Max Price',\r\n    search_price_select_min: 'Select Min Price',\r\n    search_price_select_max: 'Select Max Price',\r\n    search_price_input_min: 'Min (e.g., 200000)',\r\n    search_price_input_max: 'Max (e.g., 500000)',\r\n    search_built_area: 'Built Area',\r\n    search_plot_size: 'Plot Size',\r\n    search_features: 'Features',\r\n    search_features_placeholder: 'Select Features',\r\n    search_features_filter: 'Search features...',\r\n    search_reference: 'Reference',\r\n    search_button: 'Search',\r\n    search_reset: 'Reset Filters',\r\n    search_any: 'Any',\r\n    search_all: 'All',\r\n    search_min: 'Min',\r\n    search_max: 'Max',\r\n\r\n    // Results\r\n    results_count: '{count} properties found',\r\n    results_count_one: '1 property found',\r\n    results_count_zero: 'No properties found',\r\n    results_sort: 'Sort by',\r\n    results_view_grid: 'Grid',\r\n    results_view_list: 'List',\r\n    results_loading: 'Loading...',\r\n\r\n    // Sort options\r\n    sort_newest: 'Newest Listings',\r\n    sort_oldest: 'Oldest Listings',\r\n    sort_updated: 'Recently Updated',\r\n    sort_oldest_updated: 'Oldest Updated',\r\n    sort_price_asc: 'Price: Low to High',\r\n    sort_price_desc: 'Price: High to Low',\r\n    sort_featured: 'Featured First',\r\n    sort_location: 'By Location',\r\n    sort_own: 'Own Properties First',\r\n    sort_recent: 'Recently Added',\r\n    sort_name: 'Name: A-Z',\r\n\r\n    // AI Search\r\n    ai_search_title: 'AI Search',\r\n    ai_search_back: 'Back to filters',\r\n    ai_search_placeholder: 'Describe your dream property...\\ne.g., 3 bedroom villa with pool near beach under 500k',\r\n    ai_search_try: 'Try:',\r\n    ai_search_button: 'Search',\r\n    ai_search_empty: 'Please describe what you\\'re looking for',\r\n    ai_search_error: 'Could not understand your search. Please try again.',\r\n    ai_search_example_1: 'modern apartment with sea views',\r\n    ai_search_example_2: 'family villa with garden under 400k',\r\n    ai_search_example_3: '2 bedroom rental near beach',\r\n\r\n    // Property card\r\n    card_bed: 'bed',\r\n    card_beds: 'beds',\r\n    card_bath: 'bath',\r\n    card_baths: 'baths',\r\n    card_built: 'm\\u00B2',\r\n    card_plot: 'm\\u00B2',\r\n    card_view: 'View Details',\r\n    card_ref: 'Ref:',\r\n\r\n    // Property detail\r\n    detail_description: 'Description',\r\n    detail_features: 'Features',\r\n    detail_location: 'Location',\r\n    detail_sublocation: 'Sublocation',\r\n    detail_contact: 'Contact Agent',\r\n    detail_share: 'Share',\r\n    detail_back: 'Back to Results',\r\n    detail_back_to_search: 'Back to Search',\r\n    detail_related: 'Similar Properties',\r\n    detail_year_built: 'Year Built',\r\n    detail_property_type: 'Property Type',\r\n    detail_status: 'Status',\r\n    detail_reference: 'Reference',\r\n    detail_unique_ref: 'Unique Reference',\r\n    detail_postal_code: 'Postal Code',\r\n    detail_floor: 'Floor',\r\n    detail_orientation: 'Orientation',\r\n    detail_condition: 'Condition',\r\n    detail_furnished: 'Furnished',\r\n    detail_views: 'Views',\r\n    detail_parking: 'Parking',\r\n    detail_built_area: 'Built Area',\r\n    detail_plot_size: 'Plot Size',\r\n    detail_usable_area: 'Usable Area',\r\n    detail_terrace: 'Terrace',\r\n    detail_solarium: 'Solarium',\r\n    detail_garden: 'Garden',\r\n    detail_sizes: 'Property Sizes',\r\n    detail_property_info: 'Property Information',\r\n    detail_taxes_fees: 'Taxes & Fees',\r\n    detail_community_fees: 'Community Fees',\r\n    detail_ibi_tax: 'IBI Tax',\r\n    detail_basura_tax: 'Basura Tax',\r\n    detail_per_month: '/month',\r\n    detail_per_year: '/year',\r\n    detail_energy_certificate: 'Energy Certificate',\r\n    detail_energy_rating: 'Energy Rating',\r\n    detail_co2_rating: 'CO2 Rating',\r\n    detail_additional_resources: 'Additional Resources',\r\n    detail_video_tour: 'Video Tour',\r\n    detail_virtual_tour: 'Virtual Tour',\r\n    detail_download_pdf: 'Download PDF',\r\n    detail_read_more: 'Read More',\r\n    detail_read_less: 'Read Less',\r\n    detail_loading_map: 'Loading map...',\r\n    detail_price: 'Price',\r\n    detail_price_on_request: 'Price on Request',\r\n\r\n    // Wishlist\r\n    sort_by: 'Sort By',\r\n    wishlist_add: 'Add to Wishlist',\r\n    wishlist_remove: 'Remove from Wishlist',\r\n    wishlist_title: 'My Wishlist',\r\n    wishlist_shared_title: 'Shared Wishlist',\r\n    wishlist_empty: 'Your wishlist is empty',\r\n    wishlist_empty_desc: 'Start adding properties by clicking the heart icon',\r\n    wishlist_share: 'Share',\r\n    wishlist_email: 'Email',\r\n    wishlist_pdf: 'Download PDF',\r\n    wishlist_clear: 'Clear All',\r\n    wishlist_back: 'Back to Results',\r\n    wishlist_browse: 'Browse Properties',\r\n    wishlist_add_note: 'Add Note',\r\n    wishlist_compare: 'Compare',\r\n    wishlist_confirm_remove: 'Remove this property from your wishlist?',\r\n    wishlist_confirm_clear: 'Are you sure you want to clear your entire wishlist?',\r\n    wishlist_removed: 'Removed from wishlist',\r\n    wishlist_cleared: 'Wishlist cleared',\r\n    wishlist_no_share: 'No properties to share',\r\n    wishlist_loading_shared: 'Loading shared properties...',\r\n    wishlist_shared_empty: 'No properties found in shared wishlist',\r\n    wishlist_shared_desc: 'This is a read-only view of saved properties',\r\n    wishlist_error: 'Error loading wishlist',\r\n    wishlist_no_properties: 'No properties saved',\r\n    wishlist_share_title: 'Share Your Wishlist',\r\n    wishlist_share_desc: 'Share this link with anyone to show them your saved properties:',\r\n    wishlist_email_title: 'Email Your Wishlist',\r\n    wishlist_email_to: 'Send to:',\r\n    wishlist_email_from: 'Your email (optional):',\r\n    wishlist_email_message: 'Personal message (optional):',\r\n    wishlist_email_placeholder: 'Add a personal note...',\r\n    wishlist_email_send: 'Send Email',\r\n    wishlist_email_sent: 'Email sent successfully!',\r\n    wishlist_email_error: 'Failed to send email',\r\n    wishlist_note_title: 'Add Property Note',\r\n    wishlist_note_label: 'Your note:',\r\n    wishlist_note_placeholder: 'Add your thoughts, questions, or reminders...',\r\n    wishlist_compare_title: 'Compare Properties',\r\n    wishlist_compare_clear: 'Clear Selection',\r\n\r\n    // Sort options for wishlist\r\n    sort_wishlist_recent: 'Recently Added',\r\n    sort_wishlist_oldest: 'Oldest First',\r\n    sort_wishlist_name: 'Name: A-Z',\r\n\r\n    // Common\r\n    view_details: 'View Details',\r\n    no_results: 'No results found',\r\n    compare: 'Compare',\r\n    compare_max: 'Maximum',\r\n    compare_min: 'Select at least 2 properties to compare',\r\n    compare_confirm_clear: 'Clear all selected properties?',\r\n    added: 'Added',\r\n    note: 'Note',\r\n    note_saved: 'Note saved!',\r\n    note_deleted: 'Note deleted',\r\n    confirm_delete_note: 'Delete this note?',\r\n    copy: 'Copy',\r\n    copied: 'Link copied to clipboard!',\r\n    cancel: 'Cancel',\r\n    close: 'Close',\r\n    save: 'Save',\r\n    delete: 'Delete',\r\n    error: 'Error',\r\n    property: 'property',\r\n    properties: 'properties',\r\n    saved: 'saved',\r\n    feature: 'Feature',\r\n    price: 'Price',\r\n    location: 'Location',\r\n    type: 'Type',\r\n    bedrooms: 'Bedrooms',\r\n    bathrooms: 'Bathrooms',\r\n    build_size: 'Build Size',\r\n    plot_size: 'Plot Size',\r\n    status: 'Status',\r\n    featured: 'Featured',\r\n    own: 'Own',\r\n\r\n    // Inquiry form\r\n    inquiry_name: 'Your Name',\r\n    inquiry_first_name: 'First Name',\r\n    inquiry_last_name: 'Last Name',\r\n    inquiry_email: 'Your Email',\r\n    inquiry_phone: 'Your Phone',\r\n    inquiry_message: 'Message',\r\n    inquiry_submit: 'Send Inquiry',\r\n    inquiry_sending: 'Sending...',\r\n    inquiry_success: 'Thank you! Your inquiry has been sent.',\r\n    inquiry_error: 'Sorry, there was an error. Please try again.',\r\n    inquiry_privacy: 'I accept the privacy policy',\r\n    inquiry_privacy_accept: 'I accept the',\r\n    inquiry_privacy_policy: 'privacy policy',\r\n    inquiry_country: 'Country',\r\n    inquiry_default_message: 'I am interested in the property \"{title}\"{ref}. Please contact me with more information.',\r\n\r\n    // Pagination\r\n    pagination_prev: 'Previous',\r\n    pagination_next: 'Next',\r\n    pagination_page: 'Page',\r\n    pagination_of: 'of',\r\n    pagination_load_more: 'Load More',\r\n\r\n    // General\r\n    general_error: 'An error occurred',\r\n    general_retry: 'Try Again',\r\n    general_close: 'Close',\r\n    general_select: 'Select',\r\n    general_selected: 'Selected',\r\n    general_clear: 'Clear',\r\n\r\n    // Map\r\n    detail_view_larger_map: 'View Larger Map',\r\n    detail_get_directions: 'Get Directions',\r\n    map_precision_exact: 'Exact location',\r\n    map_precision_zipcode: 'Postal code area',\r\n    map_precision_area: 'Area',\r\n\r\n    // Map View (listing)\r\n    map_loading: 'Loading map...',\r\n    map_error: 'Unable to load map',\r\n    map_reset_view: 'Reset View',\r\n    map_properties_in_view: 'properties in view',\r\n    results_properties: 'properties',\r\n  };\r\n\r\n  // Language-specific defaults for labels not provided by the API\r\n  const languageDefaults: Record<string, Record<string, string>> = {\r\n    es_ES: {\r\n      // Search\r\n      search_location: 'Localidad',\r\n      search_location_placeholder: 'Buscar localidad...',\r\n      search_sublocation: 'UbicaciÃ³n',\r\n      search_listing_type: 'Estatus',\r\n      search_listing_type_all: 'Estatus',\r\n      search_sale: 'Ventas',\r\n      search_rent: 'Alquileres',\r\n      listing_type_sale: 'Ventas',\r\n      listing_type_new: 'Nuevas Promociones',\r\n      listing_type_long_rental: 'Alquileres',\r\n      listing_type_short_rental: 'Alquileres vacacionales',\r\n      search_property_type: 'Tipo de propiedad',\r\n      search_property_type_placeholder: 'Cualquier tipo',\r\n      search_bedrooms: 'Dormitorios',\r\n      search_bedrooms_any: 'Dorm. mÃ­n.',\r\n      search_bedrooms_select: 'Seleccionar dormitorios',\r\n      search_bathrooms: 'BaÃ±os',\r\n      search_bathrooms_any: 'BaÃ±os mÃ­n.',\r\n      search_bathrooms_select: 'Seleccionar baÃ±os',\r\n      search_price: 'Precio',\r\n      search_price_min: 'Precio mÃ­n.',\r\n      search_price_max: 'Precio mÃ¡x.',\r\n      search_price_select_min: 'Seleccionar precio mÃ­n.',\r\n      search_price_select_max: 'Seleccionar precio mÃ¡x.',\r\n      search_built_area: 'Superficie construida',\r\n      search_plot_size: 'Parcela',\r\n      search_features: 'CaracterÃ­sticas',\r\n      search_features_placeholder: 'Seleccionar caracterÃ­sticas',\r\n      search_features_filter: 'Buscar caracterÃ­sticas...',\r\n      search_reference: 'Referencia',\r\n      search_button: 'Buscar',\r\n      search_reset: 'Reiniciar',\r\n      search_any: 'Cualquiera',\r\n      search_all: 'Todos',\r\n      search_min: 'MÃ­n.',\r\n      search_max: 'MÃ¡x.',\r\n\r\n      // Results\r\n      results_count: '{count} propiedades encontradas',\r\n      results_count_one: '1 propiedad encontrada',\r\n      results_count_zero: 'No se encontraron propiedades',\r\n      results_sort: 'Ordenar por',\r\n      results_view_grid: 'CuadrÃ­cula',\r\n      results_view_list: 'Lista',\r\n      results_loading: 'Cargando...',\r\n\r\n      // Sort\r\n      sort_newest: 'MÃ¡s recientes',\r\n      sort_oldest: 'MÃ¡s antiguas',\r\n      sort_updated: 'ActualizaciÃ³n reciente',\r\n      sort_oldest_updated: 'ActualizaciÃ³n mÃ¡s antigua',\r\n      sort_price_asc: 'Precio: menor a mayor',\r\n      sort_price_desc: 'Precio: mayor a menor',\r\n      sort_featured: 'Destacados primero',\r\n      sort_location: 'Por ubicaciÃ³n',\r\n      sort_own: 'Propiedades propias primero',\r\n      sort_by: 'Ordenar por',\r\n      sort_recent: 'AÃ±adidos recientemente',\r\n      sort_name: 'Nombre: A-Z',\r\n\r\n      // AI Search\r\n      ai_search_title: 'BÃºsqueda IA',\r\n      ai_search_back: 'Volver a filtros',\r\n      ai_search_placeholder: 'Describe tu propiedad ideal...\\nej., villa de 3 dormitorios con piscina cerca de la playa menos de 500k',\r\n      ai_search_try: 'Prueba:',\r\n      ai_search_button: 'Buscar',\r\n      ai_search_empty: 'Por favor describe lo que buscas',\r\n      ai_search_error: 'No pudimos entender tu bÃºsqueda. IntÃ©ntalo de nuevo.',\r\n      ai_search_example_1: 'apartamento moderno con vistas al mar',\r\n      ai_search_example_2: 'villa familiar con jardÃ­n menos de 400k',\r\n      ai_search_example_3: 'alquiler de 2 dormitorios cerca de la playa',\r\n\r\n      // Card\r\n      card_bed: 'dorm.',\r\n      card_beds: 'dorm.',\r\n      card_bath: 'baÃ±o',\r\n      card_baths: 'baÃ±os',\r\n      card_view: 'Ver detalles',\r\n      card_ref: 'Ref:',\r\n\r\n      // Detail\r\n      detail_description: 'DescripciÃ³n',\r\n      detail_features: 'CaracterÃ­sticas',\r\n      detail_location: 'UbicaciÃ³n',\r\n      detail_contact: 'Contactar agente',\r\n      detail_share: 'Compartir',\r\n      detail_back: 'Volver a resultados',\r\n      detail_back_to_search: 'Volver a bÃºsqueda',\r\n      detail_related: 'Propiedades similares',\r\n      detail_year_built: 'AÃ±o de construcciÃ³n',\r\n      detail_property_type: 'Tipo de propiedad',\r\n      detail_status: 'Estatus',\r\n      detail_reference: 'Referencia',\r\n      detail_unique_ref: 'Referencia Ãºnica',\r\n      detail_floor: 'Planta',\r\n      detail_orientation: 'OrientaciÃ³n',\r\n      detail_condition: 'CondiciÃ³n',\r\n      detail_furnished: 'Amueblado',\r\n      detail_views: 'Vistas',\r\n      detail_parking: 'Aparcamiento',\r\n      detail_built_area: 'Superficie construida',\r\n      detail_plot_size: 'Parcela',\r\n      detail_usable_area: 'Superficie Ãºtil',\r\n      detail_terrace: 'Terraza',\r\n      detail_sizes: 'Medidas de la propiedad',\r\n      detail_property_info: 'InformaciÃ³n de la propiedad',\r\n      detail_taxes_fees: 'Impuestos y tasas',\r\n      detail_community_fees: 'Cuota de comunidad',\r\n      detail_ibi_tax: 'IBI',\r\n      detail_basura_tax: 'Basura',\r\n      detail_per_month: '/mes',\r\n      detail_per_year: '/aÃ±o',\r\n      detail_energy_certificate: 'Certificado energÃ©tico',\r\n      detail_energy_rating: 'CalificaciÃ³n energÃ©tica',\r\n      detail_co2_rating: 'CalificaciÃ³n CO2',\r\n      detail_video_tour: 'VÃ­deo tour',\r\n      detail_virtual_tour: 'Tour virtual',\r\n      detail_download_pdf: 'Descargar PDF',\r\n      detail_loading_map: 'Cargando mapa...',\r\n      detail_read_more: 'Leer mÃ¡s',\r\n      detail_read_less: 'Leer menos',\r\n      detail_price_on_request: 'Precio bajo demanda',\r\n      detail_view_larger_map: 'Ver mapa mÃ¡s grande',\r\n      detail_get_directions: 'CÃ³mo llegar',\r\n\r\n      // Wishlist\r\n      wishlist_add: 'AÃ±adir a favoritos',\r\n      wishlist_remove: 'Eliminar de favoritos',\r\n      wishlist_title: 'Mi lista de deseos',\r\n      wishlist_empty: 'Tu lista de deseos estÃ¡ vacÃ­a',\r\n      wishlist_empty_desc: 'AÃ±ade propiedades haciendo clic en el icono de corazÃ³n',\r\n      wishlist_share: 'Compartir',\r\n      wishlist_email: 'Email',\r\n      wishlist_pdf: 'Descargar PDF',\r\n      wishlist_clear: 'Borrar todo',\r\n      wishlist_back: 'Volver a resultados',\r\n      wishlist_browse: 'Ver propiedades',\r\n      wishlist_compare: 'Comparar',\r\n      wishlist_confirm_clear: 'Â¿EstÃ¡s seguro de que quieres borrar toda tu lista de deseos?',\r\n      wishlist_removed: 'Eliminado de favoritos',\r\n      wishlist_cleared: 'Lista de deseos borrada',\r\n      wishlist_share_title: 'Compartir tu lista',\r\n      wishlist_share_desc: 'Comparte este enlace con cualquiera para mostrarle tus propiedades guardadas:',\r\n      wishlist_email_title: 'Enviar lista por email',\r\n      wishlist_email_to: 'Enviar a:',\r\n      wishlist_email_from: 'Tu email (opcional):',\r\n      wishlist_email_message: 'Mensaje personal (opcional):',\r\n      wishlist_email_placeholder: 'AÃ±ade una nota personal...',\r\n      wishlist_email_send: 'Enviar email',\r\n      wishlist_email_sent: 'Â¡Email enviado con Ã©xito!',\r\n      wishlist_email_error: 'Error al enviar el email',\r\n      wishlist_note_title: 'AÃ±adir nota a propiedad',\r\n      wishlist_note_label: 'Tu nota:',\r\n      wishlist_note_placeholder: 'AÃ±ade tus pensamientos, preguntas o recordatorios...',\r\n      wishlist_compare_title: 'Comparar propiedades',\r\n      wishlist_compare_clear: 'Limpiar selecciÃ³n',\r\n      note_saved: 'Â¡Nota guardada!',\r\n      note_deleted: 'Nota eliminada',\r\n      confirm_delete_note: 'Â¿Eliminar esta nota?',\r\n      compare_min: 'Selecciona al menos 2 propiedades para comparar',\r\n      compare_confirm_clear: 'Â¿Limpiar todas las propiedades seleccionadas?',\r\n      copied: 'Â¡Enlace copiado al portapapeles!',\r\n\r\n      // Inquiry\r\n      inquiry_name: 'Su nombre',\r\n      inquiry_first_name: 'Nombre',\r\n      inquiry_last_name: 'Apellidos',\r\n      inquiry_email: 'Su email',\r\n      inquiry_phone: 'Su telÃ©fono',\r\n      inquiry_message: 'Mensaje',\r\n      inquiry_submit: 'Enviar consulta',\r\n      inquiry_sending: 'Enviando...',\r\n      inquiry_success: 'Â¡Gracias! Su consulta ha sido enviada.',\r\n      inquiry_error: 'Lo sentimos, ha ocurrido un error. IntÃ©ntelo de nuevo.',\r\n      inquiry_privacy_accept: 'Acepto la',\r\n      inquiry_privacy_policy: 'polÃ­tica de privacidad',\r\n      inquiry_country: 'PaÃ­s',\r\n      inquiry_default_message: 'Estoy interesado/a en la propiedad \"{title}\"{ref}. Por favor, contacten conmigo para mÃ¡s informaciÃ³n.',\r\n\r\n      // Pagination\r\n      pagination_prev: 'Anterior',\r\n      pagination_next: 'Siguiente',\r\n      pagination_page: 'PÃ¡gina',\r\n      pagination_of: 'de',\r\n      pagination_load_more: 'Cargar mÃ¡s',\r\n\r\n      // General\r\n      general_error: 'Ha ocurrido un error',\r\n      general_retry: 'Reintentar',\r\n      general_close: 'Cerrar',\r\n      general_select: 'Seleccionar',\r\n      general_selected: 'Seleccionado',\r\n      general_clear: 'Limpiar',\r\n      view_details: 'Ver detalles',\r\n      no_results: 'No se encontraron resultados',\r\n      compare: 'Comparar',\r\n      cancel: 'Cancelar',\r\n      close: 'Cerrar',\r\n      save: 'Guardar',\r\n      delete: 'Eliminar',\r\n      error: 'Error',\r\n      property: 'propiedad',\r\n      properties: 'propiedades',\r\n      featured: 'Destacado',\r\n      own: 'Exclusiva',\r\n      price: 'Precio',\r\n      location: 'UbicaciÃ³n',\r\n      type: 'Tipo',\r\n      bedrooms: 'Dormitorios',\r\n      bathrooms: 'BaÃ±os',\r\n      build_size: 'Construido',\r\n      plot_size: 'Parcela',\r\n      status: 'Estatus',\r\n\r\n      // Map\r\n      map_precision_exact: 'UbicaciÃ³n exacta',\r\n      map_precision_zipcode: 'CÃ³digo postal',\r\n      map_precision_area: 'Zona',\r\n      map_loading: 'Cargando mapa...',\r\n      map_error: 'No se puede cargar el mapa',\r\n      map_reset_view: 'Restablecer vista',\r\n      map_properties_in_view: 'propiedades a la vista',\r\n      results_properties: 'propiedades',\r\n    },\r\n    de_DE: {\r\n      search_location: 'Standort',\r\n      search_location_placeholder: 'Standort suchen...',\r\n      search_property_type: 'Immobilientyp',\r\n      search_bedrooms: 'Schlafzimmer',\r\n      search_bedrooms_any: 'Min. Schlafz.',\r\n      search_bathrooms: 'Badezimmer',\r\n      search_bathrooms_any: 'Min. BÃ¤der',\r\n      search_price: 'Preis',\r\n      search_price_min: 'Min. Preis',\r\n      search_price_max: 'Max. Preis',\r\n      search_button: 'Suchen',\r\n      search_reset: 'ZurÃ¼cksetzen',\r\n      search_features: 'Merkmale',\r\n      search_features_placeholder: 'Merkmale auswÃ¤hlen',\r\n      results_count: '{count} Immobilien gefunden',\r\n      results_count_one: '1 Immobilie gefunden',\r\n      results_count_zero: 'Keine Immobilien gefunden',\r\n      results_sort: 'Sortieren nach',\r\n      results_loading: 'Laden...',\r\n      // Sort\r\n      sort_newest: 'Neueste',\r\n      sort_oldest: 'Ã„lteste',\r\n      sort_updated: 'KÃ¼rzlich aktualisiert',\r\n      sort_oldest_updated: 'Ã„lteste aktualisiert',\r\n      sort_price_asc: 'Preis: aufsteigend',\r\n      sort_price_desc: 'Preis: absteigend',\r\n      sort_featured: 'Empfohlen zuerst',\r\n      sort_location: 'Nach Standort',\r\n      sort_own: 'Eigene Immobilien zuerst',\r\n      sort_by: 'Sortieren nach',\r\n      sort_recent: 'KÃ¼rzlich hinzugefÃ¼gt',\r\n      sort_name: 'Name: A-Z',\r\n\r\n      // AI Search\r\n      ai_search_title: 'KI-Suche',\r\n      ai_search_back: 'ZurÃ¼ck zu Filtern',\r\n      ai_search_placeholder: 'Beschreiben Sie Ihre Traumimmobilie...\\nz.B., 3-Zimmer-Villa mit Pool in StrandnÃ¤he unter 500k',\r\n      ai_search_try: 'Versuchen Sie:',\r\n      ai_search_button: 'Suchen',\r\n      ai_search_empty: 'Bitte beschreiben Sie, wonach Sie suchen',\r\n      ai_search_error: 'Ihre Suche konnte nicht verstanden werden. Bitte versuchen Sie es erneut.',\r\n      ai_search_example_1: 'moderne Wohnung mit Meerblick',\r\n      ai_search_example_2: 'Familienvilla mit Garten unter 400k',\r\n      ai_search_example_3: '2-Zimmer-Mietwohnung in StrandnÃ¤he',\r\n\r\n      view_details: 'Details anzeigen',\r\n      card_view: 'Details anzeigen',\r\n      detail_description: 'Beschreibung',\r\n      detail_features: 'Merkmale',\r\n      detail_contact: 'Agent kontaktieren',\r\n      detail_location: 'Standort',\r\n      detail_related: 'Ã„hnliche Immobilien',\r\n      detail_read_more: 'Mehr lesen',\r\n      detail_read_less: 'Weniger lesen',\r\n      detail_loading_map: 'Karte wird geladen...',\r\n      detail_view_larger_map: 'GrÃ¶ÃŸere Karte anzeigen',\r\n      detail_get_directions: 'Wegbeschreibung',\r\n      wishlist_add: 'Zur Merkliste hinzufÃ¼gen',\r\n      wishlist_remove: 'Von Merkliste entfernen',\r\n      wishlist_title: 'Meine Merkliste',\r\n      wishlist_empty: 'Ihre Merkliste ist leer',\r\n      wishlist_share: 'Teilen',\r\n      wishlist_email: 'E-Mail',\r\n      wishlist_pdf: 'PDF herunterladen',\r\n      wishlist_clear: 'Alles lÃ¶schen',\r\n      wishlist_compare: 'Vergleichen',\r\n      wishlist_share_title: 'Merkliste teilen',\r\n      wishlist_share_desc: 'Teilen Sie diesen Link, um Ihre gespeicherten Immobilien zu zeigen:',\r\n      wishlist_email_title: 'Merkliste per E-Mail senden',\r\n      wishlist_email_to: 'Senden an:',\r\n      wishlist_email_from: 'Ihre E-Mail (optional):',\r\n      wishlist_email_message: 'PersÃ¶nliche Nachricht (optional):',\r\n      wishlist_email_placeholder: 'FÃ¼gen Sie eine persÃ¶nliche Notiz hinzu...',\r\n      wishlist_email_send: 'E-Mail senden',\r\n      wishlist_email_sent: 'E-Mail erfolgreich gesendet!',\r\n      wishlist_email_error: 'E-Mail konnte nicht gesendet werden',\r\n      wishlist_note_title: 'Notiz hinzufÃ¼gen',\r\n      wishlist_note_label: 'Ihre Notiz:',\r\n      wishlist_note_placeholder: 'FÃ¼gen Sie Ihre Gedanken, Fragen oder Erinnerungen hinzu...',\r\n      wishlist_compare_title: 'Immobilien vergleichen',\r\n      wishlist_compare_clear: 'Auswahl lÃ¶schen',\r\n      note_saved: 'Notiz gespeichert!',\r\n      note_deleted: 'Notiz gelÃ¶scht',\r\n      confirm_delete_note: 'Diese Notiz lÃ¶schen?',\r\n      compare_min: 'WÃ¤hlen Sie mindestens 2 Immobilien zum Vergleichen',\r\n      compare_confirm_clear: 'Alle ausgewÃ¤hlten Immobilien lÃ¶schen?',\r\n      copied: 'Link in die Zwischenablage kopiert!',\r\n      pagination_prev: 'ZurÃ¼ck',\r\n      pagination_next: 'Weiter',\r\n      general_close: 'SchlieÃŸen',\r\n      general_clear: 'LÃ¶schen',\r\n      cancel: 'Abbrechen',\r\n      close: 'SchlieÃŸen',\r\n      save: 'Speichern',\r\n      no_results: 'Keine Ergebnisse gefunden',\r\n      inquiry_default_message: 'Ich interessiere mich fÃ¼r die Immobilie \"{title}\"{ref}. Bitte kontaktieren Sie mich fÃ¼r weitere Informationen.',\r\n      map_loading: 'Karte wird geladen...',\r\n      map_error: 'Karte kann nicht geladen werden',\r\n      map_reset_view: 'Ansicht zurÃ¼cksetzen',\r\n      map_properties_in_view: 'Immobilien in Ansicht',\r\n      results_properties: 'Immobilien',\r\n    },\r\n    fr_FR: {\r\n      search_location: 'Emplacement',\r\n      search_location_placeholder: 'Rechercher un lieu...',\r\n      search_property_type: 'Type de propriÃ©tÃ©',\r\n      search_bedrooms: 'Chambres',\r\n      search_bedrooms_any: 'Chambres min.',\r\n      search_bathrooms: 'Salles de bain',\r\n      search_bathrooms_any: 'SdB min.',\r\n      search_price: 'Prix',\r\n      search_price_min: 'Prix min.',\r\n      search_price_max: 'Prix max.',\r\n      search_button: 'Rechercher',\r\n      search_reset: 'RÃ©initialiser',\r\n      search_features: 'CaractÃ©ristiques',\r\n      search_features_placeholder: 'SÃ©lectionner les caractÃ©ristiques',\r\n      results_count: '{count} propriÃ©tÃ©s trouvÃ©es',\r\n      results_count_one: '1 propriÃ©tÃ© trouvÃ©e',\r\n      results_count_zero: 'Aucune propriÃ©tÃ© trouvÃ©e',\r\n      results_sort: 'Trier par',\r\n      results_loading: 'Chargement...',\r\n      // Sort\r\n      sort_newest: 'Plus rÃ©centes',\r\n      sort_oldest: 'Plus anciennes',\r\n      sort_updated: 'RÃ©cemment mis Ã  jour',\r\n      sort_oldest_updated: 'Anciennes mises Ã  jour',\r\n      sort_price_asc: 'Prix: croissant',\r\n      sort_price_desc: 'Prix: dÃ©croissant',\r\n      sort_featured: 'En vedette d\\'abord',\r\n      sort_location: 'Par emplacement',\r\n      sort_own: 'Nos propriÃ©tÃ©s d\\'abord',\r\n      sort_by: 'Trier par',\r\n      sort_recent: 'AjoutÃ©s rÃ©cemment',\r\n      sort_name: 'Nom: A-Z',\r\n\r\n      // AI Search\r\n      ai_search_title: 'Recherche IA',\r\n      ai_search_back: 'Retour aux filtres',\r\n      ai_search_placeholder: 'DÃ©crivez votre propriÃ©tÃ© idÃ©ale...\\nex., villa 3 chambres avec piscine prÃ¨s de la plage moins de 500k',\r\n      ai_search_try: 'Essayez:',\r\n      ai_search_button: 'Rechercher',\r\n      ai_search_empty: 'Veuillez dÃ©crire ce que vous recherchez',\r\n      ai_search_error: 'Impossible de comprendre votre recherche. Veuillez rÃ©essayer.',\r\n      ai_search_example_1: 'appartement moderne avec vue mer',\r\n      ai_search_example_2: 'villa familiale avec jardin moins de 400k',\r\n      ai_search_example_3: 'location 2 chambres prÃ¨s de la plage',\r\n\r\n      view_details: 'Voir les dÃ©tails',\r\n      card_view: 'Voir les dÃ©tails',\r\n      detail_description: 'Description',\r\n      detail_features: 'CaractÃ©ristiques',\r\n      detail_contact: 'Contacter l\\'agent',\r\n      detail_location: 'Emplacement',\r\n      detail_related: 'PropriÃ©tÃ©s similaires',\r\n      detail_read_more: 'Lire la suite',\r\n      detail_read_less: 'RÃ©duire',\r\n      detail_loading_map: 'Chargement de la carte...',\r\n      detail_view_larger_map: 'Voir carte agrandie',\r\n      detail_get_directions: 'ItinÃ©raire',\r\n      wishlist_add: 'Ajouter aux favoris',\r\n      wishlist_remove: 'Retirer des favoris',\r\n      wishlist_title: 'Ma liste de souhaits',\r\n      wishlist_empty: 'Votre liste de souhaits est vide',\r\n      wishlist_share: 'Partager',\r\n      wishlist_email: 'E-mail',\r\n      wishlist_pdf: 'TÃ©lÃ©charger PDF',\r\n      wishlist_clear: 'Tout effacer',\r\n      wishlist_compare: 'Comparer',\r\n      wishlist_share_title: 'Partager votre liste',\r\n      wishlist_share_desc: 'Partagez ce lien pour montrer vos propriÃ©tÃ©s enregistrÃ©es:',\r\n      wishlist_email_title: 'Envoyer la liste par e-mail',\r\n      wishlist_email_to: 'Envoyer Ã :',\r\n      wishlist_email_from: 'Votre e-mail (optionnel):',\r\n      wishlist_email_message: 'Message personnel (optionnel):',\r\n      wishlist_email_placeholder: 'Ajoutez une note personnelle...',\r\n      wishlist_email_send: 'Envoyer l\\'e-mail',\r\n      wishlist_email_sent: 'E-mail envoyÃ© avec succÃ¨s!',\r\n      wishlist_email_error: 'Impossible d\\'envoyer l\\'e-mail',\r\n      wishlist_note_title: 'Ajouter une note',\r\n      wishlist_note_label: 'Votre note:',\r\n      wishlist_note_placeholder: 'Ajoutez vos pensÃ©es, questions ou rappels...',\r\n      wishlist_compare_title: 'Comparer les propriÃ©tÃ©s',\r\n      wishlist_compare_clear: 'Effacer la sÃ©lection',\r\n      note_saved: 'Note enregistrÃ©e!',\r\n      note_deleted: 'Note supprimÃ©e',\r\n      confirm_delete_note: 'Supprimer cette note?',\r\n      compare_min: 'SÃ©lectionnez au moins 2 propriÃ©tÃ©s Ã  comparer',\r\n      compare_confirm_clear: 'Effacer toutes les propriÃ©tÃ©s sÃ©lectionnÃ©es?',\r\n      copied: 'Lien copiÃ© dans le presse-papiers!',\r\n      pagination_prev: 'PrÃ©cÃ©dent',\r\n      pagination_next: 'Suivant',\r\n      general_close: 'Fermer',\r\n      general_clear: 'Effacer',\r\n      cancel: 'Annuler',\r\n      close: 'Fermer',\r\n      save: 'Enregistrer',\r\n      no_results: 'Aucun rÃ©sultat trouvÃ©',\r\n      inquiry_default_message: 'Je suis intÃ©ressÃ©(e) par la propriÃ©tÃ© \"{title}\"{ref}. Veuillez me contacter pour plus d\\'informations.',\r\n      map_loading: 'Chargement de la carte...',\r\n      map_error: 'Impossible de charger la carte',\r\n      map_reset_view: 'RÃ©initialiser la vue',\r\n      map_properties_in_view: 'propriÃ©tÃ©s visibles',\r\n      results_properties: 'propriÃ©tÃ©s',\r\n    },\r\n    nl_NL: {\r\n      // Search\r\n      search_location: 'Locatie',\r\n      search_location_placeholder: 'Zoek locatie...',\r\n      search_sublocation: 'Sublocatie',\r\n      search_listing_type: 'Status',\r\n      search_listing_type_all: 'Status',\r\n      search_sale: 'Verkoop',\r\n      search_rent: 'Huur',\r\n      listing_type_sale: 'Verkoop',\r\n      listing_type_new: 'Nieuwbouw',\r\n      listing_type_long_rental: 'Langetermijnhuur',\r\n      listing_type_short_rental: 'Vakantieverhuur',\r\n      search_property_type: 'Type woning',\r\n      search_property_type_placeholder: 'Elk type',\r\n      search_bedrooms: 'Slaapkamers',\r\n      search_bedrooms_any: 'Min. slaapk.',\r\n      search_bedrooms_select: 'Slaapkamers selecteren',\r\n      search_bathrooms: 'Badkamers',\r\n      search_bathrooms_any: 'Min. badk.',\r\n      search_bathrooms_select: 'Badkamers selecteren',\r\n      search_price: 'Prijs',\r\n      search_price_min: 'Min. prijs',\r\n      search_price_max: 'Max. prijs',\r\n      search_price_select_min: 'Min. prijs selecteren',\r\n      search_price_select_max: 'Max. prijs selecteren',\r\n      search_built_area: 'Bebouwde oppervlakte',\r\n      search_plot_size: 'Perceelgrootte',\r\n      search_features: 'Kenmerken',\r\n      search_features_placeholder: 'Kenmerken selecteren',\r\n      search_features_filter: 'Kenmerken zoeken...',\r\n      search_reference: 'Referentie',\r\n      search_button: 'Zoeken',\r\n      search_reset: 'Opnieuw instellen',\r\n      search_any: 'Alle',\r\n      search_all: 'Alle',\r\n      search_min: 'Min.',\r\n      search_max: 'Max.',\r\n\r\n      // Results\r\n      results_count: '{count} woningen gevonden',\r\n      results_count_one: '1 woning gevonden',\r\n      results_count_zero: 'Geen woningen gevonden',\r\n      results_sort: 'Sorteren op',\r\n      results_view_grid: 'Raster',\r\n      results_view_list: 'Lijst',\r\n      results_loading: 'Laden...',\r\n\r\n      // Sort\r\n      sort_newest: 'Nieuwste',\r\n      sort_oldest: 'Oudste',\r\n      sort_updated: 'Recent bijgewerkt',\r\n      sort_oldest_updated: 'Oudste bijgewerkt',\r\n      sort_price_asc: 'Prijs: laag naar hoog',\r\n      sort_price_desc: 'Prijs: hoog naar laag',\r\n      sort_featured: 'Uitgelicht eerst',\r\n      sort_location: 'Op locatie',\r\n      sort_own: 'Eigen woningen eerst',\r\n      sort_by: 'Sorteren op',\r\n      sort_recent: 'Recent toegevoegd',\r\n      sort_name: 'Naam: A-Z',\r\n\r\n      // AI Search\r\n      ai_search_title: 'AI Zoeken',\r\n      ai_search_back: 'Terug naar filters',\r\n      ai_search_placeholder: 'Beschrijf je droomwoning...\\nbijv., villa met 3 slaapkamers en zwembad nabij strand onder 500k',\r\n      ai_search_try: 'Probeer:',\r\n      ai_search_button: 'Zoeken',\r\n      ai_search_empty: 'Beschrijf wat je zoekt',\r\n      ai_search_error: 'Kon je zoekopdracht niet begrijpen. Probeer het opnieuw.',\r\n      ai_search_example_1: 'modern appartement met zeezicht',\r\n      ai_search_example_2: 'familievilla met tuin onder 400k',\r\n      ai_search_example_3: '2 slaapkamer huurwoning nabij strand',\r\n\r\n      // Card\r\n      card_bed: 'slaapk.',\r\n      card_beds: 'slaapk.',\r\n      card_bath: 'badk.',\r\n      card_baths: 'badk.',\r\n      card_view: 'Details bekijken',\r\n      card_ref: 'Ref:',\r\n\r\n      // Detail\r\n      detail_description: 'Beschrijving',\r\n      detail_features: 'Kenmerken',\r\n      detail_location: 'Locatie',\r\n      detail_contact: 'Contact makelaar',\r\n      detail_share: 'Delen',\r\n      detail_back: 'Terug naar resultaten',\r\n      detail_back_to_search: 'Terug naar zoeken',\r\n      detail_related: 'Vergelijkbare woningen',\r\n      detail_year_built: 'Bouwjaar',\r\n      detail_property_type: 'Type woning',\r\n      detail_status: 'Status',\r\n      detail_reference: 'Referentie',\r\n      detail_unique_ref: 'Unieke referentie',\r\n      detail_floor: 'Verdieping',\r\n      detail_orientation: 'OriÃ«ntatie',\r\n      detail_condition: 'Staat',\r\n      detail_furnished: 'Gemeubileerd',\r\n      detail_views: 'Uitzicht',\r\n      detail_parking: 'Parkeren',\r\n      detail_built_area: 'Bebouwde oppervlakte',\r\n      detail_plot_size: 'Perceelgrootte',\r\n      detail_usable_area: 'Bruikbare oppervlakte',\r\n      detail_terrace: 'Terras',\r\n      detail_sizes: 'Afmetingen',\r\n      detail_property_info: 'Woninginformatie',\r\n      detail_taxes_fees: 'Belastingen & kosten',\r\n      detail_community_fees: 'Servicekosten',\r\n      detail_ibi_tax: 'IBI belasting',\r\n      detail_basura_tax: 'Afvalbelasting',\r\n      detail_per_month: '/maand',\r\n      detail_per_year: '/jaar',\r\n      detail_energy_certificate: 'Energiecertificaat',\r\n      detail_energy_rating: 'Energielabel',\r\n      detail_co2_rating: 'CO2 classificatie',\r\n      detail_video_tour: 'Video tour',\r\n      detail_virtual_tour: 'Virtuele tour',\r\n      detail_download_pdf: 'PDF downloaden',\r\n      detail_loading_map: 'Kaart laden...',\r\n      detail_read_more: 'Lees meer',\r\n      detail_read_less: 'Lees minder',\r\n      detail_price_on_request: 'Prijs op aanvraag',\r\n      detail_view_larger_map: 'Grotere kaart bekijken',\r\n      detail_get_directions: 'Routebeschrijving',\r\n\r\n      // Wishlist\r\n      wishlist_add: 'Toevoegen aan favorieten',\r\n      wishlist_remove: 'Verwijderen uit favorieten',\r\n      wishlist_title: 'Mijn verlanglijst',\r\n      wishlist_empty: 'Je verlanglijst is leeg',\r\n      wishlist_empty_desc: 'Voeg woningen toe door op het hartje te klikken',\r\n      wishlist_share: 'Delen',\r\n      wishlist_email: 'E-mail',\r\n      wishlist_pdf: 'PDF downloaden',\r\n      wishlist_clear: 'Alles wissen',\r\n      wishlist_back: 'Terug naar resultaten',\r\n      wishlist_browse: 'Woningen bekijken',\r\n      wishlist_compare: 'Vergelijken',\r\n      wishlist_confirm_clear: 'Weet je zeker dat je je hele verlanglijst wilt wissen?',\r\n      wishlist_removed: 'Verwijderd uit favorieten',\r\n      wishlist_cleared: 'Verlanglijst gewist',\r\n      wishlist_share_title: 'Deel je verlanglijst',\r\n      wishlist_share_desc: 'Deel deze link met iedereen om je opgeslagen woningen te tonen:',\r\n      wishlist_email_title: 'E-mail je verlanglijst',\r\n      wishlist_email_to: 'Verzenden naar:',\r\n      wishlist_email_from: 'Je e-mail (optioneel):',\r\n      wishlist_email_message: 'Persoonlijk bericht (optioneel):',\r\n      wishlist_email_placeholder: 'Voeg een persoonlijke notitie toe...',\r\n      wishlist_email_send: 'E-mail verzenden',\r\n      wishlist_email_sent: 'E-mail succesvol verzonden!',\r\n      wishlist_email_error: 'Kan e-mail niet verzenden',\r\n      wishlist_note_title: 'Notitie toevoegen',\r\n      wishlist_note_label: 'Je notitie:',\r\n      wishlist_note_placeholder: 'Voeg je gedachten, vragen of herinneringen toe...',\r\n      wishlist_compare_title: 'Woningen vergelijken',\r\n      wishlist_compare_clear: 'Selectie wissen',\r\n      note_saved: 'Notitie opgeslagen!',\r\n      note_deleted: 'Notitie verwijderd',\r\n      confirm_delete_note: 'Deze notitie verwijderen?',\r\n      compare_min: 'Selecteer minimaal 2 woningen om te vergelijken',\r\n      compare_confirm_clear: 'Alle geselecteerde woningen wissen?',\r\n      copied: 'Link gekopieerd naar klembord!',\r\n\r\n      // Inquiry\r\n      inquiry_name: 'Uw naam',\r\n      inquiry_first_name: 'Voornaam',\r\n      inquiry_last_name: 'Achternaam',\r\n      inquiry_email: 'Uw e-mail',\r\n      inquiry_phone: 'Uw telefoon',\r\n      inquiry_message: 'Bericht',\r\n      inquiry_submit: 'Aanvraag versturen',\r\n      inquiry_sending: 'Verzenden...',\r\n      inquiry_success: 'Bedankt! Uw aanvraag is verstuurd.',\r\n      inquiry_error: 'Er is een fout opgetreden. Probeer het opnieuw.',\r\n      inquiry_privacy_accept: 'Ik accepteer het',\r\n      inquiry_privacy_policy: 'privacybeleid',\r\n      inquiry_country: 'Land',\r\n      inquiry_default_message: 'Ik ben geÃ¯nteresseerd in de woning \"{title}\"{ref}. Neem alstublieft contact met mij op voor meer informatie.',\r\n\r\n      // Pagination\r\n      pagination_prev: 'Vorige',\r\n      pagination_next: 'Volgende',\r\n      pagination_page: 'Pagina',\r\n      pagination_of: 'van',\r\n      pagination_load_more: 'Meer laden',\r\n\r\n      // General\r\n      general_error: 'Er is een fout opgetreden',\r\n      general_retry: 'Opnieuw proberen',\r\n      general_close: 'Sluiten',\r\n      general_select: 'Selecteren',\r\n      general_selected: 'Geselecteerd',\r\n      general_clear: 'Wissen',\r\n      view_details: 'Details bekijken',\r\n      no_results: 'Geen resultaten gevonden',\r\n      compare: 'Vergelijken',\r\n      cancel: 'Annuleren',\r\n      close: 'Sluiten',\r\n      save: 'Opslaan',\r\n      delete: 'Verwijderen',\r\n      error: 'Fout',\r\n      property: 'woning',\r\n      properties: 'woningen',\r\n      featured: 'Uitgelicht',\r\n      own: 'Eigen',\r\n      price: 'Prijs',\r\n      location: 'Locatie',\r\n      type: 'Type',\r\n      bedrooms: 'Slaapkamers',\r\n      bathrooms: 'Badkamers',\r\n      build_size: 'Bebouwd',\r\n      plot_size: 'Perceel',\r\n      status: 'Status',\r\n\r\n      // Map\r\n      map_precision_exact: 'Exacte locatie',\r\n      map_precision_zipcode: 'Postcodegebied',\r\n      map_precision_area: 'Gebied',\r\n      map_loading: 'Kaart laden...',\r\n      map_error: 'Kan kaart niet laden',\r\n      map_reset_view: 'Weergave resetten',\r\n      map_properties_in_view: 'woningen in beeld',\r\n      results_properties: 'woningen',\r\n    },\r\n    pl_PL: {\r\n      // Search\r\n      search_location: 'Lokalizacja',\r\n      search_location_placeholder: 'Szukaj lokalizacji...',\r\n      search_sublocation: 'Podlokalizacja',\r\n      search_listing_type: 'Status',\r\n      search_listing_type_all: 'Status',\r\n      search_sale: 'Sprzeda\\u017c',\r\n      search_rent: 'Wynajem',\r\n      listing_type_sale: 'Sprzeda\\u017c',\r\n      listing_type_new: 'Nowe inwestycje',\r\n      listing_type_long_rental: 'Wynajem d\\u0142ugoterminowy',\r\n      listing_type_short_rental: 'Wynajem wakacyjny',\r\n      search_property_type: 'Typ nieruchomo\\u015bci',\r\n      search_property_type_placeholder: 'Dowolny typ',\r\n      search_bedrooms: 'Sypialnie',\r\n      search_bedrooms_any: 'Min. syp.',\r\n      search_bedrooms_select: 'Wybierz sypialnie',\r\n      search_bathrooms: '\\u0141azienki',\r\n      search_bathrooms_any: 'Min. \\u0142az.',\r\n      search_bathrooms_select: 'Wybierz \\u0142azienki',\r\n      search_price: 'Cena',\r\n      search_price_min: 'Cena min.',\r\n      search_price_max: 'Cena maks.',\r\n      search_price_select_min: 'Wybierz cen\\u0119 min.',\r\n      search_price_select_max: 'Wybierz cen\\u0119 maks.',\r\n      search_built_area: 'Powierzchnia zabudowy',\r\n      search_plot_size: 'Powierzchnia dzia\\u0142ki',\r\n      search_features: 'Cechy',\r\n      search_features_placeholder: 'Wybierz cechy',\r\n      search_features_filter: 'Szukaj cech...',\r\n      search_reference: 'Referencja',\r\n      search_button: 'Szukaj',\r\n      search_reset: 'Resetuj',\r\n      search_any: 'Dowolny',\r\n      search_all: 'Wszystkie',\r\n      search_min: 'Min.',\r\n      search_max: 'Maks.',\r\n\r\n      // Results\r\n      results_count: 'Znaleziono {count} nieruchomo\\u015bci',\r\n      results_count_one: 'Znaleziono 1 nieruchomo\\u015b\\u0107',\r\n      results_count_zero: 'Nie znaleziono nieruchomo\\u015bci',\r\n      results_sort: 'Sortuj wed\\u0142ug',\r\n      results_view_grid: 'Siatka',\r\n      results_view_list: 'Lista',\r\n      results_loading: '\\u0141adowanie...',\r\n\r\n      // Sort\r\n      sort_newest: 'Najnowsze',\r\n      sort_oldest: 'Najstarsze',\r\n      sort_updated: 'Ostatnio zaktualizowane',\r\n      sort_oldest_updated: 'Najdawniej zaktualizowane',\r\n      sort_price_asc: 'Cena: rosn\\u0105co',\r\n      sort_price_desc: 'Cena: malej\\u0105co',\r\n      sort_featured: 'Wyr\\u00f3\\u017cnione',\r\n      sort_location: 'Wg lokalizacji',\r\n      sort_own: 'W\\u0142asne nieruchomo\\u015bci najpierw',\r\n      sort_by: 'Sortuj wed\\u0142ug',\r\n      sort_recent: 'Ostatnio dodane',\r\n      sort_name: 'Nazwa: A-Z',\r\n\r\n      // AI Search\r\n      ai_search_title: 'Wyszukiwanie AI',\r\n      ai_search_back: 'Powr\\u00f3t do filtr\\u00f3w',\r\n      ai_search_placeholder: 'Opisz swoj\\u0105 wymarzon\\u0105 nieruchomo\\u015b\\u0107...\\nnp., willa z 3 sypialniami z basenem blisko pla\\u017cy poni\\u017cej 500k',\r\n      ai_search_try: 'Spr\\u00f3buj:',\r\n      ai_search_button: 'Szukaj',\r\n      ai_search_empty: 'Opisz czego szukasz',\r\n      ai_search_error: 'Nie uda\\u0142o si\\u0119 zrozumie\\u0107 wyszukiwania. Spr\\u00f3buj ponownie.',\r\n      ai_search_example_1: 'nowoczesne mieszkanie z widokiem na morze',\r\n      ai_search_example_2: 'rodzinna willa z ogrodem poni\\u017cej 400k',\r\n      ai_search_example_3: '2 sypialnie do wynaj\\u0119cia blisko pla\\u017cy',\r\n\r\n      // Card\r\n      card_bed: 'syp.',\r\n      card_beds: 'syp.',\r\n      card_bath: '\\u0142az.',\r\n      card_baths: '\\u0142az.',\r\n      card_view: 'Szczeg\\u00f3\\u0142y',\r\n      card_ref: 'Ref:',\r\n\r\n      // Detail\r\n      detail_description: 'Opis',\r\n      detail_features: 'Cechy',\r\n      detail_location: 'Lokalizacja',\r\n      detail_contact: 'Kontakt z agentem',\r\n      detail_share: 'Udost\\u0119pnij',\r\n      detail_back: 'Powr\\u00f3t do wynik\\u00f3w',\r\n      detail_back_to_search: 'Powr\\u00f3t do wyszukiwania',\r\n      detail_related: 'Podobne nieruchomo\\u015bci',\r\n      detail_year_built: 'Rok budowy',\r\n      detail_property_type: 'Typ nieruchomo\\u015bci',\r\n      detail_status: 'Status',\r\n      detail_reference: 'Referencja',\r\n      detail_unique_ref: 'Unikalna referencja',\r\n      detail_floor: 'Pi\\u0119tro',\r\n      detail_orientation: 'Orientacja',\r\n      detail_condition: 'Stan',\r\n      detail_furnished: 'Umeblowane',\r\n      detail_views: 'Widoki',\r\n      detail_parking: 'Parking',\r\n      detail_built_area: 'Powierzchnia zabudowy',\r\n      detail_plot_size: 'Powierzchnia dzia\\u0142ki',\r\n      detail_usable_area: 'Powierzchnia u\\u017cytkowa',\r\n      detail_terrace: 'Taras',\r\n      detail_sizes: 'Wymiary nieruchomo\\u015bci',\r\n      detail_property_info: 'Informacje o nieruchomo\\u015bci',\r\n      detail_taxes_fees: 'Podatki i op\\u0142aty',\r\n      detail_community_fees: 'Op\\u0142aty wsp\\u00f3lnoty',\r\n      detail_ibi_tax: 'Podatek IBI',\r\n      detail_basura_tax: 'Op\\u0142ata za \\u015bmieci',\r\n      detail_per_month: '/miesi\\u0105c',\r\n      detail_per_year: '/rok',\r\n      detail_energy_certificate: 'Certyfikat energetyczny',\r\n      detail_energy_rating: 'Klasa energetyczna',\r\n      detail_co2_rating: 'Klasa CO2',\r\n      detail_video_tour: 'Wideo',\r\n      detail_virtual_tour: 'Wirtualny spacer',\r\n      detail_download_pdf: 'Pobierz PDF',\r\n      detail_loading_map: '\\u0141adowanie mapy...',\r\n      detail_read_more: 'Czytaj wiÄ™cej',\r\n      detail_read_less: 'Czytaj mniej',\r\n      detail_price_on_request: 'Cena na zapytanie',\r\n      detail_view_larger_map: 'Powi\\u0119ksz map\\u0119',\r\n      detail_get_directions: 'Wyznacz tras\\u0119',\r\n\r\n      // Wishlist\r\n      wishlist_add: 'Dodaj do ulubionych',\r\n      wishlist_remove: 'Usu\\u0144 z ulubionych',\r\n      wishlist_title: 'Moja lista \\u017cycze\\u0144',\r\n      wishlist_empty: 'Twoja lista \\u017cycze\\u0144 jest pusta',\r\n      wishlist_empty_desc: 'Dodaj nieruchomo\\u015bci klikaj\\u0105c ikon\\u0119 serca',\r\n      wishlist_share: 'Udost\\u0119pnij',\r\n      wishlist_email: 'E-mail',\r\n      wishlist_pdf: 'Pobierz PDF',\r\n      wishlist_clear: 'Wyczy\\u015b\\u0107 wszystko',\r\n      wishlist_back: 'Powr\\u00f3t do wynik\\u00f3w',\r\n      wishlist_browse: 'Przegl\\u0105daj nieruchomo\\u015bci',\r\n      wishlist_compare: 'Por\\u00f3wnaj',\r\n      wishlist_confirm_clear: 'Czy na pewno chcesz wyczy\\u015bci\\u0107 ca\\u0142\\u0105 list\\u0119 \\u017cycze\\u0144?',\r\n      wishlist_removed: 'Usuni\\u0119to z ulubionych',\r\n      wishlist_cleared: 'Lista \\u017cycze\\u0144 wyczyszczona',\r\n      wishlist_share_title: 'Udost\\u0119pnij swoj\\u0105 list\\u0119',\r\n      wishlist_share_desc: 'Udost\\u0119pnij ten link, aby pokaza\\u0107 zapisane nieruchomo\\u015bci:',\r\n      wishlist_email_title: 'Wy\\u015blij list\\u0119 e-mailem',\r\n      wishlist_email_to: 'Wy\\u015blij do:',\r\n      wishlist_email_from: 'Tw\\u00f3j e-mail (opcjonalnie):',\r\n      wishlist_email_message: 'Wiadomo\\u015b\\u0107 osobista (opcjonalnie):',\r\n      wishlist_email_placeholder: 'Dodaj osobist\\u0105 notatk\\u0119...',\r\n      wishlist_email_send: 'Wy\\u015blij e-mail',\r\n      wishlist_email_sent: 'E-mail wys\\u0142any pomy\\u015blnie!',\r\n      wishlist_email_error: 'Nie uda\\u0142o si\\u0119 wys\\u0142a\\u0107 e-maila',\r\n      wishlist_note_title: 'Dodaj notatk\\u0119',\r\n      wishlist_note_label: 'Twoja notatka:',\r\n      wishlist_note_placeholder: 'Dodaj swoje przemys\\u0142enia, pytania lub przypomnienia...',\r\n      wishlist_compare_title: 'Por\\u00f3wnaj nieruchomo\\u015bci',\r\n      wishlist_compare_clear: 'Wyczy\\u015b\\u0107 wyb\\u00f3r',\r\n      note_saved: 'Notatka zapisana!',\r\n      note_deleted: 'Notatka usuni\\u0119ta',\r\n      confirm_delete_note: 'Usun\\u0105\\u0107 t\\u0119 notatk\\u0119?',\r\n      compare_min: 'Wybierz co najmniej 2 nieruchomo\\u015bci do por\\u00f3wnania',\r\n      compare_confirm_clear: 'Wyczy\\u015bci\\u0107 wszystkie wybrane nieruchomo\\u015bci?',\r\n      copied: 'Link skopiowany do schowka!',\r\n\r\n      // Inquiry\r\n      inquiry_name: 'Twoje imi\\u0119',\r\n      inquiry_first_name: 'Imi\\u0119',\r\n      inquiry_last_name: 'Nazwisko',\r\n      inquiry_email: 'Tw\\u00f3j e-mail',\r\n      inquiry_phone: 'Tw\\u00f3j telefon',\r\n      inquiry_message: 'Wiadomo\\u015b\\u0107',\r\n      inquiry_submit: 'Wy\\u015blij zapytanie',\r\n      inquiry_sending: 'Wysy\\u0142anie...',\r\n      inquiry_success: 'Dzi\\u0119kujemy! Twoje zapytanie zosta\\u0142o wys\\u0142ane.',\r\n      inquiry_error: 'Przepraszamy, wyst\\u0105pi\\u0142 b\\u0142\\u0105d. Spr\\u00f3buj ponownie.',\r\n      inquiry_privacy_accept: 'Akceptuj\\u0119',\r\n      inquiry_privacy_policy: 'polityk\\u0119 prywatno\\u015bci',\r\n      inquiry_country: 'Kraj',\r\n      inquiry_default_message: 'Jestem zainteresowany/a nieruchomo\\u015bci\\u0105 \"{title}\"{ref}. Prosz\\u0119 o kontakt w celu uzyskania wi\\u0119cej informacji.',\r\n\r\n      // Pagination\r\n      pagination_prev: 'Poprzednia',\r\n      pagination_next: 'Nast\\u0119pna',\r\n      pagination_page: 'Strona',\r\n      pagination_of: 'z',\r\n      pagination_load_more: 'Za\\u0142aduj wi\\u0119cej',\r\n\r\n      // General\r\n      general_error: 'Wyst\\u0105pi\\u0142 b\\u0142\\u0105d',\r\n      general_retry: 'Spr\\u00f3buj ponownie',\r\n      general_close: 'Zamknij',\r\n      general_select: 'Wybierz',\r\n      general_selected: 'Wybrano',\r\n      general_clear: 'Wyczy\\u015b\\u0107',\r\n      view_details: 'Szczeg\\u00f3\\u0142y',\r\n      no_results: 'Nie znaleziono wynik\\u00f3w',\r\n      compare: 'Por\\u00f3wnaj',\r\n      cancel: 'Anuluj',\r\n      close: 'Zamknij',\r\n      save: 'Zapisz',\r\n      delete: 'Usu\\u0144',\r\n      error: 'B\\u0142\\u0105d',\r\n      property: 'nieruchomo\\u015b\\u0107',\r\n      properties: 'nieruchomo\\u015bci',\r\n      featured: 'Wyr\\u00f3\\u017cnione',\r\n      own: 'W\\u0142asne',\r\n      price: 'Cena',\r\n      location: 'Lokalizacja',\r\n      type: 'Typ',\r\n      bedrooms: 'Sypialnie',\r\n      bathrooms: '\\u0141azienki',\r\n      build_size: 'Zabudowa',\r\n      plot_size: 'Dzia\\u0142ka',\r\n      status: 'Status',\r\n\r\n      // Map\r\n      map_precision_exact: 'Dok\\u0142adna lokalizacja',\r\n      map_precision_zipcode: 'Kod pocztowy',\r\n      map_precision_area: 'Obszar',\r\n      map_loading: '\\u0141adowanie mapy...',\r\n      map_error: 'Nie mo\\u017cna za\\u0142adowa\\u0107 mapy',\r\n      map_reset_view: 'Resetuj widok',\r\n      map_properties_in_view: 'nieruchomo\\u015bci w widoku',\r\n      results_properties: 'nieruchomo\\u015bci',\r\n    },\r\n    it_IT: {\r\n      // AI Search\r\n      ai_search_title: 'Ricerca IA',\r\n      ai_search_back: 'Torna ai filtri',\r\n      ai_search_placeholder: 'Descrivi la tua proprietÃ  ideale...\\nes., villa 3 camere con piscina vicino alla spiaggia sotto 500k',\r\n      ai_search_try: 'Prova:',\r\n      ai_search_button: 'Cerca',\r\n      ai_search_empty: 'Descrivi cosa stai cercando',\r\n      ai_search_error: 'Impossibile comprendere la ricerca. Riprova.',\r\n      ai_search_example_1: 'appartamento moderno con vista mare',\r\n      ai_search_example_2: 'villa familiare con giardino sotto 400k',\r\n      ai_search_example_3: 'affitto 2 camere vicino alla spiaggia',\r\n      // Sort\r\n      sort_newest: 'PiÃ¹ recenti',\r\n      sort_oldest: 'PiÃ¹ vecchi',\r\n      sort_updated: 'Aggiornati di recente',\r\n      sort_oldest_updated: 'Aggiornati meno recenti',\r\n      sort_price_asc: 'Prezzo: crescente',\r\n      sort_price_desc: 'Prezzo: decrescente',\r\n      sort_featured: 'In evidenza',\r\n      sort_location: 'Per posizione',\r\n      sort_own: 'Nostre proprietÃ  prima',\r\n      sort_recent: 'Aggiunti di recente',\r\n      sort_name: 'Nome: A-Z',\r\n      results_sort: 'Ordina per',\r\n      search_button: 'Cerca',\r\n      // Detail page\r\n      detail_location: 'Posizione',\r\n      detail_related: 'ProprietÃ  simili',\r\n      detail_read_more: 'Leggi di piÃ¹',\r\n      detail_read_less: 'Leggi meno',\r\n      detail_loading_map: 'Caricamento mappa...',\r\n      detail_view_larger_map: 'Visualizza mappa piÃ¹ grande',\r\n      detail_get_directions: 'Indicazioni stradali',\r\n      wishlist_add: 'Aggiungi ai preferiti',\r\n      wishlist_remove: 'Rimuovi dai preferiti',\r\n      pagination_prev: 'Precedente',\r\n      pagination_next: 'Successivo',\r\n      inquiry_default_message: 'Sono interessato/a alla proprietÃ  \"{title}\"{ref}. Vi prego di contattarmi per maggiori informazioni.',\r\n      map_loading: 'Caricamento mappa...',\r\n      map_error: 'Impossibile caricare la mappa',\r\n      map_reset_view: 'Reimposta vista',\r\n      map_properties_in_view: 'proprietÃ  visibili',\r\n      results_properties: 'proprietÃ ',\r\n    },\r\n    pt_PT: {\r\n      // AI Search\r\n      ai_search_title: 'Pesquisa IA',\r\n      ai_search_back: 'Voltar aos filtros',\r\n      ai_search_placeholder: 'Descreva o seu imÃ³vel ideal...\\nex., moradia T3 com piscina perto da praia menos de 500k',\r\n      ai_search_try: 'Experimente:',\r\n      ai_search_button: 'Pesquisar',\r\n      ai_search_empty: 'Descreva o que procura',\r\n      ai_search_error: 'NÃ£o foi possÃ­vel entender a pesquisa. Tente novamente.',\r\n      ai_search_example_1: 'apartamento moderno com vista mar',\r\n      ai_search_example_2: 'moradia familiar com jardim menos de 400k',\r\n      ai_search_example_3: 'arrendamento T2 perto da praia',\r\n      // Sort\r\n      sort_newest: 'Mais recentes',\r\n      sort_oldest: 'Mais antigos',\r\n      sort_updated: 'Atualizados recentemente',\r\n      sort_price_asc: 'PreÃ§o: crescente',\r\n      sort_price_desc: 'PreÃ§o: decrescente',\r\n      sort_featured: 'Em destaque',\r\n      sort_location: 'Por localizaÃ§Ã£o',\r\n      sort_recent: 'Adicionados recentemente',\r\n      sort_name: 'Nome: A-Z',\r\n      results_sort: 'Ordenar por',\r\n      search_button: 'Pesquisar',\r\n      // Detail page\r\n      detail_location: 'LocalizaÃ§Ã£o',\r\n      detail_related: 'ImÃ³veis semelhantes',\r\n      detail_read_more: 'Ler mais',\r\n      detail_read_less: 'Ler menos',\r\n      detail_loading_map: 'A carregar mapa...',\r\n      detail_view_larger_map: 'Ver mapa maior',\r\n      detail_get_directions: 'Obter direÃ§Ãµes',\r\n      wishlist_add: 'Adicionar aos favoritos',\r\n      wishlist_remove: 'Remover dos favoritos',\r\n      pagination_prev: 'Anterior',\r\n      pagination_next: 'Seguinte',\r\n      inquiry_default_message: 'Estou interessado/a no imÃ³vel \"{title}\"{ref}. Por favor, contactem-me para mais informaÃ§Ãµes.',\r\n      map_loading: 'A carregar mapa...',\r\n      map_error: 'NÃ£o foi possÃ­vel carregar o mapa',\r\n      map_reset_view: 'Repor vista',\r\n      map_properties_in_view: 'imÃ³veis Ã  vista',\r\n      results_properties: 'imÃ³veis',\r\n    },\r\n    ru_RU: {\r\n      // AI Search\r\n      ai_search_title: 'Ð˜Ð˜ ÐŸÐ¾Ð¸ÑÐº',\r\n      ai_search_back: 'ÐÐ°Ð·Ð°Ð´ Ðº Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ð¼',\r\n      ai_search_placeholder: 'ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð°ÑˆÑƒ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒ...\\nÐ½Ð°Ð¿Ñ€., Ð²Ð¸Ð»Ð»Ð° Ñ 3 ÑÐ¿Ð°Ð»ÑŒÐ½ÑÐ¼Ð¸ Ð¸ Ð±Ð°ÑÑÐµÐ¹Ð½Ð¾Ð¼ Ñƒ Ð¿Ð»ÑÐ¶Ð° Ð´Ð¾ 500k',\r\n      ai_search_try: 'ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ:',\r\n      ai_search_button: 'Ð˜ÑÐºÐ°Ñ‚ÑŒ',\r\n      ai_search_empty: 'ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð¸Ñ‰ÐµÑ‚Ðµ',\r\n      ai_search_error: 'ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð½ÑÑ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.',\r\n      ai_search_example_1: 'ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ ÐºÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð° Ñ Ð²Ð¸Ð´Ð¾Ð¼ Ð½Ð° Ð¼Ð¾Ñ€Ðµ',\r\n      ai_search_example_2: 'ÑÐµÐ¼ÐµÐ¹Ð½Ð°Ñ Ð²Ð¸Ð»Ð»Ð° Ñ ÑÐ°Ð´Ð¾Ð¼ Ð´Ð¾ 400k',\r\n      ai_search_example_3: 'Ð°Ñ€ÐµÐ½Ð´Ð° 2 ÑÐ¿Ð°Ð»ÑŒÐ½Ð¸ Ñƒ Ð¿Ð»ÑÐ¶Ð°',\r\n      // Sort\r\n      sort_newest: 'ÐÐ¾Ð²ÐµÐ¹ÑˆÐ¸Ðµ',\r\n      sort_oldest: 'Ð¡Ñ‚Ð°Ñ€ÐµÐ¹ÑˆÐ¸Ðµ',\r\n      sort_updated: 'ÐÐµÐ´Ð°Ð²Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ',\r\n      sort_price_asc: 'Ð¦ÐµÐ½Ð°: Ð¿Ð¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð°Ð½Ð¸ÑŽ',\r\n      sort_price_desc: 'Ð¦ÐµÐ½Ð°: Ð¿Ð¾ ÑƒÐ±Ñ‹Ð²Ð°Ð½Ð¸ÑŽ',\r\n      sort_featured: 'Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ðµ',\r\n      sort_location: 'ÐŸÐ¾ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑŽ',\r\n      sort_recent: 'ÐÐµÐ´Ð°Ð²Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ',\r\n      sort_name: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ: Ð-Ð¯',\r\n      results_sort: 'Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ',\r\n      search_button: 'ÐŸÐ¾Ð¸ÑÐº',\r\n      // Detail page\r\n      detail_location: 'Ð Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ',\r\n      detail_related: 'ÐŸÐ¾Ñ…Ð¾Ð¶Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹',\r\n      detail_read_more: 'Ð§Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð´Ð°Ð»ÐµÐµ',\r\n      detail_read_less: 'Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ',\r\n      detail_loading_map: 'Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ€Ñ‚Ñ‹...',\r\n      detail_view_larger_map: 'Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ',\r\n      detail_get_directions: 'ÐŸÑ€Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚',\r\n      wishlist_add: 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ',\r\n      wishlist_remove: 'Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð· Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾',\r\n      pagination_prev: 'ÐÐ°Ð·Ð°Ð´',\r\n      pagination_next: 'Ð”Ð°Ð»ÐµÐµ',\r\n      inquiry_default_message: 'ÐœÐµÐ½Ñ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÐµÑ‚ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒ \"{title}\"{ref}. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ ÑÐ¾ Ð¼Ð½Ð¾Ð¹ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸.',\r\n      map_loading: 'Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ€Ñ‚Ñ‹...',\r\n      map_error: 'ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ',\r\n      map_reset_view: 'Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²Ð¸Ð´',\r\n      map_properties_in_view: 'Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ð² Ð¿Ð¾Ð»Ðµ Ð·Ñ€ÐµÐ½Ð¸Ñ',\r\n      results_properties: 'Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²',\r\n    },\r\n    zh_CN: {\r\n      // AI Search\r\n      ai_search_title: 'AIæœç´¢',\r\n      ai_search_back: 'è¿”å›žç­›é€‰',\r\n      ai_search_placeholder: 'æè¿°æ‚¨ç†æƒ³çš„æˆ¿äº§...\\nä¾‹å¦‚ï¼š3å§å®¤æµ·æ»¨åˆ«å¢…å¸¦æ³³æ± ï¼Œ50ä¸‡ä»¥ä¸‹',\r\n      ai_search_try: 'è¯•è¯•ï¼š',\r\n      ai_search_button: 'æœç´¢',\r\n      ai_search_empty: 'è¯·æè¿°æ‚¨è¦æ‰¾çš„å†…å®¹',\r\n      ai_search_error: 'æ— æ³•ç†è§£æ‚¨çš„æœç´¢ï¼Œè¯·é‡è¯•ã€‚',\r\n      ai_search_example_1: 'çŽ°ä»£æµ·æ™¯å…¬å¯“',\r\n      ai_search_example_2: 'å¸¦èŠ±å›­çš„å®¶åº­åˆ«å¢…40ä¸‡ä»¥ä¸‹',\r\n      ai_search_example_3: 'æµ·æ»©é™„è¿‘2å§å®¤å‡ºç§Ÿ',\r\n      // Sort\r\n      sort_newest: 'æœ€æ–°',\r\n      sort_oldest: 'æœ€æ—§',\r\n      sort_updated: 'æœ€è¿‘æ›´æ–°',\r\n      sort_price_asc: 'ä»·æ ¼ï¼šä»Žä½Žåˆ°é«˜',\r\n      sort_price_desc: 'ä»·æ ¼ï¼šä»Žé«˜åˆ°ä½Ž',\r\n      sort_featured: 'ç²¾é€‰ä¼˜å…ˆ',\r\n      sort_location: 'æŒ‰ä½ç½®',\r\n      sort_recent: 'æœ€è¿‘æ·»åŠ ',\r\n      sort_name: 'åç§°: A-Z',\r\n      results_sort: 'æŽ’åº',\r\n      search_button: 'æœç´¢',\r\n      // Detail page\r\n      detail_location: 'ä½ç½®',\r\n      detail_related: 'ç›¸ä¼¼æˆ¿äº§',\r\n      detail_read_more: 'é˜…è¯»æ›´å¤š',\r\n      detail_read_less: 'æ”¶èµ·',\r\n      detail_loading_map: 'åŠ è½½åœ°å›¾ä¸­...',\r\n      detail_view_larger_map: 'æŸ¥çœ‹å¤§åœ°å›¾',\r\n      detail_get_directions: 'èŽ·å–è·¯çº¿',\r\n      wishlist_add: 'æ·»åŠ åˆ°æ”¶è—å¤¹',\r\n      wishlist_remove: 'ä»Žæ”¶è—å¤¹ç§»é™¤',\r\n      pagination_prev: 'ä¸Šä¸€é¡µ',\r\n      pagination_next: 'ä¸‹ä¸€é¡µ',\r\n      inquiry_default_message: 'æˆ‘å¯¹æˆ¿äº§\"{title}\"{ref}æ„Ÿå…´è¶£ã€‚è¯·ä¸Žæˆ‘è”ç³»ä»¥èŽ·å–æ›´å¤šä¿¡æ¯ã€‚',\r\n      map_loading: 'åŠ è½½åœ°å›¾ä¸­...',\r\n      map_error: 'æ— æ³•åŠ è½½åœ°å›¾',\r\n      map_reset_view: 'é‡ç½®è§†å›¾',\r\n      map_properties_in_view: 'ä¸ªæˆ¿äº§å¯è§',\r\n      results_properties: 'ä¸ªæˆ¿äº§',\r\n    },\r\n    ja_JP: {\r\n      // AI Search\r\n      ai_search_title: 'AIæ¤œç´¢',\r\n      ai_search_back: 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«æˆ»ã‚‹',\r\n      ai_search_placeholder: 'ç†æƒ³ã®ç‰©ä»¶ã‚’èª¬æ˜Žã—ã¦ãã ã•ã„...\\nä¾‹ï¼šãƒ“ãƒ¼ãƒè¿‘ãã€ãƒ—ãƒ¼ãƒ«ä»˜ã3ãƒ™ãƒƒãƒ‰ãƒ«ãƒ¼ãƒ ãƒ´ã‚£ãƒ©ã€50ä¸‡ä»¥ä¸‹',\r\n      ai_search_try: 'è©¦ã™ï¼š',\r\n      ai_search_button: 'æ¤œç´¢',\r\n      ai_search_empty: 'æŽ¢ã—ã¦ã„ã‚‹ã‚‚ã®ã‚’èª¬æ˜Žã—ã¦ãã ã•ã„',\r\n      ai_search_error: 'æ¤œç´¢ã‚’ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',\r\n      ai_search_example_1: 'æµ·ã®è¦‹ãˆã‚‹ãƒ¢ãƒ€ãƒ³ã‚¢ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ',\r\n      ai_search_example_2: 'åº­ä»˜ããƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ´ã‚£ãƒ©40ä¸‡ä»¥ä¸‹',\r\n      ai_search_example_3: 'ãƒ“ãƒ¼ãƒè¿‘ãã®2ãƒ™ãƒƒãƒ‰ãƒ«ãƒ¼ãƒ è³ƒè²¸',\r\n      // Sort\r\n      sort_newest: 'æ–°ç€é †',\r\n      sort_oldest: 'å¤ã„é †',\r\n      sort_updated: 'æ›´æ–°é †',\r\n      sort_price_asc: 'ä¾¡æ ¼ï¼šå®‰ã„é †',\r\n      sort_price_desc: 'ä¾¡æ ¼ï¼šé«˜ã„é †',\r\n      sort_featured: 'ãŠã™ã™ã‚',\r\n      sort_location: 'å ´æ‰€é †',\r\n      sort_recent: 'æœ€è¿‘è¿½åŠ ',\r\n      sort_name: 'åå‰: A-Z',\r\n      results_sort: 'ä¸¦ã³æ›¿ãˆ',\r\n      search_button: 'æ¤œç´¢',\r\n      // Detail page\r\n      detail_location: 'æ‰€åœ¨åœ°',\r\n      detail_related: 'é¡žä¼¼ç‰©ä»¶',\r\n      detail_read_more: 'ç¶šãã‚’èª­ã‚€',\r\n      detail_read_less: 'é–‰ã˜ã‚‹',\r\n      detail_loading_map: 'åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...',\r\n      detail_view_larger_map: 'å¤§ããªåœ°å›³ã§è¦‹ã‚‹',\r\n      detail_get_directions: 'é“é †ã‚’èª¿ã¹ã‚‹',\r\n      wishlist_add: 'ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ',\r\n      wishlist_remove: 'ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤',\r\n      pagination_prev: 'å‰ã¸',\r\n      pagination_next: 'æ¬¡ã¸',\r\n      inquiry_default_message: 'ç‰©ä»¶ã€Œ{title}ã€{ref}ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã”é€£çµ¡ãã ã•ã„ã€‚',\r\n      map_loading: 'åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...',\r\n      map_error: 'åœ°å›³ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“',\r\n      map_reset_view: 'è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ',\r\n      map_properties_in_view: 'ä»¶ã®ç‰©ä»¶ãŒè¡¨ç¤ºä¸­',\r\n      results_properties: 'ä»¶ã®ç‰©ä»¶',\r\n    },\r\n    ar_SA: {\r\n      // AI Search\r\n      ai_search_title: 'Ø¨Ø­Ø« Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',\r\n      ai_search_back: 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙÙ„Ø§ØªØ±',\r\n      ai_search_placeholder: 'ØµÙ Ø¹Ù‚Ø§Ø±Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ...\\nÙ…Ø«Ø§Ù„: ÙÙŠÙ„Ø§ 3 ØºØ±Ù Ù†ÙˆÙ… Ù…Ø¹ Ù…Ø³Ø¨Ø­ Ù‚Ø±Ø¨ Ø§Ù„Ø´Ø§Ø·Ø¦ Ø£Ù‚Ù„ Ù…Ù† 500 Ø£Ù„Ù',\r\n      ai_search_try: 'Ø¬Ø±Ø¨:',\r\n      ai_search_button: 'Ø¨Ø­Ø«',\r\n      ai_search_empty: 'ØµÙ Ù…Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡',\r\n      ai_search_error: 'Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ÙÙ‡Ù… Ø¨Ø­Ø«Ùƒ. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',\r\n      ai_search_example_1: 'Ø´Ù‚Ø© Ø­Ø¯ÙŠØ«Ø© Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø¨Ø­Ø±ÙŠØ©',\r\n      ai_search_example_2: 'ÙÙŠÙ„Ø§ Ø¹Ø§Ø¦Ù„ÙŠØ© Ù…Ø¹ Ø­Ø¯ÙŠÙ‚Ø© Ø£Ù‚Ù„ Ù…Ù† 400 Ø£Ù„Ù',\r\n      ai_search_example_3: 'Ø¥ÙŠØ¬Ø§Ø± ØºØ±ÙØªÙŠÙ† Ù‚Ø±Ø¨ Ø§Ù„Ø´Ø§Ø·Ø¦',\r\n      // Sort\r\n      sort_newest: 'Ø§Ù„Ø£Ø­Ø¯Ø«',\r\n      sort_oldest: 'Ø§Ù„Ø£Ù‚Ø¯Ù…',\r\n      sort_updated: 'Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹',\r\n      sort_price_asc: 'Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„',\r\n      sort_price_desc: 'Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰',\r\n      sort_featured: 'Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø£ÙˆÙ„Ø§Ù‹',\r\n      sort_location: 'Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹',\r\n      sort_recent: 'Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ«Ø§Ù‹',\r\n      sort_name: 'Ø§Ù„Ø§Ø³Ù…: Ø£-ÙŠ',\r\n      results_sort: 'ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨',\r\n      search_button: 'Ø¨Ø­Ø«',\r\n      // Detail page\r\n      detail_location: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹',\r\n      detail_related: 'Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©',\r\n      detail_read_more: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯',\r\n      detail_read_less: 'Ø§Ù‚Ø±Ø£ Ø£Ù‚Ù„',\r\n      detail_loading_map: 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©...',\r\n      detail_view_larger_map: 'Ø¹Ø±Ø¶ Ø®Ø±ÙŠØ·Ø© Ø£ÙƒØ¨Ø±',\r\n      detail_get_directions: 'Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª',\r\n      wishlist_add: 'Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©',\r\n      wishlist_remove: 'Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©',\r\n      pagination_prev: 'Ø§Ù„Ø³Ø§Ø¨Ù‚',\r\n      pagination_next: 'Ø§Ù„ØªØ§Ù„ÙŠ',\r\n      inquiry_default_message: 'Ø£Ù†Ø§ Ù…Ù‡ØªÙ… Ø¨Ø§Ù„Ø¹Ù‚Ø§Ø± \"{title}\"{ref}. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.',\r\n      map_loading: 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©...',\r\n      map_error: 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©',\r\n      map_reset_view: 'Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶',\r\n      map_properties_in_view: 'Ø¹Ù‚Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶',\r\n      results_properties: 'Ø¹Ù‚Ø§Ø±Ø§Øª',\r\n    },\r\n    sv_SE: {\r\n      // AI Search\r\n      ai_search_title: 'AI-sÃ¶kning',\r\n      ai_search_back: 'Tillbaka till filter',\r\n      ai_search_placeholder: 'Beskriv din drÃ¶mbostad...\\nt.ex., 3 sovrum villa med pool nÃ¤ra stranden under 500k',\r\n      ai_search_try: 'Prova:',\r\n      ai_search_button: 'SÃ¶k',\r\n      ai_search_empty: 'Beskriv vad du letar efter',\r\n      ai_search_error: 'Kunde inte fÃ¶rstÃ¥ din sÃ¶kning. FÃ¶rsÃ¶k igen.',\r\n      ai_search_example_1: 'modern lÃ¤genhet med havsutsikt',\r\n      ai_search_example_2: 'familjevilla med trÃ¤dgÃ¥rd under 400k',\r\n      ai_search_example_3: '2 sovrum hyra nÃ¤ra stranden',\r\n      // Sort\r\n      sort_newest: 'Nyaste',\r\n      sort_oldest: 'Ã„ldsta',\r\n      sort_updated: 'Senast uppdaterade',\r\n      sort_price_asc: 'Pris: lÃ¤gst fÃ¶rst',\r\n      sort_price_desc: 'Pris: hÃ¶gst fÃ¶rst',\r\n      sort_featured: 'Utvalda fÃ¶rst',\r\n      sort_location: 'Efter plats',\r\n      sort_recent: 'Nyligen tillagda',\r\n      sort_name: 'Namn: A-Ã–',\r\n      results_sort: 'Sortera efter',\r\n      search_button: 'SÃ¶k',\r\n      // Detail page\r\n      detail_location: 'Plats',\r\n      detail_related: 'Liknande fastigheter',\r\n      detail_read_more: 'LÃ¤s mer',\r\n      detail_read_less: 'LÃ¤s mindre',\r\n      detail_loading_map: 'Laddar karta...',\r\n      detail_view_larger_map: 'Visa stÃ¶rre karta',\r\n      detail_get_directions: 'VÃ¤gbeskrivning',\r\n      wishlist_add: 'LÃ¤gg till i favoriter',\r\n      wishlist_remove: 'Ta bort frÃ¥n favoriter',\r\n      pagination_prev: 'FÃ¶regÃ¥ende',\r\n      pagination_next: 'NÃ¤sta',\r\n      inquiry_default_message: 'Jag Ã¤r intresserad av fastigheten \"{title}\"{ref}. VÃ¤nligen kontakta mig fÃ¶r mer information.',\r\n      map_loading: 'Laddar karta...',\r\n      map_error: 'Kunde inte ladda kartan',\r\n      map_reset_view: 'Ã…terstÃ¤ll vy',\r\n      map_properties_in_view: 'fastigheter i vyn',\r\n      results_properties: 'fastigheter',\r\n    },\r\n    no_NO: {\r\n      // AI Search\r\n      ai_search_title: 'AI-sÃ¸k',\r\n      ai_search_back: 'Tilbake til filtre',\r\n      ai_search_placeholder: 'Beskriv din drÃ¸mmebolig...\\nf.eks., 3 soverom villa med basseng nÃ¦r stranden under 500k',\r\n      ai_search_try: 'PrÃ¸v:',\r\n      ai_search_button: 'SÃ¸k',\r\n      ai_search_empty: 'Beskriv hva du leter etter',\r\n      ai_search_error: 'Kunne ikke forstÃ¥ sÃ¸ket ditt. PrÃ¸v igjen.',\r\n      ai_search_example_1: 'moderne leilighet med havutsikt',\r\n      ai_search_example_2: 'familievilla med hage under 400k',\r\n      ai_search_example_3: '2 soverom leie nÃ¦r stranden',\r\n      // Sort\r\n      sort_newest: 'Nyeste',\r\n      sort_oldest: 'Eldste',\r\n      sort_updated: 'Sist oppdatert',\r\n      sort_price_asc: 'Pris: lavest fÃ¸rst',\r\n      sort_price_desc: 'Pris: hÃ¸yest fÃ¸rst',\r\n      sort_featured: 'Utvalgte fÃ¸rst',\r\n      sort_location: 'Etter sted',\r\n      sort_recent: 'Nylig lagt til',\r\n      sort_name: 'Navn: A-Ã…',\r\n      results_sort: 'Sorter etter',\r\n      search_button: 'SÃ¸k',\r\n      // Detail page\r\n      detail_location: 'Beliggenhet',\r\n      detail_related: 'Lignende eiendommer',\r\n      detail_read_more: 'Les mer',\r\n      detail_read_less: 'Les mindre',\r\n      detail_loading_map: 'Laster kart...',\r\n      detail_view_larger_map: 'Vis stÃ¸rre kart',\r\n      detail_get_directions: 'Veibeskrivelse',\r\n      wishlist_add: 'Legg til i favoritter',\r\n      wishlist_remove: 'Fjern fra favoritter',\r\n      pagination_prev: 'Forrige',\r\n      pagination_next: 'Neste',\r\n      inquiry_default_message: 'Jeg er interessert i eiendommen \"{title}\"{ref}. Vennligst ta kontakt for mer informasjon.',\r\n      map_loading: 'Laster kart...',\r\n      map_error: 'Kunne ikke laste kartet',\r\n      map_reset_view: 'Tilbakestill visning',\r\n      map_properties_in_view: 'eiendommer synlig',\r\n      results_properties: 'eiendommer',\r\n    },\r\n    da_DK: {\r\n      // AI Search\r\n      ai_search_title: 'AI-sÃ¸gning',\r\n      ai_search_back: 'Tilbage til filtre',\r\n      ai_search_placeholder: 'Beskriv din drÃ¸mmebolig...\\nf.eks., 3 vÃ¦relses villa med pool nÃ¦r stranden under 500k',\r\n      ai_search_try: 'PrÃ¸v:',\r\n      ai_search_button: 'SÃ¸g',\r\n      ai_search_empty: 'Beskriv hvad du leder efter',\r\n      ai_search_error: 'Kunne ikke forstÃ¥ din sÃ¸gning. PrÃ¸v igen.',\r\n      ai_search_example_1: 'moderne lejlighed med havudsigt',\r\n      ai_search_example_2: 'familievilla med have under 400k',\r\n      ai_search_example_3: '2 vÃ¦relses leje nÃ¦r stranden',\r\n      // Sort\r\n      sort_newest: 'Nyeste',\r\n      sort_oldest: 'Ã†ldste',\r\n      sort_updated: 'Sidst opdateret',\r\n      sort_price_asc: 'Pris: lavest fÃ¸rst',\r\n      sort_price_desc: 'Pris: hÃ¸jest fÃ¸rst',\r\n      sort_featured: 'FremhÃ¦vede fÃ¸rst',\r\n      sort_location: 'Efter placering',\r\n      sort_recent: 'Senest tilfÃ¸jet',\r\n      sort_name: 'Navn: A-Ã…',\r\n      results_sort: 'SortÃ©r efter',\r\n      search_button: 'SÃ¸g',\r\n      // Detail page\r\n      detail_location: 'Beliggenhed',\r\n      detail_related: 'Lignende ejendomme',\r\n      detail_read_more: 'LÃ¦s mere',\r\n      detail_read_less: 'LÃ¦s mindre',\r\n      detail_loading_map: 'IndlÃ¦ser kort...',\r\n      detail_view_larger_map: 'Vis stÃ¸rre kort',\r\n      detail_get_directions: 'Rutevejledning',\r\n      wishlist_add: 'TilfÃ¸j til favoritter',\r\n      wishlist_remove: 'Fjern fra favoritter',\r\n      pagination_prev: 'Forrige',\r\n      pagination_next: 'NÃ¦ste',\r\n      inquiry_default_message: 'Jeg er interesseret i ejendommen \"{title}\"{ref}. Kontakt mig venligst for mere information.',\r\n      map_loading: 'IndlÃ¦ser kort...',\r\n      map_error: 'Kunne ikke indlÃ¦se kortet',\r\n      map_reset_view: 'Nulstil visning',\r\n      map_properties_in_view: 'ejendomme synlige',\r\n      results_properties: 'ejendomme',\r\n    },\r\n    fi_FI: {\r\n      // AI Search\r\n      ai_search_title: 'TekoÃ¤lyhaku',\r\n      ai_search_back: 'Takaisin suodattimiin',\r\n      ai_search_placeholder: 'Kuvaile unelma-asuntoasi...\\nesim., 3 makuuhuoneen huvila uima-altaalla rannan lÃ¤hellÃ¤ alle 500k',\r\n      ai_search_try: 'Kokeile:',\r\n      ai_search_button: 'Hae',\r\n      ai_search_empty: 'Kuvaile mitÃ¤ etsit',\r\n      ai_search_error: 'Hakua ei voitu ymmÃ¤rtÃ¤Ã¤. YritÃ¤ uudelleen.',\r\n      ai_search_example_1: 'moderni asunto merinÃ¤kÃ¶alalla',\r\n      ai_search_example_2: 'perhehuvila puutarhalla alle 400k',\r\n      ai_search_example_3: '2 makuuhuoneen vuokra rannan lÃ¤hellÃ¤',\r\n      // Sort\r\n      sort_newest: 'Uusimmat',\r\n      sort_oldest: 'Vanhimmat',\r\n      sort_updated: 'Viimeksi pÃ¤ivitetyt',\r\n      sort_price_asc: 'Hinta: halvin ensin',\r\n      sort_price_desc: 'Hinta: kallein ensin',\r\n      sort_featured: 'Suositellut ensin',\r\n      sort_location: 'Sijainnin mukaan',\r\n      sort_recent: 'Viimeksi lisÃ¤tyt',\r\n      sort_name: 'Nimi: A-Ã–',\r\n      results_sort: 'JÃ¤rjestÃ¤',\r\n      search_button: 'Hae',\r\n      // Detail page\r\n      detail_location: 'Sijainti',\r\n      detail_related: 'Samankaltaiset kohteet',\r\n      detail_read_more: 'Lue lisÃ¤Ã¤',\r\n      detail_read_less: 'NÃ¤ytÃ¤ vÃ¤hemmÃ¤n',\r\n      detail_loading_map: 'Ladataan karttaa...',\r\n      detail_view_larger_map: 'NÃ¤ytÃ¤ suurempi kartta',\r\n      detail_get_directions: 'Reittiohjeet',\r\n      wishlist_add: 'LisÃ¤Ã¤ suosikkeihin',\r\n      wishlist_remove: 'Poista suosikeista',\r\n      pagination_prev: 'Edellinen',\r\n      pagination_next: 'Seuraava',\r\n      inquiry_default_message: 'Olen kiinnostunut kiinteistÃ¶stÃ¤ \"{title}\"{ref}. Ota minuun yhteyttÃ¤ lisÃ¤tietoja varten.',\r\n      map_loading: 'Ladataan karttaa...',\r\n      map_error: 'Karttaa ei voitu ladata',\r\n      map_reset_view: 'Palauta nÃ¤kymÃ¤',\r\n      map_properties_in_view: 'kohdetta nÃ¤kyvissÃ¤',\r\n      results_properties: 'kohdetta',\r\n    },\r\n  };\r\n\r\n  // Current labels (merged with API labels)\r\n  let labels: Record<string, string> = { ...defaults };\r\n\r\n  // Current language\r\n  let currentLanguage: string = 'en_US';\r\n\r\n  /**\r\n   * Language code mapping\r\n   */\r\n  const languageMap: LanguageMap = {\r\n    en: 'en_US',\r\n    es: 'es_ES',\r\n    de: 'de_DE',\r\n    fr: 'fr_FR',\r\n    it: 'it_IT',\r\n    pt: 'pt_PT',\r\n    nl: 'nl_NL',\r\n    ru: 'ru_RU',\r\n    zh: 'zh_CN',\r\n    ja: 'ja_JP',\r\n    ar: 'ar_SA',\r\n    sv: 'sv_SE',\r\n    no: 'no_NO',\r\n    da: 'da_DK',\r\n    fi: 'fi_FI',\r\n    pl: 'pl_PL',\r\n  };\r\n\r\n  /**\r\n   * Map a short language code to full locale format\r\n   */\r\n  function mapLanguageCode(code: string): string {\r\n    if (!code) return 'en_US';\r\n\r\n    // Already in full format (e.g., es_ES)\r\n    if (/^[a-z]{2}_[A-Z]{2}$/.test(code)) {\r\n      return code;\r\n    }\r\n\r\n    // Convert hyphen format (e.g., en-US -> en_US)\r\n    if (code.includes('-')) {\r\n      const converted = code.replace('-', '_');\r\n      if (/^[a-z]{2}_[A-Z]{2}$/.test(converted)) {\r\n        return converted;\r\n      }\r\n      // Extract short code if full format doesn't match\r\n      code = code.split('-')[0];\r\n    }\r\n\r\n    // Map short code to full format\r\n    const shortCode = code.toLowerCase();\r\n    return languageMap[shortCode] || 'en_US';\r\n  }\r\n\r\n  /**\r\n   * Check if a language code is valid (exists in our language map)\r\n   */\r\n  function isValidLanguageCode(code: string): boolean {\r\n    if (!code) return false;\r\n\r\n    // Check short code\r\n    const shortCode = code.toLowerCase().split(/[-_]/)[0];\r\n    return !!languageMap[shortCode];\r\n  }\r\n\r\n  /**\r\n   * Get GTranslate language from cookie\r\n   * GTranslate stores language in 'googtrans' cookie as '/en/es' (from/to)\r\n   */\r\n  function getGTranslateLanguage(): string | null {\r\n    try {\r\n      const cookies = document.cookie.split(';');\r\n      for (const cookie of cookies) {\r\n        const [name, value] = cookie.trim().split('=');\r\n        if (name === 'googtrans' && value) {\r\n          // Format: /en/es (from/to) - we want the target language\r\n          const match = value.match(/\\/[a-z]{2}\\/([a-z]{2})/);\r\n          if (match && isValidLanguageCode(match[1])) {\r\n            return match[1];\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // Cookie access may fail in some contexts\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Detect language from URL subdomain (e.g., es.example.com)\r\n   */\r\n  function detectSubdomainLanguage(): string | null {\r\n    try {\r\n      const hostname = window.location.hostname;\r\n      // Match patterns like es.example.com, de.example.com\r\n      // Exclude www and common non-language subdomains\r\n      const match = hostname.match(/^([a-z]{2})\\./);\r\n      if (match && match[1] !== 'ww' && isValidLanguageCode(match[1])) {\r\n        return match[1];\r\n      }\r\n    } catch (e) {\r\n      // Hostname access may fail\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Detect language from URL path (e.g., /es/, /de/)\r\n   */\r\n  function detectUrlLanguage(): string | null {\r\n    try {\r\n      // Match patterns like /es/, /de/, /fr/ at the start of the path\r\n      const match = window.location.pathname.match(/^\\/([a-z]{2})(?:\\/|$)/);\r\n      if (match && isValidLanguageCode(match[1])) {\r\n        return match[1];\r\n      }\r\n    } catch (e) {\r\n      // Pathname access may fail\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Detect language from translation plugins and platforms\r\n   * Supports: Polylang, WPML, Weglot, GTranslate, Webflow, URL patterns\r\n   */\r\n  function detectPlatformLanguage(): string | null {\r\n    // === WordPress Plugins ===\r\n\r\n    // Check Polylang (WordPress)\r\n    if (typeof window.pll_current_language === 'string' && window.pll_current_language) {\r\n      console.log('[RealtySoft Labels] Detected Polylang language:', window.pll_current_language);\r\n      return window.pll_current_language;\r\n    }\r\n\r\n    // Check WPML (WordPress)\r\n    if (typeof window.icl_current_language === 'string' && window.icl_current_language) {\r\n      console.log('[RealtySoft Labels] Detected WPML language:', window.icl_current_language);\r\n      return window.icl_current_language;\r\n    }\r\n\r\n    // Check Weglot (WordPress + standalone)\r\n    if (typeof window.Weglot?.getCurrentLang === 'function') {\r\n      try {\r\n        const weglotLang = window.Weglot.getCurrentLang();\r\n        if (weglotLang) {\r\n          console.log('[RealtySoft Labels] Detected Weglot language:', weglotLang);\r\n          return weglotLang;\r\n        }\r\n      } catch (e) {\r\n        // Weglot API may throw\r\n      }\r\n    }\r\n\r\n    // Check GTranslate (via cookie)\r\n    const gtranslateLang = getGTranslateLanguage();\r\n    if (gtranslateLang) {\r\n      console.log('[RealtySoft Labels] Detected GTranslate language:', gtranslateLang);\r\n      return gtranslateLang;\r\n    }\r\n\r\n    // === Non-WordPress Platforms ===\r\n\r\n    // Check Webflow locale\r\n    if (typeof window.Webflow?.env === 'function') {\r\n      try {\r\n        const locale = window.Webflow.env('locale');\r\n        if (locale) {\r\n          console.log('[RealtySoft Labels] Detected Webflow locale:', locale);\r\n          return locale;\r\n        }\r\n      } catch (e) {\r\n        // Webflow API may throw\r\n      }\r\n    }\r\n\r\n    // === Universal Detection (URL-based) ===\r\n\r\n    // Check URL subdomain (es.site.com)\r\n    const subdomainLang = detectSubdomainLanguage();\r\n    if (subdomainLang) {\r\n      console.log('[RealtySoft Labels] Detected subdomain language:', subdomainLang);\r\n      return subdomainLang;\r\n    }\r\n\r\n    // Check URL path pattern (/es/, /de/)\r\n    const urlLang = detectUrlLanguage();\r\n    if (urlLang) {\r\n      console.log('[RealtySoft Labels] Detected URL path language:', urlLang);\r\n      return urlLang;\r\n    }\r\n\r\n    // Check ?lang= query parameter\r\n    try {\r\n      const params = new URLSearchParams(window.location.search);\r\n      const langParam = params.get('lang');\r\n      if (langParam && isValidLanguageCode(langParam)) {\r\n        console.log('[RealtySoft Labels] Detected query param language:', langParam);\r\n        return langParam;\r\n      }\r\n    } catch (e) {\r\n      // URLSearchParams may fail in older browsers\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Detect language from browser/document with platform detection\r\n   */\r\n  function detectLanguage(): string {\r\n    // Priority 1: Explicit config override (handled in controller, but check here too)\r\n    if (typeof window !== 'undefined' && window.RealtySoftConfig?.language) {\r\n      return mapLanguageCode(window.RealtySoftConfig.language);\r\n    }\r\n\r\n    // Priority 2: User stored preference\r\n    try {\r\n      const stored = localStorage.getItem('rs_language');\r\n      if (stored && isValidLanguageCode(stored)) {\r\n        return stored;\r\n      }\r\n    } catch (e) {\r\n      // localStorage may be unavailable\r\n    }\r\n\r\n    // Priority 3: Platform/Plugin detection (WordPress plugins, Webflow, URL patterns)\r\n    const platformLang = detectPlatformLanguage();\r\n    if (platformLang) {\r\n      return mapLanguageCode(platformLang);\r\n    }\r\n\r\n    // Priority 4: HTML lang attribute\r\n    const htmlLang = document.documentElement.lang;\r\n    if (htmlLang) {\r\n      const shortLang = htmlLang.split('-')[0].toLowerCase();\r\n      if (languageMap[shortLang]) {\r\n        return languageMap[shortLang];\r\n      }\r\n    }\r\n\r\n    // Priority 5: Browser language\r\n    let lang: string | undefined =\r\n      navigator.language || (navigator as Navigator & { userLanguage?: string }).userLanguage;\r\n\r\n    if (lang) {\r\n      // Convert 'en-US' to 'en_US' format\r\n      lang = lang.replace('-', '_');\r\n\r\n      // Check if exact match exists\r\n      if (lang.includes('_')) {\r\n        return lang;\r\n      }\r\n\r\n      // Map short code to full format\r\n      if (languageMap[lang.toLowerCase()]) {\r\n        return languageMap[lang.toLowerCase()];\r\n      }\r\n    }\r\n\r\n    // Priority 6: Default\r\n    return 'en_US';\r\n  }\r\n\r\n  /**\r\n   * Initialize labels\r\n   */\r\n  function init(language: string | null = null): string {\r\n    currentLanguage = language || detectLanguage();\r\n    return currentLanguage;\r\n  }\r\n\r\n  /**\r\n   * Initialize labels with static defaults only (no API call).\r\n   * Used when labelsMode is 'static' or as first step in 'hybrid' mode.\r\n   */\r\n  function initStatic(language: string): void {\r\n    currentLanguage = language;\r\n    const langDefaults = languageDefaults[language] || {};\r\n    labels = { ...defaults, ...langDefaults };\r\n    console.log('[RealtySoft Labels] Initialized static labels for:', language, '- Total labels:', Object.keys(labels).length);\r\n  }\r\n\r\n  /**\r\n   * Load labels from API\r\n   */\r\n  async function loadFromAPI(apiLabels: Record<string, string>): Promise<void> {\r\n    // Merge order: English defaults â†’ API labels â†’ language-specific defaults\r\n    // Language-specific defaults take priority to ensure translations work\r\n    const langDefaults = languageDefaults[currentLanguage] || {};\r\n    const langDefaultCount = Object.keys(langDefaults).length;\r\n\r\n    if (apiLabels && typeof apiLabels === 'object') {\r\n      const labelCount = Object.keys(apiLabels).length;\r\n      console.log(\r\n        '[RealtySoft Labels] Loading',\r\n        labelCount,\r\n        'API labels +',\r\n        langDefaultCount,\r\n        'language defaults for:',\r\n        currentLanguage\r\n      );\r\n      // Language defaults take priority over API labels to ensure translations work\r\n      labels = { ...defaults, ...apiLabels, ...langDefaults };\r\n    } else {\r\n      console.log('[RealtySoft Labels] No API labels, using defaults +', langDefaultCount, 'language defaults');\r\n      labels = { ...defaults, ...langDefaults };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if overrides use the new per-language format\r\n   * New format: { _default: { key: value }, es_ES: { key: value } }\r\n   * Old format: { key: value }\r\n   */\r\n  function isPerLanguageFormat(overrides: LabelOverrides): overrides is Record<string, Record<string, string>> {\r\n    if (!overrides || typeof overrides !== 'object') return false;\r\n    const keys = Object.keys(overrides);\r\n    // Check if keys look like language codes or _default\r\n    return keys.some(key => key === '_default' || /^[a-z]{2}_[A-Z]{2}$/.test(key));\r\n  }\r\n\r\n  /**\r\n   * Apply client-specific label overrides.\r\n   * Supports two formats:\r\n   * - Flat format (legacy): { search_button: 'Find' }\r\n   * - Per-language format: { _default: { search_button: 'Find' }, es_ES: { search_button: 'Buscar' } }\r\n   */\r\n  function applyOverrides(overrides: LabelOverrides, language?: string): void {\r\n    if (!overrides || typeof overrides !== 'object') return;\r\n\r\n    const lang = language || currentLanguage;\r\n\r\n    if (isPerLanguageFormat(overrides)) {\r\n      // New per-language format\r\n      let appliedCount = 0;\r\n\r\n      // Apply _default overrides first (all languages)\r\n      const defaultOverrides = overrides['_default'];\r\n      if (defaultOverrides && typeof defaultOverrides === 'object') {\r\n        labels = { ...labels, ...defaultOverrides };\r\n        appliedCount += Object.keys(defaultOverrides).length;\r\n      }\r\n\r\n      // Then apply language-specific overrides (takes priority)\r\n      const langOverrides = overrides[lang];\r\n      if (langOverrides && typeof langOverrides === 'object') {\r\n        labels = { ...labels, ...langOverrides };\r\n        appliedCount += Object.keys(langOverrides).length;\r\n      }\r\n\r\n      console.log('[RealtySoft Labels] Applied', appliedCount, 'per-language overrides for:', lang);\r\n    } else {\r\n      // Legacy flat format - apply directly\r\n      const flatOverrides = overrides as Record<string, string>;\r\n      const overrideCount = Object.keys(flatOverrides).length;\r\n      console.log('[RealtySoft Labels] Applying', overrideCount, 'client label overrides');\r\n      labels = { ...labels, ...flatOverrides };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reload labels for a new language\r\n   */\r\n  async function reloadForLanguage(newLanguage: string): Promise<void> {\r\n    console.log('[RealtySoft Labels] Reloading labels for language:', newLanguage);\r\n    currentLanguage = newLanguage;\r\n\r\n    // Reset to defaults + language-specific defaults\r\n    const langDefaults = languageDefaults[newLanguage] || {};\r\n    labels = { ...defaults, ...langDefaults };\r\n\r\n    // Labels will be reloaded by the controller when it detects language change\r\n  }\r\n\r\n  /**\r\n   * Get a label with optional replacements\r\n   */\r\n  function get(key: string, replacements: Record<string, string | number> = {}): string {\r\n    let label = labels[key] || defaults[key] || key;\r\n\r\n    // Replace placeholders like {count}\r\n    for (const [placeholder, value] of Object.entries(replacements)) {\r\n      label = label.replace(new RegExp(`\\\\{${placeholder}\\\\}`, 'g'), String(value));\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  /**\r\n   * Get all labels\r\n   */\r\n  function getAll(): Record<string, string> {\r\n    return { ...labels };\r\n  }\r\n\r\n  /**\r\n   * Get current language\r\n   */\r\n  function getLanguage(): string {\r\n    return currentLanguage;\r\n  }\r\n\r\n  /**\r\n   * Set language\r\n   */\r\n  function setLanguage(lang: string): void {\r\n    currentLanguage = lang;\r\n  }\r\n\r\n  /**\r\n   * Format price based on locale\r\n   */\r\n  function formatPrice(price: number | null | undefined, currency: string = 'EUR'): string {\r\n    if (price === null || price === undefined) return '';\r\n\r\n    try {\r\n      const locale = currentLanguage.replace('_', '-');\r\n      return new Intl.NumberFormat(locale, {\r\n        style: 'currency',\r\n        currency: currency,\r\n        minimumFractionDigits: 0,\r\n        maximumFractionDigits: 0,\r\n      }).format(price);\r\n    } catch (e) {\r\n      return `\\u20AC${price.toLocaleString()}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format number based on locale\r\n   */\r\n  function formatNumber(number: number | null | undefined): string {\r\n    if (number === null || number === undefined) return '';\r\n\r\n    try {\r\n      const locale = currentLanguage.replace('_', '-');\r\n      return new Intl.NumberFormat(locale).format(number);\r\n    } catch (e) {\r\n      return number.toLocaleString();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format area (m\\u00B2)\r\n   */\r\n  function formatArea(value: number | null | undefined): string {\r\n    if (!value) return '';\r\n    return `${formatNumber(value)} m\\u00B2`;\r\n  }\r\n\r\n  // Public API\r\n  return {\r\n    init,\r\n    initStatic,\r\n    loadFromAPI,\r\n    applyOverrides,\r\n    reloadForLanguage,\r\n    get,\r\n    getAll,\r\n    getLanguage,\r\n    setLanguage,\r\n    detectLanguage,\r\n    mapLanguage: mapLanguageCode,\r\n    formatPrice,\r\n    formatNumber,\r\n    formatArea,\r\n  };\r\n})();\r\n\r\n// Assign to window for backwards compatibility\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { RealtySoftLabels: RealtySoftLabelsModule }).RealtySoftLabels =\r\n    RealtySoftLabels;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoftLabels };\r\nexport default RealtySoftLabels;\r\n","/**\r\n * RealtySoft Widget v3 - Analytics\r\n * Event tracking for search, views, clicks, wishlist, inquiries\r\n */\r\n\r\n// Analytics config interface\r\ninterface AnalyticsConfig {\r\n  enabled: boolean;\r\n  endpoint: string | null;\r\n  batchSize: number;\r\n  batchDelay: number;\r\n  debug: boolean;\r\n}\r\n\r\n// Analytics event interface\r\ninterface AnalyticsEvent {\r\n  category: string;\r\n  action: string;\r\n  data: Record<string, unknown>;\r\n  timestamp: string;\r\n  url: string;\r\n  referrer: string;\r\n  userAgent: string;\r\n  sessionId: string;\r\n}\r\n\r\n// Filter data for search tracking\r\ninterface FilterData {\r\n  location?: number | number[] | null;\r\n  listingType?: string | null;\r\n  propertyType?: string | string[] | null;\r\n  bedsMin?: number | null;\r\n  bedsMax?: number | null;\r\n  priceMin?: number | null;\r\n  priceMax?: number | null;\r\n  features?: number[] | null;\r\n}\r\n\r\n// Property data for tracking\r\ninterface PropertyTrackData {\r\n  id?: number;\r\n  ref?: string;\r\n  type?: string;\r\n  location?: string;\r\n  price?: number;\r\n}\r\n\r\n// Analytics module interface\r\ninterface RealtySoftAnalyticsModule {\r\n  init: (options?: Partial<AnalyticsConfig>) => void;\r\n  track: (category: string, action: string, data?: Record<string, unknown>) => void;\r\n  flush: () => void;\r\n  trackSearch: (filters?: FilterData) => void;\r\n  trackPropertyView: (property?: PropertyTrackData) => void;\r\n  trackCardClick: (property?: PropertyTrackData) => void;\r\n  trackGalleryView: (propertyId: number, imageIndex: number) => void;\r\n  trackWishlistAdd: (propertyId: number) => void;\r\n  trackWishlistRemove: (propertyId: number) => void;\r\n  trackWishlistView: (propertyIds?: number[]) => void;\r\n  trackWishlistShare: (method: string) => void;\r\n  trackInquiry: (propertyId: number, propertyRef?: string) => void;\r\n  trackShare: (platform: string, propertyId: number) => void;\r\n  trackLinkClick: (linkType: string, url: string) => void;\r\n  trackFilterChange: (filterName: string, value: unknown) => void;\r\n  trackPagination: (page: number, totalPages: number) => void;\r\n  trackSortChange: (sortValue: string) => void;\r\n  trackViewToggle: (view: string) => void;\r\n  trackResourceClick: (resourceType: string, propertyId: number) => void;\r\n}\r\n\r\nconst RealtySoftAnalytics: RealtySoftAnalyticsModule = (function () {\r\n  'use strict';\r\n\r\n  const config: AnalyticsConfig = {\r\n    enabled: true,\r\n    endpoint: null,\r\n    batchSize: 5,\r\n    batchDelay: 3000,\r\n    debug: true,\r\n  };\r\n\r\n  /**\r\n   * Auto-detect the analytics endpoint based on script location\r\n   */\r\n  function detectEndpoint(): string {\r\n    try {\r\n      const scripts = document.querySelectorAll('script[src*=\"realtysoft\"]');\r\n      for (let i = 0; i < scripts.length; i++) {\r\n        const src = (scripts[i] as HTMLScriptElement).src;\r\n        const pmIdx = src.indexOf('/propertymanager/');\r\n        if (pmIdx !== -1) {\r\n          return src.substring(0, pmIdx) + '/propertymanager/php/analytics-track.php';\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('[RealtySoft] Analytics detectEndpoint error:', e);\r\n    }\r\n    return 'https://realtysoft.ai/propertymanager/php/analytics-track.php';\r\n  }\r\n\r\n  let eventQueue: AnalyticsEvent[] = [];\r\n  let batchTimer: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  /**\r\n   * Initialize analytics\r\n   */\r\n  function init(options?: Partial<AnalyticsConfig>): void {\r\n    if (options) {\r\n      if (options.enabled !== undefined) config.enabled = options.enabled;\r\n      if (options.endpoint !== undefined) config.endpoint = options.endpoint;\r\n      if (options.batchSize !== undefined) config.batchSize = options.batchSize;\r\n      if (options.batchDelay !== undefined) config.batchDelay = options.batchDelay;\r\n      if (options.debug !== undefined) config.debug = options.debug;\r\n    }\r\n\r\n    if (!config.endpoint) {\r\n      config.endpoint = detectEndpoint();\r\n    }\r\n\r\n    console.log('[RealtySoft] Analytics initialized, endpoint:', config.endpoint);\r\n\r\n    window.addEventListener('beforeunload', flush);\r\n\r\n    document.addEventListener('visibilitychange', function () {\r\n      if (document.visibilityState === 'hidden') {\r\n        flush();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track an event\r\n   */\r\n  function track(\r\n    category: string,\r\n    action: string,\r\n    data: Record<string, unknown> = {}\r\n  ): void {\r\n    if (!config.enabled) return;\r\n\r\n    const event: AnalyticsEvent = {\r\n      category: category,\r\n      action: action,\r\n      data: data,\r\n      timestamp: new Date().toISOString(),\r\n      url: window.location.href,\r\n      referrer: document.referrer,\r\n      userAgent: navigator.userAgent,\r\n      sessionId: getSessionId(),\r\n    };\r\n\r\n    if (config.debug) {\r\n      console.log('[RealtySoft] Analytics Event:', category, action);\r\n    }\r\n\r\n    eventQueue.push(event);\r\n\r\n    if (eventQueue.length >= config.batchSize) {\r\n      flush();\r\n    } else {\r\n      scheduleBatch();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Schedule batch send\r\n   */\r\n  function scheduleBatch(): void {\r\n    if (batchTimer) return;\r\n\r\n    batchTimer = setTimeout(function () {\r\n      flush();\r\n      batchTimer = null;\r\n    }, config.batchDelay);\r\n  }\r\n\r\n  /**\r\n   * Flush event queue to server\r\n   */\r\n  function flush(): void {\r\n    if (eventQueue.length === 0) return;\r\n\r\n    const events = eventQueue.slice();\r\n    eventQueue = [];\r\n\r\n    console.log(\r\n      '[RealtySoft] Analytics: Sending',\r\n      events.length,\r\n      'events to',\r\n      config.endpoint\r\n    );\r\n\r\n    if (!config.endpoint) return;\r\n\r\n    fetch(config.endpoint, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ events: events }),\r\n      keepalive: true,\r\n    })\r\n      .then(function (response) {\r\n        console.log('[RealtySoft] Analytics response:', response.status);\r\n        return response.json();\r\n      })\r\n      .then(function (data) {\r\n        console.log('[RealtySoft] Analytics result:', data);\r\n      })\r\n      .catch(function (err) {\r\n        console.error('[RealtySoft] Analytics send failed:', err);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Get or create session ID\r\n   */\r\n  function getSessionId(): string {\r\n    let sessionId = sessionStorage.getItem('rs_session_id');\r\n    if (!sessionId) {\r\n      sessionId =\r\n        'rs_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n      sessionStorage.setItem('rs_session_id', sessionId);\r\n    }\r\n    return sessionId;\r\n  }\r\n\r\n  /**\r\n   * Track search event\r\n   */\r\n  function trackSearch(filters: FilterData = {}): void {\r\n    track('search', 'search', {\r\n      location: filters.location,\r\n      listing_type: filters.listingType,\r\n      property_type: filters.propertyType,\r\n      beds_min: filters.bedsMin,\r\n      beds_max: filters.bedsMax,\r\n      price_min: filters.priceMin,\r\n      price_max: filters.priceMax,\r\n      features: filters.features,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track property view\r\n   */\r\n  function trackPropertyView(property: PropertyTrackData = {}): void {\r\n    track('view', 'property_view', {\r\n      property_id: property.id,\r\n      property_ref: property.ref,\r\n      property_type: property.type,\r\n      location: property.location,\r\n      price: property.price,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track property card click\r\n   */\r\n  function trackCardClick(property: PropertyTrackData = {}): void {\r\n    track('click', 'card_click', {\r\n      property_id: property.id,\r\n      property_ref: property.ref,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track gallery view\r\n   */\r\n  function trackGalleryView(propertyId: number, imageIndex: number): void {\r\n    track('view', 'gallery_view', {\r\n      property_id: propertyId,\r\n      image_index: imageIndex,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track wishlist add\r\n   */\r\n  function trackWishlistAdd(propertyId: number): void {\r\n    track('wishlist', 'add', {\r\n      property_id: propertyId,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track wishlist remove\r\n   */\r\n  function trackWishlistRemove(propertyId: number): void {\r\n    track('wishlist', 'remove', {\r\n      property_id: propertyId,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track wishlist view\r\n   */\r\n  function trackWishlistView(propertyIds: number[] = []): void {\r\n    track('wishlist', 'view', {\r\n      property_ids: propertyIds,\r\n      count: propertyIds.length,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track wishlist share\r\n   */\r\n  function trackWishlistShare(method: string): void {\r\n    track('wishlist', 'share', {\r\n      method: method,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track inquiry submission\r\n   */\r\n  function trackInquiry(propertyId: number, propertyRef?: string): void {\r\n    track('inquiry', 'submit', {\r\n      property_id: propertyId,\r\n      property_ref: propertyRef,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track social share\r\n   */\r\n  function trackShare(platform: string, propertyId: number): void {\r\n    track('click', 'share', {\r\n      platform: platform,\r\n      property_id: propertyId,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track link click\r\n   */\r\n  function trackLinkClick(linkType: string, url: string): void {\r\n    track('click', 'link', {\r\n      link_type: linkType,\r\n      url: url,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track filter change\r\n   */\r\n  function trackFilterChange(filterName: string, value: unknown): void {\r\n    track('search', 'filter_change', {\r\n      filter: filterName,\r\n      value: value,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track pagination\r\n   */\r\n  function trackPagination(page: number, totalPages: number): void {\r\n    track('click', 'pagination', {\r\n      page: page,\r\n      total_pages: totalPages,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track sort change\r\n   */\r\n  function trackSortChange(sortValue: string): void {\r\n    track('click', 'sort', {\r\n      sort: sortValue,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track view toggle (grid/list)\r\n   */\r\n  function trackViewToggle(view: string): void {\r\n    track('click', 'view_toggle', {\r\n      view: view,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Track resource click (PDF, virtual tour, video, etc.)\r\n   */\r\n  function trackResourceClick(resourceType: string, propertyId: number): void {\r\n    track('click', 'resource', {\r\n      resource_type: resourceType,\r\n      property_id: propertyId,\r\n    });\r\n  }\r\n\r\n  return {\r\n    init,\r\n    track,\r\n    flush,\r\n    trackSearch,\r\n    trackPropertyView,\r\n    trackCardClick,\r\n    trackGalleryView,\r\n    trackWishlistAdd,\r\n    trackWishlistRemove,\r\n    trackWishlistView,\r\n    trackWishlistShare,\r\n    trackInquiry,\r\n    trackShare,\r\n    trackLinkClick,\r\n    trackFilterChange,\r\n    trackPagination,\r\n    trackSortChange,\r\n    trackViewToggle,\r\n    trackResourceClick,\r\n  };\r\n})();\r\n\r\n// Make globally available\r\nif (typeof window !== 'undefined') {\r\n  (\r\n    window as unknown as { RealtySoftAnalytics: RealtySoftAnalyticsModule }\r\n  ).RealtySoftAnalytics = RealtySoftAnalytics;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoftAnalytics };\r\nexport default RealtySoftAnalytics;\r\n","/**\r\n * RealtySoft Widget v3 - Toast Notification System\r\n * Non-blocking notifications for user feedback\r\n */\r\n\r\n// Toast types\r\ntype ToastType = 'success' | 'error' | 'warning' | 'info';\r\n\r\n// Toast position options\r\ntype ToastPosition =\r\n  | 'top-left'\r\n  | 'top-right'\r\n  | 'bottom-left'\r\n  | 'bottom-right'\r\n  | 'top-center'\r\n  | 'bottom-center';\r\n\r\n// Toast options interface\r\ninterface ToastOptions {\r\n  duration?: number;\r\n  position?: ToastPosition;\r\n  closable?: boolean;\r\n  pauseOnHover?: boolean;\r\n}\r\n\r\n// Toast data stored in array\r\ninterface ToastData {\r\n  id: number;\r\n  element: HTMLElement;\r\n  timeoutId: ReturnType<typeof setTimeout> | null;\r\n}\r\n\r\n// Toast module interface\r\ninterface RealtySoftToastModule {\r\n  init: () => void;\r\n  setPosition: (position: ToastPosition) => void;\r\n  show: (message: string, type?: ToastType, options?: ToastOptions) => number;\r\n  dismiss: (id: number) => void;\r\n  dismissAll: () => void;\r\n  success: (message: string, options?: ToastOptions) => number;\r\n  error: (message: string, options?: ToastOptions) => number;\r\n  warning: (message: string, options?: ToastOptions) => number;\r\n  info: (message: string, options?: ToastOptions) => number;\r\n}\r\n\r\nconst RealtySoftToast: RealtySoftToastModule = (function () {\r\n  'use strict';\r\n\r\n  let container: HTMLElement | null = null;\r\n  let toasts: ToastData[] = [];\r\n  let toastIdCounter = 0;\r\n\r\n  const defaultOptions: Required<ToastOptions> = {\r\n    duration: 4000,\r\n    position: 'bottom-right',\r\n    closable: true,\r\n    pauseOnHover: true,\r\n  };\r\n\r\n  /**\r\n   * Initialize toast container\r\n   */\r\n  function init(): void {\r\n    if (container) return;\r\n\r\n    container = document.createElement('div');\r\n    container.className = 'rs-toast-container rs-toast-container--bottom-right';\r\n    document.body.appendChild(container);\r\n  }\r\n\r\n  /**\r\n   * Set container position\r\n   */\r\n  function setPosition(position: ToastPosition): void {\r\n    if (!container) init();\r\n    if (container) {\r\n      container.className = `rs-toast-container rs-toast-container--${position}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a toast notification\r\n   */\r\n  function show(\r\n    message: string,\r\n    type: ToastType = 'info',\r\n    options: ToastOptions = {}\r\n  ): number {\r\n    if (!container) init();\r\n\r\n    const opts: Required<ToastOptions> = { ...defaultOptions, ...options };\r\n    const id = ++toastIdCounter;\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `rs-toast rs-toast--${type}`;\r\n    toast.dataset.toastId = String(id);\r\n\r\n    const icon = getIcon(type);\r\n\r\n    toast.innerHTML = `\r\n      <div class=\"rs-toast__icon\">${icon}</div>\r\n      <div class=\"rs-toast__content\">\r\n        <span class=\"rs-toast__message\">${escapeHtml(message)}</span>\r\n      </div>\r\n      ${\r\n        opts.closable\r\n          ? `\r\n        <button type=\"button\" class=\"rs-toast__close\" aria-label=\"Close\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n          </svg>\r\n        </button>\r\n      `\r\n          : ''\r\n      }\r\n      <div class=\"rs-toast__progress\"></div>\r\n    `;\r\n\r\n    // Add progress bar animation\r\n    const progressBar = toast.querySelector('.rs-toast__progress') as HTMLElement;\r\n    if (progressBar) {\r\n      progressBar.style.animationDuration = `${opts.duration}ms`;\r\n    }\r\n\r\n    // Bind events\r\n    if (opts.closable) {\r\n      const closeBtn = toast.querySelector('.rs-toast__close');\r\n      if (closeBtn) {\r\n        closeBtn.addEventListener('click', () => {\r\n          dismiss(id);\r\n        });\r\n      }\r\n    }\r\n\r\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\r\n    let remainingTime = opts.duration;\r\n    let startTime = Date.now();\r\n\r\n    if (opts.pauseOnHover) {\r\n      toast.addEventListener('mouseenter', () => {\r\n        remainingTime -= Date.now() - startTime;\r\n        if (timeoutId) {\r\n          clearTimeout(timeoutId);\r\n        }\r\n        if (progressBar) {\r\n          progressBar.style.animationPlayState = 'paused';\r\n        }\r\n      });\r\n\r\n      toast.addEventListener('mouseleave', () => {\r\n        startTime = Date.now();\r\n        timeoutId = setTimeout(() => dismiss(id), remainingTime);\r\n        if (progressBar) {\r\n          progressBar.style.animationPlayState = 'running';\r\n        }\r\n      });\r\n    }\r\n\r\n    // Add to container\r\n    if (container) {\r\n      container.appendChild(toast);\r\n    }\r\n\r\n    // Trigger animation\r\n    requestAnimationFrame(() => {\r\n      toast.classList.add('rs-toast--visible');\r\n    });\r\n\r\n    // Store reference\r\n    toasts.push({ id, element: toast, timeoutId: null });\r\n\r\n    // Auto dismiss\r\n    timeoutId = setTimeout(() => dismiss(id), opts.duration);\r\n    const toastData = toasts.find((t) => t.id === id);\r\n    if (toastData) {\r\n      toastData.timeoutId = timeoutId;\r\n    }\r\n\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Dismiss a toast\r\n   */\r\n  function dismiss(id: number): void {\r\n    const toastData = toasts.find((t) => t.id === id);\r\n    if (!toastData) return;\r\n\r\n    if (toastData.timeoutId) {\r\n      clearTimeout(toastData.timeoutId);\r\n    }\r\n\r\n    const toast = toastData.element;\r\n    toast.classList.remove('rs-toast--visible');\r\n    toast.classList.add('rs-toast--hiding');\r\n\r\n    setTimeout(() => {\r\n      toast.remove();\r\n      toasts = toasts.filter((t) => t.id !== id);\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   * Dismiss all toasts\r\n   */\r\n  function dismissAll(): void {\r\n    toasts.forEach((t) => dismiss(t.id));\r\n  }\r\n\r\n  /**\r\n   * Shorthand methods\r\n   */\r\n  function success(message: string, options?: ToastOptions): number {\r\n    return show(message, 'success', options);\r\n  }\r\n\r\n  function error(message: string, options?: ToastOptions): number {\r\n    return show(message, 'error', options);\r\n  }\r\n\r\n  function warning(message: string, options?: ToastOptions): number {\r\n    return show(message, 'warning', options);\r\n  }\r\n\r\n  function info(message: string, options?: ToastOptions): number {\r\n    return show(message, 'info', options);\r\n  }\r\n\r\n  /**\r\n   * Get icon for toast type\r\n   */\r\n  function getIcon(type: ToastType): string {\r\n    const icons: Record<ToastType, string> = {\r\n      success:\r\n        '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path><polyline points=\"22 4 12 14.01 9 11.01\"></polyline></svg>',\r\n      error:\r\n        '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"></line><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"></line></svg>',\r\n      warning:\r\n        '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"></path><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"></line><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"></line></svg>',\r\n      info: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line><line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line></svg>',\r\n    };\r\n    return icons[type] || icons.info;\r\n  }\r\n\r\n  /**\r\n   * Escape HTML\r\n   */\r\n  function escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  // Public API\r\n  return {\r\n    init,\r\n    setPosition,\r\n    show,\r\n    dismiss,\r\n    dismissAll,\r\n    success,\r\n    error,\r\n    warning,\r\n    info,\r\n  };\r\n})();\r\n\r\n// Make globally available\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { RealtySoftToast: RealtySoftToastModule }).RealtySoftToast =\r\n    RealtySoftToast;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoftToast };\r\nexport type { RealtySoftToastModule };\r\nexport default RealtySoftToast;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Manager\r\n * Handles wishlist storage, sorting, sharing, and notes\r\n * Stores full property data in localStorage for offline access\r\n * Provides shared state for modular wishlist components\r\n */\r\n\r\nimport type { RealtySoftStateModule } from '../types/index';\r\n\r\n// Declare global state module\r\ndeclare const RealtySoftState: RealtySoftStateModule | undefined;\r\n\r\n// Wishlist item interface\r\ninterface WishlistItem {\r\n  id: number;\r\n  ref_no: string;\r\n  title: string;\r\n  price: number;\r\n  location: string;\r\n  type: string;\r\n  beds: number;\r\n  baths: number;\r\n  built: number;\r\n  plot: number;\r\n  image: string;\r\n  image_count: number;\r\n  listing_type: string;\r\n  is_featured: boolean;\r\n  addedAt: number;\r\n  updatedAt?: number;\r\n  note: string;\r\n}\r\n\r\n// Wishlist storage type (keyed by ref_no)\r\ntype WishlistStorage = Record<string, WishlistItem>;\r\n\r\n// Property input for add operation\r\ninterface PropertyInput {\r\n  id: number;\r\n  ref_no?: string;\r\n  ref?: string;\r\n  title?: string;\r\n  name?: string;\r\n  price?: number;\r\n  list_price?: number;\r\n  location?: string;\r\n  location_id?: { name?: string };\r\n  type?: string;\r\n  type_id?: { name?: string };\r\n  beds?: number;\r\n  bedrooms?: number;\r\n  baths?: number;\r\n  bathrooms?: number;\r\n  built?: number;\r\n  build_size?: number;\r\n  built_area?: number;\r\n  plot?: number;\r\n  plot_size?: number;\r\n  images?: Array<string | { url?: string; src?: string }>;\r\n  total_images?: number;\r\n  image_count?: number;\r\n  listing_type?: string;\r\n  status?: string;\r\n  is_featured?: boolean;\r\n}\r\n\r\n// Sort settings\r\ninterface SortSettings {\r\n  field: string;\r\n  order: 'asc' | 'desc';\r\n}\r\n\r\n// Toggle result\r\ninterface ToggleResult {\r\n  action: 'added' | 'removed';\r\n  success: boolean;\r\n}\r\n\r\n// Compare toggle result\r\ninterface CompareToggleResult {\r\n  success: boolean;\r\n  action: 'added' | 'removed' | 'max_reached';\r\n}\r\n\r\n// Event names\r\ninterface WishlistEvents {\r\n  CHANGED: string;\r\n  SORTED: string;\r\n  COMPARE_CHANGED: string;\r\n  MODAL_OPEN: string;\r\n  MODAL_CLOSE: string;\r\n}\r\n\r\n// Wishlist Manager module interface\r\ninterface WishlistManagerModule {\r\n  // Core wishlist operations\r\n  getAll: () => WishlistStorage;\r\n  has: (refNo: string | number) => boolean;\r\n  add: (property: PropertyInput) => boolean;\r\n  remove: (refNo: string | number) => boolean;\r\n  toggle: (property: PropertyInput) => ToggleResult;\r\n  count: () => number;\r\n  get: (refNo: string | number) => WishlistItem | null;\r\n  updateNote: (refNo: string | number, note: string) => boolean;\r\n  clear: () => boolean;\r\n  getAsArray: (sortBy?: string, sortOrder?: 'asc' | 'desc') => WishlistItem[];\r\n  getRefNos: () => string[];\r\n  generateShareLink: () => string | null;\r\n  loadSharedWishlist: () => string[] | null;\r\n  exportAsJSON: () => void;\r\n  notifyChange: (action: string, property: WishlistItem | null) => void;\r\n\r\n  // Compare functionality\r\n  getCompareSelected: () => Set<string>;\r\n  setCompareSelected: (newSet: Set<string> | string[]) => void;\r\n  addToCompare: (refNo: string | number) => boolean;\r\n  removeFromCompare: (refNo: string | number) => void;\r\n  toggleCompare: (refNo: string | number) => CompareToggleResult;\r\n  isInCompare: (refNo: string | number) => boolean;\r\n  clearCompare: () => void;\r\n  getCompareCount: () => number;\r\n  getMaxCompare: () => number;\r\n  getCompareProperties: () => WishlistItem[];\r\n\r\n  // Sort functionality\r\n  setSort: (field: string, order?: 'asc' | 'desc') => void;\r\n  getSort: () => SortSettings;\r\n\r\n  // Modal communication\r\n  openModal: (modalType: string, data?: Record<string, unknown>) => void;\r\n  closeModal: (modalType: string) => void;\r\n\r\n  // Shared view detection\r\n  isSharedView: () => boolean;\r\n\r\n  // Event constants\r\n  getEvents: () => WishlistEvents;\r\n  EVENTS: WishlistEvents;\r\n}\r\n\r\nconst WishlistManager: WishlistManagerModule = (function () {\r\n  'use strict';\r\n\r\n  const STORAGE_KEY = 'realtysoft_wishlist';\r\n\r\n  // Event names for component communication\r\n  const EVENTS: WishlistEvents = {\r\n    CHANGED: 'wishlistChanged',\r\n    SORTED: 'wishlistSorted',\r\n    COMPARE_CHANGED: 'wishlistCompareChanged',\r\n    MODAL_OPEN: 'wishlistModalOpen',\r\n    MODAL_CLOSE: 'wishlistModalClose',\r\n  };\r\n\r\n  // Shared state for compare selections (not persisted)\r\n  let compareSelected = new Set<string>();\r\n  const maxCompare = 3;\r\n\r\n  // Current sort settings\r\n  const currentSort: SortSettings = {\r\n    field: 'addedAt',\r\n    order: 'desc',\r\n  };\r\n\r\n  /**\r\n   * Get all wishlist items as object\r\n   */\r\n  function getAll(): WishlistStorage {\r\n    try {\r\n      const data = localStorage.getItem(STORAGE_KEY);\r\n      return data ? JSON.parse(data) : {};\r\n    } catch (error) {\r\n      console.error('[Wishlist] Error reading wishlist:', error);\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save wishlist to localStorage\r\n   */\r\n  function save(wishlist: WishlistStorage): boolean {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(wishlist));\r\n      return true;\r\n    } catch (error) {\r\n      console.error('[Wishlist] Error saving wishlist:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if property is in wishlist\r\n   */\r\n  function has(refNo: string | number): boolean {\r\n    const wishlist = getAll();\r\n    return Object.prototype.hasOwnProperty.call(wishlist, String(refNo));\r\n  }\r\n\r\n  /**\r\n   * Add property to wishlist\r\n   */\r\n  function add(property: PropertyInput): boolean {\r\n    const wishlist = getAll();\r\n    const refNo = property.ref_no || property.ref || String(property.id);\r\n\r\n    // Store minimal property data to avoid localStorage quota issues\r\n    const images = property.images || [];\r\n    let firstImage = '';\r\n    if (images.length > 0) {\r\n      const img = images[0];\r\n      firstImage =\r\n        typeof img === 'string' ? img : (img as { url?: string; src?: string })?.url || (img as { url?: string; src?: string })?.src || '';\r\n    }\r\n    const imageCount =\r\n      property.total_images || property.image_count || images.length || 0;\r\n\r\n    const item: WishlistItem = {\r\n      id: property.id,\r\n      ref_no: refNo,\r\n      title: property.title || property.name || 'Property',\r\n      price: property.price || property.list_price || 0,\r\n      location: property.location || property.location_id?.name || 'N/A',\r\n      type: property.type || property.type_id?.name || 'N/A',\r\n      beds: property.beds || property.bedrooms || 0,\r\n      baths: property.baths || property.bathrooms || 0,\r\n      built: property.built || property.build_size || property.built_area || 0,\r\n      plot: property.plot || property.plot_size || 0,\r\n      image: firstImage,\r\n      image_count: imageCount,\r\n      listing_type: property.listing_type || property.status || 'resale',\r\n      is_featured: property.is_featured || false,\r\n      addedAt: Date.now(),\r\n      note: '',\r\n    };\r\n\r\n    wishlist[refNo] = item;\r\n\r\n    if (save(wishlist)) {\r\n      notifyChange('added', wishlist[refNo]);\r\n      return true;\r\n    }\r\n    console.error(\r\n      '[Wishlist] Storage quota exceeded. Consider clearing old items.'\r\n    );\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Remove property from wishlist\r\n   */\r\n  function remove(refNo: string | number): boolean {\r\n    const wishlist = getAll();\r\n    const property = wishlist[String(refNo)];\r\n\r\n    if (property) {\r\n      delete wishlist[String(refNo)];\r\n      if (save(wishlist)) {\r\n        notifyChange('removed', property);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Toggle property in wishlist\r\n   */\r\n  function toggle(property: PropertyInput): ToggleResult {\r\n    const refNo = property.ref_no || property.ref || String(property.id);\r\n    if (has(refNo)) {\r\n      return { action: 'removed', success: remove(refNo) };\r\n    } else {\r\n      return { action: 'added', success: add(property) };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get wishlist count\r\n   */\r\n  function count(): number {\r\n    return Object.keys(getAll()).length;\r\n  }\r\n\r\n  /**\r\n   * Get single property from wishlist\r\n   */\r\n  function get(refNo: string | number): WishlistItem | null {\r\n    const wishlist = getAll();\r\n    return wishlist[String(refNo)] || null;\r\n  }\r\n\r\n  /**\r\n   * Update property note\r\n   */\r\n  function updateNote(refNo: string | number, note: string): boolean {\r\n    const wishlist = getAll();\r\n    if (wishlist[String(refNo)]) {\r\n      wishlist[String(refNo)].note = note;\r\n      wishlist[String(refNo)].updatedAt = Date.now();\r\n      if (save(wishlist)) {\r\n        notifyChange('noteUpdated', wishlist[String(refNo)]);\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Clear entire wishlist\r\n   */\r\n  function clear(): boolean {\r\n    localStorage.removeItem(STORAGE_KEY);\r\n    notifyChange('cleared', null);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get wishlist as array (sorted)\r\n   */\r\n  function getAsArray(\r\n    sortBy: string = 'addedAt',\r\n    sortOrder: 'asc' | 'desc' = 'desc'\r\n  ): WishlistItem[] {\r\n    const wishlist = getAll();\r\n    const items = Object.values(wishlist);\r\n\r\n    items.sort((a, b) => {\r\n      // Get values using type-safe key access\r\n      const aItem = a as unknown as Record<string, unknown>;\r\n      const bItem = b as unknown as Record<string, unknown>;\r\n      let aVal = aItem[sortBy];\r\n      let bVal = bItem[sortBy];\r\n\r\n      // Handle null/undefined\r\n      if (aVal == null) aVal = '';\r\n      if (bVal == null) bVal = '';\r\n\r\n      // Convert to comparable values\r\n      let aCompare: string | number;\r\n      let bCompare: string | number;\r\n\r\n      if (typeof aVal === 'string') {\r\n        aCompare = aVal.toLowerCase();\r\n        bCompare = String(bVal || '').toLowerCase();\r\n      } else if (typeof aVal === 'number') {\r\n        aCompare = aVal;\r\n        bCompare = typeof bVal === 'number' ? bVal : 0;\r\n      } else {\r\n        aCompare = String(aVal);\r\n        bCompare = String(bVal);\r\n      }\r\n\r\n      if (sortOrder === 'asc') {\r\n        return aCompare > bCompare ? 1 : aCompare < bCompare ? -1 : 0;\r\n      } else {\r\n        return aCompare < bCompare ? 1 : aCompare > bCompare ? -1 : 0;\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  /**\r\n   * Get all ref numbers\r\n   */\r\n  function getRefNos(): string[] {\r\n    return Object.keys(getAll());\r\n  }\r\n\r\n  /**\r\n   * Generate shareable link (base64 encoded)\r\n   */\r\n  function generateShareLink(): string | null {\r\n    const refNos = getRefNos();\r\n\r\n    if (refNos.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const encoded = btoa(refNos.join(','));\r\n    return `${window.location.origin}${window.location.pathname}?shared=${encoded}`;\r\n  }\r\n\r\n  /**\r\n   * Load shared wishlist from URL\r\n   */\r\n  function loadSharedWishlist(): string[] | null {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const shared = urlParams.get('shared');\r\n\r\n    if (shared) {\r\n      try {\r\n        const refNos = atob(shared)\r\n          .split(',')\r\n          .filter((r) => r.trim());\r\n        return refNos;\r\n      } catch (error) {\r\n        console.error('[Wishlist] Error decoding shared link:', error);\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Export wishlist as JSON\r\n   */\r\n  function exportAsJSON(): void {\r\n    const wishlist = getAll();\r\n    const dataStr = JSON.stringify(wishlist, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n\r\n    const url = URL.createObjectURL(dataBlob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `wishlist_${new Date().toISOString().split('T')[0]}.json`;\r\n    link.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  /**\r\n   * Notify wishlist changes (for UI updates)\r\n   */\r\n  function notifyChange(action: string, property: WishlistItem | null): void {\r\n    try {\r\n      const event = new CustomEvent(EVENTS.CHANGED, {\r\n        detail: { action, property, count: count() },\r\n      });\r\n      window.dispatchEvent(event);\r\n    } catch (e) {\r\n      console.warn('[Wishlist] Event dispatch error:', e);\r\n    }\r\n\r\n    // Also update RealtySoftState if available\r\n    try {\r\n      if (typeof RealtySoftState !== 'undefined' && RealtySoftState) {\r\n        RealtySoftState.set('wishlist', getRefNos());\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Wishlist] State sync error:', e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get compare selected set\r\n   */\r\n  function getCompareSelected(): Set<string> {\r\n    return compareSelected;\r\n  }\r\n\r\n  /**\r\n   * Set compare selected (replaces entire set)\r\n   */\r\n  function setCompareSelected(newSet: Set<string> | string[]): void {\r\n    compareSelected = new Set(newSet);\r\n    notifyCompareChange();\r\n  }\r\n\r\n  /**\r\n   * Add to compare selection\r\n   */\r\n  function addToCompare(refNo: string | number): boolean {\r\n    if (compareSelected.size >= maxCompare) {\r\n      return false;\r\n    }\r\n    compareSelected.add(String(refNo));\r\n    notifyCompareChange();\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Remove from compare selection\r\n   */\r\n  function removeFromCompare(refNo: string | number): void {\r\n    compareSelected.delete(String(refNo));\r\n    notifyCompareChange();\r\n  }\r\n\r\n  /**\r\n   * Toggle compare selection\r\n   */\r\n  function toggleCompare(refNo: string | number): CompareToggleResult {\r\n    const ref = String(refNo);\r\n    if (compareSelected.has(ref)) {\r\n      compareSelected.delete(ref);\r\n      notifyCompareChange();\r\n      return { success: true, action: 'removed' };\r\n    } else if (compareSelected.size >= maxCompare) {\r\n      return { success: false, action: 'max_reached' };\r\n    } else {\r\n      compareSelected.add(ref);\r\n      notifyCompareChange();\r\n      return { success: true, action: 'added' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if in compare selection\r\n   */\r\n  function isInCompare(refNo: string | number): boolean {\r\n    return compareSelected.has(String(refNo));\r\n  }\r\n\r\n  /**\r\n   * Clear compare selection\r\n   */\r\n  function clearCompare(): void {\r\n    compareSelected.clear();\r\n    notifyCompareChange();\r\n  }\r\n\r\n  /**\r\n   * Get compare count\r\n   */\r\n  function getCompareCount(): number {\r\n    return compareSelected.size;\r\n  }\r\n\r\n  /**\r\n   * Get max compare limit\r\n   */\r\n  function getMaxCompare(): number {\r\n    return maxCompare;\r\n  }\r\n\r\n  /**\r\n   * Get properties selected for compare\r\n   */\r\n  function getCompareProperties(): WishlistItem[] {\r\n    return Array.from(compareSelected)\r\n      .map((refNo) => get(refNo))\r\n      .filter((item): item is WishlistItem => item !== null);\r\n  }\r\n\r\n  /**\r\n   * Notify compare selection changes\r\n   */\r\n  function notifyCompareChange(): void {\r\n    const event = new CustomEvent(EVENTS.COMPARE_CHANGED, {\r\n      detail: {\r\n        selected: Array.from(compareSelected),\r\n        count: compareSelected.size,\r\n        max: maxCompare,\r\n      },\r\n    });\r\n    window.dispatchEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Set current sort and notify\r\n   */\r\n  function setSort(field: string, order: 'asc' | 'desc' = 'desc'): void {\r\n    currentSort.field = field;\r\n    currentSort.order = order;\r\n\r\n    const event = new CustomEvent(EVENTS.SORTED, {\r\n      detail: { field, order },\r\n    });\r\n    window.dispatchEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Get current sort settings\r\n   */\r\n  function getSort(): SortSettings {\r\n    return { ...currentSort };\r\n  }\r\n\r\n  /**\r\n   * Request to open a modal\r\n   */\r\n  function openModal(\r\n    modalType: string,\r\n    data: Record<string, unknown> = {}\r\n  ): void {\r\n    const event = new CustomEvent(EVENTS.MODAL_OPEN, {\r\n      detail: { modalType, data },\r\n    });\r\n    window.dispatchEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Request to close a modal\r\n   */\r\n  function closeModal(modalType: string): void {\r\n    const event = new CustomEvent(EVENTS.MODAL_CLOSE, {\r\n      detail: { modalType },\r\n    });\r\n    window.dispatchEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Check if viewing shared wishlist\r\n   */\r\n  function isSharedView(): boolean {\r\n    return loadSharedWishlist() !== null;\r\n  }\r\n\r\n  /**\r\n   * Get event names for external use\r\n   */\r\n  function getEvents(): WishlistEvents {\r\n    return { ...EVENTS };\r\n  }\r\n\r\n  /**\r\n   * Sync with RealtySoftState (migrate from old format if needed)\r\n   */\r\n  function syncWithState(): void {\r\n    if (typeof RealtySoftState !== 'undefined' && RealtySoftState) {\r\n      RealtySoftState.set('wishlist', getRefNos());\r\n    }\r\n  }\r\n\r\n  // Initialize - sync with state\r\n  if (typeof document !== 'undefined') {\r\n    if (document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', syncWithState);\r\n    } else {\r\n      syncWithState();\r\n    }\r\n  }\r\n\r\n  // Public API\r\n  return {\r\n    // Core wishlist operations\r\n    getAll,\r\n    has,\r\n    add,\r\n    remove,\r\n    toggle,\r\n    count,\r\n    get,\r\n    updateNote,\r\n    clear,\r\n    getAsArray,\r\n    getRefNos,\r\n    generateShareLink,\r\n    loadSharedWishlist,\r\n    exportAsJSON,\r\n    notifyChange,\r\n\r\n    // Compare functionality\r\n    getCompareSelected,\r\n    setCompareSelected,\r\n    addToCompare,\r\n    removeFromCompare,\r\n    toggleCompare,\r\n    isInCompare,\r\n    clearCompare,\r\n    getCompareCount,\r\n    getMaxCompare,\r\n    getCompareProperties,\r\n\r\n    // Sort functionality\r\n    setSort,\r\n    getSort,\r\n\r\n    // Modal communication\r\n    openModal,\r\n    closeModal,\r\n\r\n    // Shared view detection\r\n    isSharedView,\r\n\r\n    // Event constants\r\n    getEvents,\r\n    EVENTS,\r\n  };\r\n})();\r\n\r\n// Export globally\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { WishlistManager: WishlistManagerModule }).WishlistManager =\r\n    WishlistManager;\r\n}\r\n\r\n// Export for ES modules\r\nexport { WishlistManager };\r\nexport type { WishlistManagerModule, WishlistItem, WishlistEvents, SortSettings, PropertyInput };\r\nexport default WishlistManager;\r\n","/**\r\n * RealtySoft Widget v3 - SPA Router\r\n * Intercepts property card clicks for client-side navigation (no page reload).\r\n * Uses history.pushState() to update the URL and swaps content in-place.\r\n */\r\n\r\nimport type {\r\n  Property,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  WidgetConfig,\r\n} from '../types/index';\r\n\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\ninterface RouterState {\r\n  rsView: 'detail' | 'listing';\r\n  ref?: string;\r\n  scrollY?: number;\r\n  listingUrl?: string;\r\n}\r\n\r\n// Session storage keys\r\nconst SS_SCROLL = 'rs_router_scroll';\r\nconst SS_LISTING_URL = 'rs_router_listing_url';\r\n\r\n/**\r\n * RealtySoftRouter â€” singleton SPA navigation module.\r\n *\r\n * Pattern: IIFE module (same as other core modules).\r\n */\r\nconst RealtySoftRouter = (function () {\r\n  'use strict';\r\n\r\n  let _initialized = false;\r\n  let _enabled = false;\r\n\r\n  /** References to listing/search containers hidden during detail view */\r\n  let _hiddenContainers: HTMLElement[] = [];\r\n\r\n  /** The detail container created by the router */\r\n  let _routerDetailContainer: HTMLElement | null = null;\r\n\r\n  // ---------------------------------------------------------------\r\n  // Public API\r\n  // ---------------------------------------------------------------\r\n\r\n  /**\r\n   * Initialize the router. Safe to call multiple times (idempotent).\r\n   */\r\n  function init(): void {\r\n    if (_initialized) return;\r\n    _initialized = true;\r\n\r\n    // Listen for browser back/forward\r\n    window.addEventListener('popstate', _onPopState);\r\n\r\n    // Determine if routing is possible on this page\r\n    _enabled = _detectListingContainers().length > 0;\r\n\r\n    console.log('[RealtySoftRouter] Initialized, enabled:', _enabled);\r\n  }\r\n\r\n  /**\r\n   * Whether the SPA router can handle navigation on the current page.\r\n   * Disabled: listing (/properties/) and detail (/property/) are separate\r\n   * pages with their own WordPress templates, so SPA in-page swapping\r\n   * would render detail content inside the wrong page layout.\r\n   * Card clicks fall through to full page navigation instead.\r\n   */\r\n  function isEnabled(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * SPA-navigate to a property detail view.\r\n   *\r\n   * @param property  The property to display\r\n   * @param url       The target URL (SEO-friendly or query-param)\r\n   */\r\n  function navigateToProperty(property: Property, url: string): void {\r\n    if (!isEnabled()) {\r\n      // Fallback: full page navigation\r\n      window.location.href = url;\r\n      return;\r\n    }\r\n\r\n    // 1. Save scroll position + listing URL\r\n    const scrollY = window.scrollY || window.pageYOffset;\r\n    try {\r\n      sessionStorage.setItem(SS_SCROLL, String(scrollY));\r\n      sessionStorage.setItem(SS_LISTING_URL, window.location.href);\r\n    } catch { /* storage full â€” non-critical */ }\r\n\r\n    // 2. Hide listing/search containers\r\n    _hiddenContainers = _detectListingContainers();\r\n    for (const el of _hiddenContainers) {\r\n      el.style.display = 'none';\r\n    }\r\n\r\n    // 3. Create detail container\r\n    const ref = property.ref || String(property.id);\r\n    _routerDetailContainer = document.createElement('div');\r\n    _routerDetailContainer.className = 'property-detail-container rs-router-detail';\r\n    _routerDetailContainer.id = 'property-detail-container';\r\n    _routerDetailContainer.dataset.propertyRef = ref;\r\n    _routerDetailContainer.dataset.rsAutoInjected = 'true';\r\n\r\n    // Loading spinner\r\n    _routerDetailContainer.innerHTML = `\r\n      <div class=\"rs-detail-loading\" style=\"text-align: center; padding: 60px 20px;\">\r\n        <div class=\"rs-spinner\" style=\"width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: rs-spin 1s linear infinite; margin: 0 auto;\"></div>\r\n        <p style=\"margin-top: 20px; color: #666;\">Loading property details...</p>\r\n      </div>\r\n      <style>\r\n        @keyframes rs-spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      </style>\r\n    `;\r\n\r\n    // Insert into the page â€” find the best parent\r\n    const parent = _findContentParent();\r\n    if (parent.firstChild) {\r\n      parent.insertBefore(_routerDetailContainer, parent.firstChild);\r\n    } else {\r\n      parent.appendChild(_routerDetailContainer);\r\n    }\r\n\r\n    // 4. Push history state\r\n    const title = property.title || 'Property Details';\r\n    const state: RouterState = { rsView: 'detail', ref };\r\n    history.pushState(state, title, url);\r\n\r\n    // 5. Signal to the widget that this ref should be loaded\r\n    window._rsAutoInjectedRef = ref;\r\n\r\n    // 6. Mark body ready (removes early-hide if present)\r\n    document.body.classList.add('rs-property-ready');\r\n    const earlyHide = document.getElementById('rs-early-hide');\r\n    if (earlyHide) earlyHide.remove();\r\n\r\n    // 7. Update document title\r\n    document.title = title;\r\n\r\n    // 8. Scroll to top\r\n    window.scrollTo({ top: 0, behavior: 'instant' as ScrollBehavior });\r\n\r\n    // 9. Trigger component initialization on the new container\r\n    // The controller's auto-init will pick up the container via the\r\n    // rs_detail component registration, but we also dispatch a custom\r\n    // event so the controller can handle it immediately.\r\n    window.dispatchEvent(new CustomEvent('rs:router:navigated', {\r\n      detail: { view: 'detail', ref, property }\r\n    }));\r\n\r\n    console.log('[RealtySoftRouter] Navigated to detail:', ref);\r\n  }\r\n\r\n  /**\r\n   * Navigate back to the listing view (reverse of navigateToProperty).\r\n   */\r\n  function navigateToListing(): void {\r\n    // 1. Remove detail container\r\n    if (_routerDetailContainer) {\r\n      _routerDetailContainer.remove();\r\n      _routerDetailContainer = null;\r\n    }\r\n\r\n    // 2. Restore listing/search containers\r\n    for (const el of _hiddenContainers) {\r\n      el.style.display = '';\r\n    }\r\n    _hiddenContainers = [];\r\n\r\n    // 3. Clear auto-injected ref\r\n    window._rsAutoInjectedRef = undefined;\r\n\r\n    // 4. Go back in history\r\n    const listingUrl = _getStoredListingUrl();\r\n    if (listingUrl) {\r\n      history.pushState({ rsView: 'listing' } as RouterState, '', listingUrl);\r\n    } else {\r\n      history.back();\r\n      return; // popstate will handle the rest\r\n    }\r\n\r\n    // 5. Restore scroll position\r\n    const storedScroll = _getStoredScroll();\r\n    if (storedScroll > 0) {\r\n      // Use requestAnimationFrame to ensure DOM has reflowed\r\n      requestAnimationFrame(() => {\r\n        window.scrollTo({ top: storedScroll, behavior: 'instant' as ScrollBehavior });\r\n      });\r\n    }\r\n\r\n    // 6. Restore document title (from listing page)\r\n    // The title was set by the listing page originally; we can't recover it,\r\n    // so leave it as-is or let the page logic handle it.\r\n\r\n    console.log('[RealtySoftRouter] Navigated back to listing');\r\n  }\r\n\r\n  /**\r\n   * Whether we can go back to a listing view via the router\r\n   * (i.e. we SPA-navigated to detail from a listing).\r\n   */\r\n  function canGoBackToListing(): boolean {\r\n    return _hiddenContainers.length > 0 || !!_getStoredListingUrl();\r\n  }\r\n\r\n  // ---------------------------------------------------------------\r\n  // Internal helpers\r\n  // ---------------------------------------------------------------\r\n\r\n  /** Find listing and search containers on the page */\r\n  function _detectListingContainers(): HTMLElement[] {\r\n    const selectors = [\r\n      '.rs_property_grid',\r\n      '.rs-property-grid',\r\n      '[class*=\"rs-listing-template\"]',\r\n      '[class*=\"rs-search-template\"]',\r\n      '.rs_search',\r\n      '#rs_search',\r\n      '.rs_listing',\r\n      '#rs_listing',\r\n      '.rs_property_carousel',\r\n      '.rs-property-carousel',\r\n      '.rs_pagination',\r\n      '.rs-pagination',\r\n      '.rs_results_count',\r\n      '.rs-results-count',\r\n      '.rs_sort',\r\n      '.rs_view_toggle',\r\n    ];\r\n\r\n    const found: HTMLElement[] = [];\r\n    const seen = new Set<HTMLElement>();\r\n\r\n    for (const sel of selectors) {\r\n      document.querySelectorAll<HTMLElement>(sel).forEach((el) => {\r\n        // Skip elements marked as duplicates\r\n        if ((el as HTMLElement).dataset?.rsTemplateDuplicate) return;\r\n\r\n        if (!seen.has(el)) {\r\n          seen.add(el);\r\n          found.push(el);\r\n        }\r\n      });\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  /** Find the best parent element to inject the detail container */\r\n  function _findContentParent(): HTMLElement {\r\n    const containerSelectors = [\r\n      'main',\r\n      '.content',\r\n      '#content',\r\n      'article',\r\n      '.entry-content',\r\n      '.page-content',\r\n      '.site-content',\r\n      '.main-content',\r\n      '#main',\r\n      '#primary',\r\n    ];\r\n\r\n    for (const sel of containerSelectors) {\r\n      const el = document.querySelector<HTMLElement>(sel);\r\n      if (el) return el;\r\n    }\r\n\r\n    return document.body;\r\n  }\r\n\r\n  /** Handle browser back/forward buttons */\r\n  function _onPopState(e: PopStateEvent): void {\r\n    const state = e.state as RouterState | null;\r\n\r\n    if (state && state.rsView === 'listing') {\r\n      // User pressed back from detail â†’ listing\r\n      if (_routerDetailContainer) {\r\n        _routerDetailContainer.remove();\r\n        _routerDetailContainer = null;\r\n      }\r\n      for (const el of _hiddenContainers) {\r\n        el.style.display = '';\r\n      }\r\n      _hiddenContainers = [];\r\n      window._rsAutoInjectedRef = undefined;\r\n\r\n      const storedScroll = _getStoredScroll();\r\n      if (storedScroll > 0) {\r\n        requestAnimationFrame(() => {\r\n          window.scrollTo({ top: storedScroll, behavior: 'instant' as ScrollBehavior });\r\n        });\r\n      }\r\n    } else if (state && state.rsView === 'detail' && state.ref) {\r\n      // User pressed forward from listing â†’ detail (re-enter detail)\r\n      // Let the page reload handle this â€” or we could re-inject,\r\n      // but for simplicity we allow default browser behavior.\r\n    }\r\n  }\r\n\r\n  function _getStoredScroll(): number {\r\n    try {\r\n      return parseInt(sessionStorage.getItem(SS_SCROLL) || '0', 10) || 0;\r\n    } catch {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  function _getStoredListingUrl(): string | null {\r\n    try {\r\n      return sessionStorage.getItem(SS_LISTING_URL);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // ---------------------------------------------------------------\r\n  // Module export\r\n  // ---------------------------------------------------------------\r\n\r\n  return {\r\n    init,\r\n    isEnabled,\r\n    navigateToProperty,\r\n    navigateToListing,\r\n    canGoBackToListing,\r\n  };\r\n})();\r\n\r\n// Make globally available\r\nif (typeof window !== 'undefined') {\r\n  (window as any).RealtySoftRouter = RealtySoftRouter;\r\n}\r\n\r\nexport { RealtySoftRouter };\r\nexport default RealtySoftRouter;\r\n","/**\r\n * RealtySoft Widget v3 - Central Controller\r\n * Main entry point that initializes and coordinates all modules\r\n */\r\n\r\n// Import TypeScript modules\r\nimport { RealtySoftState } from './state';\r\nimport { RealtySoftAPI } from './api';\r\nimport { RealtySoftLabels } from './labels';\r\nimport { RealtySoftAnalytics } from './analytics';\r\nimport { RealtySoftRouter } from './router';\r\nimport type {\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAnalyticsModule,\r\n  Property,\r\n  FilterState,\r\n  SearchParams,\r\n  WidgetConfig,\r\n  ComponentOptions,\r\n  LockedFilters,\r\n} from '../types/index';\r\n\r\n// Extended config type for controller-specific options\r\ninterface ControllerConfig {\r\n  language?: string;\r\n  apiKey?: string;\r\n  apiUrl?: string;\r\n  analytics?: boolean;\r\n  debug?: boolean;\r\n  ownerEmail?: string;\r\n  privacyPolicyUrl?: string;\r\n  defaultCountryCode?: string;\r\n  inquiryThankYouMessage?: string;\r\n  inquiryThankYouUrl?: string;\r\n  propertyPageSlug?: string;\r\n  useWidgetPropertyTemplate?: boolean;\r\n  useQueryParamUrls?: boolean;\r\n  propertyUrlFormat?: string;\r\n  resultsPage?: string;\r\n  detailPageTitle?: string;\r\n  labelsMode?: 'static' | 'api' | 'hybrid';\r\n  labelOverrides?: import('../types/index').LabelOverrides;\r\n  cache?: import('../types/index').CacheConfig;\r\n  serviceWorker?: boolean;\r\n  serviceWorkerUrl?: string;\r\n  wpRestUrl?: string;\r\n  wpApiNonce?: string;\r\n  siteName?: string;\r\n  enableMapView?: boolean;\r\n  perPage?: number;      // Items per page for grid/list view (default: 12)\r\n  mapPerPage?: number;   // Items per page for map view (default: 50)\r\n}\r\n\r\n// Widget mode type\r\ntype WidgetMode = 'combined' | 'search-only' | 'results-only' | null;\r\n\r\n// Component constructor type\r\ntype ComponentConstructor = new (\r\n  element: HTMLElement,\r\n  options: ComponentOptions\r\n) => { render?: () => void };\r\n\r\n// Component instance type\r\ninterface ComponentInstance {\r\n  render?: () => void;\r\n  bindEvents?: () => void;\r\n  [key: string]: unknown;\r\n}\r\n\r\n// HTML Element with component reference\r\ninterface RSHTMLElement extends HTMLElement {\r\n  _rsComponent?: ComponentInstance;\r\n}\r\n\r\n// Cast to allow flexibility in return type\r\nconst RealtySoft = (function () {\r\n  'use strict';\r\n\r\n  // â”€â”€ Early Content Hiding â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n  // Injected synchronously during script parse so the browser hides\r\n  // the page *before* first paint when we are on a property-detail URL.\r\n  // This prevents the \"flash of 404\" on CMS platforms that serve a 404\r\n  // template before the widget JS can take over.\r\n  (function earlyPropertyUrlHide() {\r\n    // Skip if SSR preview is already visible (rendered server-side by WordPress plugin).\r\n    // The preview IS the visible content â€” no hiding needed.\r\n    if ((window as any).__rsSSR) return;\r\n\r\n    // Skip if PHP (WordPress plugin) already injected the early-hide CSS + spinner.\r\n    // PHP handles it faster since it's in the initial HTML (no JS loading delay).\r\n    if (document.getElementById('rs-early-hide')) {\r\n      // Still add the body class for conditional CSS\r\n      document.addEventListener('DOMContentLoaded', () => {\r\n        document.body.classList.add('rs-property-detail');\r\n      });\r\n      // Safety: auto-remove after 5 seconds if widget fails to initialize\r\n      setTimeout(() => {\r\n        document.body.classList.add('rs-property-ready');\r\n        const existing = document.getElementById('rs-early-hide');\r\n        if (existing) existing.remove();\r\n        const overlay = document.getElementById('rs-loading-overlay');\r\n        if (overlay) overlay.remove();\r\n      }, 5000);\r\n      return;\r\n    }\r\n\r\n    const config = (window as any).RealtySoftConfig || {};\r\n    const slug = config.propertyPageSlug || 'property';\r\n    // Only hide on property DETAIL URLs (slug + subpath), not the listing page itself\r\n    // Also check query param format: /property?ref=X\r\n    const hasSubpath = new RegExp('/' + slug + '/[^/]+', 'i').test(window.location.pathname);\r\n    const hasQueryRef = /[?&]ref(erence)?=/i.test(window.location.search);\r\n    if (!hasSubpath && !hasQueryRef) return;\r\n\r\n    // Add body class for conditional CSS (listing vs detail)\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      document.body.classList.add('rs-property-detail');\r\n    });\r\n\r\n    const style = document.createElement('style');\r\n    style.id = 'rs-early-hide';\r\n    style.textContent =\r\n      'body:not(.rs-property-ready) > *:not(script):not(style):not(link) {' +\r\n      '  visibility: hidden !important;' +\r\n      '}' +\r\n      'body:not(.rs-property-ready)::after {' +\r\n      '  content: \"\";' +\r\n      '  position: fixed;' +\r\n      '  top: 0; left: 0; right: 0; bottom: 0;' +\r\n      '  background: #fff;' +\r\n      '  z-index: 999999;' +\r\n      '}';\r\n    (document.head || document.documentElement).appendChild(style);\r\n\r\n    // Safety: auto-remove after 5 seconds if widget fails to initialize\r\n    setTimeout(() => {\r\n      document.body.classList.add('rs-property-ready');\r\n      style.remove();\r\n    }, 5000);\r\n  })();\r\n\r\n  // Version check\r\n  console.log('[RealtySoft] Version 3.0.0 - TypeScript Build');\r\n\r\n  // Component registry\r\n  const components: Record<string, ComponentConstructor> = {};\r\n  const componentInstances: ComponentInstance[] = [];\r\n\r\n  // Initialization state\r\n  let initialized = false;\r\n  let initPromise: Promise<boolean> | null = null;\r\n\r\n  /**\r\n   * Transform API labels response into widget label format.\r\n   * API returns: { count, data: [{ code: \"location\", es_ES: \"Localidad\" }, ...] }\r\n   * Widget expects: { search_location: \"Localidad\", ... }\r\n   */\r\n  function transformAPILabels(\r\n    rawData: unknown,\r\n    language: string\r\n  ): Record<string, string> {\r\n    const result: Record<string, string> = {};\r\n\r\n    // Handle different response shapes\r\n    let items: Array<Record<string, string>> = [];\r\n    const raw = rawData as Record<string, unknown>;\r\n\r\n    if (raw && Array.isArray(raw.data)) {\r\n      items = raw.data as Array<Record<string, string>>;\r\n    } else if (Array.isArray(rawData)) {\r\n      items = rawData as Array<Record<string, string>>;\r\n    } else if (raw && !raw.data && !raw.count) {\r\n      // Already a flat key-value object â€” return as-is\r\n      return raw as Record<string, string>;\r\n    }\r\n\r\n    if (items.length === 0) return result;\r\n\r\n    // API code â†’ widget label key(s) mapping\r\n    const codeMap: Record<string, string[]> = {\r\n      location: ['search_location'],\r\n      sublocation: ['search_sublocation'],\r\n      property_type: ['search_property_type'],\r\n      status: ['search_listing_type', 'search_listing_type_all', 'status'],\r\n      bed: ['search_bedrooms', 'bedrooms'],\r\n      bath: ['search_bathrooms', 'bathrooms'],\r\n      price: ['search_price', 'price'],\r\n      min_price: ['search_price_min', 'search_price_select_min'],\r\n      max_price: ['search_price_max', 'search_price_select_max'],\r\n      submit: ['search_button'],\r\n      reset: ['search_reset'],\r\n      ref: ['search_reference', 'detail_reference', 'card_ref'],\r\n      features_heading: ['search_features', 'detail_features'],\r\n      build_size_value: ['search_built_area', 'detail_built_area', 'build_size'],\r\n      plot_size_value: ['search_plot_size', 'detail_plot_size', 'plot_size'],\r\n      min_build: ['search_min'],\r\n      max_build: ['search_max'],\r\n      order_drop_down: ['results_sort', 'sort_by'],\r\n      not_found_message: ['results_count_zero', 'no_results'],\r\n      close_button: ['general_close', 'close'],\r\n      more_button: ['pagination_load_more'],\r\n      property_detail_ref_no: ['detail_reference'],\r\n      property_detail_price: ['detail_price'],\r\n      property_detail_description: ['detail_description'],\r\n      property_detail_location: ['detail_location', 'location'],\r\n      property_detail_sublocation: ['detail_sublocation'],\r\n      property_detail_property_type: ['detail_property_type'],\r\n      property_detail_bedrooms: ['bedrooms', 'card_beds'],\r\n      property_detail_bathrooms: ['bathrooms', 'card_baths'],\r\n      property_detail_plot_size: ['detail_plot_size'],\r\n      property_detail_living_area: ['detail_built_area'],\r\n      property_detail_terrace: ['detail_terrace'],\r\n      property_listing_read_more_button: ['card_view', 'view_details'],\r\n      property_listing_reference: ['card_ref'],\r\n      property_listing_bedrooms: ['card_beds'],\r\n      property_listing_bathrooms: ['card_baths'],\r\n      property_listing_built_area: ['build_size'],\r\n      property_listing_plot: ['plot_size'],\r\n      property_listing_price: ['price'],\r\n      property_listing_month: ['detail_per_month'],\r\n      property_button_text: ['view_details', 'card_view'],\r\n      property_property_sale: ['listing_type_sale', 'search_sale'],\r\n      tab_sale: ['listing_type_sale', 'search_sale'],\r\n      tab_rent: ['search_rent', 'listing_type_long_rental'],\r\n      tab_holiday: ['listing_type_short_rental'],\r\n      tab_dev: ['listing_type_new'],\r\n    };\r\n\r\n    for (const item of items) {\r\n      const code = item.code;\r\n      if (!code) continue;\r\n\r\n      // Get value for current language, fall back to any available language value\r\n      let value = item[language];\r\n      if (!value) {\r\n        // Try without region (e.g. 'es' from 'es_ES')\r\n        const shortLang = language.split('_')[0];\r\n        for (const key of Object.keys(item)) {\r\n          if (key !== 'code' && key.startsWith(shortLang)) {\r\n            value = item[key];\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (!value) continue;\r\n\r\n      // Special handling for label_status_dropdown (pipe-separated listing types)\r\n      if (code === 'label_status_dropdown') {\r\n        const statusMap: Record<string, string> = {\r\n          resale: 'listing_type_sale',\r\n          development: 'listing_type_new',\r\n          long_rental: 'listing_type_long_rental',\r\n          short_rental: 'listing_type_short_rental',\r\n        };\r\n        const pairs = value.split(',');\r\n        for (const pair of pairs) {\r\n          const [typeKey, typeLabel] = pair.split('|');\r\n          if (typeKey && typeLabel && statusMap[typeKey.trim()]) {\r\n            result[statusMap[typeKey.trim()]] = typeLabel.trim();\r\n          }\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // Special handling for order_button (pipe-separated sort options)\r\n      if (code === 'order_button') {\r\n        const sortMap: Record<string, string> = {\r\n          list_price_asc: 'sort_price_asc',\r\n          list_price_desc: 'sort_price_desc',\r\n          last_date_desc: 'sort_newest',\r\n        };\r\n        const pairs = value.split(',');\r\n        for (const pair of pairs) {\r\n          const [sortKey, sortLabel] = pair.split('|');\r\n          if (sortKey && sortLabel && sortMap[sortKey.trim()]) {\r\n            result[sortMap[sortKey.trim()]] = sortLabel.trim();\r\n          }\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // Map code to widget label key(s)\r\n      const widgetKeys = codeMap[code];\r\n      if (widgetKeys) {\r\n        for (const wk of widgetKeys) {\r\n          result[wk] = value;\r\n        }\r\n      } else {\r\n        // Store unmapped codes directly (may match widget keys)\r\n        result[code] = value;\r\n      }\r\n    }\r\n\r\n    console.log('[RealtySoft] Transformed', Object.keys(result).length, 'API labels for language:', language);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Extract available language codes from the unfiltered labels API response.\r\n   * API returns: { count, data: [{ code: \"location\", en_US: \"Location\", es_ES: \"Localidad\", ... }, ...] }\r\n   * We scan item keys (excluding \"code\") to find all language codes present.\r\n   */\r\n  function extractAvailableLanguages(rawData: unknown): string[] {\r\n    if (!rawData) return ['en_US'];\r\n\r\n    const raw = rawData as Record<string, unknown>;\r\n    let items: Array<Record<string, string>> = [];\r\n\r\n    if (raw && Array.isArray(raw.data)) {\r\n      items = raw.data as Array<Record<string, string>>;\r\n    } else if (Array.isArray(rawData)) {\r\n      items = rawData as Array<Record<string, string>>;\r\n    }\r\n\r\n    if (items.length === 0) return ['en_US'];\r\n\r\n    const langCodes = new Set<string>();\r\n\r\n    // Scan first few items to detect language keys\r\n    const samplSize = Math.min(items.length, 10);\r\n    for (let i = 0; i < samplSize; i++) {\r\n      const item = items[i];\r\n      for (const key of Object.keys(item)) {\r\n        // Language keys match pattern like \"en_US\", \"es_ES\", \"nl_NL\", \"pl_PL\"\r\n        if (key !== 'code' && /^[a-z]{2}_[A-Z]{2}$/.test(key)) {\r\n          langCodes.add(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Always include en_US as fallback\r\n    langCodes.add('en_US');\r\n\r\n    const result = Array.from(langCodes).sort();\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Parse data attributes for locked filters\r\n   */\r\n  function parseLockedFilters(container: HTMLElement): LockedFilters {\r\n    const locked: LockedFilters = {};\r\n    const attrMap: Record<string, string> = {\r\n      'rs-location': 'location',\r\n      'rs-property-type': 'propertyType',\r\n      'rs-listing-type': 'listingType',\r\n      'rs-beds-min': 'bedsMin',\r\n      'rs-beds-max': 'bedsMax',\r\n      'rs-baths-min': 'bathsMin',\r\n      'rs-baths-max': 'bathsMax',\r\n      'rs-price-min': 'priceMin',\r\n      'rs-price-max': 'priceMax',\r\n      'rs-built-min': 'builtMin',\r\n      'rs-built-max': 'builtMax',\r\n      'rs-plot-min': 'plotMin',\r\n      'rs-plot-max': 'plotMax',\r\n      'rs-features': 'features',\r\n      'rs-ref': 'ref',\r\n    };\r\n\r\n    const numericKeys = [\r\n      'bedsMin',\r\n      'bedsMax',\r\n      'bathsMin',\r\n      'bathsMax',\r\n      'priceMin',\r\n      'priceMax',\r\n      'builtMin',\r\n      'builtMax',\r\n      'plotMin',\r\n      'plotMax',\r\n      'location',\r\n      'propertyType',\r\n    ];\r\n\r\n    for (const [attr, key] of Object.entries(attrMap)) {\r\n      const datasetKey = attr.replace(/-([a-z])/g, (g) => g[1].toUpperCase());\r\n      const value = container.dataset[datasetKey];\r\n      if (value !== undefined && value !== '') {\r\n        if (numericKeys.includes(key)) {\r\n          locked[key] = parseInt(value, 10);\r\n        } else if (key === 'features') {\r\n          locked[key] = value.split(',').map((v) => parseInt(v.trim(), 10));\r\n        } else {\r\n          locked[key] = value;\r\n        }\r\n      }\r\n    }\r\n\r\n    return locked;\r\n  }\r\n\r\n  /**\r\n   * Validate domain against whitelist\r\n   */\r\n  async function validateDomain(): Promise<boolean> {\r\n    // In production, this would check against the PHP whitelist\r\n    // For now, we trust the proxy to handle validation\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Detect widget mode based on container presence\r\n   */\r\n  function detectMode(): WidgetMode {\r\n    const hasSearch =\r\n      !!document.getElementById('rs_search') ||\r\n      !!document.querySelector('.rs-search-template-01') ||\r\n      !!document.querySelector('.rs-search-template-02') ||\r\n      !!document.querySelector('.rs-search-template-03') ||\r\n      !!document.querySelector('.rs-search-template-04') ||\r\n      !!document.querySelector('.rs-search-template-05') ||\r\n      !!document.querySelector('.rs-search-template-06');\r\n    let hasListing =\r\n      !!document.getElementById('rs_listing') ||\r\n      !!document.querySelector('.rs-listing-template-01') ||\r\n      !!document.querySelector('.rs-listing-template-02') ||\r\n      !!document.querySelector('.rs-listing-template-03') ||\r\n      !!document.querySelector('.rs-listing-template-04') ||\r\n      !!document.querySelector('.rs-listing-template-05') ||\r\n      !!document.querySelector('.rs-listing-template-06') ||\r\n      !!document.querySelector('.rs-listing-template-07') ||\r\n      !!document.querySelector('.rs-listing-template-08') ||\r\n      !!document.querySelector('.rs-listing-template-09') ||\r\n      !!document.querySelector('.rs-listing-template-10') ||\r\n      !!document.querySelector('.rs-listing-template-11') ||\r\n      !!document.querySelector('.rs-listing-template-12') ||\r\n      !!document.querySelector('.rs-map-search-template-01');\r\n\r\n    // Standalone listings fetch their own data independently â€” don't count for widget mode\r\n    if (hasListing) {\r\n      const allListings = document.querySelectorAll(\r\n        '#rs_listing, [class*=\"rs-listing-template-\"]'\r\n      );\r\n      hasListing = Array.from(allListings).some(\r\n        el => !el.hasAttribute('data-rs-standalone')\r\n      );\r\n    }\r\n\r\n    if (hasSearch && hasListing) {\r\n      return 'combined';\r\n    } else if (hasSearch && !hasListing) {\r\n      return 'search-only';\r\n    } else if (!hasSearch && hasListing) {\r\n      return 'results-only';\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get results page URL for redirect in search-only mode\r\n   */\r\n  function getResultsPageURL(): string {\r\n    const globalConfig = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n    if (globalConfig.resultsPage) {\r\n      return globalConfig.resultsPage;\r\n    }\r\n    return '/properties';\r\n  }\r\n\r\n  /**\r\n   * Build search URL with filter parameters\r\n   */\r\n  function buildSearchURL(filters: Partial<FilterState>): string {\r\n    const baseURL = getResultsPageURL();\r\n    const params = new URLSearchParams();\r\n\r\n    if (filters.location) params.set('location', String(filters.location));\r\n    if (filters.sublocation) params.set('sublocation', String(filters.sublocation));\r\n    if (filters.propertyType) params.set('type', String(filters.propertyType));\r\n    if (filters.listingType) params.set('listing', filters.listingType);\r\n    if (filters.bedsMin) params.set('beds', String(filters.bedsMin));\r\n    if (filters.bathsMin) params.set('baths', String(filters.bathsMin));\r\n    if (filters.priceMin) params.set('price_min', String(filters.priceMin));\r\n    if (filters.priceMax) params.set('price_max', String(filters.priceMax));\r\n    if (filters.builtMin) params.set('built_min', String(filters.builtMin));\r\n    if (filters.builtMax) params.set('built_max', String(filters.builtMax));\r\n    if (filters.plotMin) params.set('plot_min', String(filters.plotMin));\r\n    if (filters.plotMax) params.set('plot_max', String(filters.plotMax));\r\n    if (filters.ref) params.set('ref', filters.ref);\r\n    if (filters.features && filters.features.length > 0) {\r\n      params.set('features', filters.features.join(','));\r\n    }\r\n\r\n    const queryString = params.toString();\r\n    return queryString ? `${baseURL}?${queryString}` : baseURL;\r\n  }\r\n\r\n  /**\r\n   * Parse URL parameters and apply as filters\r\n   */\r\n  function parseURLFilters(): void {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const filters: Partial<FilterState> = {};\r\n\r\n    if (urlParams.has('location')) {\r\n      const val = parseInt(urlParams.get('location') || '', 10);\r\n      if (!isNaN(val)) filters.location = val;\r\n    }\r\n    if (urlParams.has('sublocation')) {\r\n      const val = parseInt(urlParams.get('sublocation') || '', 10);\r\n      if (!isNaN(val)) filters.sublocation = val;\r\n    }\r\n    if (urlParams.has('type')) {\r\n      const val = parseInt(urlParams.get('type') || '', 10);\r\n      if (!isNaN(val)) filters.propertyType = val;\r\n    }\r\n    if (urlParams.has('listing')) {\r\n      filters.listingType = urlParams.get('listing') || undefined;\r\n    }\r\n    if (urlParams.has('beds')) {\r\n      const val = parseInt(urlParams.get('beds') || '', 10);\r\n      if (!isNaN(val)) filters.bedsMin = val;\r\n    }\r\n    if (urlParams.has('baths')) {\r\n      const val = parseInt(urlParams.get('baths') || '', 10);\r\n      if (!isNaN(val)) filters.bathsMin = val;\r\n    }\r\n    if (urlParams.has('price_min')) {\r\n      const val = parseInt(urlParams.get('price_min') || '', 10);\r\n      if (!isNaN(val)) filters.priceMin = val;\r\n    }\r\n    if (urlParams.has('price_max')) {\r\n      const val = parseInt(urlParams.get('price_max') || '', 10);\r\n      if (!isNaN(val)) filters.priceMax = val;\r\n    }\r\n    if (urlParams.has('built_min')) {\r\n      const val = parseInt(urlParams.get('built_min') || '', 10);\r\n      if (!isNaN(val)) filters.builtMin = val;\r\n    }\r\n    if (urlParams.has('built_max')) {\r\n      const val = parseInt(urlParams.get('built_max') || '', 10);\r\n      if (!isNaN(val)) filters.builtMax = val;\r\n    }\r\n    if (urlParams.has('plot_min')) {\r\n      const val = parseInt(urlParams.get('plot_min') || '', 10);\r\n      if (!isNaN(val)) filters.plotMin = val;\r\n    }\r\n    if (urlParams.has('plot_max')) {\r\n      const val = parseInt(urlParams.get('plot_max') || '', 10);\r\n      if (!isNaN(val)) filters.plotMax = val;\r\n    }\r\n    if (urlParams.has('ref')) {\r\n      filters.ref = urlParams.get('ref') || undefined;\r\n    }\r\n    if (urlParams.has('features')) {\r\n      const featuresStr = urlParams.get('features');\r\n      if (featuresStr) {\r\n        filters.features = featuresStr\r\n          .split(',')\r\n          .map((f) => parseInt(f, 10))\r\n          .filter((f) => !isNaN(f));\r\n      }\r\n    }\r\n\r\n    if (Object.keys(filters).length > 0) {\r\n      console.log('[RealtySoft] Applying URL filters:', filters);\r\n      for (const [key, value] of Object.entries(filters)) {\r\n        RealtySoftState.set(`filters.${key}`, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Store current mode\r\n  let widgetMode: WidgetMode = null;\r\n\r\n  /**\r\n   * Template HTML definitions for auto-rendering\r\n   */\r\n  const TEMPLATES: Record<string, string> = {\r\n    // Search Template 01: Compact Horizontal (2-row)\r\n    'rs-search-template-01': `\r\n      <div class=\"rs-template-search-01__row rs-template-search-01__row--primary\">\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--reference\">\r\n          <div class=\"rs_ref\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--location\">\r\n          <div class=\"rs_location\" data-rs-variation=\"2\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--type\">\r\n          <div class=\"rs_property_type\" data-rs-variation=\"2\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--search\">\r\n          <div class=\"rs_search_button\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs-template-search-01__row rs-template-search-01__row--secondary\">\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--beds\">\r\n          <div class=\"rs_bedrooms\" data-rs-variation=\"1\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--baths\">\r\n          <div class=\"rs_bathrooms\" data-rs-variation=\"1\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--price-min\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--price-max\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--listing-type\">\r\n          <div class=\"rs_listing_type\" data-rs-variation=\"1\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--features\">\r\n          <div class=\"rs_features\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-01__field rs-template-search-01__field--reset\">\r\n          <div class=\"rs_reset_button\"></div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Search Template 02: Single Row with More Filters Dropdown\r\n    'rs-search-template-02': `\r\n      <div class=\"rs-template-search-02__row\">\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--location\">\r\n          <div class=\"rs_location\" data-rs-variation=\"1\" data-rs-placeholder=\"Search Location\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--property-type\">\r\n          <div class=\"rs_property_type\" data-rs-variation=\"2\" data-rs-placeholder=\"Property Type\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--price\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min Price\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--price\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\" data-rs-placeholder=\"Max Price\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__more-filters-wrapper\">\r\n          <button type=\"button\" class=\"rs-template-search-02__more-filters-btn\">\r\n            <svg class=\"rs-template-search-02__more-filters-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polygon points=\"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3\"></polygon>\r\n            </svg>\r\n            <span>More Filters</span>\r\n            <svg class=\"rs-template-search-02__more-filters-arrow\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n            </svg>\r\n          </button>\r\n          <div class=\"rs-template-search-02__dropdown\">\r\n            <div class=\"rs-template-search-02__dropdown-header\">\r\n              <span class=\"rs-template-search-02__dropdown-title\">More Filters</span>\r\n              <button type=\"button\" class=\"rs-template-search-02__dropdown-close\">\r\n                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div class=\"rs-template-search-02__dropdown-section\">\r\n              <div class=\"rs-template-search-02__dropdown-label\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\r\n                  <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\r\n                </svg>\r\n                Reference\r\n              </div>\r\n              <div class=\"rs-template-search-02__dropdown-field\">\r\n                <div class=\"rs_ref\" data-rs-placeholder=\"Reference\"></div>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-search-02__dropdown-section\">\r\n              <div class=\"rs-template-search-02__dropdown-row\">\r\n                <div class=\"rs-template-search-02__dropdown-col\">\r\n                  <div class=\"rs-template-search-02__dropdown-label\">\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <path d=\"M2 4v16\"></path>\r\n                      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                      <path d=\"M2 17h20\"></path>\r\n                      <path d=\"M6 8v9\"></path>\r\n                    </svg>\r\n                    Bedrooms\r\n                  </div>\r\n                  <div class=\"rs-template-search-02__dropdown-field\">\r\n                    <div class=\"rs_bedrooms\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min. Bedrooms\"></div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"rs-template-search-02__dropdown-col\">\r\n                  <div class=\"rs-template-search-02__dropdown-label\">\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                      <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                      <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                    </svg>\r\n                    Bathrooms\r\n                  </div>\r\n                  <div class=\"rs-template-search-02__dropdown-field\">\r\n                    <div class=\"rs_bathrooms\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min. Bathrooms\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-search-02__dropdown-section\">\r\n              <div class=\"rs-template-search-02__dropdown-label\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                  <path d=\"M3 9h18\"></path>\r\n                  <path d=\"M9 21V9\"></path>\r\n                </svg>\r\n                Min. Build\r\n              </div>\r\n              <div class=\"rs-template-search-02__dropdown-field\">\r\n                <div class=\"rs_built_area\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min. Build\"></div>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-search-02__dropdown-section\">\r\n              <div class=\"rs-template-search-02__dropdown-label\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                  <path d=\"M12 2v20\"></path>\r\n                </svg>\r\n                Min. Plot\r\n              </div>\r\n              <div class=\"rs-template-search-02__dropdown-field\">\r\n                <div class=\"rs_plot_size\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min. Plot\"></div>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-search-02__dropdown-section\">\r\n              <div class=\"rs-template-search-02__dropdown-label\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\r\n                  <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\r\n                </svg>\r\n                Status\r\n              </div>\r\n              <div class=\"rs-template-search-02__dropdown-field\">\r\n                <div class=\"rs_listing_type\" data-rs-variation=\"3\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--search\">\r\n          <div class=\"rs_search_button\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-02__field rs-template-search-02__field--reset\">\r\n          <div class=\"rs_reset_button\"></div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Search Template 03: Tab-Based Search\r\n    'rs-search-template-03': `\r\n      <div class=\"rs-template-search-03__tabs\">\r\n        <button type=\"button\" class=\"rs-template-search-03__tab is-active\" data-listing-type=\"resale\">Sales</button>\r\n        <button type=\"button\" class=\"rs-template-search-03__tab\" data-listing-type=\"development\">New Developments</button>\r\n        <button type=\"button\" class=\"rs-template-search-03__tab\" data-listing-type=\"long_rental\">Rentals</button>\r\n        <button type=\"button\" class=\"rs-template-search-03__tab\" data-listing-type=\"short_rental\">Holiday Rentals</button>\r\n      </div>\r\n      <div class=\"rs-template-search-03__form\">\r\n        <div class=\"rs-template-search-03__row rs-template-search-03__row--filters\">\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--location\">\r\n            <div class=\"rs_location\" data-rs-variation=\"3\" data-rs-placeholder=\"Location\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--type\">\r\n            <div class=\"rs_property_type\" data-rs-variation=\"2\" data-rs-placeholder=\"Property Type\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--beds\">\r\n            <div class=\"rs_bedrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Bedrooms\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--baths\">\r\n            <div class=\"rs_bathrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Bathrooms\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--price-min\">\r\n            <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min Price\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--price-max\">\r\n            <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\" data-rs-placeholder=\"Max Price\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--reference\">\r\n            <div class=\"rs_ref\" data-rs-placeholder=\"Reference\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"rs-template-search-03__row rs-template-search-03__row--actions\">\r\n          <div class=\"rs-template-search-03__features\">\r\n            <div class=\"rs_features\"></div>\r\n          </div>\r\n          <div class=\"rs-template-search-03__field rs-template-search-03__field--search\">\r\n            <div class=\"rs_search_button\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Search Template 04: Dark Horizontal Bar\r\n    'rs-search-template-04': `\r\n      <div class=\"rs-template-search-04__row rs-template-search-04__row--primary\">\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--reference\">\r\n          <label class=\"rs-template-search-04__label\">Reference</label>\r\n          <div class=\"rs_ref\" data-rs-placeholder=\"Ref\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--location\">\r\n          <label class=\"rs-template-search-04__label\">Location</label>\r\n          <div class=\"rs_location\" data-rs-variation=\"2\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--type\">\r\n          <label class=\"rs-template-search-04__label\">Property Type</label>\r\n          <div class=\"rs_property_type\" data-rs-variation=\"2\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--status\">\r\n          <label class=\"rs-template-search-04__label\">Status</label>\r\n          <div class=\"rs_listing_type\" data-rs-variation=\"1\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs-template-search-04__row rs-template-search-04__row--secondary\">\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--beds\">\r\n          <label class=\"rs-template-search-04__label\">Bed</label>\r\n          <div class=\"rs_bedrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--baths\">\r\n          <label class=\"rs-template-search-04__label\">Bath</label>\r\n          <div class=\"rs_bathrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--price-min\">\r\n          <label class=\"rs-template-search-04__label\">Min Price</label>\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--price-max\">\r\n          <label class=\"rs-template-search-04__label\">Max Price</label>\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\" data-rs-placeholder=\"Any\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__features\">\r\n          <div class=\"rs_features\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-04__field rs-template-search-04__field--search\">\r\n          <div class=\"rs_search_button\"></div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Search Template 05: Vertical Card/Sidebar\r\n    'rs-search-template-05': `\r\n      <div class=\"rs-template-search-05__field rs-template-search-05__field--reference\">\r\n        <div class=\"rs_ref\" data-rs-placeholder=\"Reference\"></div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__field rs-template-search-05__field--status\">\r\n        <div class=\"rs_listing_type\" data-rs-variation=\"1\" data-rs-placeholder=\"Status\"></div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__field rs-template-search-05__field--location\">\r\n        <div class=\"rs_location\" data-rs-variation=\"2\" data-rs-placeholder=\"Location\"></div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__field rs-template-search-05__field--type\">\r\n        <div class=\"rs_property_type\" data-rs-variation=\"2\" data-rs-placeholder=\"Property Type\"></div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__row-half\">\r\n        <div class=\"rs-template-search-05__field rs-template-search-05__field--beds\">\r\n          <div class=\"rs_bedrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Bed\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-05__field rs-template-search-05__field--baths\">\r\n          <div class=\"rs_bathrooms\" data-rs-variation=\"1\" data-rs-placeholder=\"Bath\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__row-half\">\r\n        <div class=\"rs-template-search-05__field rs-template-search-05__field--price-min\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\" data-rs-placeholder=\"Min Price\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-05__field rs-template-search-05__field--price-max\">\r\n          <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\" data-rs-placeholder=\"Max Price\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__field rs-template-search-05__field--search\">\r\n        <div class=\"rs_search_button\" data-rs-label=\"Submit\"></div>\r\n      </div>\r\n      <div class=\"rs-template-search-05__links\">\r\n        <div class=\"rs-template-search-05__features\">\r\n          <div class=\"rs_features\"></div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Search Template 06: Minimal Single Row\r\n    'rs-search-template-06': `\r\n      <div class=\"rs-template-search-06__container\">\r\n        <div class=\"rs-template-search-06__field rs-template-search-06__field--location\">\r\n          <svg class=\"rs-template-search-06__location-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n            <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n          </svg>\r\n          <div class=\"rs_location\" data-rs-variation=\"1\" data-rs-placeholder=\"Enter Location\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-06__field rs-template-search-06__field--type\">\r\n          <div class=\"rs_property_type\" data-rs-variation=\"2\" data-rs-placeholder=\"Property Type\"></div>\r\n        </div>\r\n        <div class=\"rs-template-search-06__field rs-template-search-06__field--search\">\r\n          <div class=\"rs_search_button\" data-rs-label=\"Search Here\"></div>\r\n        </div>\r\n      </div>\r\n    `,\r\n\r\n    // Listing Template 01: Location-First Cards\r\n    'rs-listing-template-01': `\r\n      <div class=\"rs-template-listing-01__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-01__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-01\">\r\n          <div class=\"rs-template-card-01__image-section\">\r\n            <a class=\"rs_card_link rs-template-card-01__image-link\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n            </a>\r\n            <button class=\"rs_card_wishlist\" type=\"button\"></button>\r\n            <div class=\"rs_card_status\"></div>\r\n            <div class=\"rs-template-card-01__image-count\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n              </svg>\r\n              <span class=\"rs_card_image_count\"></span>\r\n            </div>\r\n          </div>\r\n          <a class=\"rs_card_link rs-template-card-01__content\">\r\n            <h3 class=\"rs_card_location rs-template-card-01__location\"></h3>\r\n            <p class=\"rs_card_type rs-template-card-01__type\"></p>\r\n            <p class=\"rs_card_description rs-template-card-01__description\"></p>\r\n            <div class=\"rs-template-card-01__specs\">\r\n              <div class=\"rs-template-card-01__spec-item\">\r\n                <svg class=\"rs-template-card-01__spec-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n                  <path d=\"M2 4v16\"></path>\r\n                  <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                  <path d=\"M2 17h20\"></path>\r\n                  <path d=\"M6 8v9\"></path>\r\n                </svg>\r\n                <span class=\"rs_card_beds rs-template-card-01__spec-value\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-01__spec-item\">\r\n                <svg class=\"rs-template-card-01__spec-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n                  <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n                  <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n                  <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n                  <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n                  <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n                </svg>\r\n                <span class=\"rs_card_baths rs-template-card-01__spec-value\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-01__spec-item\">\r\n                <svg class=\"rs-template-card-01__spec-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n                  <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                  <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                  <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                </svg>\r\n                <span class=\"rs_card_built rs-template-card-01__spec-value\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-01__spec-item\">\r\n                <svg class=\"rs-template-card-01__spec-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\r\n                  <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                  <path d=\"M12 2v20\"></path>\r\n                  <path d=\"M3 6l9 4 9-4\"></path>\r\n                </svg>\r\n                <span class=\"rs_card_plot rs-template-card-01__spec-value\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs_card_price rs-template-card-01__price\"></div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 02: Price on Image Cards\r\n    'rs-listing-template-02': `\r\n      <div class=\"rs-template-listing-02__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-02__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-02\">\r\n          <div class=\"rs-template-card-02__image-section\">\r\n            <a class=\"rs_card_link rs-template-card-02__image-link\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs-template-card-02__image-overlay\"></div>\r\n            </a>\r\n            <div class=\"rs_card_status rs-template-card-02__status\"></div>\r\n            <button class=\"rs_card_wishlist rs-template-card-02__wishlist\" type=\"button\"></button>\r\n            <div class=\"rs-template-card-02__image-bottom-left\">\r\n              <div class=\"rs-template-card-02__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                  <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                  <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-card-02__price-overlay\">\r\n              <span class=\"rs_card_price rs-template-card-02__price\"></span>\r\n              <span class=\"rs_card_price_suffix rs-template-card-02__price-suffix\"></span>\r\n            </div>\r\n          </div>\r\n          <a class=\"rs_card_link rs-template-card-02__content\">\r\n            <div class=\"rs-template-card-02__title-row\">\r\n              <h3 class=\"rs_card_title rs-template-card-02__title\"></h3>\r\n              <span class=\"rs-template-card-02__arrow-icon\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <line x1=\"7\" y1=\"17\" x2=\"17\" y2=\"7\"></line>\r\n                  <polyline points=\"7 7 17 7 17 17\"></polyline>\r\n                </svg>\r\n              </span>\r\n            </div>\r\n            <p class=\"rs_card_location rs-template-card-02__location\"></p>\r\n            <div class=\"rs-template-card-02__specs\">\r\n              <span class=\"rs-template-card-02__spec\">\r\n                <span class=\"rs-template-card-02__spec-label\">Beds:</span>\r\n                <span class=\"rs_card_beds rs-template-card-02__spec-value\"></span>\r\n              </span>\r\n              <span class=\"rs-template-card-02__spec\">\r\n                <span class=\"rs-template-card-02__spec-label\">Baths:</span>\r\n                <span class=\"rs_card_baths rs-template-card-02__spec-value\"></span>\r\n              </span>\r\n              <span class=\"rs-template-card-02__spec\">\r\n                <span class=\"rs-template-card-02__spec-label\">Area:</span>\r\n                <span class=\"rs_card_built rs-template-card-02__spec-value\"></span>\r\n              </span>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 03: Horizontal Card (Image left 40%, Content right 60%)\r\n    'rs-listing-template-03': `\r\n      <div class=\"rs-template-listing-03__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-03__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-03\">\r\n          <div class=\"rs-template-card-03__image-section\">\r\n            <a class=\"rs_card_link rs-template-card-03__image-link\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n            </a>\r\n            <div class=\"rs_card_status rs-template-card-03__status\"></div>\r\n            <div class=\"rs-template-card-03__image-count\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n              </svg>\r\n              <span class=\"rs_card_image_count\"></span>\r\n            </div>\r\n            <div class=\"rs-template-card-03__carousel-dots\"></div>\r\n          </div>\r\n          <button class=\"rs_card_wishlist rs-template-card-03__wishlist\" type=\"button\"></button>\r\n          <a class=\"rs_card_link rs-template-card-03__content\">\r\n            <div class=\"rs-template-card-03__tags\">\r\n              <span class=\"rs_card_type rs-template-card-03__tag\"></span>\r\n            </div>\r\n            <h3 class=\"rs_card_title rs-template-card-03__title\"></h3>\r\n            <div class=\"rs-template-card-03__specs\">\r\n              <span class=\"rs-template-card-03__spec\">\r\n                <svg class=\"rs-template-card-03__spec-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M2 4v16\"></path>\r\n                  <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                  <path d=\"M2 17h20\"></path>\r\n                  <path d=\"M6 8v9\"></path>\r\n                </svg>\r\n                <span class=\"rs_card_beds\"></span>\r\n              </span>\r\n              <span class=\"rs-template-card-03__spec\">\r\n                <svg class=\"rs-template-card-03__spec-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                  <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                  <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_baths\"></span>\r\n              </span>\r\n              <span class=\"rs-template-card-03__spec\">\r\n                <svg class=\"rs-template-card-03__spec-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                  <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                  <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                </svg>\r\n                <span class=\"rs_card_built\"></span>\r\n              </span>\r\n            </div>\r\n            <div class=\"rs-template-card-03__bottom\">\r\n              <div class=\"rs-template-card-03__price-pill\">\r\n                <span class=\"rs_card_price\"></span>\r\n                <span class=\"rs_card_price_suffix\"></span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 04: Airbnb Style (Vertical, full-width image)\r\n    'rs-listing-template-04': `\r\n      <div class=\"rs-template-listing-04__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-04__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-04\">\r\n          <div class=\"rs-template-card-04__image-section\">\r\n            <a class=\"rs_card_link rs-template-card-04__image-link\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n            </a>\r\n            <div class=\"rs_card_status rs-template-card-04__status\"></div>\r\n            <div class=\"rs-template-card-04__image-count\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n              </svg>\r\n              <span class=\"rs_card_image_count\"></span>\r\n            </div>\r\n            <div class=\"rs-template-card-04__carousel-dots\"></div>\r\n          </div>\r\n          <button class=\"rs_card_wishlist rs-template-card-04__wishlist\" type=\"button\"></button>\r\n          <a class=\"rs_card_link rs-template-card-04__content\">\r\n            <div class=\"rs-template-card-04__meta\">\r\n              <span class=\"rs_card_type rs-template-card-04__type\"></span>\r\n              <span class=\"rs-template-card-04__meta-separator\">&middot;</span>\r\n              <span class=\"rs_card_beds rs-template-card-04__beds\"></span>\r\n            </div>\r\n            <h3 class=\"rs_card_title rs-template-card-04__title\"></h3>\r\n            <div class=\"rs-template-card-04__location\">\r\n              <svg class=\"rs-template-card-04__location-icon\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n                <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n              </svg>\r\n              <span class=\"rs_card_location\"></span>\r\n            </div>\r\n            <div class=\"rs-template-card-04__price-row\">\r\n              <span class=\"rs_card_price rs-template-card-04__price\"></span>\r\n              <span class=\"rs_card_price_suffix rs-template-card-04__price-suffix\"></span>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 05: Hover Overlay (Image only, content on hover)\r\n    'rs-listing-template-05': `\r\n      <div class=\"rs-template-listing-05__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-05__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-05\">\r\n          <a class=\"rs_card_link rs-template-card-05__link\">\r\n            <div class=\"rs-template-card-05__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n            </div>\r\n            <div class=\"rs_card_status rs-template-card-05__status\"></div>\r\n            <div class=\"rs-template-card-05__image-count\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n              </svg>\r\n              <span class=\"rs_card_image_count\"></span>\r\n            </div>\r\n            <div class=\"rs-template-card-05__overlay\">\r\n              <div class=\"rs-template-card-05__overlay-content\">\r\n                <h3 class=\"rs_card_title rs-template-card-05__title\"></h3>\r\n                <div class=\"rs_card_price rs-template-card-05__price\"></div>\r\n                <div class=\"rs-template-card-05__specs\">\r\n                  <span class=\"rs-template-card-05__spec\">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <path d=\"M2 4v16\"></path>\r\n                      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                      <path d=\"M2 17h20\"></path>\r\n                      <path d=\"M6 8v9\"></path>\r\n                    </svg>\r\n                    <span class=\"rs_card_beds\"></span>\r\n                  </span>\r\n                  <span class=\"rs-template-card-05__spec\">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                      <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                      <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                    </svg>\r\n                    <span class=\"rs_card_baths\"></span>\r\n                  </span>\r\n                  <span class=\"rs-template-card-05__spec\">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                      <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                    </svg>\r\n                    <span class=\"rs_card_built\"></span>\r\n                  </span>\r\n                  <span class=\"rs-template-card-05__spec\">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                      <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                      <path d=\"M12 2v20\"></path>\r\n                    </svg>\r\n                    <span class=\"rs_card_plot\"></span>\r\n                  </span>\r\n                </div>\r\n                <span class=\"rs-template-card-05__view-link\">View Details</span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n          <button class=\"rs_card_wishlist rs-template-card-05__wishlist\" type=\"button\"></button>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 06: Gradient Overlay (Full image with permanent dark gradient)\r\n    'rs-listing-template-06': `\r\n      <div class=\"rs-template-listing-06__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-06__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-06\">\r\n          <a class=\"rs_card_link rs-template-card-06__link\">\r\n            <div class=\"rs-template-card-06__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs-template-card-06__gradient\"></div>\r\n            </div>\r\n            <div class=\"rs_card_status rs-template-card-06__status\"></div>\r\n            <button class=\"rs_card_wishlist rs-template-card-06__wishlist\" type=\"button\"></button>\r\n            <div class=\"rs-template-card-06__content\">\r\n              <h3 class=\"rs_card_type rs-template-card-06__title\"></h3>\r\n              <div class=\"rs_card_price rs-template-card-06__price\"></div>\r\n              <div class=\"rs-template-card-06__specs\">\r\n                <span class=\"rs-template-card-06__spec\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-06__spec\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-06__spec\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n              </div>\r\n              <span class=\"rs-template-card-06__view-link\">View Details</span>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Listing Template 07: Dark Overlay with Badges\r\n    'rs-listing-template-07': `\r\n      <div class=\"rs-template-listing-07__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-07__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-07\">\r\n          <a class=\"rs_card_link rs-template-card-07__link\">\r\n            <div class=\"rs-template-card-07__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs-template-card-07__gradient\"></div>\r\n            </div>\r\n            <div class=\"rs-template-card-07__badges\">\r\n              <div class=\"rs_card_status rs-template-card-07__status\"></div>\r\n            </div>\r\n            <button class=\"rs_card_wishlist rs-template-card-07__wishlist\" type=\"button\"></button>\r\n            <div class=\"rs-template-card-07__content\">\r\n              <div class=\"rs-template-card-07__price-row\">\r\n                <span class=\"rs_card_price rs-template-card-07__price\"></span>\r\n                <span class=\"rs_card_price_suffix rs-template-card-07__price-suffix\"></span>\r\n              </div>\r\n              <h3 class=\"rs_card_type rs-template-card-07__title\"></h3>\r\n              <div class=\"rs-template-card-07__specs\">\r\n                <span class=\"rs-template-card-07__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-07__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-07__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-07__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Template 08: Dark Overlay Grid with view toggle\r\n    'rs-listing-template-08': `\r\n      <div class=\"rs-template-listing-08__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-08__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-08\">\r\n          <a class=\"rs_card_link rs-template-card-08__link\">\r\n            <div class=\"rs-template-card-08__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs_card_status rs-template-card-08__status\"></div>\r\n              <button class=\"rs_card_wishlist rs-template-card-08__wishlist\" type=\"button\"></button>\r\n              <div class=\"rs-template-card-08__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path>\r\n                  <circle cx=\"12\" cy=\"13\" r=\"4\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-card-08__content\">\r\n              <h3 class=\"rs_card_title rs-template-card-08__title\"></h3>\r\n              <div class=\"rs-template-card-08__specs\">\r\n                <span class=\"rs-template-card-08__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-08__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-08__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-08__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </span>\r\n                <span class=\"rs_card_price rs-template-card-08__price\"></span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Template 09: Horizontal Detail Card (single row, no view toggle)\r\n    'rs-listing-template-09': `\r\n      <div class=\"rs-template-listing-09__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-09__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-09\">\r\n          <a class=\"rs_card_link rs-template-card-09__link\">\r\n            <div class=\"rs-template-card-09__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs_card_status rs-template-card-09__status\"></div>\r\n              <button class=\"rs_card_wishlist rs-template-card-09__wishlist\" type=\"button\"></button>\r\n              <div class=\"rs-template-card-09__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path>\r\n                  <circle cx=\"12\" cy=\"13\" r=\"4\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-card-09__content\">\r\n              <div class=\"rs-template-card-09__location-row\">\r\n                <span class=\"rs_card_location rs-template-card-09__location\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-09__ref-row\">\r\n                <span class=\"rs_card_ref rs-template-card-09__ref\"></span>\r\n              </div>\r\n              <h3 class=\"rs_card_title rs-template-card-09__title\"></h3>\r\n              <p class=\"rs_card_description rs-template-card-09__description\"></p>\r\n              <div class=\"rs-template-card-09__specs\">\r\n                <span class=\"rs-template-card-09__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-09__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-09__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-09__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </span>\r\n              </div>\r\n              <div class=\"rs_card_price rs-template-card-09__price\"></div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Template 10: Development/Large Card (single row, no view toggle)\r\n    'rs-listing-template-10': `\r\n      <div class=\"rs-template-listing-10__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-10__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-10\">\r\n          <a class=\"rs_card_link rs-template-card-10__link\">\r\n            <div class=\"rs-template-card-10__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs_card_status rs-template-card-10__status\"></div>\r\n              <button class=\"rs_card_wishlist rs-template-card-10__wishlist\" type=\"button\"></button>\r\n              <div class=\"rs-template-card-10__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path>\r\n                  <circle cx=\"12\" cy=\"13\" r=\"4\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-card-10__content\">\r\n              <h3 class=\"rs_card_title rs-template-card-10__title\"></h3>\r\n              <p class=\"rs_card_description rs-template-card-10__description\"></p>\r\n              <div class=\"rs-template-card-10__price-row\">\r\n                <span class=\"rs_card_price rs-template-card-10__price\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-10__specs\">\r\n                <span class=\"rs-template-card-10__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-10__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-10__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-10__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </span>\r\n              </div>\r\n              <div class=\"rs-template-card-10__actions\">\r\n                <span class=\"rs_card_ref rs-template-card-10__ref-btn\"></span>\r\n                <span class=\"rs-template-card-10__view-details\">View Details</span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Template 11: Alternating Dark Content Card (single row, no view toggle)\r\n    'rs-listing-template-11': `\r\n      <div class=\"rs-template-listing-11__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-11__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-11\">\r\n          <a class=\"rs_card_link rs-template-card-11__link\">\r\n            <div class=\"rs-template-card-11__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs_card_status rs-template-card-11__status\"></div>\r\n              <button class=\"rs_card_wishlist rs-template-card-11__wishlist\" type=\"button\"></button>\r\n              <div class=\"rs-template-card-11__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path>\r\n                  <circle cx=\"12\" cy=\"13\" r=\"4\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <div class=\"rs-template-card-11__content\">\r\n              <h3 class=\"rs_card_title rs-template-card-11__title\"></h3>\r\n              <p class=\"rs_card_description rs-template-card-11__description\"></p>\r\n              <div class=\"rs-template-card-11__specs\">\r\n                <span class=\"rs-template-card-11__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-11__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-11__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </span>\r\n                <span class=\"rs-template-card-11__spec\">\r\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </span>\r\n              </div>\r\n              <div class=\"rs-template-card-11__price-section\">\r\n                <span class=\"rs-template-card-11__price-label\">Price</span>\r\n                <span class=\"rs_card_price rs-template-card-11__price\"></span>\r\n              </div>\r\n              <div class=\"rs-template-card-11__actions\">\r\n                <span class=\"rs-template-card-11__details-btn\">View Details</span>\r\n                <span class=\"rs_card_ref rs-template-card-11__ref\"></span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Template 12: Vertical Grid Card with Read More button\r\n    'rs-listing-template-12': `\r\n      <div class=\"rs-template-listing-12__header\">\r\n        <div class=\"rs_results_count\"></div>\r\n        <div class=\"rs-template-listing-12__controls\">\r\n          <div class=\"rs_sort\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_active_filters\" style=\"margin-bottom: 20px;\"></div>\r\n      <div class=\"rs_map_view\"></div>\r\n      <div class=\"rs_property_grid\">\r\n        <div class=\"rs_card rs-template-card-12\">\r\n          <a class=\"rs_card_link rs-template-card-12__link\">\r\n            <div class=\"rs-template-card-12__image-section\">\r\n              <div class=\"rs_card_carousel\"></div>\r\n              <div class=\"rs_card_status rs-template-card-12__status\"></div>\r\n              <button class=\"rs_card_wishlist rs-template-card-12__wishlist\" type=\"button\"></button>\r\n              <div class=\"rs-template-card-12__image-count\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path>\r\n                  <circle cx=\"12\" cy=\"13\" r=\"4\"></circle>\r\n                </svg>\r\n                <span class=\"rs_card_image_count\"></span>\r\n              </div>\r\n            </div>\r\n            <span class=\"rs-template-card-12__read-more\">Read More</span>\r\n            <div class=\"rs-template-card-12__content\">\r\n              <div class=\"rs-template-card-12__price-ref-row\">\r\n                <span class=\"rs_card_price rs-template-card-12__price\"></span>\r\n                <span class=\"rs_card_ref rs-template-card-12__ref\"></span>\r\n              </div>\r\n              <h3 class=\"rs_card_title rs-template-card-12__title\"></h3>\r\n              <p class=\"rs_card_description rs-template-card-12__description\"></p>\r\n              <div class=\"rs-template-card-12__specs\">\r\n                <div class=\"rs-template-card-12__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M2 4v16\"></path>\r\n                    <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                    <path d=\"M2 17h20\"></path>\r\n                    <path d=\"M6 8v9\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_beds\"></span>\r\n                </div>\r\n                <div class=\"rs-template-card-12__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n                    <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n                    <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n                  </svg>\r\n                  <span class=\"rs_card_baths\"></span>\r\n                </div>\r\n                <div class=\"rs-template-card-12__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n                    <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"></line>\r\n                    <line x1=\"9\" y1=\"21\" x2=\"9\" y2=\"9\"></line>\r\n                  </svg>\r\n                  <span class=\"rs_card_built\"></span>\r\n                </div>\r\n                <div class=\"rs-template-card-12__spec\">\r\n                  <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                    <path d=\"M12 2v20\"></path>\r\n                  </svg>\r\n                  <span class=\"rs_card_plot\"></span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n    `,\r\n\r\n    // Map Search Template 01: Full-width map with filters on top\r\n    'rs-map-search-template-01': `\r\n      <div class=\"rs-map-search-template-01\">\r\n        <div class=\"rs-map-search-template-01__filters\">\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_location\" data-rs-variation=\"2\"></div>\r\n          </div>\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_property_type\" data-rs-variation=\"2\"></div>\r\n          </div>\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_bedrooms\" data-rs-variation=\"1\"></div>\r\n          </div>\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"min\"></div>\r\n          </div>\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_price\" data-rs-variation=\"1\" data-rs-type=\"max\"></div>\r\n          </div>\r\n          <div class=\"rs-map-search-template-01__field\">\r\n            <div class=\"rs_search_button\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"rs-map-search-template-01__map-container\">\r\n          <div class=\"rs_map_view\"></div>\r\n        </div>\r\n        <div class=\"rs-map-search-template-01__results-bar\">\r\n          <div class=\"rs_results_count\"></div>\r\n          <div class=\"rs_view_toggle\"></div>\r\n        </div>\r\n        <div class=\"rs_property_grid\"></div>\r\n        <div class=\"rs_pagination\" style=\"margin-top: 30px;\"></div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  /**\r\n   * Check if an element is inside a header or footer zone\r\n   * Supports: WordPress, Wix, Webflow, Squarespace, and standard HTML\r\n   */\r\n  function isInHeaderFooter(el: HTMLElement): boolean {\r\n    let current: HTMLElement | null = el;\r\n    while (current && current !== document.body) {\r\n      const tag = current.tagName.toLowerCase();\r\n      const id = current.id?.toLowerCase() || '';\r\n      const className = typeof current.className === 'string' ? current.className.toLowerCase() : '';\r\n\r\n      // Check semantic elements\r\n      if (tag === 'header' || tag === 'footer') {\r\n        return true;\r\n      }\r\n\r\n      // Check common header/footer class/id patterns\r\n      if (\r\n        // Standard/WordPress patterns\r\n        id.includes('header') ||\r\n        id.includes('footer') ||\r\n        id.includes('masthead') ||\r\n        className.includes('header') ||\r\n        className.includes('footer') ||\r\n        className.includes('masthead') ||\r\n        // Wix patterns\r\n        id === 'site_header' ||\r\n        id === 'site_footer' ||\r\n        id.includes('wixui-header') ||\r\n        id.includes('wixui-footer') ||\r\n        // Webflow patterns\r\n        className.includes('w-nav') ||\r\n        className.includes('navbar') ||\r\n        className.includes('footer-wrapper') ||\r\n        className.includes('footer-section') ||\r\n        // Squarespace patterns\r\n        id === 'sqs-header' ||\r\n        id === 'sqs-footer' ||\r\n        className.includes('header-inner') ||\r\n        className.includes('footer-inner')\r\n      ) {\r\n        return true;\r\n      }\r\n\r\n      current = current.parentElement;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check if an element is inside a main content zone\r\n   * Supports: WordPress, Wix, Webflow, Squarespace, and standard HTML\r\n   */\r\n  function isInMainContent(el: HTMLElement): boolean {\r\n    let current: HTMLElement | null = el;\r\n    while (current && current !== document.body) {\r\n      const tag = current.tagName.toLowerCase();\r\n      const id = current.id?.toLowerCase() || '';\r\n      const className = typeof current.className === 'string' ? current.className.toLowerCase() : '';\r\n\r\n      // Check semantic elements\r\n      if (tag === 'main' || tag === 'article') {\r\n        return true;\r\n      }\r\n\r\n      // Check common content class/id patterns\r\n      if (\r\n        // Standard/WordPress patterns\r\n        id === 'content' ||\r\n        id === 'main' ||\r\n        id === 'primary' ||\r\n        id.includes('main-content') ||\r\n        id.includes('page-content') ||\r\n        id.includes('site-content') ||\r\n        className.includes('entry-content') ||\r\n        className.includes('page-content') ||\r\n        className.includes('site-content') ||\r\n        className.includes('main-content') ||\r\n        className.includes('post-content') ||\r\n        // Wix patterns\r\n        id === 'pages_container' ||\r\n        id === 'site_pages' ||\r\n        id.includes('masterpage') ||\r\n        id.includes('pagescontent') ||\r\n        // Webflow patterns\r\n        className.includes('page-wrapper') ||\r\n        className.includes('main-wrapper') ||\r\n        className.includes('w-container') ||\r\n        className.includes('body-content') ||\r\n        // Squarespace patterns\r\n        id === 'page' ||\r\n        id === 'sections' ||\r\n        id === 'collection' ||\r\n        className.includes('content-wrapper') ||\r\n        className.includes('page-section') ||\r\n        className.includes('sqs-block-content')\r\n      ) {\r\n        return true;\r\n      }\r\n\r\n      current = current.parentElement;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Find the best element to render into (prefer main content over header/footer)\r\n   */\r\n  function findBestElement(elements: NodeListOf<HTMLElement>): HTMLElement | null {\r\n    if (elements.length === 0) return null;\r\n    if (elements.length === 1) return elements[0];\r\n\r\n    // Priority 1: Element in main content area (not in header/footer)\r\n    for (const el of elements) {\r\n      if (isInMainContent(el) && !isInHeaderFooter(el)) {\r\n        return el;\r\n      }\r\n    }\r\n\r\n    // Priority 2: Element NOT in header/footer\r\n    for (const el of elements) {\r\n      if (!isInHeaderFooter(el)) {\r\n        return el;\r\n      }\r\n    }\r\n\r\n    // Fallback: first element (shouldn't happen but safety)\r\n    return elements[0];\r\n  }\r\n\r\n  /**\r\n   * Render templates - finds template markers and injects full HTML\r\n   * Prefers elements in main content area over header/footer duplicates\r\n   */\r\n  function renderTemplates(): void {\r\n    console.log('[RealtySoft] renderTemplates() - scanning for template elements...');\r\n    for (const [templateClass, templateHTML] of Object.entries(TEMPLATES)) {\r\n      const elements = document.querySelectorAll<HTMLElement>(`.${templateClass}`);\r\n      console.log(\r\n        `[RealtySoft] Looking for .${templateClass}: found ${elements.length} element(s)`\r\n      );\r\n\r\n      if (elements.length === 0) continue;\r\n\r\n      // Find the best element (prefer main content over header/footer)\r\n      const bestElement = findBestElement(elements);\r\n\r\n      elements.forEach((el) => {\r\n        // Skip if already rendered\r\n        if (el.dataset.rsTemplateRendered) {\r\n          return;\r\n        }\r\n\r\n        // Mark non-best elements as duplicates\r\n        if (el !== bestElement) {\r\n          console.log(`[RealtySoft] Skipping duplicate ${templateClass} element (header/footer)`);\r\n          el.dataset.rsTemplateDuplicate = 'true';\r\n          return;\r\n        }\r\n\r\n        if (templateClass.includes('search')) {\r\n          if (!el.id) el.id = 'rs_search';\r\n          const templateNum = templateClass.match(/template-(\\d+)/)?.[1];\r\n          if (templateNum) {\r\n            el.classList.add(`rs-template-search-${templateNum.padStart(2, '0')}`);\r\n          }\r\n        }\r\n\r\n        if (templateClass.includes('listing')) {\r\n          if (!el.id) el.id = 'rs_listing';\r\n        }\r\n\r\n        el.innerHTML = templateHTML;\r\n        el.dataset.rsTemplateRendered = 'true';\r\n\r\n        if (el.dataset.rsColumns) {\r\n          const propertyGrid = el.querySelector<HTMLElement>('.rs_property_grid');\r\n          if (propertyGrid) {\r\n            propertyGrid.dataset.rsColumns = el.dataset.rsColumns;\r\n          }\r\n        }\r\n\r\n        if (templateClass === 'rs-search-template-02') {\r\n          initTemplate02MoreFilters(el);\r\n        }\r\n\r\n        if (templateClass === 'rs-search-template-03') {\r\n          initTemplate03Tabs(el);\r\n        }\r\n\r\n        console.log(`[RealtySoft] Auto-rendered template: ${templateClass}`);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize More Filters dropdown toggle for Search Template 02\r\n   */\r\n  function initTemplate02MoreFilters(container: HTMLElement): void {\r\n    const wrapper = container.querySelector<HTMLElement>(\r\n      '.rs-template-search-02__more-filters-wrapper'\r\n    );\r\n    const btn = container.querySelector<HTMLButtonElement>(\r\n      '.rs-template-search-02__more-filters-btn'\r\n    );\r\n    const dropdown = container.querySelector<HTMLElement>('.rs-template-search-02__dropdown');\r\n    const closeBtn = container.querySelector<HTMLButtonElement>(\r\n      '.rs-template-search-02__dropdown-close'\r\n    );\r\n\r\n    if (!btn || !dropdown || !wrapper) return;\r\n\r\n    function openDropdown(): void {\r\n      dropdown!.classList.add('is-open');\r\n      btn!.classList.add('is-active');\r\n      wrapper!.classList.add('is-active');\r\n      if (window.innerWidth <= 768) {\r\n        document.body.style.overflow = 'hidden';\r\n      }\r\n    }\r\n\r\n    function closeDropdown(): void {\r\n      dropdown!.classList.remove('is-open');\r\n      btn!.classList.remove('is-active');\r\n      wrapper!.classList.remove('is-active');\r\n      document.body.style.overflow = '';\r\n    }\r\n\r\n    btn.addEventListener('click', function (e: Event) {\r\n      e.stopPropagation();\r\n      const isOpen = dropdown!.classList.contains('is-open');\r\n      if (isOpen) {\r\n        closeDropdown();\r\n      } else {\r\n        openDropdown();\r\n      }\r\n    });\r\n\r\n    if (closeBtn) {\r\n      closeBtn.addEventListener('click', closeDropdown);\r\n    }\r\n\r\n    document.addEventListener('click', function (e: Event) {\r\n      if (\r\n        !dropdown!.contains(e.target as Node) &&\r\n        !btn!.contains(e.target as Node)\r\n      ) {\r\n        closeDropdown();\r\n      }\r\n    });\r\n\r\n    wrapper.addEventListener('click', function (e: Event) {\r\n      if (\r\n        e.target === wrapper ||\r\n        (e.target as HTMLElement).classList.contains(\r\n          'rs-template-search-02__more-filters-wrapper'\r\n        )\r\n      ) {\r\n        if (\r\n          window.innerWidth <= 768 &&\r\n          !dropdown!.contains(e.target as Node) &&\r\n          !btn!.contains(e.target as Node)\r\n        ) {\r\n          closeDropdown();\r\n        }\r\n      }\r\n    });\r\n\r\n    dropdown.addEventListener('click', function (e: Event) {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    document.addEventListener('keydown', function (e: KeyboardEvent) {\r\n      if (e.key === 'Escape' && dropdown!.classList.contains('is-open')) {\r\n        closeDropdown();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize Tab switching for Search Template 03\r\n   */\r\n  function initTemplate03Tabs(container: HTMLElement): void {\r\n    const tabs = container.querySelectorAll<HTMLButtonElement>('.rs-template-search-03__tab');\r\n    if (!tabs.length) return;\r\n\r\n    tabs.forEach((tab) => {\r\n      tab.addEventListener('click', function () {\r\n        tabs.forEach((t) => t.classList.remove('is-active'));\r\n        this.classList.add('is-active');\r\n\r\n        const listingType = this.dataset.listingType;\r\n        if (listingType) {\r\n          RealtySoftState.set('filters.listingType', listingType);\r\n          console.log(`[RealtySoft] Template 03: Tab switched to \"${listingType}\"`);\r\n        }\r\n      });\r\n    });\r\n\r\n    const activeTab = container.querySelector<HTMLButtonElement>(\r\n      '.rs-template-search-03__tab.is-active'\r\n    );\r\n    if (activeTab && activeTab.dataset.listingType) {\r\n      RealtySoftState.set('filters.listingType', activeTab.dataset.listingType);\r\n      console.log(\r\n        `[RealtySoft] Template 03: Initial listing type set to \"${activeTab.dataset.listingType}\"`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show skeleton loading placeholders\r\n   */\r\n  function showLoadingSkeletons(): void {\r\n    const searchContainer = document.getElementById('rs_search');\r\n    const listingContainer = document.getElementById('rs_listing') ||\r\n                             document.querySelector('.rs_property_grid') ||\r\n                             document.querySelector('[class*=\"rs-listing-template-\"]');\r\n    const wishlistContainer = document.querySelector('.rs_wishlist_list');\r\n\r\n    if (searchContainer && !searchContainer.querySelector('.rs-search-skeleton')) {\r\n      const searchSkeleton = document.createElement('div');\r\n      searchSkeleton.className = 'rs-search-skeleton';\r\n      searchSkeleton.innerHTML = `\r\n        <div class=\"rs-search-skeleton__item\">\r\n          <div class=\"rs-search-skeleton__label\"></div>\r\n          <div class=\"rs-search-skeleton__input\"></div>\r\n        </div>\r\n        <div class=\"rs-search-skeleton__item\">\r\n          <div class=\"rs-search-skeleton__label\"></div>\r\n          <div class=\"rs-search-skeleton__input\"></div>\r\n        </div>\r\n        <div class=\"rs-search-skeleton__item\">\r\n          <div class=\"rs-search-skeleton__label\"></div>\r\n          <div class=\"rs-search-skeleton__input\"></div>\r\n        </div>\r\n        <div class=\"rs-search-skeleton__item\">\r\n          <div class=\"rs-search-skeleton__label\"></div>\r\n          <div class=\"rs-search-skeleton__input\"></div>\r\n        </div>\r\n        <div class=\"rs-search-skeleton__item\">\r\n          <div class=\"rs-search-skeleton__button\"></div>\r\n        </div>\r\n      `;\r\n      searchContainer.insertBefore(searchSkeleton, searchContainer.firstChild);\r\n    }\r\n\r\n    // Show listing skeleton for property grid\r\n    if (listingContainer && !listingContainer.querySelector('.rs-listing-skeleton')) {\r\n      const listingSkeleton = document.createElement('div');\r\n      listingSkeleton.className = 'rs-listing-skeleton';\r\n      for (let i = 0; i < 6; i++) {\r\n        listingSkeleton.innerHTML += `\r\n          <div class=\"rs-listing-skeleton__card\">\r\n            <div class=\"rs-listing-skeleton__image\"></div>\r\n            <div class=\"rs-listing-skeleton__content\">\r\n              <div class=\"rs-listing-skeleton__price\"></div>\r\n              <div class=\"rs-listing-skeleton__title\"></div>\r\n              <div class=\"rs-listing-skeleton__location\"></div>\r\n              <div class=\"rs-listing-skeleton__specs\">\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `;\r\n      }\r\n      listingContainer.insertBefore(listingSkeleton, listingContainer.firstChild);\r\n    }\r\n\r\n    // Show wishlist skeleton\r\n    if (wishlistContainer && !wishlistContainer.querySelector('.rs-listing-skeleton')) {\r\n      const wishlistSkeleton = document.createElement('div');\r\n      wishlistSkeleton.className = 'rs-listing-skeleton rs-wishlist-skeleton';\r\n      for (let i = 0; i < 4; i++) {\r\n        wishlistSkeleton.innerHTML += `\r\n          <div class=\"rs-listing-skeleton__card\">\r\n            <div class=\"rs-listing-skeleton__image\"></div>\r\n            <div class=\"rs-listing-skeleton__content\">\r\n              <div class=\"rs-listing-skeleton__price\"></div>\r\n              <div class=\"rs-listing-skeleton__title\"></div>\r\n              <div class=\"rs-listing-skeleton__location\"></div>\r\n              <div class=\"rs-listing-skeleton__specs\">\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n                <div class=\"rs-listing-skeleton__spec\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `;\r\n      }\r\n      wishlistContainer.insertBefore(wishlistSkeleton, wishlistContainer.firstChild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide skeleton loading placeholders\r\n   */\r\n  function hideLoadingSkeletons(): void {\r\n    // Remove all skeleton elements\r\n    document.querySelectorAll('.rs-search-skeleton, .rs-listing-skeleton, .rs-wishlist-skeleton').forEach(el => el.remove());\r\n\r\n    // Mark containers as loaded\r\n    const searchContainer = document.getElementById('rs_search');\r\n    const listingContainer = document.getElementById('rs_listing');\r\n    const wishlistContainer = document.querySelector('.rs_wishlist_list');\r\n    if (searchContainer) searchContainer.classList.add('rs-loaded');\r\n    if (listingContainer) listingContainer.classList.add('rs-loaded');\r\n    if (wishlistContainer) wishlistContainer.classList.add('rs-loaded');\r\n  }\r\n\r\n  /**\r\n   * Register service worker (opt-in)\r\n   */\r\n  function registerServiceWorker(customUrl?: string): void {\r\n    const swUrl = customUrl || '/realtysoft-sw.js';\r\n    navigator.serviceWorker\r\n      .register(swUrl)\r\n      .then((registration) => {\r\n        console.log('[RealtySoft] Service worker registered:', registration.scope);\r\n      })\r\n      .catch((error) => {\r\n        console.warn('[RealtySoft] Service worker registration failed:', error);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Initialize platform/plugin language sync listeners.\r\n   * Handles translation plugins that change language without page reload.\r\n   */\r\n  function initPlatformLanguageSync(): void {\r\n    // Weglot: Listen for language changes (no page reload)\r\n    if (typeof window.Weglot?.on === 'function') {\r\n      window.Weglot.on('languageChanged', (newLang: string) => {\r\n        console.log('[RealtySoft] Weglot language changed:', newLang);\r\n        const mappedLang = RealtySoftLabels.mapLanguage(newLang);\r\n        const currentLang = RealtySoftState.get<string>('config.language');\r\n        if (mappedLang !== currentLang) {\r\n          setLanguage(mappedLang);\r\n        }\r\n      });\r\n      console.log('[RealtySoft] Weglot language sync initialized');\r\n    }\r\n\r\n    // MutationObserver: Watch for HTML lang attribute changes\r\n    // This covers most translation plugins (Polylang, WPML, TranslatePress, etc.)\r\n    const observer = new MutationObserver((mutations) => {\r\n      for (const mutation of mutations) {\r\n        if (mutation.attributeName === 'lang') {\r\n          const newLang = document.documentElement.lang;\r\n          if (newLang) {\r\n            const currentLang = RealtySoftState.get<string>('config.language');\r\n            const mappedLang = RealtySoftLabels.mapLanguage(newLang);\r\n            if (mappedLang !== currentLang) {\r\n              console.log('[RealtySoft] HTML lang attribute changed:', newLang, '-> mapped:', mappedLang);\r\n              setLanguage(mappedLang);\r\n            }\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['lang'] });\r\n    console.log('[RealtySoft] HTML lang attribute sync initialized');\r\n\r\n    // URL popstate: Watch for browser back/forward navigation (URL-based language switchers)\r\n    window.addEventListener('popstate', () => {\r\n      // Re-detect language from URL after navigation\r\n      const detectedLang = RealtySoftLabels.detectLanguage();\r\n      const currentLang = RealtySoftState.get<string>('config.language');\r\n      if (detectedLang !== currentLang) {\r\n        console.log('[RealtySoft] URL navigation detected language change:', detectedLang);\r\n        setLanguage(detectedLang);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the widget\r\n   */\r\n  async function init(): Promise<boolean> {\r\n    if (initPromise) return initPromise;\r\n\r\n    initPromise = (async () => {\r\n      try {\r\n        showLoadingSkeletons();\r\n        RealtySoftState.set('ui.loading', true);\r\n\r\n        const globalConfig = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n\r\n        // Language priority: config > localStorage (user preference) > browser detect\r\n        let storedLanguage: string | null = null;\r\n        try {\r\n          storedLanguage = localStorage.getItem('rs_language');\r\n        } catch (_e) { /* ignore */ }\r\n        const language = globalConfig.language || storedLanguage || RealtySoftLabels.init();\r\n        RealtySoftLabels.setLanguage(language);\r\n\r\n        RealtySoftAPI.init({\r\n          language: language,\r\n          apiKey: globalConfig.apiKey,\r\n          apiUrl: globalConfig.apiUrl,\r\n          cache: globalConfig.cache,\r\n        });\r\n\r\n        // Detect if we're on a property detail page (used to skip unnecessary API calls)\r\n        const propertyRef = extractPropertyRefFromUrl();\r\n        const isDetailPage = !!propertyRef;\r\n\r\n        // Pre-fetch property data in parallel with labels (detail pages only)\r\n        if (isDetailPage && propertyRef) {\r\n          RealtySoftAPI.prefetchProperty(propertyRef, true);\r\n        }\r\n\r\n        if (globalConfig.analytics !== false) {\r\n          RealtySoftAnalytics.init({\r\n            enabled: true,\r\n            debug: globalConfig.debug || false,\r\n          });\r\n        }\r\n\r\n        RealtySoftState.set('config.language', language);\r\n        RealtySoftState.set('config.ownerEmail', globalConfig.ownerEmail || null);\r\n        RealtySoftState.set('config.privacyPolicyUrl', globalConfig.privacyPolicyUrl || null);\r\n        RealtySoftState.set('config.defaultCountryCode', globalConfig.defaultCountryCode || '+34');\r\n        RealtySoftState.set(\r\n          'config.inquiryThankYouMessage',\r\n          globalConfig.inquiryThankYouMessage || null\r\n        );\r\n        RealtySoftState.set('config.inquiryThankYouUrl', globalConfig.inquiryThankYouUrl || null);\r\n        RealtySoftState.set('config.propertyPageSlug', globalConfig.propertyPageSlug || 'property');\r\n        RealtySoftState.set(\r\n          'config.useWidgetPropertyTemplate',\r\n          globalConfig.useWidgetPropertyTemplate !== false\r\n        );\r\n        RealtySoftState.set('config.useQueryParamUrls', globalConfig.useQueryParamUrls === true);\r\n        RealtySoftState.set('config.propertyUrlFormat', globalConfig.propertyUrlFormat || 'seo');\r\n        RealtySoftState.set('config.resultsPage', globalConfig.resultsPage || '/properties');\r\n        RealtySoftState.set('config.enableMapView', globalConfig.enableMapView !== false);\r\n\r\n        // Pagination settings\r\n        const defaultPerPage = globalConfig.perPage || 12;\r\n        const defaultMapPerPage = globalConfig.mapPerPage || 50;\r\n        RealtySoftState.set('config.perPage', defaultPerPage);\r\n        RealtySoftState.set('config.mapPerPage', defaultMapPerPage);\r\n        RealtySoftState.set('results.perPage', defaultPerPage);\r\n\r\n        // Labels mode: 'static' (default), 'api', or 'hybrid'\r\n        const labelsMode = globalConfig.labelsMode || 'static';\r\n        console.log('[RealtySoft] Labels mode:', labelsMode);\r\n\r\n        // Fire getAllLabels early (runs in parallel regardless - needed for language switcher)\r\n        const allLabelsPromise = RealtySoftAPI.getAllLabels().catch(() => null);\r\n\r\n        // Build API promises based on labelsMode and page type\r\n        const apiPromises: Promise<any>[] = [];\r\n\r\n        if (labelsMode === 'api') {\r\n          // API mode: blocking labels fetch (current behavior)\r\n          apiPromises.push(RealtySoftAPI.getLabels().catch(() => ({ labels: {} })));\r\n        }\r\n\r\n        if (!isDetailPage) {\r\n          // Listing pages: always fetch locations and property types\r\n          apiPromises.push(\r\n            RealtySoftAPI.getLocations().catch(() => ({ data: [] })),\r\n            RealtySoftAPI.getPropertyTypes().catch(() => ({ data: [] })),\r\n            allLabelsPromise,\r\n          );\r\n        }\r\n\r\n        // Static and hybrid modes: initialize labels from static defaults FIRST (instant)\r\n        if (labelsMode === 'static' || labelsMode === 'hybrid') {\r\n          RealtySoftLabels.initStatic(language);\r\n          if (globalConfig.labelOverrides) {\r\n            RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, language);\r\n          }\r\n          RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n        }\r\n\r\n        // Hybrid mode: fire API labels in background (non-blocking)\r\n        if (labelsMode === 'hybrid') {\r\n          RealtySoftAPI.getLabels()\r\n            .then((labelsData) => {\r\n              const apiLabels = transformAPILabels(labelsData, language);\r\n              if (Object.keys(apiLabels).length > 0) {\r\n                RealtySoftLabels.loadFromAPI(apiLabels);\r\n                if (globalConfig.labelOverrides) {\r\n                  RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, language);\r\n                }\r\n                RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n                console.log('[RealtySoft] Hybrid mode: API labels merged in background');\r\n              }\r\n            })\r\n            .catch(() => {\r\n              console.log('[RealtySoft] Hybrid mode: API labels fetch failed, using static');\r\n            });\r\n        }\r\n\r\n        // Wait for blocking API calls\r\n        const results = await Promise.all(apiPromises);\r\n\r\n        // Process API data â€” wrapped in try/catch so that initializeComponents()\r\n        // ALWAYS runs even if data processing fails (critical for property detail pages)\r\n        try {\r\n          // API mode: process blocking labels response\r\n          if (labelsMode === 'api') {\r\n            const labelsData = results[0];\r\n            const apiLabels = transformAPILabels(labelsData, language);\r\n            if (Object.keys(apiLabels).length > 0) {\r\n              await RealtySoftLabels.loadFromAPI(apiLabels);\r\n            } else {\r\n              console.log('[RealtySoft] No labels from API, using defaults');\r\n            }\r\n\r\n            if (globalConfig.labelOverrides) {\r\n              RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, language);\r\n            }\r\n\r\n            RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n          }\r\n\r\n          // Extract locations/propertyTypes from results\r\n          // Result indices shift based on whether labels was in apiPromises\r\n          const resultOffset = labelsMode === 'api' ? 1 : 0;\r\n          const locations = isDetailPage ? { data: [] as any[] } : results[resultOffset];\r\n          const propertyTypes = isDetailPage ? { data: [] as any[] } : results[resultOffset + 1];\r\n          const allLabelsData = isDetailPage ? null : results[resultOffset + 2];\r\n\r\n          // Extract available languages from the unfiltered labels response\r\n          if (allLabelsData) {\r\n            const availableLanguages = extractAvailableLanguages(allLabelsData);\r\n            RealtySoftState.set('data.availableLanguages', availableLanguages);\r\n            console.log('[RealtySoft] Available languages from API:', availableLanguages);\r\n          } else if (isDetailPage) {\r\n            // Detail pages: allLabels was deferred â€” process when it arrives\r\n            RealtySoftState.set('data.availableLanguages', []);\r\n            allLabelsPromise.then((data: unknown) => {\r\n              const availableLanguages = extractAvailableLanguages(data);\r\n              RealtySoftState.set('data.availableLanguages', availableLanguages);\r\n              console.log('[RealtySoft] Available languages loaded (deferred):', availableLanguages);\r\n            });\r\n          }\r\n\r\n          RealtySoftState.set('data.locations', locations?.data || []);\r\n          RealtySoftState.set('data.propertyTypes', propertyTypes?.data || []);\r\n          RealtySoftState.set('data.features', []);\r\n          RealtySoftState.set('data.featuresLoaded', false);\r\n\r\n          renderTemplates();\r\n\r\n          widgetMode = detectMode();\r\n          console.log('[RealtySoft] Widget mode:', widgetMode);\r\n\r\n          parseURLFilters();\r\n\r\n          const searchContainer = document.getElementById('rs_search');\r\n          const listingContainer = document.getElementById('rs_listing');\r\n\r\n          let allLocked: LockedFilters = {};\r\n\r\n          if (listingContainer && !listingContainer.hasAttribute('data-rs-standalone')) {\r\n            const listingLocked = parseLockedFilters(listingContainer);\r\n            allLocked = { ...allLocked, ...listingLocked };\r\n          }\r\n\r\n          if (searchContainer) {\r\n            const searchLocked = parseLockedFilters(searchContainer);\r\n            allLocked = { ...allLocked, ...searchLocked };\r\n          }\r\n\r\n          if (Object.keys(allLocked).length > 0) {\r\n            RealtySoftState.setLockedFilters(allLocked);\r\n          }\r\n        } catch (dataError) {\r\n          console.error('[RealtySoft] Data processing error (continuing with component init):', dataError);\r\n        }\r\n\r\n        // ALWAYS initialize components regardless of data processing errors\r\n        initializeComponents();\r\n        hideLoadingSkeletons();\r\n\r\n        // Initialize SPA router for client-side navigation\r\n        RealtySoftRouter.init();\r\n\r\n        // Initialize platform/plugin language sync (Weglot, HTML lang observer, etc.)\r\n        initPlatformLanguageSync();\r\n\r\n        // Trigger initial search if listing is present\r\n        if (widgetMode === 'combined' || widgetMode === 'results-only') {\r\n          search();\r\n        }\r\n\r\n        // Initialize standalone listings (independent data fetch, no effect on global filters)\r\n        initStandaloneListings();\r\n\r\n        // Register service worker if opted in\r\n        if (globalConfig.serviceWorker && 'serviceWorker' in navigator) {\r\n          registerServiceWorker(globalConfig.serviceWorkerUrl);\r\n        }\r\n\r\n        initialized = true;\r\n\r\n        document.dispatchEvent(new CustomEvent('realtysoft:ready'));\r\n\r\n        return true;\r\n      } catch (error) {\r\n        console.error('RealtySoft initialization failed:', error);\r\n        document.dispatchEvent(new CustomEvent('realtysoft:error', { detail: error }));\r\n        throw error;\r\n      }\r\n    })();\r\n\r\n    return initPromise;\r\n  }\r\n\r\n  /**\r\n   * Get all valid widget containers on the page\r\n   */\r\n  function getWidgetContainers(): HTMLElement[] {\r\n    const containerSelectors = [\r\n      // Main widget containers\r\n      '#rs_search',\r\n      '#rs_listing',\r\n      '#rs_wishlist',\r\n      '.rs_wishlist_list',\r\n      '.property-detail-container',\r\n      // Search templates\r\n      '.rs-search-template-01',\r\n      '.rs-search-template-02',\r\n      '.rs-search-template-03',\r\n      '.rs-search-template-04',\r\n      '.rs-search-template-05',\r\n      '.rs-search-template-06',\r\n      // Listing templates\r\n      '.rs-listing-template-01',\r\n      '.rs-listing-template-02',\r\n      '.rs-listing-template-03',\r\n      '.rs-listing-template-04',\r\n      '.rs-listing-template-05',\r\n      '.rs-listing-template-06',\r\n      '.rs-listing-template-07',\r\n      '.rs-listing-template-08',\r\n      '.rs-listing-template-09',\r\n      '.rs-listing-template-10',\r\n      '.rs-listing-template-11',\r\n      '.rs-listing-template-12',\r\n      // Map search templates\r\n      '.rs-map-search-template-01',\r\n      // Standalone components (can be placed without a container)\r\n      '.rs_property_carousel',\r\n      '.rs_property_grid',\r\n      // Standalone listings\r\n      '[data-rs-standalone]',\r\n    ];\r\n\r\n    const containers: HTMLElement[] = [];\r\n    const seen = new Set<HTMLElement>();\r\n\r\n    for (const selector of containerSelectors) {\r\n      document.querySelectorAll<HTMLElement>(selector).forEach((el) => {\r\n        // Skip elements marked as duplicates by renderTemplates()\r\n        if (el.dataset.rsTemplateDuplicate) return;\r\n\r\n        // Avoid duplicates (an element might match multiple selectors)\r\n        if (!seen.has(el)) {\r\n          seen.add(el);\r\n          containers.push(el);\r\n        }\r\n      });\r\n    }\r\n\r\n    return containers;\r\n  }\r\n\r\n  /**\r\n   * Global utility components that can be placed ANYWHERE on the page\r\n   * (including header, footer, sidebar, etc.)\r\n   * These are NOT affected by the duplicate prevention logic\r\n   */\r\n  const GLOBAL_UTILITY_COMPONENTS = [\r\n    'rs_wishlist_counter',\r\n    'rs_wishlist_button',\r\n    'rs_language_selector',\r\n    'rs_share_buttons',\r\n  ];\r\n\r\n  /**\r\n   * Initialize all components in DOM\r\n   * - Container-scoped components: Only within valid widget containers\r\n   * - Global utility components: Anywhere on the page\r\n   */\r\n  function initializeComponents(): void {\r\n    const allComponentNames = Object.keys(components);\r\n    if (allComponentNames.length === 0) return;\r\n\r\n    // Separate global utility components from container-scoped components\r\n    const globalComponents = allComponentNames.filter(name => GLOBAL_UTILITY_COMPONENTS.includes(name));\r\n    const containerComponents = allComponentNames.filter(name => !GLOBAL_UTILITY_COMPONENTS.includes(name));\r\n\r\n    // Phase 1: Initialize GLOBAL utility components anywhere on the page\r\n    if (globalComponents.length > 0) {\r\n      const globalSelectors = globalComponents.map(name => `.${name}`).join(', ');\r\n      document.querySelectorAll<RSHTMLElement>(globalSelectors).forEach((element) => {\r\n        // Skip if already initialized\r\n        if (element._rsComponent) return;\r\n\r\n        for (const name of globalComponents) {\r\n          if (element.classList.contains(name) && components[name]) {\r\n            const variation = element.dataset.rsVariation || '1';\r\n            console.log(`[RealtySoft] Initializing global ${name} with variation: ${variation}`);\r\n            const instance = new components[name](element, { variation });\r\n            componentInstances.push(instance);\r\n            element._rsComponent = instance;\r\n            break;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // Phase 2: Initialize CONTAINER-SCOPED components only within valid containers\r\n    if (containerComponents.length > 0) {\r\n      const containerSelectors = containerComponents.map(name => `.${name}`).join(', ');\r\n      const containers = getWidgetContainers();\r\n\r\n      if (containers.length === 0) {\r\n        console.log('[RealtySoft] No widget containers found on page');\r\n        return;\r\n      }\r\n\r\n      console.log('[RealtySoft] Found', containers.length, 'widget container(s)');\r\n\r\n      for (const container of containers) {\r\n        // Check if the container ITSELF is a component that needs initialization\r\n        // (e.g., property-detail-container is both a container and a component)\r\n        const rsContainer = container as RSHTMLElement;\r\n        if (!rsContainer._rsComponent) {\r\n          for (const name of containerComponents) {\r\n            if (rsContainer.classList.contains(name) && components[name]) {\r\n              const variation = rsContainer.dataset.rsVariation || '1';\r\n              console.log(`[RealtySoft] Initializing container-component ${name} with variation: ${variation}`);\r\n              const instance = new components[name](rsContainer, { variation });\r\n              componentInstances.push(instance);\r\n              rsContainer._rsComponent = instance;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Then search for components INSIDE the container\r\n        container.querySelectorAll<RSHTMLElement>(containerSelectors).forEach((element) => {\r\n          // Skip if already initialized\r\n          if (element._rsComponent) return;\r\n\r\n          for (const name of containerComponents) {\r\n            if (element.classList.contains(name) && components[name]) {\r\n              const variation = element.dataset.rsVariation || '1';\r\n              console.log(`[RealtySoft] Initializing ${name} with variation: ${variation}`);\r\n              const instance = new components[name](element, { variation });\r\n              componentInstances.push(instance);\r\n              element._rsComponent = instance;\r\n              break;\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register a component\r\n   */\r\n  function registerComponent(name: string, Component: ComponentConstructor): void {\r\n    components[name] = Component;\r\n  }\r\n\r\n  /**\r\n   * Get component instance by element\r\n   */\r\n  function getComponent(element: RSHTMLElement): ComponentInstance | undefined {\r\n    return element._rsComponent;\r\n  }\r\n\r\n  /**\r\n   * Perform search with current filters\r\n   */\r\n  async function search(): Promise<unknown> {\r\n    if (widgetMode === 'search-only') {\r\n      const filters = RealtySoftState.get('filters') as Partial<FilterState>;\r\n      const searchURL = buildSearchURL(filters);\r\n      console.log('[RealtySoft] Search-only mode: redirecting to', searchURL);\r\n      window.location.href = searchURL;\r\n      return;\r\n    }\r\n\r\n    RealtySoftState.set('ui.loading', true);\r\n    RealtySoftState.set('ui.error', null);\r\n\r\n    try {\r\n      const params = RealtySoftState.getSearchParams();\r\n      const results = await RealtySoftAPI.searchProperties(params);\r\n\r\n      // Results can have additional fields from API\r\n      const resultsAny = results as unknown as Record<string, unknown>;\r\n      const properties = results.data || [];\r\n      const total = (results.total || results.count || properties.length || 0) as number;\r\n      const paramsAny = params as unknown as Record<string, unknown>;\r\n      const perPage = (paramsAny.per_page || paramsAny.limit || 12) as number;\r\n      const totalPages =\r\n        ((resultsAny.total_pages as number) || Math.ceil(total / perPage)) || 0;\r\n\r\n      RealtySoftState.setMultiple({\r\n        'results.properties': properties,\r\n        'results.total': total,\r\n        'results.totalPages': totalPages,\r\n        'ui.loading': false,\r\n      });\r\n\r\n      // Track search with current filters\r\n      RealtySoftAnalytics.trackSearch();\r\n\r\n      document.dispatchEvent(\r\n        new CustomEvent('realtysoft:search', {\r\n          detail: { results: results },\r\n        })\r\n      );\r\n\r\n      return results;\r\n    } catch (error) {\r\n      RealtySoftState.set('ui.loading', false);\r\n      RealtySoftState.set('ui.error', (error as Error).message);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize standalone listings â€” containers with data-rs-standalone.\r\n   * These fetch their own data independently and don't affect global filters/results.\r\n   * Use case: homepage with a full search widget + a curated property grid.\r\n   */\r\n  async function initStandaloneListings(): Promise<void> {\r\n    const containers = document.querySelectorAll<HTMLElement>(\r\n      '#rs_listing[data-rs-standalone], [class*=\"rs-listing-template-\"][data-rs-standalone]'\r\n    );\r\n    if (!containers.length) return;\r\n\r\n    for (const container of Array.from(containers)) {\r\n      try {\r\n        const filters = parseLockedFilters(container);\r\n\r\n        // Convert locked filter format to API search params\r\n        const params: Partial<SearchParams> = {};\r\n        if (filters.location) params.location_id = filters.location as number;\r\n        if (filters.listingType) params.listing_type = filters.listingType as string;\r\n        if (filters.propertyType) params.type_id = filters.propertyType as number;\r\n        if (filters.bedsMin) params.bedrooms_min = filters.bedsMin as number;\r\n        if (filters.bedsMax) params.bedrooms_max = filters.bedsMax as number;\r\n        if (filters.bathsMin) params.bathrooms_min = filters.bathsMin as number;\r\n        if (filters.bathsMax) params.bathrooms_max = filters.bathsMax as number;\r\n        if (filters.priceMin) params.list_price_min = filters.priceMin as number;\r\n        if (filters.priceMax) params.list_price_max = filters.priceMax as number;\r\n        if (filters.builtMin) params.build_size_min = filters.builtMin as number;\r\n        if (filters.builtMax) params.build_size_max = filters.builtMax as number;\r\n        if (filters.plotMin) params.plot_size_min = filters.plotMin as number;\r\n        if (filters.plotMax) params.plot_size_max = filters.plotMax as number;\r\n        if (filters.features) params.features = (filters.features as number[]).join(',');\r\n        if (filters.ref) params.ref_no = filters.ref as string;\r\n\r\n        // Limit and sort from data attributes (defaults: 6 properties, newest first)\r\n        params.limit = parseInt(container.dataset.rsLimit || '6', 10);\r\n        params.page = 1;\r\n        params.order = container.dataset.rsOrder || 'create_date_desc';\r\n\r\n        // Filter options\r\n        const featuredOnly = container.dataset.rsFeatured === 'true';\r\n        const ownOnly = container.dataset.rsOwn === 'true';\r\n        const ownFirst = container.dataset.rsOwnFirst === 'true';\r\n\r\n        if (featuredOnly) params.featured = '1';\r\n        if (ownOnly) params.is_own = '1';\r\n\r\n        const results = await RealtySoftAPI.searchProperties(params as SearchParams);\r\n        let properties = results.data || [];\r\n\r\n        // Sort own properties first if ownFirst is enabled\r\n        if (ownFirst && properties.length > 0) {\r\n          properties = properties.sort((a: Property, b: Property) => {\r\n            const aOwn = a.is_own ? 1 : 0;\r\n            const bOwn = b.is_own ? 1 : 0;\r\n            return bOwn - aOwn; // Own properties first\r\n          });\r\n        }\r\n\r\n        // Find grid component inside this container and inject data\r\n        const gridEl = container.querySelector('.rs_property_grid') as RSHTMLElement | null;\r\n        if (gridEl && gridEl._rsComponent) {\r\n          const grid = gridEl._rsComponent as ComponentInstance;\r\n          if (typeof grid.setStandaloneProperties === 'function') {\r\n            (grid.setStandaloneProperties as (p: Property[]) => void)(properties);\r\n          }\r\n        }\r\n\r\n        console.log('[RealtySoft] Standalone listing loaded:', properties.length, 'properties');\r\n      } catch (error) {\r\n        console.error('[RealtySoft] Standalone listing error:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Push property OG data to WordPress transient cache.\r\n   * Fire-and-forget â€” OG caching is non-critical.\r\n   * Only runs on WordPress (wpRestUrl present in config).\r\n   */\r\n  function cacheOgData(property: Property): void {\r\n    const config = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n    if (!config.wpRestUrl) return;\r\n\r\n    const headers: Record<string, string> = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    if (config.wpApiNonce) headers['X-WP-Nonce'] = config.wpApiNonce;\r\n    if ((config as any).wpOgToken) headers['X-RS-OG-Token'] = (config as any).wpOgToken;\r\n\r\n    fetch(config.wpRestUrl + 'og-cache', {\r\n      method: 'POST',\r\n      headers,\r\n      body: JSON.stringify({\r\n        ref: property.ref || property.unique_ref,\r\n        title: property.title,\r\n        description: (property.short_description || property.description || '').substring(0, 300),\r\n        image: (property.imagesFull?.[0]) || (property.images?.[0]) || '',\r\n        price: RealtySoftLabels.formatPrice(property.price),\r\n        location: property.location || '',\r\n        site_name: config.siteName || '',\r\n      }),\r\n    })\r\n      .then((r) => {\r\n        if (!r.ok) console.warn('[RealtySoft] OG cache POST failed:', r.status, r.statusText);\r\n        else console.log('[RealtySoft] OG cache updated for:', property.ref || property.unique_ref);\r\n      })\r\n      .catch((e) => console.warn('[RealtySoft] OG cache POST error:', e));\r\n  }\r\n\r\n  /**\r\n   * Load property detail\r\n   */\r\n  async function loadProperty(id: number): Promise<Property> {\r\n    RealtySoftState.set('ui.loading', true);\r\n\r\n    try {\r\n      const result = await RealtySoftAPI.getProperty(id);\r\n      const property = result.data || result;\r\n\r\n      RealtySoftState.set('currentProperty', property);\r\n      RealtySoftState.set('ui.loading', false);\r\n      cacheOgData(property);\r\n\r\n      RealtySoftAnalytics.trackPropertyView(property);\r\n\r\n      document.dispatchEvent(\r\n        new CustomEvent('realtysoft:property-loaded', {\r\n          detail: { property },\r\n        })\r\n      );\r\n\r\n      return property;\r\n    } catch (error) {\r\n      RealtySoftState.set('ui.loading', false);\r\n      RealtySoftState.set('ui.error', (error as Error).message);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load property by reference\r\n   */\r\n  async function loadPropertyByRef(ref: string): Promise<Property> {\r\n    RealtySoftState.set('ui.loading', true);\r\n\r\n    try {\r\n      const result = await RealtySoftAPI.getPropertyByRef(ref);\r\n      const property = result.data || result;\r\n\r\n      RealtySoftState.set('currentProperty', property);\r\n      RealtySoftState.set('ui.loading', false);\r\n      cacheOgData(property);\r\n\r\n      RealtySoftAnalytics.trackPropertyView(property);\r\n\r\n      document.dispatchEvent(\r\n        new CustomEvent('realtysoft:property-loaded', {\r\n          detail: { property },\r\n        })\r\n      );\r\n\r\n      return property;\r\n    } catch (error) {\r\n      RealtySoftState.set('ui.loading', false);\r\n      RealtySoftState.set('ui.error', (error as Error).message);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset filters and search\r\n   */\r\n  function reset(): void {\r\n    RealtySoftState.resetFilters();\r\n  }\r\n\r\n  /**\r\n   * Go to page\r\n   */\r\n  function goToPage(page: number): void {\r\n    RealtySoftState.set('results.page', page);\r\n    RealtySoftAnalytics.trackPagination(\r\n      page,\r\n      RealtySoftState.get('results.totalPages') as number\r\n    );\r\n    search();\r\n  }\r\n\r\n  /**\r\n   * Change sort\r\n   */\r\n  function setSort(sort: string): void {\r\n    RealtySoftState.set('ui.sort', sort);\r\n    RealtySoftState.set('results.page', 1);\r\n    RealtySoftAnalytics.trackSortChange(sort);\r\n    search();\r\n  }\r\n\r\n  /**\r\n   * Change view (grid/list/map)\r\n   * When switching to/from map view, adjust perPage and re-fetch if needed\r\n   */\r\n  function setView(view: string): void {\r\n    const previousView = RealtySoftState.get<string>('ui.view') || 'grid';\r\n    const wasMapView = previousView === 'map';\r\n    const isMapView = view === 'map';\r\n\r\n    RealtySoftState.set('ui.view', view);\r\n    RealtySoftAnalytics.trackViewToggle(view);\r\n\r\n    // Check if perPage needs to change\r\n    if (wasMapView !== isMapView) {\r\n      const listPerPage = RealtySoftState.get<number>('config.perPage') || 12;\r\n      const mapPerPage = RealtySoftState.get<number>('config.mapPerPage') || 50;\r\n      const newPerPage = isMapView ? mapPerPage : listPerPage;\r\n      const currentPerPage = RealtySoftState.get<number>('results.perPage') || 12;\r\n\r\n      if (newPerPage !== currentPerPage) {\r\n        RealtySoftState.set('results.perPage', newPerPage);\r\n        RealtySoftState.set('results.page', 1); // Reset to page 1\r\n        search();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update filter\r\n   */\r\n  function setFilter(name: string, value: unknown): void {\r\n    console.log('[RealtySoft] setFilter called:', name, '=', value);\r\n    if (!RealtySoftState.isFilterLocked(name)) {\r\n      RealtySoftState.set(`filters.${name}`, value);\r\n      RealtySoftAnalytics.trackFilterChange(name, value);\r\n    } else {\r\n      console.log('[RealtySoft] setFilter BLOCKED - filter is locked:', name);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get public state\r\n   */\r\n  function getState(): Record<string, unknown> {\r\n    return RealtySoftState.getState() as unknown as Record<string, unknown>;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  function subscribe(\r\n    path: string,\r\n    callback: (value: unknown, oldValue: unknown, path: string) => void\r\n  ): () => void {\r\n    return RealtySoftState.subscribe(path, callback);\r\n  }\r\n\r\n  /**\r\n   * Check if initialized\r\n   */\r\n  function isReady(): boolean {\r\n    return initialized;\r\n  }\r\n\r\n  /**\r\n   * Extract property reference from current URL\r\n   */\r\n  function extractPropertyRefFromUrl(): string | null {\r\n    const pathname = window.location.pathname;\r\n    const globalConfig = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n    const propertySlug = globalConfig.propertyPageSlug || 'property';\r\n\r\n    // 1. Query params: ?ref=X or ?reference=X\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const queryRef = urlParams.get('ref') || urlParams.get('reference');\r\n    if (queryRef) return queryRef.trim();\r\n\r\n    // 2. Check if URL is under the property slug at all\r\n    const slugRegex = new RegExp(`/${propertySlug}/(.+?)/?$`, 'i');\r\n    const slugMatch = pathname.match(slugRegex);\r\n    if (!slugMatch) return null;\r\n\r\n    const subpath = slugMatch[1]; // e.g. \"villa-name-V12345\" or \"R123456\"\r\n\r\n    // 3. SEO URL: /property/title-slug-REF (ref is last hyphen-separated segment)\r\n    const parts = subpath.split('-');\r\n    if (parts.length > 1) {\r\n      const lastPart = parts[parts.length - 1];\r\n      if (/^[A-Z0-9]{3,}$/i.test(lastPart)) return lastPart;\r\n    }\r\n\r\n    // 4. Direct ref URL: /property/REF (the whole subpath is the ref)\r\n    if (/^[A-Z0-9]{3,}$/i.test(subpath)) return subpath;\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Check if current page looks like a 404 error page\r\n   */\r\n  function isLikely404Page(): boolean {\r\n    const bodyText = (document.body.innerText || '').toLowerCase();\r\n    const title = (document.title || '').toLowerCase();\r\n\r\n    const titlePatterns = [\r\n      '404',\r\n      'not found',\r\n      'page not found',\r\n      'error',\r\n      'pagina no encontrada',\r\n      'seite nicht gefunden',\r\n      'page introuvable',\r\n      'pagina non trovata',\r\n    ];\r\n\r\n    for (const pattern of titlePatterns) {\r\n      if (title.includes(pattern)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    const bodyPatterns = [\r\n      '404',\r\n      'not found',\r\n      'page not found',\r\n      \"page doesn't exist\",\r\n      'page does not exist',\r\n      \"couldn't find\",\r\n      'could not find',\r\n      'no longer exists',\r\n      'has been removed',\r\n      'has been deleted',\r\n      'oops!',\r\n      \"sorry, we couldn't\",\r\n      'pagina no encontrada',\r\n      'no se encuentra',\r\n    ];\r\n\r\n    for (const pattern of bodyPatterns) {\r\n      if (bodyText.includes(pattern)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    const statusMeta = document.querySelector('meta[name=\"status\"]') as HTMLMetaElement | null;\r\n    if (statusMeta && statusMeta.content === '404') {\r\n      return true;\r\n    }\r\n\r\n    const errorSelectors = [\r\n      '.error-404',\r\n      '#error-404',\r\n      '.page-404',\r\n      '.not-found',\r\n      '.error-page',\r\n      '[class*=\"404\"]',\r\n      '[id*=\"404\"]',\r\n    ];\r\n\r\n    for (const selector of errorSelectors) {\r\n      if (document.querySelector(selector)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Auto-inject property detail container and initialize\r\n   */\r\n  function autoInjectPropertyDetail(propertyRef: string): boolean {\r\n    console.log('[RealtySoft] Auto-detected property URL, ref:', propertyRef);\r\n\r\n    const is404 = isLikely404Page();\r\n    if (is404) {\r\n      console.log('[RealtySoft] Detected 404/error page, will replace content');\r\n    }\r\n\r\n    // Narrowest WordPress content selectors first\r\n    const containerSelectors = [\r\n      '.entry-content',\r\n      '.page-content',\r\n      '.post-content',\r\n      '.single-content',\r\n      'article',\r\n      '.content',\r\n      '#content',\r\n      '.main-content',\r\n      '.site-content',\r\n      '#primary',\r\n      '#main',\r\n      'main',\r\n    ];\r\n\r\n    let mainContent: HTMLElement | null = null;\r\n    let usedFallback = false;\r\n    for (const selector of containerSelectors) {\r\n      mainContent = document.querySelector<HTMLElement>(selector);\r\n      if (mainContent) {\r\n        console.log(`[RealtySoft] Found container: ${selector}`);\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Fallback: find the page heading and use its parent as the content container\r\n    if (!mainContent) {\r\n      const pageHeading = document.querySelector<HTMLElement>('h1, h2.page-title, h2.entry-title');\r\n      if (pageHeading && pageHeading.parentElement && pageHeading.parentElement !== document.body) {\r\n        mainContent = pageHeading.parentElement;\r\n        usedFallback = true;\r\n        console.log(`[RealtySoft] Using heading parent as container: <${mainContent.tagName.toLowerCase()}>`);\r\n      }\r\n    }\r\n\r\n    if (!mainContent) {\r\n      mainContent = document.body;\r\n      usedFallback = true;\r\n      console.log('[RealtySoft] Using body as container');\r\n    }\r\n\r\n    if (is404) {\r\n      console.log('[RealtySoft] Clearing 404 content...');\r\n      mainContent.innerHTML = '';\r\n\r\n      const wrapper = document.createElement('div');\r\n      wrapper.className = 'rs-auto-injected-wrapper';\r\n      wrapper.style.cssText = 'max-width: 1400px; margin: 0 auto; padding: 20px;';\r\n      mainContent.appendChild(wrapper);\r\n      mainContent = wrapper;\r\n\r\n      const globalConfig = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n      const originalTitle = document.title;\r\n      document.title = globalConfig.detailPageTitle || 'Property Details';\r\n      console.log(\r\n        `[RealtySoft] Updated page title from \"${originalTitle}\" to \"${document.title}\"`\r\n      );\r\n\r\n      const metaDesc = document.querySelector(\r\n        'meta[name=\"description\"]'\r\n      ) as HTMLMetaElement | null;\r\n      if (metaDesc) {\r\n        metaDesc.content = `Property details for ${propertyRef}`;\r\n      }\r\n\r\n      if (window.history && window.history.replaceState) {\r\n        window.history.replaceState({ propertyRef }, document.title, window.location.href);\r\n      }\r\n    }\r\n\r\n    // On non-404 (WordPress rewrite served the real page):\r\n    // Hide existing content and inject the detail container.\r\n    // Use CSS hiding (not innerHTML clearing) when we fell back to a broad\r\n    // container like body or a heading parent â€” clearing would destroy\r\n    // nav, header, footer, and sidebar elements.\r\n    if (!is404) {\r\n      if (!usedFallback) {\r\n        // Standard content container (e.g. .entry-content) â€” safe to replace\r\n        mainContent.innerHTML = '';\r\n      } else {\r\n        // Broad container â€” hide children with CSS instead of destroying them\r\n        const hideStyle = document.createElement('style');\r\n        hideStyle.id = 'rs-auto-inject-hide';\r\n        hideStyle.textContent =\r\n          '.rs-auto-inject-hidden { display: none !important; }';\r\n        document.head.appendChild(hideStyle);\r\n\r\n        Array.from(mainContent.children).forEach((child) => {\r\n          const el = child as HTMLElement;\r\n          const tag = el.tagName.toLowerCase();\r\n          // Keep structural elements (nav, header, footer, sidebar, scripts, styles)\r\n          if (\r\n            tag === 'nav' || tag === 'header' || tag === 'footer' ||\r\n            tag === 'aside' || tag === 'script' || tag === 'style' ||\r\n            tag === 'link' || tag === 'noscript' ||\r\n            el.id === 'rs-early-hide' ||\r\n            el.getAttribute('role') === 'navigation' ||\r\n            el.getAttribute('role') === 'banner' ||\r\n            el.getAttribute('role') === 'contentinfo'\r\n          ) {\r\n            return;\r\n          }\r\n          el.classList.add('rs-auto-inject-hidden');\r\n        });\r\n      }\r\n    }\r\n\r\n    const detailContainer = document.createElement('div');\r\n    detailContainer.className = 'property-detail-container';\r\n    detailContainer.id = 'property-detail-container';\r\n    detailContainer.dataset.propertyRef = propertyRef;\r\n    detailContainer.dataset.rsAutoInjected = 'true';\r\n\r\n    detailContainer.innerHTML = `\r\n      <div class=\"rs-detail-loading\" style=\"text-align: center; padding: 60px 20px;\">\r\n        <div class=\"rs-spinner\" style=\"width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: rs-spin 1s linear infinite; margin: 0 auto;\"></div>\r\n        <p style=\"margin-top: 20px; color: #666;\">Loading property details...</p>\r\n      </div>\r\n      <style>\r\n        @keyframes rs-spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      </style>\r\n    `;\r\n\r\n    mainContent.appendChild(detailContainer);\r\n\r\n    console.log('[RealtySoft] Auto-injected rs_detail container successfully');\r\n\r\n    window._rsAutoInjectedRef = propertyRef;\r\n\r\n    // Remove early-hide CSS + loading overlay now that the detail container is injected\r\n    document.body.classList.add('rs-property-ready');\r\n    const earlyHideStyle = document.getElementById('rs-early-hide');\r\n    if (earlyHideStyle) earlyHideStyle.remove();\r\n    const loadingOverlay = document.getElementById('rs-loading-overlay');\r\n    if (loadingOverlay) loadingOverlay.remove();\r\n\r\n    // Safety timeout: if the component hasn't initialized after 10 seconds,\r\n    // show an error with retry instead of spinning forever\r\n    setTimeout(() => {\r\n      const loading = detailContainer.querySelector('.rs-detail-loading');\r\n      if (loading) {\r\n        console.error('[RealtySoft] Auto-inject timeout â€” component did not initialize');\r\n        detailContainer.innerHTML = `\r\n          <div style=\"text-align: center; padding: 60px 20px;\">\r\n            <div style=\"width: 48px; height: 48px; margin: 0 auto 16px; border-radius: 50%; border: 2px solid #e74c3c; display: flex; align-items: center; justify-content: center;\">\r\n              <span style=\"color: #e74c3c; font-weight: bold; font-size: 20px;\">!</span>\r\n            </div>\r\n            <p style=\"color: #666; margin-bottom: 16px;\">Failed to load property details</p>\r\n            <button onclick=\"window.location.reload()\" style=\"padding: 10px 24px; background: #3498db; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;\">Try Again</button>\r\n          </div>\r\n        `;\r\n      }\r\n    }, 10000);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check if we should auto-initialize based on URL or elements\r\n   */\r\n  function shouldAutoInit(): boolean {\r\n    // CHECK 1: Property detail URL â€” takes priority over widget elements\r\n    const propertyRef = extractPropertyRefFromUrl();\r\n    if (propertyRef) {\r\n      const existingDetail = document.querySelector<HTMLElement>('.rs_detail');\r\n      const existingTemplate =\r\n        document.querySelector('.property-detail-container') ||\r\n        document.querySelector('#property-detail-container');\r\n\r\n      if (existingDetail && existingDetail.children.length === 0 && !existingTemplate) {\r\n        // Empty rs_detail div â€” upgrade to self-rendering template\r\n        console.log('[RealtySoft] Found empty .rs_detail â€” upgrading to property-detail-container');\r\n        existingDetail.classList.remove('rs_detail');\r\n        existingDetail.classList.add('property-detail-container');\r\n        existingDetail.id = 'property-detail-container';\r\n        existingDetail.dataset.propertyRef = propertyRef;\r\n        // Remove early-hide + loading overlay now that the container is ready\r\n        document.body.classList.add('rs-property-ready');\r\n        const earlyHide = document.getElementById('rs-early-hide');\r\n        if (earlyHide) earlyHide.remove();\r\n        const overlay = document.getElementById('rs-loading-overlay');\r\n        if (overlay) overlay.remove();\r\n      } else if (!existingDetail && !existingTemplate) {\r\n        autoInjectPropertyDetail(propertyRef);\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // CHECK 2: Widget elements\r\n    if (\r\n      document.querySelector('[class^=\"rs_\"]') ||\r\n      document.getElementById('rs_search') ||\r\n      document.getElementById('rs_listing')\r\n    ) {\r\n      return true;\r\n    }\r\n\r\n    // CHECK 3: Template elements\r\n    if (\r\n      document.querySelector('.rs-search-template-01') ||\r\n      document.querySelector('.rs-search-template-02') ||\r\n      document.querySelector('.rs-search-template-03') ||\r\n      document.querySelector('.rs-search-template-04') ||\r\n      document.querySelector('.rs-search-template-05') ||\r\n      document.querySelector('.rs-search-template-06') ||\r\n      document.querySelector('.rs-listing-template-01') ||\r\n      document.querySelector('.rs-listing-template-02') ||\r\n      document.querySelector('.rs-listing-template-03') ||\r\n      document.querySelector('.rs-listing-template-04') ||\r\n      document.querySelector('.rs-listing-template-05') ||\r\n      document.querySelector('.rs-listing-template-06') ||\r\n      document.querySelector('.rs-listing-template-07') ||\r\n      document.querySelector('.rs-listing-template-08') ||\r\n      document.querySelector('.rs-listing-template-09') ||\r\n      document.querySelector('.rs-listing-template-10') ||\r\n      document.querySelector('.rs-listing-template-11') ||\r\n      document.querySelector('.rs-listing-template-12')\r\n    ) {\r\n      return true;\r\n    }\r\n\r\n    // No widget elements found and no property URL â€” clean up early hide + overlay\r\n    document.body.classList.add('rs-property-ready');\r\n    const earlyHide = document.getElementById('rs-early-hide');\r\n    if (earlyHide) earlyHide.remove();\r\n    const loadOverlay = document.getElementById('rs-loading-overlay');\r\n    if (loadOverlay) loadOverlay.remove();\r\n\r\n    return false;\r\n  }\r\n\r\n  // Auto-initialize: start as early as possible\r\n  if (document.readyState === 'loading') {\r\n    // On property detail pages, start init as soon as <body> exists\r\n    // (no need to wait for full DOM â€” the widget creates its own container).\r\n    const cfg = (window as any).RealtySoftConfig || {};\r\n    const detailSlug = cfg.propertyPageSlug || 'property';\r\n    const isDetailUrl =\r\n      new RegExp('/' + detailSlug + '/[^/]+', 'i').test(window.location.pathname) ||\r\n      /[?&]ref(erence)?=/i.test(window.location.search);\r\n\r\n    if (isDetailUrl && document.body) {\r\n      // Body already exists (script loaded async after <body> tag) â€” start immediately\r\n      if (shouldAutoInit()) {\r\n        init();\r\n      }\r\n    } else {\r\n      // Listing pages or body not ready â€” wait for full DOM\r\n      document.addEventListener('DOMContentLoaded', () => {\r\n        if (shouldAutoInit()) {\r\n          init();\r\n        }\r\n      });\r\n    }\r\n  } else {\r\n    setTimeout(() => {\r\n      if (shouldAutoInit()) {\r\n        init();\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Get current widget mode\r\n   */\r\n  function getMode(): WidgetMode {\r\n    return widgetMode;\r\n  }\r\n\r\n  /**\r\n   * Re-render all component instances with current labels\r\n   */\r\n  function reRenderComponents(): void {\r\n    console.log(\r\n      '[RealtySoft] Re-rendering',\r\n      componentInstances.length,\r\n      'components with new labels'\r\n    );\r\n    for (const instance of componentInstances) {\r\n      if (instance && typeof instance.render === 'function') {\r\n        try {\r\n          instance.render();\r\n          if (typeof instance.bindEvents === 'function') {\r\n            instance.bindEvents();\r\n          }\r\n        } catch (e) {\r\n          console.warn('[RealtySoft] Error re-rendering component:', e);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change language and reload labels\r\n   */\r\n  async function setLanguage(newLanguage: string): Promise<void> {\r\n    console.log('[RealtySoft] Changing language to:', newLanguage);\r\n\r\n    const globalConfig = (window.RealtySoftConfig || {}) as ControllerConfig;\r\n    const labelsMode = globalConfig.labelsMode || 'static';\r\n\r\n    // IMPORTANT: Always reset labels to new language static defaults FIRST (instant)\r\n    // This ensures components get correct labels when their subscriptions fire\r\n    RealtySoftLabels.initStatic(newLanguage);\r\n    if (globalConfig.labelOverrides) {\r\n      RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, newLanguage);\r\n    }\r\n    RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n\r\n    // Now set state - this triggers component subscriptions, but labels are already updated\r\n    RealtySoftState.set('config.language', newLanguage);\r\n\r\n    // Re-initialize API with new language\r\n    RealtySoftAPI.init({\r\n      language: newLanguage,\r\n      apiKey: globalConfig.apiKey,\r\n      apiUrl: globalConfig.apiUrl,\r\n      cache: globalConfig.cache,\r\n    });\r\n\r\n    // Clear all language-dependent caches to force fresh data\r\n    RealtySoftAPI.clearPropertyCache();\r\n\r\n    // Reset features/property types loaded flags so they refetch with new language\r\n    RealtySoftState.set('data.featuresLoaded', false);\r\n    RealtySoftState.set('data.propertyTypesLoaded', false);\r\n    RealtySoftState.set('data.features', []);\r\n    RealtySoftState.set('data.propertyTypes', []);\r\n\r\n    // Refetch property data with new language\r\n    // This ensures translated content is loaded from API\r\n    const refetchPropertyData = async () => {\r\n      try {\r\n        // If on listing page with properties, re-run search\r\n        const currentProperties = RealtySoftState.get<Property[]>('results.properties');\r\n        if (currentProperties && currentProperties.length > 0) {\r\n          console.log('[RealtySoft] Language changed: refetching listing properties...');\r\n          await search();\r\n        }\r\n\r\n        // If on detail page with a property, reload it with forceRefresh\r\n        const currentProperty = RealtySoftState.get<Property>('currentProperty');\r\n        if (currentProperty) {\r\n          console.log('[RealtySoft] Language changed: reloading detail property...');\r\n          RealtySoftState.set('ui.loading', true);\r\n          try {\r\n            let result;\r\n            if (currentProperty.ref) {\r\n              result = await RealtySoftAPI.getPropertyByRef(currentProperty.ref, { forceRefresh: true });\r\n            } else if (currentProperty.id) {\r\n              result = await RealtySoftAPI.getProperty(currentProperty.id, { forceRefresh: true });\r\n            }\r\n            if (result?.data) {\r\n              RealtySoftState.set('currentProperty', result.data);\r\n              console.log('[RealtySoft] Property reloaded with new language:', newLanguage);\r\n            }\r\n          } finally {\r\n            RealtySoftState.set('ui.loading', false);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[RealtySoft] Error refetching property data for new language:', error);\r\n      }\r\n    };\r\n\r\n    // Start property refetch (don't await - let it run in parallel with label fetching)\r\n    refetchPropertyData();\r\n\r\n    // Static mode: we're done - no API call needed\r\n    if (labelsMode === 'static') {\r\n      console.log('[RealtySoft] Static mode: language changed to:', newLanguage);\r\n      reRenderComponents();\r\n      return;\r\n    }\r\n\r\n    // API and hybrid modes: fetch labels from API\r\n    RealtySoftAPI.clearCache('labels_' + newLanguage);\r\n\r\n    if (labelsMode === 'hybrid') {\r\n      // Hybrid mode: API fetch in background (non-blocking)\r\n      RealtySoftAPI.getLabels()\r\n        .then((labelsData) => {\r\n          const apiLabels = transformAPILabels(labelsData, newLanguage);\r\n          if (Object.keys(apiLabels).length > 0) {\r\n            RealtySoftLabels.loadFromAPI(apiLabels);\r\n            if (globalConfig.labelOverrides) {\r\n              RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, newLanguage);\r\n            }\r\n            RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n            reRenderComponents();\r\n            console.log('[RealtySoft] Hybrid mode: API labels merged for:', newLanguage);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[RealtySoft] Hybrid mode: API labels fetch failed, using static:', error);\r\n        });\r\n\r\n      // Re-render immediately with static labels\r\n      reRenderComponents();\r\n      console.log('[RealtySoft] Hybrid mode: language changed to:', newLanguage);\r\n      return;\r\n    }\r\n\r\n    // API mode: blocking fetch\r\n    try {\r\n      const labelsData = await RealtySoftAPI.getLabels();\r\n      const apiLabels = transformAPILabels(labelsData, newLanguage);\r\n      if (Object.keys(apiLabels).length > 0) {\r\n        await RealtySoftLabels.loadFromAPI(apiLabels);\r\n      }\r\n\r\n      if (globalConfig.labelOverrides) {\r\n        RealtySoftLabels.applyOverrides(globalConfig.labelOverrides, newLanguage);\r\n      }\r\n\r\n      RealtySoftState.set('data.labels', RealtySoftLabels.getAll());\r\n      reRenderComponents();\r\n      console.log('[RealtySoft] API mode: language changed successfully to:', newLanguage);\r\n    } catch (error) {\r\n      console.error('[RealtySoft] Error loading labels for language:', newLanguage, error);\r\n      // Still re-render with static labels on error\r\n      reRenderComponents();\r\n    }\r\n  }\r\n\r\n  // Public API\r\n  return {\r\n    init,\r\n    registerComponent,\r\n    getComponent,\r\n    search,\r\n    loadProperty,\r\n    loadPropertyByRef,\r\n    reset,\r\n    goToPage,\r\n    setSort,\r\n    setView,\r\n    setFilter,\r\n    getState,\r\n    subscribe,\r\n    isReady,\r\n    getMode,\r\n    setLanguage,\r\n\r\n    // Expose sub-modules\r\n    State: RealtySoftState as RealtySoftStateModule,\r\n    API: RealtySoftAPI as RealtySoftAPIModule,\r\n    Labels: RealtySoftLabels as RealtySoftLabelsModule,\r\n    Analytics: RealtySoftAnalytics,\r\n    Router: RealtySoftRouter,\r\n  };\r\n})();\r\n\r\n// Make globally available\r\nif (typeof window !== 'undefined') {\r\n  window.RealtySoft = RealtySoft;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RealtySoft };\r\nexport default RealtySoft;\r\n","/**\r\n * RealtySoft Widget v3 - Base Component\r\n * Base class for all components\r\n */\r\n\r\nimport type {\r\n  ComponentOptions,\r\n  UnsubscribeFunction,\r\n  SubscriptionCallback,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftModule,\r\n  LockedFilters,\r\n} from '../types/index';\r\n\r\n// Declare global modules (they are set by the IIFE modules)\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\n// Extended HTMLElement with component reference\r\ninterface RSHTMLElement extends HTMLElement {\r\n  _rsComponent?: RSBaseComponent;\r\n  dataset: DOMStringMap & {\r\n    rsInit?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Base component class for all RealtySoft components\r\n */\r\nclass RSBaseComponent {\r\n  element: RSHTMLElement;\r\n  options: ComponentOptions;\r\n  variation: string;\r\n  subscriptions: UnsubscribeFunction[];\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    this.element = element as RSHTMLElement;\r\n    this.options = options;\r\n    this.variation = options.variation || '1';\r\n    this.subscriptions = [];\r\n\r\n    // Mark element as initialized\r\n    this.element.dataset.rsInit = 'true';\r\n\r\n    // NOTE: this.init() is NOT called here.\r\n    // Subclasses MUST call this.init() at the end of their own constructor.\r\n    // This is required because ES2022 class field initializers run AFTER super()\r\n    // returns but BEFORE the rest of the subclass constructor body. If init()\r\n    // were called here (inside super), any subclass field initializers (e.g.\r\n    // `private select: HTMLSelectElement | null = null`) would overwrite\r\n    // properties set during init/render/bindEvents.\r\n  }\r\n\r\n  /**\r\n   * Initialize component - override in subclass\r\n   */\r\n  init(): void {\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  /**\r\n   * Render component - override in subclass\r\n   */\r\n  render(): void {}\r\n\r\n  /**\r\n   * Bind events - override in subclass\r\n   */\r\n  bindEvents(): void {}\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  subscribe<T = unknown>(path: string, callback: SubscriptionCallback<T>): UnsubscribeFunction {\r\n    const unsubscribe = RealtySoftState.subscribe(path, callback);\r\n    this.subscriptions.push(unsubscribe);\r\n    return unsubscribe;\r\n  }\r\n\r\n  /**\r\n   * Get label\r\n   */\r\n  label(key: string, replacements?: Record<string, string | number>): string {\r\n    return RealtySoftLabels.get(key, replacements);\r\n  }\r\n\r\n  /**\r\n   * Check if this filter is locked\r\n   */\r\n  isLocked(filterName: string): boolean {\r\n    return RealtySoftState.isFilterLocked(filterName);\r\n  }\r\n\r\n  /**\r\n   * Apply locked/disabled styles to element\r\n   * Shows the filter but prevents interaction\r\n   */\r\n  applyLockedStyle(): void {\r\n    this.element.classList.add('rs-filter--locked');\r\n    this.element.setAttribute('title', 'This filter is pre-set for this page');\r\n  }\r\n\r\n  /**\r\n   * Get locked filter value\r\n   */\r\n  getLockedValue(filterName: string): unknown {\r\n    const lockedFilters = RealtySoftState.get<LockedFilters>('lockedFilters') || {};\r\n    return lockedFilters[filterName];\r\n  }\r\n\r\n  /**\r\n   * Set filter value\r\n   */\r\n  setFilter(name: string, value: unknown): void {\r\n    RealtySoft.setFilter(name, value);\r\n  }\r\n\r\n  /**\r\n   * Get filter value\r\n   */\r\n  getFilter<T = unknown>(name: string): T {\r\n    return RealtySoftState.get<T>(`filters.${name}`);\r\n  }\r\n\r\n  /**\r\n   * Create element helper\r\n   */\r\n  createElement(tag: string, className?: string, innerHTML: string = ''): HTMLElement {\r\n    const el = document.createElement(tag);\r\n    if (className) el.className = className;\r\n    if (innerHTML) el.innerHTML = innerHTML;\r\n    return el;\r\n  }\r\n\r\n  /**\r\n   * Destroy component\r\n   */\r\n  destroy(): void {\r\n    // Unsubscribe from all state subscriptions\r\n    this.subscriptions.forEach((unsub) => unsub());\r\n    this.subscriptions = [];\r\n\r\n    // Clear element\r\n    this.element.innerHTML = '';\r\n    delete this.element._rsComponent;\r\n    delete this.element.dataset.rsInit;\r\n  }\r\n}\r\n\r\n// Assign to window for backwards compatibility\r\nif (typeof window !== 'undefined') {\r\n  (window as unknown as { RSBaseComponent: typeof RSBaseComponent }).RSBaseComponent =\r\n    RSBaseComponent;\r\n}\r\n\r\n// Export for ES modules\r\nexport { RSBaseComponent };\r\nexport default RSBaseComponent;\r\n","/**\r\n * RealtySoft Widget v3 - Location Component\r\n * Variations:\r\n *   1 = Search/Autocomplete (typeahead single select)\r\n *   2 = Two Dropdowns (parent + child cascading multi-select)\r\n *   3 = Hierarchical Multi-Select (single dropdown with tree)\r\n *   4 = Traditional Dropdown (simple select with hierarchy)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  Location,\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\ninterface ExtendedLocation extends Location {\r\n  type?: string;\r\n  count?: number;\r\n  level?: number;\r\n}\r\n\r\n/**\r\n * Check if a location has properties (property_count > 0)\r\n * Returns true if property_count is undefined (backwards compatibility) or > 0\r\n * Returns false only if property_count is explicitly 0\r\n */\r\nfunction hasProperties(loc: ExtendedLocation): boolean {\r\n  const count = loc.property_count;\r\n  // Debug logging\r\n  if (count === 0) {\r\n    console.log(`[RealtySoft] Filtering out location with 0 properties: ${loc.name} (id: ${loc.id})`);\r\n  }\r\n  // If property_count doesn't exist, show the location (backwards compatibility)\r\n  if (count === undefined || count === null) return true;\r\n  return count > 0;\r\n}\r\n\r\n/**\r\n * Check if a parent location or any of its descendants have properties\r\n * A parent is shown only if:\r\n * 1. It has property_count > 0, OR\r\n * 2. At least one of its descendants has property_count > 0\r\n */\r\nfunction hasPropertiesOrChildren(loc: ExtendedLocation, allLocations: ExtendedLocation[]): boolean {\r\n  // Check if the location itself has properties\r\n  const selfHasProperties = hasProperties(loc);\r\n\r\n  // Get all descendants (children, grandchildren, etc.)\r\n  const getAllDescendants = (parentId: number | string): ExtendedLocation[] => {\r\n    const children = allLocations.filter(child => {\r\n      const pid = child.parent_id;\r\n      if (!pid && pid !== 0) return false;\r\n      return String(pid) === String(parentId);\r\n    });\r\n\r\n    let descendants = [...children];\r\n    children.forEach(child => {\r\n      descendants = descendants.concat(getAllDescendants(child.id));\r\n    });\r\n    return descendants;\r\n  };\r\n\r\n  const descendants = getAllDescendants(loc.id);\r\n  const anyDescendantHasProperties = descendants.some(d => hasProperties(d));\r\n\r\n  // Show if self has properties OR any descendant has properties\r\n  return selfHasProperties || anyDescendantHasProperties;\r\n}\r\n\r\nclass RSLocation extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private locations: ExtendedLocation[] = [];\r\n  private selectedLocations: Set<string> = new Set();\r\n  private selectedLocation: number | null = null;\r\n  private selectedName: string = '';\r\n  private isOpen: boolean = false;\r\n  private searchTerm: string = '';\r\n  private filteredLocations: ExtendedLocation[] = [];\r\n  private highlightIndex: number = -1;\r\n\r\n  // For variation 2 (two dropdowns)\r\n  private selectedParents: Set<string> = new Set();\r\n  private selectedChildren: Set<string> = new Set();\r\n  private parentType: string = 'municipality';\r\n  private childType: string = 'city';\r\n  private parentLabel: string = '';\r\n  private childLabel: string = '';\r\n\r\n  // DOM elements\r\n  private input: HTMLInputElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n  private list: HTMLElement | null = null;\r\n  private clearBtn: HTMLButtonElement | null = null;\r\n  private select: HTMLSelectElement | null = null;\r\n  private multiBtn: HTMLButtonElement | null = null;\r\n  private filterInput: HTMLInputElement | null = null;\r\n  private hierarchyList: HTMLElement | null = null;\r\n  private tagsContainer: HTMLElement | null = null;\r\n\r\n  // For variation 2\r\n  private parentBtn: HTMLButtonElement | null = null;\r\n  private parentDropdown: HTMLElement | null = null;\r\n  private parentList: HTMLElement | null = null;\r\n  private parentFilter: HTMLInputElement | null = null;\r\n  private childBtn: HTMLButtonElement | null = null;\r\n  private childDropdown: HTMLElement | null = null;\r\n  private childList: HTMLElement | null = null;\r\n  private childFilter: HTMLInputElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('location');\r\n    this.locations = RealtySoftState.get<ExtendedLocation[]>('data.locations') || [];\r\n\r\n    // Debug: Log location data on init\r\n    const zeroCount = this.locations.filter(l => l.property_count === 0);\r\n    const undefinedCount = this.locations.filter(l => l.property_count === undefined || l.property_count === null);\r\n    console.log(`[RealtySoft] Location init: ${this.locations.length} locations, ${zeroCount.length} with count=0, ${undefinedCount.length} with count=undefined`);\r\n    if (zeroCount.length > 0) {\r\n      console.log(`[RealtySoft] Zero-count: ${zeroCount.slice(0, 15).map(l => `${l.name}(id:${l.id})`).join(', ')}`);\r\n    }\r\n    this.selectedLocations = new Set();\r\n    this.selectedLocation = this.getFilter<number | null>('location');\r\n    this.selectedName = this.getFilter<string>('locationName') || '';\r\n    this.isOpen = false;\r\n    this.searchTerm = '';\r\n    this.filteredLocations = [];\r\n    this.highlightIndex = -1;\r\n\r\n    // For variation 2 (two dropdowns)\r\n    this.selectedParents = new Set();\r\n    this.selectedChildren = new Set();\r\n\r\n    // Get parent/child type from data attributes or defaults\r\n    this.parentType = this.element.dataset.rsParentType || 'municipality';\r\n    this.childType = this.element.dataset.rsChildType || 'city';\r\n\r\n    // If locked, find the location name for display\r\n    if (this.lockedMode) {\r\n      const lockedValue = this.getFilter<number | null>('location');\r\n      if (lockedValue) {\r\n        const lockedLocation = this.locations.find(loc => loc.id == lockedValue);\r\n        if (lockedLocation) {\r\n          this.selectedName = lockedLocation.name;\r\n        }\r\n      }\r\n    }\r\n\r\n    // If we have a location ID but no name (e.g., from URL params), look up the name\r\n    if (this.selectedLocation && !this.selectedName && this.locations.length > 0) {\r\n      const loc = this.locations.find(l => l.id === this.selectedLocation);\r\n      if (loc) {\r\n        this.selectedName = loc.name;\r\n        // Also update the state so other components can use it\r\n        this.setFilter('locationName', loc.name);\r\n      }\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    // If we have a pre-selected location, update the display\r\n    if (this.selectedLocation) {\r\n      this.updateDisplay();\r\n    }\r\n\r\n    // Subscribe to location data updates\r\n    this.subscribe<ExtendedLocation[]>('data.locations', (locations) => {\r\n      this.locations = locations;\r\n\r\n      // Debug: Log locations with property_count = 0 or undefined\r\n      const zeroCountLocs = locations.filter(l => l.property_count === 0);\r\n      const undefinedCountLocs = locations.filter(l => l.property_count === undefined || l.property_count === null);\r\n      console.log(`[RealtySoft] Location data: ${locations.length} total, ${zeroCountLocs.length} with count=0, ${undefinedCountLocs.length} with count=undefined`);\r\n      if (zeroCountLocs.length > 0) {\r\n        console.log(`[RealtySoft] Zero-count locations: ${zeroCountLocs.slice(0, 10).map(l => `${l.name}(id:${l.id},type:${l.type})`).join(', ')}${zeroCountLocs.length > 10 ? '...' : ''}`);\r\n      }\r\n\r\n      // If we have a location ID but no name, look it up now that we have data\r\n      if (this.selectedLocation && !this.selectedName) {\r\n        const loc = this.locations.find(l => l.id === this.selectedLocation);\r\n        if (loc) {\r\n          this.selectedName = loc.name;\r\n          this.setFilter('locationName', loc.name);\r\n          this.updateDisplay();\r\n        }\r\n      }\r\n      this.updateLocationData();\r\n    });\r\n\r\n    // Subscribe to filter changes\r\n    this.subscribe<number | null>('filters.location', (value) => {\r\n      this.selectedLocation = value;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  private getParentLocations(): ExtendedLocation[] {\r\n    // Filter by parentType (default: municipality) and exclude items with 0 properties\r\n    // For parents, also check if they have children with properties\r\n    const allParents = this.locations.filter(loc =>\r\n      loc.type && loc.type.toLowerCase() === this.parentType.toLowerCase()\r\n    );\r\n\r\n    // First filter by property_count\r\n    let filtered = allParents.filter(loc => hasPropertiesOrChildren(loc, this.locations));\r\n\r\n    // For variation 2 (Two Dropdowns), also filter out parents with no children\r\n    // This handles cases where API has incorrect property_count but parent has no actual children\r\n    if (this.variation === '2') {\r\n      filtered = filtered.filter(parent => {\r\n        const children = this.locations.filter(loc => {\r\n          const pid = loc.parent_id;\r\n          if (!pid && pid !== 0) return false;\r\n          const matchesParent = String(pid) === String(parent.id);\r\n          const matchesType = loc.type && loc.type.toLowerCase() === this.childType.toLowerCase();\r\n          return matchesParent && matchesType && hasProperties(loc);\r\n        });\r\n        return children.length > 0;\r\n      });\r\n    }\r\n\r\n    const filteredOut = allParents.filter(p => !filtered.includes(p));\r\n    console.log(`[RealtySoft] Location parents: ${allParents.length} total, ${filtered.length} after filtering, ${filteredOut.length} filtered out`);\r\n\r\n    if (filteredOut.length > 0) {\r\n      console.log(`[RealtySoft] Filtered out parents: ${filteredOut.map(p => `${p.name}(id:${p.id},count:${p.property_count})`).join(', ')}`);\r\n    }\r\n\r\n    return filtered.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n  }\r\n\r\n  private getChildLocations(parentId: number | string): ExtendedLocation[] {\r\n    // Get the parent location to check for duplicate names\r\n    const parent = this.locations.find(loc => String(loc.id) === String(parentId));\r\n    const parentName = parent?.name?.toLowerCase().trim() || '';\r\n\r\n    // Get locations of childType that have this parentId, exclude items with 0 properties\r\n    const allChildren = this.locations.filter(loc => {\r\n      const pid = loc.parent_id;\r\n      const matchesParent = pid && String(pid) === String(parentId);\r\n      const matchesType = loc.type && loc.type.toLowerCase() === this.childType.toLowerCase();\r\n      return matchesParent && matchesType;\r\n    });\r\n\r\n    // Filter by property_count and exclude children with same name as parent\r\n    const filtered = allChildren.filter(loc => {\r\n      const hasProps = hasProperties(loc);\r\n      const isDuplicateName = loc.name?.toLowerCase().trim() === parentName;\r\n      return hasProps && !isDuplicateName;\r\n    });\r\n\r\n    console.log(`[RealtySoft] Child locations for parent ${parentId}: ${allChildren.length} total, ${filtered.length} after filtering`);\r\n\r\n    return filtered.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n  }\r\n\r\n  // Get all descendants of a location (recursive)\r\n  private getAllDescendants(parentId: number | string): ExtendedLocation[] {\r\n    const descendants: ExtendedLocation[] = [];\r\n    const children = this.locations.filter(loc => {\r\n      const pid = loc.parent_id;\r\n      return pid && String(pid) === String(parentId);\r\n    });\r\n    children.forEach(child => {\r\n      descendants.push(child);\r\n      descendants.push(...this.getAllDescendants(child.id));\r\n    });\r\n    return descendants;\r\n  }\r\n\r\n  private getAllLocationsFlat(): ExtendedLocation[] {\r\n    const result: ExtendedLocation[] = [];\r\n\r\n    // Build full hierarchy tree recursively, excluding items with 0 properties\r\n    const buildFlat = (parentId: number | string | null, level: number) => {\r\n      const children = this.locations.filter(loc => {\r\n        const pid = loc.parent_id;\r\n        let matchesParent = false;\r\n        if (parentId === null) {\r\n          matchesParent = pid === null || pid === undefined || pid === 0 || String(pid) === '0' || String(pid) === '';\r\n        } else {\r\n          matchesParent = pid && String(pid) === String(parentId);\r\n        }\r\n        return matchesParent && hasProperties(loc);\r\n      }).sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n\r\n      children.forEach(loc => {\r\n        result.push({ ...loc, level });\r\n        buildFlat(loc.id, level + 1);\r\n      });\r\n    };\r\n\r\n    buildFlat(null, 0);\r\n\r\n    // If hierarchy build found nothing, return all locations with properties sorted alphabetically\r\n    if (result.length === 0 && this.locations.length > 0) {\r\n      return [...this.locations].filter(loc => hasProperties(loc)).sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  render(): void {\r\n    console.log(`[RealtySoft] Location render() - variation: ${this.variation}`);\r\n    this.element.classList.add('rs-location', `rs-location--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        console.log('[RealtySoft] Location: rendering Two Dropdowns');\r\n        this.renderTwoDropdowns();\r\n        break;\r\n      case '3':\r\n        console.log('[RealtySoft] Location: rendering Hierarchical MultiSelect');\r\n        this.renderHierarchicalMultiSelect();\r\n        break;\r\n      case '4':\r\n        console.log('[RealtySoft] Location: rendering Traditional Dropdown');\r\n        this.renderTraditionalDropdown();\r\n        break;\r\n      default:\r\n        console.log('[RealtySoft] Location: rendering Typeahead');\r\n        this.renderTypeahead();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Search/Autocomplete (Typeahead)\r\n  private renderTypeahead(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-location__wrapper\">\r\n        <label class=\"rs-location__label\">${this.label('search_location')}</label>\r\n        <div class=\"rs-location__input-wrapper\">\r\n          <input type=\"text\"\r\n                 class=\"rs-location__input\"\r\n                 placeholder=\"Enter location name\"\r\n                 value=\"${this.selectedName}\"\r\n                 autocomplete=\"off\">\r\n          ${this.selectedLocation ? '<button class=\"rs-location__clear\" type=\"button\">&times;</button>' : ''}\r\n        </div>\r\n        <div class=\"rs-location__dropdown\" style=\"display: none;\">\r\n          <ul class=\"rs-location__list\"></ul>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-location__input');\r\n    this.dropdown = this.element.querySelector('.rs-location__dropdown');\r\n    this.list = this.element.querySelector('.rs-location__list');\r\n    this.clearBtn = this.element.querySelector('.rs-location__clear');\r\n  }\r\n\r\n  // VARIATION 2: Two Dropdowns (Parent + Child)\r\n  private renderTwoDropdowns(): void {\r\n    this.parentLabel = this.label('search_location') || 'Location';\r\n    this.childLabel = this.label('search_sublocation') || 'Sub-location';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-location__wrapper rs-location__two-dropdowns\">\r\n        <label class=\"rs-location__label\">${this.label('search_location')}</label>\r\n\r\n        <div class=\"rs-location__parent-container\">\r\n          <button type=\"button\" class=\"rs-location__multi-btn rs-location__parent-btn\">\r\n            ${this.parentLabel}\r\n          </button>\r\n          <div class=\"rs-location__dropdown rs-location__parent-dropdown\" style=\"display: none;\">\r\n            <input type=\"text\" class=\"rs-location__filter-input\" placeholder=\"${this.label('search_location_placeholder') || 'Search location...'}\">\r\n            <div class=\"rs-location__checklist rs-location__parent-list\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"rs-location__child-container\" style=\"margin-top: 10px;\">\r\n          <button type=\"button\" class=\"rs-location__multi-btn rs-location__child-btn\" disabled>\r\n            ${this.childLabel}\r\n          </button>\r\n          <div class=\"rs-location__dropdown rs-location__child-dropdown\" style=\"display: none;\">\r\n            <input type=\"text\" class=\"rs-location__filter-input\" placeholder=\"${this.label('search_location_placeholder') || 'Search location...'}\">\r\n            <div class=\"rs-location__checklist rs-location__child-list\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.parentBtn = this.element.querySelector('.rs-location__parent-btn');\r\n    this.parentDropdown = this.element.querySelector('.rs-location__parent-dropdown');\r\n    this.parentList = this.element.querySelector('.rs-location__parent-list');\r\n    this.parentFilter = this.parentDropdown?.querySelector('.rs-location__filter-input') || null;\r\n\r\n    this.childBtn = this.element.querySelector('.rs-location__child-btn');\r\n    this.childDropdown = this.element.querySelector('.rs-location__child-dropdown');\r\n    this.childList = this.element.querySelector('.rs-location__child-list');\r\n    this.childFilter = this.childDropdown?.querySelector('.rs-location__filter-input') || null;\r\n\r\n    this.renderParentChecklist();\r\n  }\r\n\r\n  private renderParentChecklist(filter: string = ''): void {\r\n    if (!this.parentList) return;\r\n\r\n    const parents = this.getParentLocations();\r\n    const filtered = filter\r\n      ? parents.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()))\r\n      : parents;\r\n\r\n    if (filtered.length === 0) {\r\n      this.parentList.innerHTML = '<div class=\"rs-location__no-results\">No results</div>';\r\n      return;\r\n    }\r\n\r\n    this.parentList.innerHTML = filtered.map(loc => `\r\n      <label class=\"rs-location__check-item\">\r\n        <input type=\"checkbox\" value=\"${loc.id}\" data-name=\"${this.escapeHtml(loc.name)}\"\r\n               ${this.selectedParents.has(String(loc.id)) ? 'checked' : ''}>\r\n        <span>${this.escapeHtml(loc.name)}</span>\r\n        ${loc.count ? `<span class=\"rs-location__count\">(${loc.count})</span>` : ''}\r\n      </label>\r\n    `).join('');\r\n  }\r\n\r\n  private renderChildChecklist(filter: string = ''): void {\r\n    if (!this.childList) return;\r\n\r\n    if (this.selectedParents.size === 0) {\r\n      this.childList.innerHTML = '<div class=\"rs-location__no-results\">Select a municipality first</div>';\r\n      return;\r\n    }\r\n\r\n    let children: ExtendedLocation[] = [];\r\n    this.selectedParents.forEach(parentId => {\r\n      children = children.concat(this.getChildLocations(parentId));\r\n    });\r\n\r\n    const filtered = filter\r\n      ? children.filter(c => c.name.toLowerCase().includes(filter.toLowerCase()))\r\n      : children;\r\n\r\n    if (filtered.length === 0) {\r\n      this.childList.innerHTML = '<div class=\"rs-location__no-results\">No areas found</div>';\r\n      return;\r\n    }\r\n\r\n    this.childList.innerHTML = filtered.map(loc => `\r\n      <label class=\"rs-location__check-item\">\r\n        <input type=\"checkbox\" value=\"${loc.id}\" data-name=\"${this.escapeHtml(loc.name)}\"\r\n               ${this.selectedChildren.has(String(loc.id)) ? 'checked' : ''}>\r\n        <span>${this.escapeHtml(loc.name)}</span>\r\n        ${loc.count ? `<span class=\"rs-location__count\">(${loc.count})</span>` : ''}\r\n      </label>\r\n    `).join('');\r\n  }\r\n\r\n  // VARIATION 3: Hierarchical Multi-Select\r\n  private renderHierarchicalMultiSelect(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-location__wrapper\">\r\n        <label class=\"rs-location__label\">${this.label('search_location')}</label>\r\n        <button type=\"button\" class=\"rs-location__multi-btn\">\r\n          ${this.label('search_location') || 'Location'}\r\n        </button>\r\n        <div class=\"rs-location__dropdown\" style=\"display: none;\">\r\n          <input type=\"text\" class=\"rs-location__filter-input\" placeholder=\"${this.label('search_location_placeholder') || 'Search location...'}\">\r\n          <div class=\"rs-location__checklist rs-location__hierarchy-list\"></div>\r\n        </div>\r\n        <div class=\"rs-location__tags\"></div>\r\n      </div>\r\n    `;\r\n\r\n    this.multiBtn = this.element.querySelector('.rs-location__multi-btn');\r\n    this.dropdown = this.element.querySelector('.rs-location__dropdown');\r\n    this.filterInput = this.element.querySelector('.rs-location__filter-input');\r\n    this.hierarchyList = this.element.querySelector('.rs-location__hierarchy-list');\r\n    this.tagsContainer = this.element.querySelector('.rs-location__tags');\r\n\r\n    this.renderHierarchyChecklist();\r\n  }\r\n\r\n  private renderHierarchyChecklist(filter: string = ''): void {\r\n    if (!this.hierarchyList) return;\r\n\r\n    const parents = this.getParentLocations();\r\n    let html = '';\r\n\r\n    parents.forEach(parent => {\r\n      const children = this.getChildLocations(parent.id);\r\n      const matchesFilter = !filter || parent.name.toLowerCase().includes(filter.toLowerCase());\r\n      const childrenMatch = children.some(c => c.name.toLowerCase().includes(filter.toLowerCase()));\r\n\r\n      if (!matchesFilter && !childrenMatch) return;\r\n\r\n      html += `\r\n        <div class=\"rs-location__parent-group\">\r\n          <label class=\"rs-location__check-item rs-location__check-item--parent\">\r\n            <input type=\"checkbox\" value=\"${parent.id}\" data-name=\"${this.escapeHtml(parent.name)}\" data-is-parent=\"true\"\r\n                   ${this.selectedLocations.has(String(parent.id)) ? 'checked' : ''}>\r\n            <strong>${this.escapeHtml(parent.name)}</strong>\r\n            ${parent.count ? `<span class=\"rs-location__count\">(${parent.count})</span>` : ''}\r\n          </label>\r\n          <div class=\"rs-location__children\">\r\n      `;\r\n\r\n      children.forEach(child => {\r\n        if (filter && !child.name.toLowerCase().includes(filter.toLowerCase()) && !matchesFilter) return;\r\n        html += `\r\n          <label class=\"rs-location__check-item rs-location__check-item--child\">\r\n            <input type=\"checkbox\" value=\"${child.id}\" data-name=\"${this.escapeHtml(child.name)}\" data-parent-id=\"${parent.id}\"\r\n                   ${this.selectedLocations.has(String(child.id)) ? 'checked' : ''}>\r\n            <span>${this.escapeHtml(child.name)}</span>\r\n            ${child.count ? `<span class=\"rs-location__count\">(${child.count})</span>` : ''}\r\n          </label>\r\n        `;\r\n      });\r\n\r\n      html += `</div></div>`;\r\n    });\r\n\r\n    this.hierarchyList.innerHTML = html || '<div class=\"rs-location__no-results\">No locations found</div>';\r\n  }\r\n\r\n  // VARIATION 4: Traditional Dropdown\r\n  private renderTraditionalDropdown(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-location__wrapper\">\r\n        <label class=\"rs-location__label\">${this.label('search_location')}</label>\r\n        <div class=\"rs-location__select-wrapper\">\r\n          <select class=\"rs-location__select\">\r\n            <option value=\"\">${this.label('search_location')}</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-location__select');\r\n    this.populateTraditionalSelect();\r\n  }\r\n\r\n  private populateTraditionalSelect(): void {\r\n    if (!this.select) return;\r\n\r\n    let html = `<option value=\"\">${this.label('search_location')}</option>`;\r\n\r\n    // Get municipalities (parents) and cities (children), excluding items with 0 properties\r\n    // For parents, show if they or their children have properties\r\n    const municipalities = this.locations\r\n      .filter(loc => loc.type && loc.type.toLowerCase() === this.parentType.toLowerCase() &&\r\n                     hasPropertiesOrChildren(loc, this.locations))\r\n      .sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n\r\n    municipalities.forEach(municipality => {\r\n      // Add municipality with type label\r\n      html += `<option value=\"${municipality.id}\">${this.escapeHtml(municipality.name)} â€¢ ${municipality.type}</option>`;\r\n\r\n      // Find all cities that belong to this municipality (direct or via descendants)\r\n      const descendantIds = new Set<number>();\r\n      const collectDescendants = (parentId: number | string) => {\r\n        this.locations.forEach(loc => {\r\n          if (loc.parent_id && String(loc.parent_id) === String(parentId)) {\r\n            descendantIds.add(loc.id);\r\n            collectDescendants(loc.id);\r\n          }\r\n        });\r\n      };\r\n      collectDescendants(municipality.id);\r\n\r\n      // Get cities that are descendants of this municipality, excluding items with 0 properties\r\n      const cities = this.locations\r\n        .filter(loc => {\r\n          if (!loc.type || loc.type.toLowerCase() !== this.childType.toLowerCase()) return false;\r\n          if (!hasProperties(loc)) return false;\r\n          // Check if city is direct child or descendant\r\n          return (loc.parent_id && String(loc.parent_id) === String(municipality.id)) ||\r\n                 descendantIds.has(loc.id);\r\n        })\r\n        .sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n\r\n      cities.forEach(city => {\r\n        html += `<option value=\"${city.id}\">&nbsp;&nbsp;â”œâ”€ ${this.escapeHtml(city.name)}</option>`;\r\n      });\r\n    });\r\n\r\n    this.select.innerHTML = html;\r\n\r\n    if (this.selectedLocation) {\r\n      this.select.value = String(this.selectedLocation);\r\n    }\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindTwoDropdownsEvents();\r\n        break;\r\n      case '3':\r\n        this.bindHierarchicalEvents();\r\n        break;\r\n      case '4':\r\n        this.bindTraditionalEvents();\r\n        break;\r\n      default:\r\n        this.bindTypeaheadEvents();\r\n    }\r\n  }\r\n\r\n  private bindTypeaheadEvents(): void {\r\n    if (!this.input || !this.list) return;\r\n\r\n    let debounceTimer: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // Don't show dropdown on focus - only show when user types\r\n    this.input.addEventListener('blur', () => {\r\n      setTimeout(() => this.hideDropdown(), 200);\r\n    });\r\n\r\n    this.input.addEventListener('input', (e: Event) => {\r\n      clearTimeout(debounceTimer);\r\n      const target = e.target as HTMLInputElement;\r\n      this.searchTerm = target.value;\r\n\r\n      // Only show dropdown when user starts typing\r\n      if (this.searchTerm.length >= 1) {\r\n        debounceTimer = setTimeout(() => {\r\n          this.searchLocations(this.searchTerm);\r\n          this.showDropdown();\r\n        }, 300);\r\n      } else {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n\r\n    this.input.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      this.handleKeyboard(e);\r\n    });\r\n\r\n    this.list.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const item = target.closest('.rs-location__item') as HTMLElement | null;\r\n      if (item && item.dataset.id && item.dataset.name) {\r\n        this.selectLocation(parseInt(item.dataset.id), item.dataset.name);\r\n      }\r\n    });\r\n\r\n    if (this.clearBtn) {\r\n      this.clearBtn.addEventListener('click', () => this.clearSelection());\r\n    }\r\n\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n  }\r\n\r\n  private bindTwoDropdownsEvents(): void {\r\n    // Debounce timers for filter inputs\r\n    let parentFilterDebounce: ReturnType<typeof setTimeout> | undefined;\r\n    let childFilterDebounce: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // Parent button toggle\r\n    if (this.parentBtn) {\r\n      this.parentBtn.addEventListener('click', () => {\r\n        this.toggleDropdownEl(this.parentDropdown);\r\n        this.hideDropdownEl(this.childDropdown);\r\n      });\r\n    }\r\n\r\n    // Child button toggle\r\n    if (this.childBtn) {\r\n      this.childBtn.addEventListener('click', () => {\r\n        if (!this.childBtn!.disabled) {\r\n          this.toggleDropdownEl(this.childDropdown);\r\n          this.hideDropdownEl(this.parentDropdown);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Parent filter with 200ms debounce\r\n    if (this.parentFilter) {\r\n      this.parentFilter.addEventListener('input', (e: Event) => {\r\n        clearTimeout(parentFilterDebounce);\r\n        parentFilterDebounce = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          this.renderParentChecklist(target.value);\r\n        }, 200);\r\n      });\r\n    }\r\n\r\n    // Child filter with 200ms debounce\r\n    if (this.childFilter) {\r\n      this.childFilter.addEventListener('input', (e: Event) => {\r\n        clearTimeout(childFilterDebounce);\r\n        childFilterDebounce = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          this.renderChildChecklist(target.value);\r\n        }, 200);\r\n      });\r\n    }\r\n\r\n    // Parent checkbox changes\r\n    if (this.parentList) {\r\n      this.parentList.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target.type === 'checkbox') {\r\n          const id = String(target.value);\r\n          if (target.checked) {\r\n            this.selectedParents.add(id);\r\n          } else {\r\n            this.selectedParents.delete(id);\r\n            // Remove children of this parent\r\n            this.getChildLocations(id).forEach(child => {\r\n              this.selectedChildren.delete(String(child.id));\r\n            });\r\n          }\r\n          this.updateTwoDropdownsState();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Child checkbox changes\r\n    if (this.childList) {\r\n      this.childList.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target.type === 'checkbox') {\r\n          const id = String(target.value);\r\n          if (target.checked) {\r\n            this.selectedChildren.add(id);\r\n          } else {\r\n            this.selectedChildren.delete(id);\r\n          }\r\n          this.updateTwoDropdownsState();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Close on outside click\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdownEl(this.parentDropdown);\r\n        this.hideDropdownEl(this.childDropdown);\r\n      }\r\n    });\r\n  }\r\n\r\n  private updateTwoDropdownsState(): void {\r\n    // Update parent button text\r\n    if (this.selectedParents.size > 0) {\r\n      if (this.parentBtn) {\r\n        this.parentBtn.textContent = this.selectedParents.size + ' selected';\r\n        this.parentBtn.classList.add('has-selection');\r\n      }\r\n      if (this.childBtn) {\r\n        this.childBtn.disabled = false;\r\n      }\r\n    } else {\r\n      if (this.parentBtn) {\r\n        this.parentBtn.textContent = this.parentLabel || this.label('search_location') || 'Location';\r\n        this.parentBtn.classList.remove('has-selection');\r\n      }\r\n      if (this.childBtn) {\r\n        this.childBtn.disabled = true;\r\n        this.childBtn.textContent = this.childLabel || this.label('search_sublocation') || 'Sub-location';\r\n      }\r\n    }\r\n\r\n    // Update child button text\r\n    if (this.selectedChildren.size > 0) {\r\n      if (this.childBtn) {\r\n        this.childBtn.textContent = this.selectedChildren.size + ' selected';\r\n        this.childBtn.classList.add('has-selection');\r\n      }\r\n    } else if (this.childBtn && !this.childBtn.disabled) {\r\n      this.childBtn.textContent = this.childLabel || this.label('search_sublocation') || 'Sub-location';\r\n      this.childBtn.classList.remove('has-selection');\r\n    }\r\n\r\n    // Render child list\r\n    this.renderChildChecklist(this.childFilter?.value || '');\r\n\r\n    // Update filter - use children if selected, otherwise parents\r\n    const locationIds = this.selectedChildren.size > 0\r\n      ? Array.from(this.selectedChildren)\r\n      : Array.from(this.selectedParents);\r\n\r\n    if (locationIds.length > 0) {\r\n      this.setFilter('location', locationIds.join(','));\r\n    } else {\r\n      this.setFilter('location', null);\r\n    }\r\n  }\r\n\r\n  private bindHierarchicalEvents(): void {\r\n    let filterDebounce: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    if (this.multiBtn) {\r\n      this.multiBtn.addEventListener('click', () => {\r\n        this.toggleDropdownEl(this.dropdown);\r\n      });\r\n    }\r\n\r\n    // Filter with 200ms debounce\r\n    if (this.filterInput) {\r\n      this.filterInput.addEventListener('input', (e: Event) => {\r\n        clearTimeout(filterDebounce);\r\n        filterDebounce = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          this.renderHierarchyChecklist(target.value);\r\n        }, 200);\r\n      });\r\n    }\r\n\r\n    if (this.hierarchyList) {\r\n      this.hierarchyList.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target.type === 'checkbox') {\r\n          const id = String(target.value);\r\n          const isParent = target.dataset.isParent === 'true';\r\n\r\n          if (target.checked) {\r\n            this.selectedLocations.add(id);\r\n            // If parent, optionally select all children\r\n            if (isParent) {\r\n              const children = this.getChildLocations(id);\r\n              children.forEach(child => {\r\n                this.selectedLocations.add(String(child.id));\r\n              });\r\n              this.renderHierarchyChecklist(this.filterInput?.value || '');\r\n            }\r\n          } else {\r\n            this.selectedLocations.delete(id);\r\n            if (isParent) {\r\n              const children = this.getChildLocations(id);\r\n              children.forEach(child => {\r\n                this.selectedLocations.delete(String(child.id));\r\n              });\r\n              this.renderHierarchyChecklist(this.filterInput?.value || '');\r\n            }\r\n          }\r\n\r\n          this.updateHierarchicalState();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdownEl(this.dropdown);\r\n      }\r\n    });\r\n  }\r\n\r\n  private updateHierarchicalState(): void {\r\n    // Update button\r\n    if (this.multiBtn) {\r\n      if (this.selectedLocations.size > 0) {\r\n        this.multiBtn.textContent = this.selectedLocations.size + ' selected';\r\n        this.multiBtn.classList.add('has-selection');\r\n      } else {\r\n        this.multiBtn.textContent = this.label('search_location') || 'Location';\r\n        this.multiBtn.classList.remove('has-selection');\r\n      }\r\n    }\r\n\r\n    // Update tags\r\n    this.updateTags();\r\n\r\n    // Update filter\r\n    if (this.selectedLocations.size > 0) {\r\n      this.setFilter('location', Array.from(this.selectedLocations).join(','));\r\n    } else {\r\n      this.setFilter('location', null);\r\n    }\r\n  }\r\n\r\n  private updateTags(): void {\r\n    if (!this.tagsContainer) return;\r\n\r\n    const tags: string[] = [];\r\n    this.selectedLocations.forEach(id => {\r\n      const loc = this.locations.find(l => String(l.id) === id);\r\n      if (loc) {\r\n        tags.push(`\r\n          <span class=\"rs-location__tag\">\r\n            ${this.escapeHtml(loc.name)}\r\n            <button type=\"button\" class=\"rs-location__tag-remove\" data-id=\"${id}\">&times;</button>\r\n          </span>\r\n        `);\r\n      }\r\n    });\r\n\r\n    this.tagsContainer.innerHTML = tags.join('');\r\n\r\n    // Bind tag remove events\r\n    this.tagsContainer.querySelectorAll<HTMLButtonElement>('.rs-location__tag-remove').forEach(btn => {\r\n      btn.addEventListener('click', (e: Event) => {\r\n        const id = btn.dataset.id;\r\n        if (id) {\r\n          this.selectedLocations.delete(id);\r\n          this.renderHierarchyChecklist(this.filterInput?.value || '');\r\n          this.updateHierarchicalState();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindTraditionalEvents(): void {\r\n    if (!this.select) return;\r\n\r\n    this.select.addEventListener('change', (e: Event) => {\r\n      const target = e.target as HTMLSelectElement;\r\n      const option = target.options[target.selectedIndex];\r\n      this.setFilter('location', target.value ? parseInt(target.value) : null);\r\n      this.setFilter('locationName', option.text.trim() || '');\r\n    });\r\n  }\r\n\r\n  private toggleDropdownEl(dropdown: HTMLElement | null): void {\r\n    if (!dropdown) return;\r\n    if (dropdown.style.display === 'none') {\r\n      dropdown.style.display = 'block';\r\n    } else {\r\n      dropdown.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private showDropdown(dropdown?: HTMLElement | null): void {\r\n    const dd = dropdown || this.dropdown;\r\n    if (!dd) return;\r\n    this.isOpen = true;\r\n    dd.style.display = 'block';\r\n  }\r\n\r\n  private hideDropdown(dropdown?: HTMLElement | null): void {\r\n    const dd = dropdown || this.dropdown;\r\n    if (!dd) return;\r\n    this.isOpen = false;\r\n    dd.style.display = 'none';\r\n    this.highlightIndex = -1;\r\n  }\r\n\r\n  private hideDropdownEl(dropdown: HTMLElement | null): void {\r\n    if (!dropdown) return;\r\n    dropdown.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Search locations using client-side filtering on preloaded data\r\n   * This is instant since all locations are already loaded\r\n   */\r\n  private searchLocations(term: string): void {\r\n    if (!term || term.length < 2) {\r\n      this.filteredLocations = this.getAllLocationsFlat().slice(0, 15);\r\n      this.updateDropdownItems();\r\n      return;\r\n    }\r\n\r\n    // Client-side filtering for instant results\r\n    const lowerTerm = term.toLowerCase();\r\n    this.filteredLocations = this.getAllLocationsFlat().filter(loc =>\r\n      loc.name.toLowerCase().includes(lowerTerm)\r\n    ).slice(0, 20);\r\n    this.updateDropdownItems();\r\n  }\r\n\r\n  private updateDropdownItems(): void {\r\n    if (!this.list) return;\r\n\r\n    if (this.filteredLocations.length === 0) {\r\n      this.list.innerHTML = `<li class=\"rs-location__empty\">${this.label('no_results') || 'No results found'}</li>`;\r\n      return;\r\n    }\r\n\r\n    this.list.innerHTML = this.filteredLocations.map((loc, index) => {\r\n      // Show type label on right side for all except City\r\n      const locType = loc.type ? loc.type.toLowerCase() : '';\r\n      const showType = locType && locType !== 'city';\r\n      const typeLabel = showType ? `<span class=\"rs-location__type\">${this.escapeHtml(loc.type || '')}</span>` : '';\r\n\r\n      return `\r\n        <li class=\"rs-location__item ${loc.level ? 'rs-location__item--child' : ''} ${index === this.highlightIndex ? 'rs-location__item--highlight' : ''}\"\r\n            data-id=\"${loc.id}\"\r\n            data-name=\"${this.escapeHtml(loc.name)}\">\r\n          <span class=\"rs-location__name\">\r\n            ${loc.level ? '<span class=\"rs-location__indent\"></span>' : ''}\r\n            ${this.escapeHtml(loc.name)}\r\n          </span>\r\n          ${typeLabel}\r\n          ${loc.count ? `<span class=\"rs-location__count\">(${loc.count})</span>` : ''}\r\n        </li>\r\n      `;\r\n    }).join('');\r\n  }\r\n\r\n  private updateLocationData(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderParentChecklist();\r\n        break;\r\n      case '3':\r\n        this.renderHierarchyChecklist();\r\n        break;\r\n      case '4':\r\n        this.populateTraditionalSelect();\r\n        break;\r\n      default:\r\n        this.filteredLocations = this.getAllLocationsFlat().slice(0, 15);\r\n        this.updateDropdownItems();\r\n    }\r\n  }\r\n\r\n  private handleKeyboard(e: KeyboardEvent): void {\r\n    if (!this.isOpen) {\r\n      if (e.key === 'ArrowDown' || e.key === 'Enter') {\r\n        this.showDropdown();\r\n      }\r\n      return;\r\n    }\r\n\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        this.highlightIndex = Math.min(this.highlightIndex + 1, this.filteredLocations.length - 1);\r\n        this.updateDropdownItems();\r\n        break;\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        this.highlightIndex = Math.max(this.highlightIndex - 1, 0);\r\n        this.updateDropdownItems();\r\n        break;\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        if (this.highlightIndex >= 0 && this.filteredLocations[this.highlightIndex]) {\r\n          const loc = this.filteredLocations[this.highlightIndex];\r\n          this.selectLocation(loc.id, loc.name);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        this.hideDropdown();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private selectLocation(id: number, name: string): void {\r\n    this.selectedLocation = id;\r\n    this.selectedName = name;\r\n\r\n    this.setFilter('location', this.selectedLocation);\r\n    this.setFilter('locationName', name);\r\n\r\n    this.updateDisplay();\r\n    this.hideDropdown();\r\n  }\r\n\r\n  private clearSelection(): void {\r\n    this.selectedLocation = null;\r\n    this.selectedName = '';\r\n    this.setFilter('location', null);\r\n    this.setFilter('locationName', '');\r\n    this.updateDisplay();\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Variation 1: Typeahead\r\n    if (this.input) {\r\n      this.input.value = this.selectedName || '';\r\n    }\r\n\r\n    // Variation 4: Traditional dropdown\r\n    if (this.select) {\r\n      this.select.value = this.selectedLocation?.toString() || '';\r\n    }\r\n\r\n    const clearBtn = this.element.querySelector<HTMLButtonElement>('.rs-location__clear');\r\n    if (clearBtn) {\r\n      clearBtn.style.display = this.selectedLocation ? 'block' : 'none';\r\n    }\r\n\r\n    // Variation 2: Two dropdowns\r\n    if (this.variation === '2') {\r\n      if (this.selectedLocation) {\r\n        // Find the location and its parent to pre-select\r\n        const loc = this.locations.find(l => l.id === this.selectedLocation);\r\n        if (loc) {\r\n          // Check if it's a parent or child type\r\n          const isParent = loc.type && loc.type.toLowerCase() === this.parentType.toLowerCase();\r\n          const isChild = loc.type && loc.type.toLowerCase() === this.childType.toLowerCase();\r\n\r\n          if (isParent) {\r\n            this.selectedParents.add(String(loc.id));\r\n          } else if (isChild && loc.parent_id) {\r\n            // Add the parent first\r\n            this.selectedParents.add(String(loc.parent_id));\r\n            this.selectedChildren.add(String(loc.id));\r\n          } else {\r\n            // Unknown type, just add as parent\r\n            this.selectedParents.add(String(loc.id));\r\n          }\r\n\r\n          // Update button texts\r\n          if (this.parentBtn) {\r\n            this.parentBtn.textContent = this.selectedParents.size + ' selected';\r\n            this.parentBtn.classList.add('has-selection');\r\n          }\r\n          if (this.childBtn) {\r\n            this.childBtn.disabled = false;\r\n            if (this.selectedChildren.size > 0) {\r\n              this.childBtn.textContent = this.selectedChildren.size + ' selected';\r\n              this.childBtn.classList.add('has-selection');\r\n            }\r\n          }\r\n\r\n          // Re-render checklists with selections\r\n          this.renderParentChecklist();\r\n          this.renderChildChecklist();\r\n        }\r\n      } else {\r\n        // Reset if no location\r\n        this.selectedParents.clear();\r\n        this.selectedChildren.clear();\r\n        this.renderParentChecklist();\r\n        this.renderChildChecklist();\r\n        if (this.parentBtn) {\r\n          this.parentBtn.textContent = this.parentLabel || this.label('search_location') || 'Location';\r\n          this.parentBtn.classList.remove('has-selection');\r\n        }\r\n        if (this.childBtn) {\r\n          this.childBtn.textContent = this.childLabel || this.label('search_sublocation') || 'Sub-location';\r\n          this.childBtn.classList.remove('has-selection');\r\n          this.childBtn.disabled = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Variation 3: Hierarchical multi-select\r\n    if (this.variation === '3') {\r\n      if (this.selectedLocation) {\r\n        this.selectedLocations.add(String(this.selectedLocation));\r\n        this.renderHierarchyChecklist();\r\n        this.updateTags();\r\n        if (this.multiBtn) {\r\n          this.multiBtn.textContent = this.selectedLocations.size + ' selected';\r\n          this.multiBtn.classList.add('has-selection');\r\n        }\r\n      } else {\r\n        this.selectedLocations.clear();\r\n        this.renderHierarchyChecklist();\r\n        this.updateTags();\r\n        if (this.multiBtn) {\r\n          this.multiBtn.textContent = this.label('search_location') || 'Location';\r\n          this.multiBtn.classList.remove('has-selection');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_location', RSLocation as unknown as ComponentConstructor);\r\n\r\nexport { RSLocation };\r\nexport default RSLocation;\r\n","/**\r\n * RealtySoft Widget v3 - Listing Type Component\r\n * Variations: 1=Dropdown, 2=Checkboxes, 3=Radio Buttons\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule, RealtySoftStateModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\nclass RSListingType extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private selectedTypes: Set<string> = new Set();\r\n  private selected: string | string[] = '';\r\n  private radioName: string = '';\r\n  private select: HTMLSelectElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('listingType');\r\n    this.selectedTypes = new Set();\r\n    this.selected = this.getFilter<string | string[]>('listingType') || '';\r\n    this.radioName = 'rs-listing-type-' + Math.random().toString(36).substr(2, 9);\r\n\r\n    // Initialize from existing filter\r\n    if (this.selected) {\r\n      if (Array.isArray(this.selected)) {\r\n        this.selected.forEach(t => this.selectedTypes.add(t));\r\n      } else {\r\n        this.selectedTypes.add(this.selected);\r\n      }\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    // Subscribe to filter changes\r\n    this.subscribe<string | string[] | null>('filters.listingType', (value) => {\r\n      this.selected = value || '';\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  // Get listing type options\r\n  private getOptions(): Record<string, string> {\r\n    const labels = RealtySoftState.get<Record<string, string>>('data.labels') || {};\r\n    return {\r\n      'resale': labels.listing_type_sale || 'ReSale',\r\n      'development': labels.listing_type_new || 'New Development',\r\n      'long_rental': labels.listing_type_long_rental || 'Long Term Rental',\r\n      'short_rental': labels.listing_type_short_rental || 'Holiday Rental'\r\n    };\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-listing-type', `rs-listing-type--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderCheckboxes();\r\n        break;\r\n      case '3':\r\n        this.renderRadioButtons();\r\n        break;\r\n      default:\r\n        this.renderDropdown();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Dropdown (Single Select)\r\n  private renderDropdown(): void {\r\n    const options = this.getOptions();\r\n    const selectedValue = Array.isArray(this.selected) ? this.selected[0] : this.selected;\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-listing-type__wrapper\">\r\n        <label class=\"rs-listing-type__label\">${this.label('search_listing_type')}</label>\r\n        <div class=\"rs-listing-type__select-wrapper\">\r\n          <select class=\"rs-listing-type__select\">\r\n            <option value=\"\">${this.label('search_listing_type_all') || 'All Listing Types'}</option>\r\n            ${Object.entries(options).map(([value, label]) =>\r\n              `<option value=\"${value}\" ${selectedValue === value ? 'selected' : ''}>${label}</option>`\r\n            ).join('')}\r\n          </select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-listing-type__select');\r\n  }\r\n\r\n  // VARIATION 2: Checkboxes (Multi-Select)\r\n  private renderCheckboxes(): void {\r\n    const options = this.getOptions();\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-listing-type__wrapper\">\r\n        <label class=\"rs-listing-type__label\">${this.label('search_listing_type')}</label>\r\n        <div class=\"rs-listing-type__checkboxes\">\r\n          ${Object.entries(options).map(([value, label]) => `\r\n            <label class=\"rs-listing-type__checkbox-wrapper\">\r\n              <input type=\"checkbox\"\r\n                     class=\"rs-listing-type__checkbox\"\r\n                     value=\"${value}\"\r\n                     ${this.selectedTypes.has(value) ? 'checked' : ''}>\r\n              <span class=\"rs-listing-type__checkbox-label\">${label}</span>\r\n            </label>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // VARIATION 3: Radio Buttons (Single Select)\r\n  private renderRadioButtons(): void {\r\n    const options = this.getOptions();\r\n    const selectedValue = Array.isArray(this.selected) ? this.selected[0] : this.selected;\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-listing-type__wrapper\">\r\n        <label class=\"rs-listing-type__label\">${this.label('search_listing_type')}</label>\r\n        <div class=\"rs-listing-type__radios\">\r\n          <label class=\"rs-listing-type__radio-wrapper\">\r\n            <input type=\"radio\"\r\n                   class=\"rs-listing-type__radio\"\r\n                   name=\"${this.radioName}\"\r\n                   value=\"\"\r\n                   ${!selectedValue ? 'checked' : ''}>\r\n            <span class=\"rs-listing-type__radio-label\">${this.label('search_all') || 'All'}</span>\r\n          </label>\r\n          ${Object.entries(options).map(([value, label]) => `\r\n            <label class=\"rs-listing-type__radio-wrapper\">\r\n              <input type=\"radio\"\r\n                     class=\"rs-listing-type__radio\"\r\n                     name=\"${this.radioName}\"\r\n                     value=\"${value}\"\r\n                     ${selectedValue === value ? 'checked' : ''}>\r\n              <span class=\"rs-listing-type__radio-label\">${label}</span>\r\n            </label>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindCheckboxEvents();\r\n        break;\r\n      case '3':\r\n        this.bindRadioEvents();\r\n        break;\r\n      default:\r\n        this.bindDropdownEvents();\r\n    }\r\n  }\r\n\r\n  private bindDropdownEvents(): void {\r\n    if (this.select) {\r\n      this.select.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        const value = target.value;\r\n        this.selected = value;\r\n        this.setFilter('listingType', value || null);\r\n      });\r\n    }\r\n  }\r\n\r\n  private bindCheckboxEvents(): void {\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-listing-type__checkbox').forEach(checkbox => {\r\n      checkbox.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = target.value;\r\n        if (target.checked) {\r\n          this.selectedTypes.add(value);\r\n        } else {\r\n          this.selectedTypes.delete(value);\r\n        }\r\n        this.updateListingTypeFilter();\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindRadioEvents(): void {\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-listing-type__radio').forEach(radio => {\r\n      radio.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target.checked) {\r\n          this.selected = target.value;\r\n          this.setFilter('listingType', target.value || null);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateListingTypeFilter(): void {\r\n    if (this.selectedTypes.size === 0) {\r\n      this.setFilter('listingType', null);\r\n    } else if (this.selectedTypes.size === 1) {\r\n      this.setFilter('listingType', Array.from(this.selectedTypes)[0]);\r\n    } else {\r\n      this.setFilter('listingType', Array.from(this.selectedTypes));\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    const selectedValue = Array.isArray(this.selected) ? this.selected[0] : this.selected;\r\n\r\n    // Update dropdown\r\n    if (this.select) {\r\n      this.select.value = selectedValue || '';\r\n    }\r\n\r\n    // Update checkboxes\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-listing-type__checkbox').forEach(checkbox => {\r\n      checkbox.checked = this.selectedTypes.has(checkbox.value);\r\n    });\r\n\r\n    // Update radio buttons\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-listing-type__radio').forEach(radio => {\r\n      radio.checked = radio.value === (selectedValue || '');\r\n    });\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_listing_type', RSListingType as unknown as ComponentConstructor);\r\n\r\nexport { RSListingType };\r\nexport default RSListingType;\r\n","/**\r\n * RealtySoft Widget v3 - Property Type Component\r\n * Variations: 1=Typeahead, 2=Flat Multi-select, 3=Accordion Multi-select, 4=Traditional Dropdown\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  PropertyType,\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\ninterface ExtendedPropertyType extends PropertyType {\r\n  parent_id?: number | string | null;\r\n  count?: number;\r\n}\r\n\r\n/**\r\n * Check if a property type has properties (property_count > 0)\r\n * Returns true if property_count is undefined (backwards compatibility) or > 0\r\n * Returns false only if property_count is explicitly 0\r\n */\r\nfunction hasProperties(type: ExtendedPropertyType): boolean {\r\n  // If property_count doesn't exist, show the type (backwards compatibility)\r\n  if (!('property_count' in type)) return true;\r\n  if (type.property_count === undefined || type.property_count === null) return true;\r\n  return type.property_count > 0;\r\n}\r\n\r\n/**\r\n * Check if a parent type or any of its children have properties\r\n */\r\nfunction hasPropertiesOrChildren(type: ExtendedPropertyType, allTypes: ExtendedPropertyType[]): boolean {\r\n  // First check if the type itself has properties\r\n  if (hasProperties(type)) return true;\r\n\r\n  // Then check if any children have properties\r\n  const children = allTypes.filter(child => {\r\n    const pid = child.parent_id;\r\n    if (!pid && pid !== 0) return false;\r\n    return String(pid) === String(type.id);\r\n  });\r\n  return children.some(child => hasProperties(child));\r\n}\r\n\r\nclass RSPropertyType extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private propertyTypes: ExtendedPropertyType[] = [];\r\n  private selectedIds: Set<string> = new Set();\r\n  private selectedName: string = '';\r\n  private isOpen: boolean = false;\r\n  private searchTerm: string = '';\r\n  private filteredTypes: ExtendedPropertyType[] = [];\r\n  private highlightIndex: number = -1;\r\n  private expandedParents: Set<string> = new Set();\r\n\r\n  // DOM elements\r\n  private input: HTMLInputElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n  private list: HTMLElement | null = null;\r\n  private clearBtn: HTMLButtonElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private buttonText: HTMLElement | null = null;\r\n  private filterInput: HTMLInputElement | null = null;\r\n  private tagsContainer: HTMLElement | null = null;\r\n  private select: HTMLSelectElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('propertyType');\r\n    this.propertyTypes = RealtySoftState.get<ExtendedPropertyType[]>('data.propertyTypes') || [];\r\n    this.selectedIds = new Set();\r\n    this.selectedName = this.getFilter<string>('propertyTypeName') || '';\r\n    this.isOpen = false;\r\n    this.searchTerm = '';\r\n    this.filteredTypes = [];\r\n    this.highlightIndex = -1;\r\n    this.expandedParents = new Set();\r\n\r\n    // Initialize from existing filter\r\n    const existingFilter = this.getFilter<number | number[]>('propertyType');\r\n    if (existingFilter) {\r\n      if (Array.isArray(existingFilter)) {\r\n        existingFilter.forEach(id => this.selectedIds.add(String(id)));\r\n      } else {\r\n        this.selectedIds.add(String(existingFilter));\r\n      }\r\n    }\r\n\r\n    // If locked, find the property type name for display\r\n    if (this.lockedMode && this.selectedIds.size > 0) {\r\n      const lockedId = Array.from(this.selectedIds)[0];\r\n      const lockedType = this.propertyTypes.find(t => String(t.id) === lockedId);\r\n      if (lockedType) {\r\n        this.selectedName = lockedType.name;\r\n      }\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    // Subscribe to data updates\r\n    this.subscribe<ExtendedPropertyType[]>('data.propertyTypes', (types) => {\r\n      this.propertyTypes = types;\r\n      this.updateList();\r\n    });\r\n\r\n    // Subscribe to filter changes\r\n    this.subscribe<number | number[] | null>('filters.propertyType', (value) => {\r\n      if (value === null) {\r\n        this.selectedIds.clear();\r\n      }\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  // Get parent property types (no parent_id or parent_id = 0), excluding items with 0 properties\r\n  // For parents, show if they or their children have properties\r\n  private getParentTypes(): ExtendedPropertyType[] {\r\n    const allParents = this.propertyTypes.filter(type =>\r\n      !type.parent_id || type.parent_id === '0' || type.parent_id === 0\r\n    );\r\n\r\n    const filtered = allParents.filter(type => hasPropertiesOrChildren(type, this.propertyTypes));\r\n\r\n    console.log(`[RealtySoft] Property type parents: ${allParents.length} total, ${filtered.length} after filtering`);\r\n    console.log(`[RealtySoft] Filtered out types: ${allParents.filter(p => !filtered.includes(p)).map(p => `${p.name}(${p.property_count})`).join(', ')}`);\r\n\r\n    return filtered.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n  }\r\n\r\n  // Get child property types for a parent, excluding items with 0 properties\r\n  private getChildTypes(parentId: number | string): ExtendedPropertyType[] {\r\n    return this.propertyTypes\r\n      .filter(type => type.parent_id == parentId && hasProperties(type))\r\n      .sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n  }\r\n\r\n  // Get all child IDs for a parent\r\n  private getAllChildIds(parentId: number | string): string[] {\r\n    return this.getChildTypes(parentId).map(child => String(child.id));\r\n  }\r\n\r\n  // Check if all children of a parent are selected\r\n  private areAllChildrenSelected(parentId: number | string): boolean {\r\n    const childIds = this.getAllChildIds(parentId);\r\n    return childIds.length > 0 && childIds.every(id => this.selectedIds.has(id));\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-property-type', `rs-property-type--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderFlatMultiSelect();\r\n        break;\r\n      case '3':\r\n        this.renderAccordionMultiSelect();\r\n        break;\r\n      case '4':\r\n        this.renderTraditionalDropdown();\r\n        break;\r\n      default:\r\n        this.renderTypeahead();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Search/Autocomplete (Single Select)\r\n  private renderTypeahead(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-type__wrapper\">\r\n        <label class=\"rs-property-type__label\">${this.label('search_property_type')}</label>\r\n        <div class=\"rs-property-type__search-wrapper\">\r\n          <input type=\"text\"\r\n                 class=\"rs-property-type__input\"\r\n                 placeholder=\"Enter property type\"\r\n                 value=\"${this.selectedName}\"\r\n                 autocomplete=\"off\">\r\n          <button class=\"rs-property-type__clear\" type=\"button\" style=\"display: ${this.selectedName ? 'block' : 'none'}\">Ã—</button>\r\n        </div>\r\n        <div class=\"rs-property-type__dropdown\" style=\"display: none;\">\r\n          <div class=\"rs-property-type__list\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-property-type__input');\r\n    this.dropdown = this.element.querySelector('.rs-property-type__dropdown');\r\n    this.list = this.element.querySelector('.rs-property-type__list');\r\n    this.clearBtn = this.element.querySelector('.rs-property-type__clear');\r\n\r\n    // Filter out types with 0 properties\r\n    this.filteredTypes = this.propertyTypes.filter(type => hasProperties(type));\r\n  }\r\n\r\n  // VARIATION 2: Flat Multi-Select with Filter (styled like Location V3)\r\n  private renderFlatMultiSelect(): void {\r\n    const count = this.selectedIds.size;\r\n    const buttonText = count > 0 ? (count + ' selected') : this.label('search_property_type');\r\n    const hasSelectionClass = count > 0 ? 'has-selection' : '';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-type__wrapper\">\r\n        <label class=\"rs-property-type__label\">${this.label('search_property_type')}</label>\r\n        <button type=\"button\" class=\"rs-property-type__button ${hasSelectionClass}\">\r\n          <span class=\"rs-property-type__button-text\">${buttonText}</span>\r\n          <span class=\"rs-property-type__button-arrow\">â–¼</span>\r\n        </button>\r\n        <div class=\"rs-property-type__tags\"></div>\r\n        <div class=\"rs-property-type__dropdown rs-property-type__dropdown--multiselect\" style=\"display: none;\">\r\n          <input type=\"text\" class=\"rs-property-type__filter\" placeholder=\"${this.label('search_location_placeholder') || 'Search...'}\">\r\n          <div class=\"rs-property-type__list\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-property-type__button');\r\n    this.buttonText = this.element.querySelector('.rs-property-type__button-text');\r\n    this.tagsContainer = this.element.querySelector('.rs-property-type__tags');\r\n    this.dropdown = this.element.querySelector('.rs-property-type__dropdown');\r\n    this.filterInput = this.element.querySelector('.rs-property-type__filter');\r\n    this.list = this.element.querySelector('.rs-property-type__list');\r\n\r\n    this.renderFlatList();\r\n    this.updateTags();\r\n  }\r\n\r\n  // VARIATION 3: Accordion Multi-Select with Filter\r\n  private renderAccordionMultiSelect(): void {\r\n    const count = this.selectedIds.size;\r\n    const buttonText = count > 0 ? `${count} type${count > 1 ? 's' : ''} selected` : this.label('search_property_type_placeholder');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-type__wrapper\">\r\n        <label class=\"rs-property-type__label\">${this.label('search_property_type')}</label>\r\n        <button type=\"button\" class=\"rs-property-type__button\">\r\n          <span class=\"rs-property-type__button-text\">${buttonText}</span>\r\n          <span class=\"rs-property-type__button-arrow\">â–¼</span>\r\n        </button>\r\n        <div class=\"rs-property-type__dropdown rs-property-type__dropdown--accordion\" style=\"display: none;\">\r\n          <input type=\"text\" class=\"rs-property-type__filter\" placeholder=\"Search property types...\">\r\n          <div class=\"rs-property-type__list\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-property-type__button');\r\n    this.buttonText = this.element.querySelector('.rs-property-type__button-text');\r\n    this.dropdown = this.element.querySelector('.rs-property-type__dropdown');\r\n    this.filterInput = this.element.querySelector('.rs-property-type__filter');\r\n    this.list = this.element.querySelector('.rs-property-type__list');\r\n\r\n    this.renderAccordionList();\r\n  }\r\n\r\n  // VARIATION 4: Traditional Hierarchical Dropdown (Single Select)\r\n  private renderTraditionalDropdown(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-type__wrapper\">\r\n        <label class=\"rs-property-type__label\">${this.label('search_property_type')}</label>\r\n        <div class=\"rs-property-type__select-wrapper\">\r\n          <select class=\"rs-property-type__select\">\r\n            <option value=\"\">${this.label('search_property_type_placeholder')}</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-property-type__select');\r\n    this.populateHierarchicalSelect();\r\n  }\r\n\r\n  // Update typeahead list (V1)\r\n  private updateTypeaheadList(): void {\r\n    if (!this.list) return;\r\n\r\n    const results = this.filteredTypes.slice(0, 10);\r\n\r\n    if (results.length === 0) {\r\n      this.list.innerHTML = '<div class=\"rs-property-type__no-results\">No results found</div>';\r\n      return;\r\n    }\r\n\r\n    this.list.innerHTML = results.map((type, index) => {\r\n      const isParent = !type.parent_id || type.parent_id === '0' || type.parent_id === 0;\r\n      return `\r\n        <div class=\"rs-property-type__item ${index === this.highlightIndex ? 'rs-property-type__item--highlight' : ''}\"\r\n             data-id=\"${type.id}\"\r\n             data-name=\"${this.escapeHtml(type.name)}\">\r\n          <span class=\"rs-property-type__item-text\">${this.escapeHtml(type.name)}</span>\r\n          ${!isParent ? '<span class=\"rs-property-type__item-badge\">Sub-type</span>' : ''}\r\n        </div>\r\n      `;\r\n    }).join('');\r\n  }\r\n\r\n  // Render flat list with parent/child hierarchy (V2)\r\n  private renderFlatList(filterQuery: string = ''): void {\r\n    if (!this.list) return;\r\n\r\n    const parents = this.getParentTypes();\r\n    const lowerQuery = filterQuery.toLowerCase();\r\n    let html = '';\r\n\r\n    parents.forEach(parent => {\r\n      const parentMatches = (parent.name || '').toLowerCase().includes(lowerQuery);\r\n      const children = this.getChildTypes(parent.id);\r\n      const matchingChildren = children.filter(child =>\r\n        (child.name || '').toLowerCase().includes(lowerQuery)\r\n      );\r\n\r\n      if (!filterQuery || parentMatches || matchingChildren.length > 0) {\r\n        const parentChecked = this.areAllChildrenSelected(parent.id);\r\n\r\n        // Parent item with gray background\r\n        html += `\r\n          <div class=\"rs-property-type__item rs-property-type__item--parent\" style=\"background: #f5f5f5; padding: 8px 12px; border-bottom: 1px solid #eee;\">\r\n            <label class=\"rs-property-type__checkbox-label\" style=\"display: flex; align-items: center; cursor: pointer;\">\r\n              <input type=\"checkbox\"\r\n                     class=\"rs-property-type__checkbox\"\r\n                     value=\"${parent.id}\"\r\n                     data-is-parent=\"true\"\r\n                     data-name=\"${this.escapeHtml(parent.name)}\"\r\n                     ${parentChecked ? 'checked' : ''}\r\n                     style=\"margin-right: 10px;\">\r\n              <span class=\"rs-property-type__checkbox-text\" style=\"font-weight: 600;\">${this.escapeHtml(parent.name)}</span>\r\n            </label>\r\n          </div>\r\n        `;\r\n\r\n        const displayChildren = filterQuery ? matchingChildren : children;\r\n        displayChildren.forEach(child => {\r\n          html += `\r\n            <div class=\"rs-property-type__item rs-property-type__item--child\" style=\"padding: 8px 12px 8px 32px; border-bottom: 1px solid #eee;\">\r\n              <label class=\"rs-property-type__checkbox-label\" style=\"display: flex; align-items: center; cursor: pointer;\">\r\n                <input type=\"checkbox\"\r\n                       class=\"rs-property-type__checkbox\"\r\n                       value=\"${child.id}\"\r\n                       data-parent-id=\"${parent.id}\"\r\n                       data-name=\"${this.escapeHtml(child.name)}\"\r\n                       ${this.selectedIds.has(String(child.id)) ? 'checked' : ''}\r\n                       style=\"margin-right: 10px;\">\r\n                <span class=\"rs-property-type__checkbox-text\">${this.escapeHtml(child.name)}</span>\r\n              </label>\r\n            </div>\r\n          `;\r\n        });\r\n      }\r\n    });\r\n\r\n    this.list.innerHTML = html || '<div class=\"rs-property-type__no-results\">No results found</div>';\r\n  }\r\n\r\n  // Render accordion list (V3)\r\n  private renderAccordionList(filterQuery: string = ''): void {\r\n    if (!this.list) return;\r\n\r\n    const parents = this.getParentTypes();\r\n    const lowerQuery = filterQuery.toLowerCase();\r\n    let html = '';\r\n\r\n    parents.forEach(parent => {\r\n      const parentMatches = (parent.name || '').toLowerCase().includes(lowerQuery);\r\n      const children = this.getChildTypes(parent.id);\r\n      const matchingChildren = children.filter(child =>\r\n        (child.name || '').toLowerCase().includes(lowerQuery)\r\n      );\r\n\r\n      if (!filterQuery || parentMatches || matchingChildren.length > 0) {\r\n        const isExpanded = this.expandedParents.has(String(parent.id)) || !!filterQuery;\r\n        const parentChecked = this.areAllChildrenSelected(parent.id);\r\n        const displayChildren = filterQuery ? matchingChildren : children;\r\n\r\n        html += `\r\n          <div class=\"rs-property-type__accordion ${isExpanded ? 'rs-property-type__accordion--expanded' : ''}\">\r\n            <div class=\"rs-property-type__accordion-header\">\r\n              <label class=\"rs-property-type__checkbox-label\" onclick=\"event.stopPropagation()\">\r\n                <input type=\"checkbox\"\r\n                       class=\"rs-property-type__checkbox\"\r\n                       value=\"${parent.id}\"\r\n                       data-is-parent=\"true\"\r\n                       ${parentChecked ? 'checked' : ''}>\r\n                <span class=\"rs-property-type__checkbox-text\"><strong>${this.escapeHtml(parent.name)}</strong></span>\r\n              </label>\r\n              <button type=\"button\" class=\"rs-property-type__accordion-toggle\" data-parent-id=\"${parent.id}\">\r\n                ${isExpanded ? 'âˆ’' : '+'}\r\n              </button>\r\n            </div>\r\n            <div class=\"rs-property-type__accordion-content\" style=\"display: ${isExpanded ? 'block' : 'none'}\">\r\n        `;\r\n\r\n        displayChildren.forEach(child => {\r\n          html += `\r\n            <div class=\"rs-property-type__item rs-property-type__item--child\">\r\n              <label class=\"rs-property-type__checkbox-label\">\r\n                <input type=\"checkbox\"\r\n                       class=\"rs-property-type__checkbox\"\r\n                       value=\"${child.id}\"\r\n                       data-parent-id=\"${parent.id}\"\r\n                       ${this.selectedIds.has(String(child.id)) ? 'checked' : ''}>\r\n                <span class=\"rs-property-type__checkbox-text\">${this.escapeHtml(child.name)}</span>\r\n              </label>\r\n            </div>\r\n          `;\r\n        });\r\n\r\n        html += `</div></div>`;\r\n      }\r\n    });\r\n\r\n    this.list.innerHTML = html || '<div class=\"rs-property-type__no-results\">No results found</div>';\r\n  }\r\n\r\n  // Populate hierarchical select (V4)\r\n  private populateHierarchicalSelect(): void {\r\n    if (!this.select) return;\r\n\r\n    const parents = this.getParentTypes();\r\n    let html = `<option value=\"\">${this.label('search_property_type')}</option>`;\r\n\r\n    parents.forEach(parent => {\r\n      html += `<option value=\"${parent.id}\">${this.escapeHtml(parent.name)}</option>`;\r\n\r\n      const children = this.getChildTypes(parent.id);\r\n      children.forEach(child => {\r\n        html += `<option value=\"${child.id}\">&nbsp;&nbsp;â”œâ”€ ${this.escapeHtml(child.name)}</option>`;\r\n      });\r\n    });\r\n\r\n    this.select.innerHTML = html;\r\n\r\n    // Restore selection if any\r\n    if (this.selectedIds.size > 0) {\r\n      this.select.value = Array.from(this.selectedIds)[0];\r\n    }\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindFlatMultiSelectEvents();\r\n        break;\r\n      case '3':\r\n        this.bindAccordionMultiSelectEvents();\r\n        break;\r\n      case '4':\r\n        this.bindTraditionalDropdownEvents();\r\n        break;\r\n      default:\r\n        this.bindTypeaheadEvents();\r\n    }\r\n\r\n    // Close dropdown when clicking outside\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Bind events for V1 (Typeahead)\r\n  private bindTypeaheadEvents(): void {\r\n    if (!this.input || !this.list || !this.clearBtn) return;\r\n\r\n    // Don't show dropdown on focus - only show when user types\r\n    this.input.addEventListener('blur', () => {\r\n      setTimeout(() => this.hideDropdown(), 200);\r\n    });\r\n\r\n    this.input.addEventListener('input', (e: Event) => {\r\n      const target = e.target as HTMLInputElement;\r\n      this.searchTerm = target.value.toLowerCase();\r\n      if (this.clearBtn) {\r\n        this.clearBtn.style.display = target.value ? 'block' : 'none';\r\n      }\r\n\r\n      // Only show dropdown when user starts typing\r\n      if (target.value.length >= 1) {\r\n        this.filterTypes();\r\n        this.showDropdown();\r\n      } else {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n\r\n    this.input.addEventListener('keydown', (e: KeyboardEvent) => this.handleKeyboard(e));\r\n\r\n    this.list.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const item = target.closest('.rs-property-type__item') as HTMLElement | null;\r\n      if (item && item.dataset.id && item.dataset.name) {\r\n        this.selectSingleType(item.dataset.id, item.dataset.name);\r\n      }\r\n    });\r\n\r\n    this.clearBtn.addEventListener('click', () => this.clearSelection());\r\n  }\r\n\r\n  // Bind events for V2 (Flat Multi-Select)\r\n  private bindFlatMultiSelectEvents(): void {\r\n    if (!this.button || !this.filterInput || !this.list) return;\r\n\r\n    let filterDebounce: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    this.button.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      this.toggleDropdown();\r\n    });\r\n\r\n    // Filter with 200ms debounce\r\n    this.filterInput.addEventListener('input', (e: Event) => {\r\n      clearTimeout(filterDebounce);\r\n      filterDebounce = setTimeout(() => {\r\n        const target = e.target as HTMLInputElement;\r\n        this.renderFlatList(target.value.trim());\r\n      }, 200);\r\n    });\r\n\r\n    this.list.addEventListener('change', (e: Event) => {\r\n      const target = e.target as HTMLInputElement;\r\n      if (!target.classList.contains('rs-property-type__checkbox')) return;\r\n\r\n      this.handleCheckboxChange(target);\r\n    });\r\n  }\r\n\r\n  // Bind events for V3 (Accordion Multi-Select)\r\n  private bindAccordionMultiSelectEvents(): void {\r\n    if (!this.button || !this.filterInput || !this.list) return;\r\n\r\n    let filterDebounce: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    this.button.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      this.toggleDropdown();\r\n    });\r\n\r\n    // Filter with 200ms debounce\r\n    this.filterInput.addEventListener('input', (e: Event) => {\r\n      clearTimeout(filterDebounce);\r\n      filterDebounce = setTimeout(() => {\r\n        const target = e.target as HTMLInputElement;\r\n        this.renderAccordionList(target.value.trim());\r\n      }, 200);\r\n    });\r\n\r\n    // Handle accordion toggle\r\n    this.list.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const toggleBtn = target.closest('.rs-property-type__accordion-toggle') as HTMLButtonElement | null;\r\n      if (toggleBtn) {\r\n        const parentId = toggleBtn.dataset.parentId;\r\n        const accordion = toggleBtn.closest('.rs-property-type__accordion');\r\n        if (!accordion || !parentId) return;\r\n\r\n        const content = accordion.querySelector('.rs-property-type__accordion-content') as HTMLElement | null;\r\n        const isExpanded = accordion.classList.contains('rs-property-type__accordion--expanded');\r\n\r\n        if (isExpanded) {\r\n          accordion.classList.remove('rs-property-type__accordion--expanded');\r\n          if (content) content.style.display = 'none';\r\n          toggleBtn.textContent = '+';\r\n          this.expandedParents.delete(parentId);\r\n        } else {\r\n          accordion.classList.add('rs-property-type__accordion--expanded');\r\n          if (content) content.style.display = 'block';\r\n          toggleBtn.textContent = 'âˆ’';\r\n          this.expandedParents.add(parentId);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Handle checkbox changes\r\n    this.list.addEventListener('change', (e: Event) => {\r\n      const target = e.target as HTMLInputElement;\r\n      if (!target.classList.contains('rs-property-type__checkbox')) return;\r\n\r\n      this.handleCheckboxChange(target);\r\n    });\r\n  }\r\n\r\n  // Bind events for V4 (Traditional Dropdown)\r\n  private bindTraditionalDropdownEvents(): void {\r\n    if (!this.select) return;\r\n\r\n    this.select.addEventListener('change', (e: Event) => {\r\n      const target = e.target as HTMLSelectElement;\r\n      const value = target.value;\r\n      if (value) {\r\n        this.selectedIds.clear();\r\n        this.selectedIds.add(value);\r\n        const option = target.options[target.selectedIndex];\r\n        this.setFilter('propertyType', parseInt(value));\r\n        this.setFilter('propertyTypeName', option.text.replace(/^\\s*â”œâ”€\\s*/, ''));\r\n      } else {\r\n        this.selectedIds.clear();\r\n        this.setFilter('propertyType', null);\r\n        this.setFilter('propertyTypeName', '');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Handle checkbox change for multi-select variations\r\n  private handleCheckboxChange(checkbox: HTMLInputElement): void {\r\n    const typeId = checkbox.value;\r\n    const isParent = checkbox.dataset.isParent === 'true';\r\n\r\n    if (isParent) {\r\n      const childIds = this.getAllChildIds(typeId);\r\n\r\n      if (checkbox.checked) {\r\n        this.selectedIds.add(typeId);\r\n        childIds.forEach(id => this.selectedIds.add(id));\r\n      } else {\r\n        this.selectedIds.delete(typeId);\r\n        childIds.forEach(id => this.selectedIds.delete(id));\r\n      }\r\n\r\n      // Update child checkboxes in DOM\r\n      if (this.list) {\r\n        this.list.querySelectorAll<HTMLInputElement>(`input[data-parent-id=\"${typeId}\"]`).forEach(cb => {\r\n          cb.checked = checkbox.checked;\r\n        });\r\n      }\r\n    } else {\r\n      if (checkbox.checked) {\r\n        this.selectedIds.add(typeId);\r\n      } else {\r\n        this.selectedIds.delete(typeId);\r\n      }\r\n\r\n      // Update parent checkbox state\r\n      const parentId = checkbox.dataset.parentId;\r\n      if (parentId && this.list) {\r\n        const parentCheckbox = this.list.querySelector<HTMLInputElement>(`input[value=\"${parentId}\"][data-is-parent=\"true\"]`);\r\n        if (parentCheckbox) {\r\n          parentCheckbox.checked = this.areAllChildrenSelected(parentId);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.updateButtonText();\r\n    this.updateTags();\r\n    this.updateFilters();\r\n  }\r\n\r\n  private filterTypes(): void {\r\n    // Filter by search term and exclude items with 0 properties\r\n    const typesWithProperties = this.propertyTypes.filter(type => hasProperties(type));\r\n\r\n    if (!this.searchTerm) {\r\n      this.filteredTypes = typesWithProperties;\r\n    } else {\r\n      this.filteredTypes = typesWithProperties.filter(type =>\r\n        (type.name || '').toLowerCase().includes(this.searchTerm)\r\n      );\r\n    }\r\n    this.highlightIndex = -1;\r\n    this.updateTypeaheadList();\r\n  }\r\n\r\n  private showDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = true;\r\n    this.dropdown.style.display = 'block';\r\n  }\r\n\r\n  private hideDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = false;\r\n    this.dropdown.style.display = 'none';\r\n    this.highlightIndex = -1;\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    if (this.isOpen) {\r\n      this.hideDropdown();\r\n    } else {\r\n      this.showDropdown();\r\n    }\r\n  }\r\n\r\n  private handleKeyboard(e: KeyboardEvent): void {\r\n    if (!this.isOpen) {\r\n      if (e.key === 'ArrowDown' || e.key === 'Enter') {\r\n        this.showDropdown();\r\n      }\r\n      return;\r\n    }\r\n\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        this.highlightIndex = Math.min(this.highlightIndex + 1, this.filteredTypes.slice(0, 10).length - 1);\r\n        this.updateTypeaheadList();\r\n        break;\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        this.highlightIndex = Math.max(this.highlightIndex - 1, 0);\r\n        this.updateTypeaheadList();\r\n        break;\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        if (this.highlightIndex >= 0 && this.filteredTypes[this.highlightIndex]) {\r\n          const type = this.filteredTypes[this.highlightIndex];\r\n          this.selectSingleType(String(type.id), type.name);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        this.hideDropdown();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private selectSingleType(id: string, name: string): void {\r\n    this.selectedIds.clear();\r\n    this.selectedIds.add(id);\r\n    this.selectedName = name;\r\n\r\n    this.setFilter('propertyType', parseInt(id));\r\n    this.setFilter('propertyTypeName', name);\r\n\r\n    if (this.input && this.clearBtn) {\r\n      this.input.value = name;\r\n      this.clearBtn.style.display = 'block';\r\n    }\r\n\r\n    this.hideDropdown();\r\n  }\r\n\r\n  private clearSelection(): void {\r\n    this.selectedIds.clear();\r\n    this.selectedName = '';\r\n    this.setFilter('propertyType', null);\r\n    this.setFilter('propertyTypeName', '');\r\n\r\n    if (this.input && this.clearBtn) {\r\n      this.input.value = '';\r\n      this.clearBtn.style.display = 'none';\r\n    }\r\n    if (this.select) {\r\n      this.select.value = '';\r\n    }\r\n\r\n    this.updateButtonText();\r\n  }\r\n\r\n  private updateButtonText(): void {\r\n    if (!this.buttonText || !this.button) return;\r\n    const count = this.selectedIds.size;\r\n    if (count > 0) {\r\n      this.buttonText.textContent = count + ' selected';\r\n      this.button.classList.add('has-selection');\r\n    } else {\r\n      this.buttonText.textContent = this.label('search_property_type');\r\n      this.button.classList.remove('has-selection');\r\n    }\r\n  }\r\n\r\n  // Update tags for V2\r\n  private updateTags(): void {\r\n    if (!this.tagsContainer) return;\r\n\r\n    if (this.selectedIds.size === 0) {\r\n      this.tagsContainer.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    // Get selected type names\r\n    const selectedTypes: { id: number; name: string }[] = [];\r\n    this.selectedIds.forEach(id => {\r\n      const type = this.propertyTypes.find(t => String(t.id) === String(id));\r\n      if (type) {\r\n        selectedTypes.push({ id: type.id, name: type.name });\r\n      }\r\n    });\r\n\r\n    const html = selectedTypes.map(type => `\r\n      <span class=\"rs-property-type__tag\" style=\"display: inline-flex; align-items: center; background: #2e7d32; color: white; padding: 4px 10px; border-radius: 4px; margin: 4px 4px 4px 0; font-size: 13px;\">\r\n        ${this.escapeHtml(type.name)}\r\n        <button type=\"button\" class=\"rs-property-type__tag-remove\" data-id=\"${type.id}\" style=\"background: none; border: none; color: white; margin-left: 6px; cursor: pointer; font-size: 14px; padding: 0; line-height: 1;\">&times;</button>\r\n      </span>\r\n    `).join('');\r\n\r\n    this.tagsContainer.innerHTML = html;\r\n\r\n    // Bind remove events\r\n    this.tagsContainer.querySelectorAll<HTMLButtonElement>('.rs-property-type__tag-remove').forEach(btn => {\r\n      btn.addEventListener('click', (e: Event) => {\r\n        e.stopPropagation();\r\n        const id = btn.dataset.id;\r\n        if (id) {\r\n          this.selectedIds.delete(String(id));\r\n          this.updateButtonText();\r\n          this.updateTags();\r\n          this.updateFilters();\r\n          this.renderFlatList(this.filterInput?.value || '');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateFilters(): void {\r\n    if (this.selectedIds.size > 0) {\r\n      const ids = Array.from(this.selectedIds).map(id => parseInt(id));\r\n      this.setFilter('propertyType', ids.length === 1 ? ids[0] : ids);\r\n    } else {\r\n      this.setFilter('propertyType', null);\r\n    }\r\n  }\r\n\r\n  private updateList(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderFlatList();\r\n        break;\r\n      case '3':\r\n        this.renderAccordionList();\r\n        break;\r\n      case '4':\r\n        this.populateHierarchicalSelect();\r\n        break;\r\n      default:\r\n        this.filterTypes();\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    const currentFilter = this.getFilter<number | number[] | null>('propertyType');\r\n\r\n    // Variation 1: Typeahead\r\n    if (this.input) {\r\n      this.input.value = this.selectedName || '';\r\n    }\r\n\r\n    // Variation 4: Traditional dropdown\r\n    if (this.select) {\r\n      this.select.value = this.selectedIds.size > 0 ? Array.from(this.selectedIds)[0] : '';\r\n    }\r\n\r\n    // Variations 2 & 3: Multi-select - reset if no filter\r\n    if ((this.variation === '2' || this.variation === '3') && !currentFilter) {\r\n      this.selectedIds.clear();\r\n      this.selectedName = '';\r\n      // Update checkbox states\r\n      this.element.querySelectorAll<HTMLInputElement>('.rs-property-type__checkbox').forEach(checkbox => {\r\n        checkbox.checked = false;\r\n      });\r\n      // Update tags\r\n      this.updateTags();\r\n    }\r\n\r\n    this.updateButtonText();\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_property_type', RSPropertyType as unknown as ComponentConstructor);\r\n\r\nexport { RSPropertyType };\r\nexport default RSPropertyType;\r\n","/**\r\n * RealtySoft Widget v3 - Bedrooms Component\r\n * Variations: 1=Dropdown, 2=Box Style, 3=Multi-Select, 4=Free Input\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSBedrooms extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private minValue: number | null = null;\r\n  private maxValue: number | null = null;\r\n  private maxOptions: number = 10;\r\n  private style: string = 'minimum';\r\n  private selectedValues: Set<number> = new Set();\r\n  private isOpen: boolean = false;\r\n  private select: HTMLSelectElement | null = null;\r\n  private input: HTMLInputElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private buttonText: HTMLElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('bedsMin') || this.isLocked('bedsMax');\r\n    this.minValue = this.getFilter<number | null>('bedsMin');\r\n    this.maxValue = this.getFilter<number | null>('bedsMax');\r\n    this.maxOptions = 10;\r\n    this.style = this.element.dataset.rsStyle || 'minimum'; // 'minimum' or 'exact'\r\n    this.selectedValues = new Set();\r\n    this.isOpen = false;\r\n\r\n    // Initialize from existing filter\r\n    if (this.minValue) {\r\n      if (this.style === 'exact' && this.maxValue) {\r\n        for (let i = this.minValue; i <= this.maxValue; i++) {\r\n          this.selectedValues.add(i);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<number | null>('filters.bedsMin', (value) => {\r\n      this.minValue = value;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-bedrooms', `rs-bedrooms--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderBoxStyle();\r\n        break;\r\n      case '3':\r\n        this.renderMultiSelect();\r\n        break;\r\n      case '4':\r\n        this.renderFreeInput();\r\n        break;\r\n      default:\r\n        this.renderDropdown();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Dropdown\r\n  private renderDropdown(): void {\r\n    const placeholder = this.label('search_bedrooms_any') || 'Any Bedrooms';\r\n\r\n    let options = `<option value=\"\">${placeholder}</option>`;\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const selected = this.minValue === i ? 'selected' : '';\r\n      options += `<option value=\"${i}\" ${selected}>${label}</option>`;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bedrooms__wrapper\">\r\n        <label class=\"rs-bedrooms__label\">${this.label('search_bedrooms')}</label>\r\n        <div class=\"rs-bedrooms__select-wrapper\">\r\n          <select class=\"rs-bedrooms__select\">${options}</select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-bedrooms__select');\r\n  }\r\n\r\n  // VARIATION 2: Box Style (Horizontal Buttons)\r\n  private renderBoxStyle(): void {\r\n    let buttons = '';\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const active = this.minValue === i ? 'rs-bedrooms__box--active' : '';\r\n      buttons += `<button type=\"button\" class=\"rs-bedrooms__box ${active}\" data-value=\"${i}\">${label}</button>`;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bedrooms__wrapper\">\r\n        <label class=\"rs-bedrooms__label\">${this.label('search_bedrooms')}</label>\r\n        <div class=\"rs-bedrooms__boxes\">${buttons}</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // VARIATION 3: Multi-Select Dropdown\r\n  private renderMultiSelect(): void {\r\n    const placeholder = this.label('search_bedrooms_select') || 'Select Bedrooms';\r\n    const count = this.selectedValues.size;\r\n    const buttonText = count > 0 ? `${count} selected` : placeholder;\r\n\r\n    let checkboxes = '';\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const checked = this.selectedValues.has(i) ? 'checked' : '';\r\n      checkboxes += `\r\n        <label class=\"rs-bedrooms__multiselect-option\">\r\n          <input type=\"checkbox\" class=\"rs-bedrooms__multiselect-checkbox\" value=\"${i}\" ${checked}>\r\n          <span>${label}</span>\r\n        </label>\r\n      `;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bedrooms__wrapper\">\r\n        <label class=\"rs-bedrooms__label\">${this.label('search_bedrooms')}</label>\r\n        <div class=\"rs-bedrooms__multiselect\">\r\n          <button type=\"button\" class=\"rs-bedrooms__multiselect-button\">\r\n            <span class=\"rs-bedrooms__multiselect-text\">${buttonText}</span>\r\n            <span class=\"rs-bedrooms__multiselect-arrow\">â–¼</span>\r\n          </button>\r\n          <div class=\"rs-bedrooms__multiselect-dropdown\" style=\"display: none;\">\r\n            ${checkboxes}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-bedrooms__multiselect-button');\r\n    this.buttonText = this.element.querySelector('.rs-bedrooms__multiselect-text');\r\n    this.dropdown = this.element.querySelector('.rs-bedrooms__multiselect-dropdown');\r\n  }\r\n\r\n  // VARIATION 4: Free Input\r\n  private renderFreeInput(): void {\r\n    const placeholder = this.label('search_bedrooms_input') || 'e.g., 3';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bedrooms__wrapper\">\r\n        <label class=\"rs-bedrooms__label\">${this.label('search_bedrooms')}</label>\r\n        <div class=\"rs-bedrooms__input-wrapper\">\r\n          <input type=\"number\"\r\n                 class=\"rs-bedrooms__input\"\r\n                 min=\"0\"\r\n                 max=\"20\"\r\n                 placeholder=\"${placeholder}\"\r\n                 value=\"${this.minValue || ''}\">\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-bedrooms__input');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindBoxStyleEvents();\r\n        break;\r\n      case '3':\r\n        this.bindMultiSelectEvents();\r\n        break;\r\n      case '4':\r\n        this.bindFreeInputEvents();\r\n        break;\r\n      default:\r\n        this.bindDropdownEvents();\r\n    }\r\n  }\r\n\r\n  private bindDropdownEvents(): void {\r\n    if (this.select) {\r\n      this.select.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.handleSelection(value);\r\n      });\r\n    }\r\n  }\r\n\r\n  private bindBoxStyleEvents(): void {\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-bedrooms__box').forEach(box => {\r\n      box.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        const target = e.target as HTMLButtonElement;\r\n        const value = parseInt(target.dataset.value || '0');\r\n        const isActive = target.classList.contains('rs-bedrooms__box--active');\r\n\r\n        // Remove active from all\r\n        this.element.querySelectorAll('.rs-bedrooms__box').forEach(b =>\r\n          b.classList.remove('rs-bedrooms__box--active')\r\n        );\r\n\r\n        if (!isActive) {\r\n          target.classList.add('rs-bedrooms__box--active');\r\n          this.handleSelection(value);\r\n        } else {\r\n          this.handleSelection(null);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindMultiSelectEvents(): void {\r\n    // Toggle dropdown\r\n    if (this.button) {\r\n      this.button.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        this.toggleDropdown();\r\n      });\r\n    }\r\n\r\n    // Close on outside click\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n\r\n    // Checkbox changes\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-bedrooms__multiselect-checkbox').forEach(checkbox => {\r\n      checkbox.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = parseInt(target.value);\r\n        if (target.checked) {\r\n          this.selectedValues.add(value);\r\n        } else {\r\n          this.selectedValues.delete(value);\r\n        }\r\n        this.updateMultiSelectButton();\r\n        this.updateMultiSelectFilters();\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindFreeInputEvents(): void {\r\n    // Debounce input\r\n    let timeout: ReturnType<typeof setTimeout> | undefined;\r\n    if (this.input) {\r\n      this.input.addEventListener('input', (e: Event) => {\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          const value = parseInt(target.value);\r\n          this.handleSelection(value && value > 0 ? value : null);\r\n        }, 300);\r\n      });\r\n    }\r\n  }\r\n\r\n  private handleSelection(value: number | null): void {\r\n    if (value) {\r\n      if (this.style === 'minimum') {\r\n        this.setFilter('bedsMin', value);\r\n        this.setFilter('bedsMax', null);\r\n      } else {\r\n        this.setFilter('bedsMin', value);\r\n        this.setFilter('bedsMax', value);\r\n      }\r\n    } else {\r\n      this.setFilter('bedsMin', null);\r\n      this.setFilter('bedsMax', null);\r\n    }\r\n  }\r\n\r\n  private updateMultiSelectButton(): void {\r\n    if (!this.buttonText) return;\r\n    const placeholder = this.label('search_bedrooms_select') || 'Select Bedrooms';\r\n    const count = this.selectedValues.size;\r\n    this.buttonText.textContent = count > 0 ? `${count} selected` : placeholder;\r\n  }\r\n\r\n  private updateMultiSelectFilters(): void {\r\n    if (this.selectedValues.size > 0) {\r\n      const values = Array.from(this.selectedValues).sort((a, b) => a - b);\r\n      this.setFilter('bedsMin', Math.min(...values));\r\n      this.setFilter('bedsMax', Math.max(...values));\r\n    } else {\r\n      this.setFilter('bedsMin', null);\r\n      this.setFilter('bedsMax', null);\r\n    }\r\n  }\r\n\r\n  private showDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = true;\r\n    this.dropdown.style.display = 'block';\r\n  }\r\n\r\n  private hideDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = false;\r\n    this.dropdown.style.display = 'none';\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    if (this.isOpen) {\r\n      this.hideDropdown();\r\n    } else {\r\n      this.showDropdown();\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Update dropdown\r\n    if (this.select) {\r\n      this.select.value = this.minValue?.toString() || '';\r\n    }\r\n\r\n    // Update box buttons\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-bedrooms__box').forEach(box => {\r\n      const boxValue = parseInt(box.dataset.value || '0');\r\n      box.classList.toggle('rs-bedrooms__box--active', this.minValue === boxValue);\r\n    });\r\n\r\n    // Update free input\r\n    if (this.input) {\r\n      this.input.value = this.minValue?.toString() || '';\r\n    }\r\n\r\n    // Update multi-select (variation 3)\r\n    if (this.variation === '3') {\r\n      // Clear selectedValues if filter is reset\r\n      if (!this.minValue) {\r\n        this.selectedValues.clear();\r\n      }\r\n      // Update checkbox states\r\n      this.element.querySelectorAll<HTMLInputElement>('.rs-bedrooms__multiselect-checkbox').forEach(checkbox => {\r\n        const value = parseInt(checkbox.value);\r\n        checkbox.checked = this.selectedValues.has(value);\r\n      });\r\n    }\r\n    this.updateMultiSelectButton();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_bedrooms', RSBedrooms as unknown as ComponentConstructor);\r\n\r\nexport { RSBedrooms };\r\nexport default RSBedrooms;\r\n","/**\r\n * RealtySoft Widget v3 - Bathrooms Component\r\n * Variations: 1=Dropdown, 2=Box Style, 3=Multi-Select, 4=Free Input\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSBathrooms extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private minValue: number | null = null;\r\n  private maxValue: number | null = null;\r\n  private maxOptions: number = 10;\r\n  private style: string = 'minimum';\r\n  private selectedValues: Set<number> = new Set();\r\n  private isOpen: boolean = false;\r\n  private select: HTMLSelectElement | null = null;\r\n  private input: HTMLInputElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private buttonText: HTMLElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('bathsMin') || this.isLocked('bathsMax');\r\n    this.minValue = this.getFilter<number | null>('bathsMin');\r\n    this.maxValue = this.getFilter<number | null>('bathsMax');\r\n    this.maxOptions = 10;\r\n    this.style = this.element.dataset.rsStyle || 'minimum'; // 'minimum' or 'exact'\r\n    this.selectedValues = new Set();\r\n    this.isOpen = false;\r\n\r\n    // Initialize from existing filter\r\n    if (this.minValue) {\r\n      if (this.style === 'exact' && this.maxValue) {\r\n        for (let i = this.minValue; i <= this.maxValue; i++) {\r\n          this.selectedValues.add(i);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<number | null>('filters.bathsMin', (value) => {\r\n      this.minValue = value;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-bathrooms', `rs-bathrooms--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderBoxStyle();\r\n        break;\r\n      case '3':\r\n        this.renderMultiSelect();\r\n        break;\r\n      case '4':\r\n        this.renderFreeInput();\r\n        break;\r\n      default:\r\n        this.renderDropdown();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Dropdown\r\n  private renderDropdown(): void {\r\n    const placeholder = this.label('search_bathrooms_any') || 'Any Bathrooms';\r\n\r\n    let options = `<option value=\"\">${placeholder}</option>`;\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const selected = this.minValue === i ? 'selected' : '';\r\n      options += `<option value=\"${i}\" ${selected}>${label}</option>`;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bathrooms__wrapper\">\r\n        <label class=\"rs-bathrooms__label\">${this.label('search_bathrooms')}</label>\r\n        <div class=\"rs-bathrooms__select-wrapper\">\r\n          <select class=\"rs-bathrooms__select\">${options}</select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-bathrooms__select');\r\n  }\r\n\r\n  // VARIATION 2: Box Style (Horizontal Buttons)\r\n  private renderBoxStyle(): void {\r\n    let buttons = '';\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const active = this.minValue === i ? 'rs-bathrooms__box--active' : '';\r\n      buttons += `<button type=\"button\" class=\"rs-bathrooms__box ${active}\" data-value=\"${i}\">${label}</button>`;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bathrooms__wrapper\">\r\n        <label class=\"rs-bathrooms__label\">${this.label('search_bathrooms')}</label>\r\n        <div class=\"rs-bathrooms__boxes\">${buttons}</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  // VARIATION 3: Multi-Select Dropdown\r\n  private renderMultiSelect(): void {\r\n    const placeholder = this.label('search_bathrooms_select') || 'Select Bathrooms';\r\n    const count = this.selectedValues.size;\r\n    const buttonText = count > 0 ? count + ' selected' : placeholder;\r\n\r\n    let checkboxes = '';\r\n    for (let i = 1; i <= this.maxOptions; i++) {\r\n      const label = this.style === 'minimum' ? `${i}+` : `${i}`;\r\n      const checked = this.selectedValues.has(i) ? 'checked' : '';\r\n      checkboxes += `\r\n        <label class=\"rs-bathrooms__multiselect-option\">\r\n          <input type=\"checkbox\" class=\"rs-bathrooms__multiselect-checkbox\" value=\"${i}\" ${checked}>\r\n          <span>${label}</span>\r\n        </label>\r\n      `;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bathrooms__wrapper\">\r\n        <label class=\"rs-bathrooms__label\">${this.label('search_bathrooms')}</label>\r\n        <div class=\"rs-bathrooms__multiselect\">\r\n          <button type=\"button\" class=\"rs-bathrooms__multiselect-button\">\r\n            <span class=\"rs-bathrooms__multiselect-text\">${buttonText}</span>\r\n            <span class=\"rs-bathrooms__multiselect-arrow\">â–¼</span>\r\n          </button>\r\n          <div class=\"rs-bathrooms__multiselect-dropdown\" style=\"display: none;\">\r\n            ${checkboxes}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-bathrooms__multiselect-button');\r\n    this.buttonText = this.element.querySelector('.rs-bathrooms__multiselect-text');\r\n    this.dropdown = this.element.querySelector('.rs-bathrooms__multiselect-dropdown');\r\n  }\r\n\r\n  // VARIATION 4: Free Input\r\n  private renderFreeInput(): void {\r\n    const placeholder = this.label('search_bathrooms_input') || 'e.g., 2';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-bathrooms__wrapper\">\r\n        <label class=\"rs-bathrooms__label\">${this.label('search_bathrooms')}</label>\r\n        <div class=\"rs-bathrooms__input-wrapper\">\r\n          <input type=\"number\"\r\n                 class=\"rs-bathrooms__input\"\r\n                 min=\"0\"\r\n                 max=\"10\"\r\n                 placeholder=\"${placeholder}\"\r\n                 value=\"${this.minValue || ''}\">\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-bathrooms__input');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindBoxStyleEvents();\r\n        break;\r\n      case '3':\r\n        this.bindMultiSelectEvents();\r\n        break;\r\n      case '4':\r\n        this.bindFreeInputEvents();\r\n        break;\r\n      default:\r\n        this.bindDropdownEvents();\r\n    }\r\n  }\r\n\r\n  private bindDropdownEvents(): void {\r\n    if (this.select) {\r\n      this.select.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.handleSelection(value);\r\n      });\r\n    }\r\n  }\r\n\r\n  private bindBoxStyleEvents(): void {\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-bathrooms__box').forEach(box => {\r\n      box.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        const target = e.target as HTMLButtonElement;\r\n        const value = parseInt(target.dataset.value || '0');\r\n        const isActive = target.classList.contains('rs-bathrooms__box--active');\r\n\r\n        // Remove active from all\r\n        this.element.querySelectorAll('.rs-bathrooms__box').forEach(b =>\r\n          b.classList.remove('rs-bathrooms__box--active')\r\n        );\r\n\r\n        if (!isActive) {\r\n          target.classList.add('rs-bathrooms__box--active');\r\n          this.handleSelection(value);\r\n        } else {\r\n          this.handleSelection(null);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindMultiSelectEvents(): void {\r\n    // Toggle dropdown\r\n    if (this.button) {\r\n      this.button.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        this.toggleDropdown();\r\n      });\r\n    }\r\n\r\n    // Close on outside click\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n\r\n    // Checkbox changes\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-bathrooms__multiselect-checkbox').forEach(checkbox => {\r\n      checkbox.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = parseInt(target.value);\r\n        if (target.checked) {\r\n          this.selectedValues.add(value);\r\n        } else {\r\n          this.selectedValues.delete(value);\r\n        }\r\n        this.updateMultiSelectButton();\r\n        this.updateMultiSelectFilters();\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindFreeInputEvents(): void {\r\n    // Debounce input\r\n    let timeout: ReturnType<typeof setTimeout> | undefined;\r\n    if (this.input) {\r\n      this.input.addEventListener('input', (e: Event) => {\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          const value = parseInt(target.value);\r\n          this.handleSelection(value && value > 0 ? value : null);\r\n        }, 300);\r\n      });\r\n    }\r\n  }\r\n\r\n  private handleSelection(value: number | null): void {\r\n    if (value) {\r\n      if (this.style === 'minimum') {\r\n        this.setFilter('bathsMin', value);\r\n        this.setFilter('bathsMax', null);\r\n      } else {\r\n        this.setFilter('bathsMin', value);\r\n        this.setFilter('bathsMax', value);\r\n      }\r\n    } else {\r\n      this.setFilter('bathsMin', null);\r\n      this.setFilter('bathsMax', null);\r\n    }\r\n  }\r\n\r\n  private updateMultiSelectButton(): void {\r\n    if (!this.buttonText) return;\r\n    const placeholder = this.label('search_bathrooms_select') || 'Select Bathrooms';\r\n    const count = this.selectedValues.size;\r\n    this.buttonText.textContent = count > 0 ? count + ' selected' : placeholder;\r\n  }\r\n\r\n  private updateMultiSelectFilters(): void {\r\n    if (this.selectedValues.size > 0) {\r\n      const values = Array.from(this.selectedValues).sort((a, b) => a - b);\r\n      this.setFilter('bathsMin', Math.min(...values));\r\n      this.setFilter('bathsMax', Math.max(...values));\r\n    } else {\r\n      this.setFilter('bathsMin', null);\r\n      this.setFilter('bathsMax', null);\r\n    }\r\n  }\r\n\r\n  private showDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = true;\r\n    this.dropdown.style.display = 'block';\r\n  }\r\n\r\n  private hideDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = false;\r\n    this.dropdown.style.display = 'none';\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    if (this.isOpen) {\r\n      this.hideDropdown();\r\n    } else {\r\n      this.showDropdown();\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Update dropdown\r\n    if (this.select) {\r\n      this.select.value = this.minValue?.toString() || '';\r\n    }\r\n\r\n    // Update box buttons\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-bathrooms__box').forEach(box => {\r\n      const boxValue = parseInt(box.dataset.value || '0');\r\n      box.classList.toggle('rs-bathrooms__box--active', this.minValue === boxValue);\r\n    });\r\n\r\n    // Update free input\r\n    if (this.input) {\r\n      this.input.value = this.minValue?.toString() || '';\r\n    }\r\n\r\n    // Update multi-select (variation 3)\r\n    if (this.variation === '3') {\r\n      // Clear selectedValues if filter is reset\r\n      if (!this.minValue) {\r\n        this.selectedValues.clear();\r\n      }\r\n      // Update checkbox states\r\n      this.element.querySelectorAll<HTMLInputElement>('.rs-bathrooms__multiselect-checkbox').forEach(checkbox => {\r\n        const value = parseInt(checkbox.value);\r\n        checkbox.checked = this.selectedValues.has(value);\r\n      });\r\n    }\r\n    this.updateMultiSelectButton();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_bathrooms', RSBathrooms as unknown as ComponentConstructor);\r\n\r\nexport { RSBathrooms };\r\nexport default RSBathrooms;\r\n","/**\r\n * RealtySoft Widget v3 - Price Component\r\n * Variations: 1=Styled Dropdown, 2=Stacked Buttons, 3=Multi-Select, 4=Free Input\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\ninterface PriceRanges {\r\n  min: number[];\r\n  max: number[];\r\n}\r\n\r\ninterface DefaultPriceRanges {\r\n  [key: string]: PriceRanges;\r\n}\r\n\r\nclass RSPrice extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private type: 'min' | 'max' = 'min';\r\n  private minValue: number | null = null;\r\n  private maxValue: number | null = null;\r\n  private currentValue: number | null = null;\r\n  private selectedValues: Set<number> = new Set();\r\n  private isOpen: boolean = false;\r\n  private maxVisible: number = 10;\r\n  private select: HTMLSelectElement | null = null;\r\n  private input: HTMLInputElement | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private buttonText: HTMLElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n  private toggleBtn: HTMLButtonElement | null = null;\r\n  private toggleText: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('priceMin') || this.isLocked('priceMax');\r\n    this.type = (this.element.dataset.rsType as 'min' | 'max') || 'min';\r\n    this.minValue = this.getFilter<number | null>('priceMin');\r\n    this.maxValue = this.getFilter<number | null>('priceMax');\r\n    this.currentValue = this.type === 'min' ? this.minValue : this.maxValue;\r\n    this.selectedValues = new Set();\r\n    this.isOpen = false;\r\n    this.maxVisible = 10;\r\n\r\n    // Initialize from existing filter\r\n    if (this.currentValue) {\r\n      this.selectedValues.add(this.currentValue);\r\n    }\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<number | null>('filters.priceMin', (value) => {\r\n      this.minValue = value;\r\n      if (this.type === 'min') {\r\n        this.currentValue = value;\r\n        this.updateDisplay();\r\n      }\r\n    });\r\n\r\n    this.subscribe<number | null>('filters.priceMax', (value) => {\r\n      this.maxValue = value;\r\n      if (this.type === 'max') {\r\n        this.currentValue = value;\r\n        this.updateDisplay();\r\n      }\r\n    });\r\n\r\n    // Listen for listing type changes to rebuild price options\r\n    this.subscribe<string | null>('filters.listingType', () => {\r\n      this.updatePriceOptions();\r\n    });\r\n  }\r\n\r\n  // Get price options based on listing type\r\n  private getPriceOptions(): number[] {\r\n    const listingType = this.getFilter<string>('listingType') || 'resale';\r\n\r\n    const defaultPriceRanges: DefaultPriceRanges = {\r\n      resale: {\r\n        min: [50000, 100000, 150000, 200000, 250000, 300000, 400000, 500000, 750000, 1000000, 1500000, 2000000, 3000000, 5000000, 10000000, 20000000],\r\n        max: [100000, 200000, 300000, 500000, 750000, 1000000, 1500000, 2000000, 3000000, 5000000, 10000000, 20000000, 50000000]\r\n      },\r\n      development: {\r\n        min: [50000, 100000, 150000, 200000, 250000, 300000, 400000, 500000, 750000, 1000000, 1500000, 2000000, 3000000, 5000000, 10000000, 20000000],\r\n        max: [100000, 200000, 300000, 500000, 750000, 1000000, 1500000, 2000000, 3000000, 5000000, 10000000, 20000000, 50000000]\r\n      },\r\n      long_rental: {\r\n        min: [500, 750, 1000, 1250, 1500, 2000, 2500, 3000, 5000, 10000, 25000],\r\n        max: [750, 1000, 1250, 1500, 2000, 2500, 3000, 5000, 10000, 25000, 50000]\r\n      },\r\n      short_rental: {\r\n        min: [250, 350, 500, 750, 1000, 1250, 1500, 2000, 2500, 3000, 5000, 10000, 25000],\r\n        max: [350, 500, 750, 1000, 1250, 1500, 2000, 2500, 3000, 5000, 10000, 25000, 50000]\r\n      }\r\n    };\r\n\r\n    const priceRange = defaultPriceRanges[listingType] || defaultPriceRanges.resale;\r\n    return priceRange[this.type] || priceRange.min;\r\n  }\r\n\r\n  // Format price (short format)\r\n  private formatPrice(price: number): string {\r\n    if (price >= 1000000) return `â‚¬${price / 1000000}M`;\r\n    if (price >= 1000) return `â‚¬${price / 1000}K`;\r\n    return `â‚¬${price.toLocaleString()}`;\r\n  }\r\n\r\n  // Format price (full format)\r\n  private formatPriceFull(price: number): string {\r\n    return `â‚¬${price.toLocaleString()}`;\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-price', `rs-price--v${this.variation}`, `rs-price--${this.type}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderStackedButtons();\r\n        break;\r\n      case '3':\r\n        this.renderMultiSelect();\r\n        break;\r\n      case '4':\r\n        this.renderFreeInput();\r\n        break;\r\n      default:\r\n        this.renderStyledDropdown();\r\n    }\r\n  }\r\n\r\n  // VARIATION 1: Styled Dropdown\r\n  private renderStyledDropdown(): void {\r\n    const placeholder = this.type === 'min'\r\n      ? (this.label('search_price_min') || 'Min. Price')\r\n      : (this.label('search_price_max') || 'Max. Price');\r\n\r\n    const options = this.getPriceOptions();\r\n\r\n    // If current value exists but isn't in options, add it\r\n    if (this.currentValue && !options.includes(this.currentValue)) {\r\n      options.push(this.currentValue);\r\n      options.sort((a, b) => a - b);\r\n    }\r\n\r\n    let optionsHtml = `<option value=\"\">${placeholder}</option>`;\r\n    options.forEach(price => {\r\n      const selected = this.currentValue === price ? 'selected' : '';\r\n      optionsHtml += `<option value=\"${price}\" ${selected}>${this.formatPriceFull(price)}</option>`;\r\n    });\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-price__wrapper\">\r\n        <label class=\"rs-price__label\">${this.type === 'min' ? this.label('search_price_min') : this.label('search_price_max')}</label>\r\n        <div class=\"rs-price__select-wrapper\">\r\n          <select class=\"rs-price__select\">${optionsHtml}</select>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-price__select');\r\n  }\r\n\r\n  // VARIATION 2: Stacked Buttons\r\n  private renderStackedButtons(): void {\r\n    const placeholder = this.type === 'min'\r\n      ? (this.label('search_price_min') || 'Min. Price')\r\n      : (this.label('search_price_max') || 'Max. Price');\r\n\r\n    const options = this.getPriceOptions();\r\n    const buttonText = this.currentValue ? this.formatPriceFull(this.currentValue) : placeholder;\r\n\r\n    let buttonsHtml = `\r\n      <button type=\"button\" class=\"rs-price__option\" data-value=\"\">\r\n        <span class=\"rs-price__option-text\">${placeholder}</span>\r\n      </button>\r\n    `;\r\n\r\n    options.slice(0, this.maxVisible).forEach(price => {\r\n      const active = this.currentValue === price ? 'rs-price__option--active' : '';\r\n      buttonsHtml += `\r\n        <button type=\"button\" class=\"rs-price__option ${active}\" data-value=\"${price}\">\r\n          <span class=\"rs-price__option-text\">${this.formatPriceFull(price)}</span>\r\n        </button>\r\n      `;\r\n    });\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-price__wrapper\">\r\n        <label class=\"rs-price__label\">${this.type === 'min' ? this.label('search_price_min') : this.label('search_price_max')}</label>\r\n        <div class=\"rs-price__stacked\">\r\n          <button type=\"button\" class=\"rs-price__toggle ${this.currentValue ? 'rs-price__toggle--has-selection' : ''}\">\r\n            <span class=\"rs-price__toggle-text\">${buttonText}</span>\r\n            <span class=\"rs-price__toggle-arrow\">â–¼</span>\r\n          </button>\r\n          <div class=\"rs-price__dropdown\" style=\"display: none;\">\r\n            ${buttonsHtml}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.toggleBtn = this.element.querySelector('.rs-price__toggle');\r\n    this.toggleText = this.element.querySelector('.rs-price__toggle-text');\r\n    this.dropdown = this.element.querySelector('.rs-price__dropdown');\r\n  }\r\n\r\n  // VARIATION 3: Multi-Select Dropdown\r\n  private renderMultiSelect(): void {\r\n    const placeholder = this.type === 'min'\r\n      ? (this.label('search_price_select_min') || 'Select Min Prices')\r\n      : (this.label('search_price_select_max') || 'Select Max Prices');\r\n\r\n    const options = this.getPriceOptions();\r\n    const count = this.selectedValues.size;\r\n    const buttonText = count > 0 ? count + ' selected' : placeholder;\r\n\r\n    let checkboxesHtml = '';\r\n    options.forEach(price => {\r\n      const checked = this.selectedValues.has(price) ? 'checked' : '';\r\n      checkboxesHtml += `\r\n        <label class=\"rs-price__multiselect-option\">\r\n          <input type=\"checkbox\" class=\"rs-price__multiselect-checkbox\" value=\"${price}\" ${checked}>\r\n          <span>${this.formatPriceFull(price)}</span>\r\n        </label>\r\n      `;\r\n    });\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-price__wrapper\">\r\n        <label class=\"rs-price__label\">${this.type === 'min' ? this.label('search_price_min') : this.label('search_price_max')}</label>\r\n        <div class=\"rs-price__multiselect\">\r\n          <button type=\"button\" class=\"rs-price__multiselect-button\">\r\n            <span class=\"rs-price__multiselect-text\">${buttonText}</span>\r\n            <span class=\"rs-price__multiselect-arrow\">â–¼</span>\r\n          </button>\r\n          <div class=\"rs-price__multiselect-dropdown\" style=\"display: none;\">\r\n            ${checkboxesHtml}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-price__multiselect-button');\r\n    this.buttonText = this.element.querySelector('.rs-price__multiselect-text');\r\n    this.dropdown = this.element.querySelector('.rs-price__multiselect-dropdown');\r\n  }\r\n\r\n  // VARIATION 4: Free Input\r\n  private renderFreeInput(): void {\r\n    const placeholder = this.type === 'min'\r\n      ? (this.label('search_price_input_min') || 'Min. Price (e.g., 200000)')\r\n      : (this.label('search_price_input_max') || 'Max. Price (e.g., 500000)');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-price__wrapper\">\r\n        <label class=\"rs-price__label\">${this.type === 'min' ? this.label('search_price_min') : this.label('search_price_max')}</label>\r\n        <div class=\"rs-price__input-wrapper\">\r\n          <span class=\"rs-price__currency\">â‚¬</span>\r\n          <input type=\"number\"\r\n                 class=\"rs-price__input\"\r\n                 min=\"0\"\r\n                 step=\"10000\"\r\n                 placeholder=\"${placeholder}\"\r\n                 value=\"${this.currentValue || ''}\">\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-price__input');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.bindStackedButtonsEvents();\r\n        break;\r\n      case '3':\r\n        this.bindMultiSelectEvents();\r\n        break;\r\n      case '4':\r\n        this.bindFreeInputEvents();\r\n        break;\r\n      default:\r\n        this.bindStyledDropdownEvents();\r\n    }\r\n\r\n    // Close dropdown on outside click\r\n    document.addEventListener('click', (e: Event) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.hideDropdown();\r\n      }\r\n    });\r\n  }\r\n\r\n  private bindStyledDropdownEvents(): void {\r\n    if (this.select) {\r\n      this.select.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.setValue(value);\r\n      });\r\n    }\r\n  }\r\n\r\n  private bindStackedButtonsEvents(): void {\r\n    // Toggle dropdown\r\n    if (this.toggleBtn) {\r\n      this.toggleBtn.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        this.toggleDropdown();\r\n      });\r\n    }\r\n\r\n    // Option selection\r\n    if (this.dropdown) {\r\n      this.dropdown.addEventListener('click', (e: Event) => {\r\n        const target = e.target as HTMLElement;\r\n        const optionBtn = target.closest('.rs-price__option') as HTMLButtonElement | null;\r\n        if (!optionBtn) return;\r\n\r\n        e.preventDefault();\r\n        const value = optionBtn.dataset.value ? parseInt(optionBtn.dataset.value) : null;\r\n\r\n        // Update active state\r\n        this.dropdown!.querySelectorAll('.rs-price__option').forEach(b =>\r\n          b.classList.remove('rs-price__option--active')\r\n        );\r\n        if (value) {\r\n          optionBtn.classList.add('rs-price__option--active');\r\n        }\r\n\r\n        // Update toggle button\r\n        const placeholder = this.type === 'min'\r\n          ? (this.label('search_price_min') || 'Min. Price')\r\n          : (this.label('search_price_max') || 'Max. Price');\r\n\r\n        if (value && this.toggleText && this.toggleBtn) {\r\n          this.toggleText.textContent = this.formatPriceFull(value);\r\n          this.toggleBtn.classList.add('rs-price__toggle--has-selection');\r\n        } else if (this.toggleText && this.toggleBtn) {\r\n          this.toggleText.textContent = placeholder;\r\n          this.toggleBtn.classList.remove('rs-price__toggle--has-selection');\r\n        }\r\n\r\n        this.hideDropdown();\r\n        this.setValue(value);\r\n      });\r\n    }\r\n  }\r\n\r\n  private bindMultiSelectEvents(): void {\r\n    // Toggle dropdown\r\n    if (this.button) {\r\n      this.button.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        this.toggleDropdown();\r\n      });\r\n    }\r\n\r\n    // Checkbox changes\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-price__multiselect-checkbox').forEach(checkbox => {\r\n      checkbox.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = parseInt(target.value);\r\n        if (target.checked) {\r\n          this.selectedValues.add(value);\r\n        } else {\r\n          this.selectedValues.delete(value);\r\n        }\r\n        this.updateMultiSelectButton();\r\n        this.updateMultiSelectFilter();\r\n      });\r\n    });\r\n  }\r\n\r\n  private bindFreeInputEvents(): void {\r\n    // Debounce input\r\n    let timeout: ReturnType<typeof setTimeout> | undefined;\r\n    if (this.input) {\r\n      this.input.addEventListener('input', (e: Event) => {\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          const value = parseInt(target.value);\r\n          this.setValue(value && value > 0 ? value : null);\r\n        }, 300);\r\n      });\r\n\r\n      // Format on blur\r\n      this.input.addEventListener('blur', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = parseInt(target.value);\r\n        if (value && value > 0) {\r\n          target.value = String(value);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private setValue(value: number | null): void {\r\n    this.currentValue = value;\r\n    const filterKey = this.type === 'min' ? 'priceMin' : 'priceMax';\r\n    this.setFilter(filterKey, value);\r\n  }\r\n\r\n  private updateMultiSelectButton(): void {\r\n    if (!this.buttonText) return;\r\n    const placeholder = this.type === 'min'\r\n      ? (this.label('search_price_select_min') || 'Select Min Prices')\r\n      : (this.label('search_price_select_max') || 'Select Max Prices');\r\n    const count = this.selectedValues.size;\r\n    this.buttonText.textContent = count > 0 ? count + ' selected' : placeholder;\r\n  }\r\n\r\n  private updateMultiSelectFilter(): void {\r\n    if (this.selectedValues.size > 0) {\r\n      const values = Array.from(this.selectedValues).sort((a, b) => a - b);\r\n      const filterValue = this.type === 'min' ? Math.min(...values) : Math.max(...values);\r\n      this.setValue(filterValue);\r\n    } else {\r\n      this.setValue(null);\r\n    }\r\n  }\r\n\r\n  private updatePriceOptions(): void {\r\n    // Re-render when listing type changes\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  private showDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = true;\r\n    this.dropdown.style.display = 'block';\r\n  }\r\n\r\n  private hideDropdown(): void {\r\n    if (!this.dropdown) return;\r\n    this.isOpen = false;\r\n    this.dropdown.style.display = 'none';\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    if (this.isOpen) {\r\n      this.hideDropdown();\r\n    } else {\r\n      this.showDropdown();\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Update styled dropdown\r\n    if (this.select) {\r\n      this.select.value = this.currentValue?.toString() || '';\r\n    }\r\n\r\n    // Update stacked buttons toggle\r\n    if (this.toggleText && this.toggleBtn) {\r\n      const placeholder = this.type === 'min'\r\n        ? (this.label('search_price_min') || 'Min. Price')\r\n        : (this.label('search_price_max') || 'Max. Price');\r\n\r\n      if (this.currentValue) {\r\n        this.toggleText.textContent = this.formatPriceFull(this.currentValue);\r\n        this.toggleBtn.classList.add('rs-price__toggle--has-selection');\r\n      } else {\r\n        this.toggleText.textContent = placeholder;\r\n        this.toggleBtn.classList.remove('rs-price__toggle--has-selection');\r\n      }\r\n    }\r\n\r\n    // Update free input\r\n    if (this.input) {\r\n      this.input.value = this.currentValue?.toString() || '';\r\n    }\r\n\r\n    // Update multi-select (variation 3)\r\n    if (this.variation === '3') {\r\n      // Clear selectedValues if filter is reset\r\n      if (!this.currentValue) {\r\n        this.selectedValues.clear();\r\n      }\r\n      // Update checkbox states\r\n      this.element.querySelectorAll<HTMLInputElement>('.rs-price__multiselect-checkbox').forEach(checkbox => {\r\n        const value = parseInt(checkbox.value);\r\n        checkbox.checked = this.selectedValues.has(value);\r\n      });\r\n    }\r\n    this.updateMultiSelectButton();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_price', RSPrice as unknown as ComponentConstructor);\r\n\r\nexport { RSPrice };\r\nexport default RSPrice;\r\n","/**\r\n * RealtySoft Widget v3 - Built Area Component\r\n * Variations: 1=Min/Max inputs, 2=Range slider\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSBuiltArea extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private minValue: number | null = null;\r\n  private maxValue: number | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('builtMin') || this.isLocked('builtMax');\r\n    this.minValue = this.getFilter<number | null>('builtMin');\r\n    this.maxValue = this.getFilter<number | null>('builtMax');\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<number | null>('filters.builtMin', (value) => {\r\n      this.minValue = value;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    this.subscribe<number | null>('filters.builtMax', (value) => {\r\n      this.maxValue = value;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-built-area', `rs-built-area--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderSlider();\r\n        break;\r\n      default:\r\n        this.renderInputs();\r\n    }\r\n  }\r\n\r\n  private renderInputs(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-built-area__wrapper\">\r\n        <label class=\"rs-built-area__label\">${this.label('search_built_area')}</label>\r\n        <div class=\"rs-built-area__inputs\">\r\n          <div class=\"rs-built-area__input-group\">\r\n            <input type=\"number\"\r\n                   class=\"rs-built-area__input rs-built-area__input--min\"\r\n                   placeholder=\"${this.label('search_min')}\"\r\n                   value=\"${this.minValue || ''}\"\r\n                   min=\"0\"\r\n                   step=\"10\">\r\n            <span class=\"rs-built-area__unit\">mÂ²</span>\r\n          </div>\r\n          <span class=\"rs-built-area__separator\">-</span>\r\n          <div class=\"rs-built-area__input-group\">\r\n            <input type=\"number\"\r\n                   class=\"rs-built-area__input rs-built-area__input--max\"\r\n                   placeholder=\"${this.label('search_max')}\"\r\n                   value=\"${this.maxValue || ''}\"\r\n                   min=\"0\"\r\n                   step=\"10\">\r\n            <span class=\"rs-built-area__unit\">mÂ²</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderSlider(): void {\r\n    const minVal = this.minValue || 0;\r\n    const maxVal = this.maxValue || 1000;\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-built-area__wrapper\">\r\n        <label class=\"rs-built-area__label\">${this.label('search_built_area')}</label>\r\n        <div class=\"rs-built-area__slider-wrapper\">\r\n          <div class=\"rs-built-area__slider-values\">\r\n            <span class=\"rs-built-area__slider-min\">${minVal} mÂ²</span>\r\n            <span class=\"rs-built-area__slider-max\">${maxVal >= 1000 ? '1000+ mÂ²' : maxVal + ' mÂ²'}</span>\r\n          </div>\r\n          <div class=\"rs-built-area__slider-track\">\r\n            <input type=\"range\" class=\"rs-built-area__slider rs-built-area__slider--min\"\r\n                   min=\"0\" max=\"1000\" step=\"10\" value=\"${minVal}\">\r\n            <input type=\"range\" class=\"rs-built-area__slider rs-built-area__slider--max\"\r\n                   min=\"0\" max=\"1000\" step=\"10\" value=\"${maxVal}\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Input fields\r\n    const minInput = this.element.querySelector<HTMLInputElement>('.rs-built-area__input--min');\r\n    const maxInput = this.element.querySelector<HTMLInputElement>('.rs-built-area__input--max');\r\n\r\n    if (minInput) {\r\n      minInput.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.setFilter('builtMin', value);\r\n      });\r\n    }\r\n\r\n    if (maxInput) {\r\n      maxInput.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.setFilter('builtMax', value);\r\n      });\r\n    }\r\n\r\n    // Sliders\r\n    const minSlider = this.element.querySelector<HTMLInputElement>('.rs-built-area__slider--min');\r\n    const maxSlider = this.element.querySelector<HTMLInputElement>('.rs-built-area__slider--max');\r\n\r\n    if (minSlider) {\r\n      minSlider.addEventListener('input', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        let value = parseInt(target.value);\r\n        if (maxSlider && value > parseInt(maxSlider.value)) {\r\n          value = parseInt(maxSlider.value);\r\n          target.value = String(value);\r\n        }\r\n        this.setFilter('builtMin', value || null);\r\n        this.updateSliderDisplay();\r\n      });\r\n    }\r\n\r\n    if (maxSlider) {\r\n      maxSlider.addEventListener('input', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        let value = parseInt(target.value);\r\n        if (minSlider && value < parseInt(minSlider.value)) {\r\n          value = parseInt(minSlider.value);\r\n          target.value = String(value);\r\n        }\r\n        this.setFilter('builtMax', value >= 1000 ? null : value);\r\n        this.updateSliderDisplay();\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Update inputs\r\n    const minInput = this.element.querySelector<HTMLInputElement>('.rs-built-area__input--min');\r\n    const maxInput = this.element.querySelector<HTMLInputElement>('.rs-built-area__input--max');\r\n\r\n    if (minInput) minInput.value = this.minValue?.toString() || '';\r\n    if (maxInput) maxInput.value = this.maxValue?.toString() || '';\r\n\r\n    // Update sliders\r\n    this.updateSliderDisplay();\r\n  }\r\n\r\n  private updateSliderDisplay(): void {\r\n    const minLabel = this.element.querySelector('.rs-built-area__slider-min');\r\n    const maxLabel = this.element.querySelector('.rs-built-area__slider-max');\r\n    const minSlider = this.element.querySelector<HTMLInputElement>('.rs-built-area__slider--min');\r\n    const maxSlider = this.element.querySelector<HTMLInputElement>('.rs-built-area__slider--max');\r\n\r\n    if (minLabel && minSlider) {\r\n      minLabel.textContent = `${minSlider.value} mÂ²`;\r\n    }\r\n\r\n    if (maxLabel && maxSlider) {\r\n      const val = parseInt(maxSlider.value);\r\n      maxLabel.textContent = val >= 1000 ? '1000+ mÂ²' : `${val} mÂ²`;\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_built_area', RSBuiltArea as unknown as ComponentConstructor);\r\n\r\nexport { RSBuiltArea };\r\nexport default RSBuiltArea;\r\n","/**\r\n * RealtySoft Widget v3 - Plot Size Component\r\n * Variations: 1=Min/Max inputs, 2=Range slider\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSPlotSize extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private minValue: number | null = null;\r\n  private maxValue: number | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('plotMin') || this.isLocked('plotMax');\r\n    this.minValue = this.getFilter<number | null>('plotMin');\r\n    this.maxValue = this.getFilter<number | null>('plotMax');\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<number | null>('filters.plotMin', (value) => {\r\n      this.minValue = value;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    this.subscribe<number | null>('filters.plotMax', (value) => {\r\n      this.maxValue = value;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-plot-size', `rs-plot-size--v${this.variation}`);\r\n\r\n    switch (this.variation) {\r\n      case '2':\r\n        this.renderSlider();\r\n        break;\r\n      default:\r\n        this.renderInputs();\r\n    }\r\n  }\r\n\r\n  private renderInputs(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-plot-size__wrapper\">\r\n        <label class=\"rs-plot-size__label\">${this.label('search_plot_size')}</label>\r\n        <div class=\"rs-plot-size__inputs\">\r\n          <div class=\"rs-plot-size__input-group\">\r\n            <input type=\"number\"\r\n                   class=\"rs-plot-size__input rs-plot-size__input--min\"\r\n                   placeholder=\"${this.label('search_min')}\"\r\n                   value=\"${this.minValue || ''}\"\r\n                   min=\"0\"\r\n                   step=\"100\">\r\n            <span class=\"rs-plot-size__unit\">mÂ²</span>\r\n          </div>\r\n          <span class=\"rs-plot-size__separator\">-</span>\r\n          <div class=\"rs-plot-size__input-group\">\r\n            <input type=\"number\"\r\n                   class=\"rs-plot-size__input rs-plot-size__input--max\"\r\n                   placeholder=\"${this.label('search_max')}\"\r\n                   value=\"${this.maxValue || ''}\"\r\n                   min=\"0\"\r\n                   step=\"100\">\r\n            <span class=\"rs-plot-size__unit\">mÂ²</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderSlider(): void {\r\n    const minVal = this.minValue || 0;\r\n    const maxVal = this.maxValue || 10000;\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-plot-size__wrapper\">\r\n        <label class=\"rs-plot-size__label\">${this.label('search_plot_size')}</label>\r\n        <div class=\"rs-plot-size__slider-wrapper\">\r\n          <div class=\"rs-plot-size__slider-values\">\r\n            <span class=\"rs-plot-size__slider-min\">${this.formatArea(minVal)}</span>\r\n            <span class=\"rs-plot-size__slider-max\">${maxVal >= 10000 ? '10,000+ mÂ²' : this.formatArea(maxVal)}</span>\r\n          </div>\r\n          <div class=\"rs-plot-size__slider-track\">\r\n            <input type=\"range\" class=\"rs-plot-size__slider rs-plot-size__slider--min\"\r\n                   min=\"0\" max=\"10000\" step=\"100\" value=\"${minVal}\">\r\n            <input type=\"range\" class=\"rs-plot-size__slider rs-plot-size__slider--max\"\r\n                   min=\"0\" max=\"10000\" step=\"100\" value=\"${maxVal}\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Input fields\r\n    const minInput = this.element.querySelector<HTMLInputElement>('.rs-plot-size__input--min');\r\n    const maxInput = this.element.querySelector<HTMLInputElement>('.rs-plot-size__input--max');\r\n\r\n    if (minInput) {\r\n      minInput.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.setFilter('plotMin', value);\r\n      });\r\n    }\r\n\r\n    if (maxInput) {\r\n      maxInput.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = target.value ? parseInt(target.value) : null;\r\n        this.setFilter('plotMax', value);\r\n      });\r\n    }\r\n\r\n    // Sliders\r\n    const minSlider = this.element.querySelector<HTMLInputElement>('.rs-plot-size__slider--min');\r\n    const maxSlider = this.element.querySelector<HTMLInputElement>('.rs-plot-size__slider--max');\r\n\r\n    if (minSlider) {\r\n      minSlider.addEventListener('input', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        let value = parseInt(target.value);\r\n        if (maxSlider && value > parseInt(maxSlider.value)) {\r\n          value = parseInt(maxSlider.value);\r\n          target.value = String(value);\r\n        }\r\n        this.setFilter('plotMin', value || null);\r\n        this.updateSliderDisplay();\r\n      });\r\n    }\r\n\r\n    if (maxSlider) {\r\n      maxSlider.addEventListener('input', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        let value = parseInt(target.value);\r\n        if (minSlider && value < parseInt(minSlider.value)) {\r\n          value = parseInt(minSlider.value);\r\n          target.value = String(value);\r\n        }\r\n        this.setFilter('plotMax', value >= 10000 ? null : value);\r\n        this.updateSliderDisplay();\r\n      });\r\n    }\r\n  }\r\n\r\n  private formatArea(value: number): string {\r\n    if (!value) return '0 mÂ²';\r\n    return `${value.toLocaleString()} mÂ²`;\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    // Update inputs\r\n    const minInput = this.element.querySelector<HTMLInputElement>('.rs-plot-size__input--min');\r\n    const maxInput = this.element.querySelector<HTMLInputElement>('.rs-plot-size__input--max');\r\n\r\n    if (minInput) minInput.value = this.minValue?.toString() || '';\r\n    if (maxInput) maxInput.value = this.maxValue?.toString() || '';\r\n\r\n    // Update sliders\r\n    this.updateSliderDisplay();\r\n  }\r\n\r\n  private updateSliderDisplay(): void {\r\n    const minLabel = this.element.querySelector('.rs-plot-size__slider-min');\r\n    const maxLabel = this.element.querySelector('.rs-plot-size__slider-max');\r\n    const minSlider = this.element.querySelector<HTMLInputElement>('.rs-plot-size__slider--min');\r\n    const maxSlider = this.element.querySelector<HTMLInputElement>('.rs-plot-size__slider--max');\r\n\r\n    if (minLabel && minSlider) {\r\n      minLabel.textContent = this.formatArea(parseInt(minSlider.value));\r\n    }\r\n\r\n    if (maxLabel && maxSlider) {\r\n      const val = parseInt(maxSlider.value);\r\n      maxLabel.textContent = val >= 10000 ? '10,000+ mÂ²' : this.formatArea(val);\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_plot_size', RSPlotSize as unknown as ComponentConstructor);\r\n\r\nexport { RSPlotSize };\r\nexport default RSPlotSize;\r\n","/**\r\n * RealtySoft Widget v3 - Features Component\r\n * Popup with categories, checkboxes, and search filter\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  Feature,\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\n\r\ninterface FeatureCategory {\r\n  id: number;\r\n  name: string;\r\n  value_ids?: { id: number; name: string }[];\r\n}\r\n\r\ninterface MappedCategory {\r\n  id: number;\r\n  name: string;\r\n  children: { id: number; name: string }[];\r\n}\r\n\r\nclass RSFeatures extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private features: FeatureCategory[] = [];\r\n  private selectedFeatures: Set<number> = new Set();\r\n  private isOpen: boolean = false;\r\n  private searchTerm: string = '';\r\n  private expandedCategories: Set<string> = new Set();\r\n  private isLoadingFeatures: boolean = false;\r\n  private overlay: HTMLElement | null = null;\r\n  private trigger: HTMLButtonElement | null = null;\r\n  private triggerText: HTMLElement | null = null;\r\n  private modal: HTMLElement | null = null;\r\n  private searchInput: HTMLInputElement | null = null;\r\n  private categoriesContainer: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('features');\r\n    this.features = RealtySoftState.get<FeatureCategory[]>('data.features') || [];\r\n    this.selectedFeatures = new Set(this.getFilter<number[]>('features') || []);\r\n    this.isOpen = false;\r\n    this.searchTerm = '';\r\n    this.expandedCategories = new Set();\r\n    this.isLoadingFeatures = false;\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<FeatureCategory[]>('data.features', (features) => {\r\n      this.features = features;\r\n      this.updateCategoryList();\r\n    });\r\n\r\n    this.subscribe<number[]>('filters.features', (value) => {\r\n      this.selectedFeatures = new Set(value || []);\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load features on demand (when user clicks button)\r\n   * Only loads if not already loaded, caches in localStorage via API\r\n   */\r\n  private async loadFeaturesOnDemand(): Promise<void> {\r\n    // Already loaded or currently loading\r\n    if (RealtySoftState.get<boolean>('data.featuresLoaded') || this.isLoadingFeatures) {\r\n      return;\r\n    }\r\n\r\n    this.isLoadingFeatures = true;\r\n    console.log('[RealtySoft] Loading features on demand...');\r\n\r\n    try {\r\n      const result = await RealtySoftAPI.getFeatures();\r\n      RealtySoftState.set('data.features', result.data || []);\r\n      RealtySoftState.set('data.featuresLoaded', true);\r\n      this.features = (result.data || []) as FeatureCategory[];\r\n      console.log('[RealtySoft] Features loaded on demand:', this.features.length);\r\n    } catch (e) {\r\n      console.error('[RealtySoft] Failed to load features:', e);\r\n    } finally {\r\n      this.isLoadingFeatures = false;\r\n    }\r\n  }\r\n\r\n  // Build parent-child map from API structure\r\n  // API returns: [{id, name, value_ids: [{id, name}, ...]}, ...]\r\n  private buildFeatureMap(): MappedCategory[] {\r\n    return this.features\r\n      .filter(category => category.value_ids && category.value_ids.length > 0)\r\n      .map(category => ({\r\n        id: category.id,\r\n        name: category.name,\r\n        children: (category.value_ids || []).sort((a, b) =>\r\n          (a.name || '').localeCompare(b.name || '')\r\n        )\r\n      }))\r\n      .sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n  }\r\n\r\n  // Filter features by search term\r\n  private getFilteredFeatureMap(): MappedCategory[] {\r\n    const allCategories = this.buildFeatureMap();\r\n\r\n    if (!this.searchTerm) {\r\n      return allCategories;\r\n    }\r\n\r\n    const searchLower = this.searchTerm.toLowerCase();\r\n    const filtered: MappedCategory[] = [];\r\n\r\n    allCategories.forEach(category => {\r\n      // Check if category name matches\r\n      const categoryMatches = (category.name || '').toLowerCase().includes(searchLower);\r\n\r\n      // Filter children that match\r\n      const matchingChildren = category.children.filter(child =>\r\n        (child.name || '').toLowerCase().includes(searchLower)\r\n      );\r\n\r\n      // Include category if it matches or has matching children\r\n      if (categoryMatches || matchingChildren.length > 0) {\r\n        filtered.push({\r\n          ...category,\r\n          children: categoryMatches ? category.children : matchingChildren\r\n        });\r\n      }\r\n    });\r\n\r\n    return filtered;\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-features');\r\n\r\n    const count = this.selectedFeatures.size;\r\n    const buttonText = count > 0 ? (count + ' feature' + (count > 1 ? 's' : '') + ' selected') : this.label('search_features_placeholder') || 'Select Features';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-features__wrapper\">\r\n        <label class=\"rs-features__label\">${this.label('search_features')}</label>\r\n        <button type=\"button\" class=\"rs-features__trigger\">\r\n          <span class=\"rs-features__trigger-text\">${buttonText}</span>\r\n          <span class=\"rs-features__trigger-arrow\">â–¼</span>\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Create modal popup (appended to body for proper positioning)\r\n    this.overlay = document.createElement('div');\r\n    this.overlay.className = 'rs-features__overlay';\r\n    this.overlay.style.display = 'none';\r\n    this.overlay.innerHTML = `\r\n      <div class=\"rs-features__modal\">\r\n        <div class=\"rs-features__modal-header\">\r\n          <h3 class=\"rs-features__modal-title\">${this.label('search_features')}</h3>\r\n          <button type=\"button\" class=\"rs-features__modal-close\">&times;</button>\r\n        </div>\r\n        <div class=\"rs-features__modal-search\">\r\n          <input type=\"text\"\r\n                 class=\"rs-features__search\"\r\n                 placeholder=\"${this.label('search_features_filter') || 'Search features...'}\"\r\n                 autocomplete=\"off\">\r\n        </div>\r\n        <div class=\"rs-features__modal-body\">\r\n          <div class=\"rs-features__categories\"></div>\r\n        </div>\r\n        <div class=\"rs-features__modal-footer\">\r\n          <button type=\"button\" class=\"rs-features__clear-btn\">${this.label('general_clear') || 'Clear'}</button>\r\n          <button type=\"button\" class=\"rs-features__done-btn\">${this.label('general_close') || 'Done'}</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    document.body.appendChild(this.overlay);\r\n\r\n    this.trigger = this.element.querySelector('.rs-features__trigger');\r\n    this.triggerText = this.element.querySelector('.rs-features__trigger-text');\r\n    this.modal = this.overlay.querySelector('.rs-features__modal');\r\n    this.searchInput = this.overlay.querySelector('.rs-features__search');\r\n    this.categoriesContainer = this.overlay.querySelector('.rs-features__categories');\r\n\r\n    this.updateCategoryList();\r\n  }\r\n\r\n  private updateCategoryList(): void {\r\n    if (!this.categoriesContainer) return;\r\n\r\n    const categories = this.getFilteredFeatureMap();\r\n\r\n    if (categories.length === 0) {\r\n      this.categoriesContainer.innerHTML = `\r\n        <div class=\"rs-features__empty\">No features found</div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    let html = '';\r\n\r\n    categories.forEach(category => {\r\n      const categoryKey = category.id.toString();\r\n      const isExpanded = this.expandedCategories.has(categoryKey) || !!this.searchTerm;\r\n      const selectedInCategory = category.children.filter(f => this.selectedFeatures.has(f.id)).length;\r\n\r\n      html += `\r\n        <div class=\"rs-features__category ${isExpanded ? 'rs-features__category--expanded' : ''}\">\r\n          <div class=\"rs-features__category-header\" data-category=\"${categoryKey}\">\r\n            <span class=\"rs-features__category-toggle\">${isExpanded ? 'âˆ’' : '+'}</span>\r\n            <span class=\"rs-features__category-name\">${this.escapeHtml(category.name)}</span>\r\n            ${selectedInCategory > 0 ? `<span class=\"rs-features__category-count\">${selectedInCategory}</span>` : ''}\r\n          </div>\r\n          <div class=\"rs-features__category-items\" style=\"display: ${isExpanded ? 'block' : 'none'}\">\r\n      `;\r\n\r\n      category.children.forEach(feature => {\r\n        const isSelected = this.selectedFeatures.has(feature.id);\r\n        html += `\r\n          <label class=\"rs-features__item\">\r\n            <input type=\"checkbox\"\r\n                   class=\"rs-features__checkbox\"\r\n                   value=\"${feature.id}\"\r\n                   ${isSelected ? 'checked' : ''}>\r\n            <span class=\"rs-features__item-name\">${this.escapeHtml(feature.name)}</span>\r\n          </label>\r\n        `;\r\n      });\r\n\r\n      html += `\r\n          </div>\r\n        </div>\r\n      `;\r\n    });\r\n\r\n    this.categoriesContainer.innerHTML = html;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Open modal\r\n    if (this.trigger) {\r\n      this.trigger.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        this.showModal();\r\n      });\r\n    }\r\n\r\n    // Search input\r\n    if (this.searchInput) {\r\n      this.searchInput.addEventListener('input', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        this.searchTerm = target.value.trim();\r\n        this.updateCategoryList();\r\n      });\r\n    }\r\n\r\n    // Category toggle\r\n    if (this.categoriesContainer) {\r\n      this.categoriesContainer.addEventListener('click', (e: Event) => {\r\n        const target = e.target as HTMLElement;\r\n        const header = target.closest('.rs-features__category-header') as HTMLElement | null;\r\n        if (header) {\r\n          const category = header.dataset.category;\r\n          if (category) {\r\n            this.toggleCategory(category);\r\n          }\r\n        }\r\n      });\r\n\r\n      // Checkbox change\r\n      this.categoriesContainer.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target.classList.contains('rs-features__checkbox')) {\r\n          const featureId = parseInt(target.value);\r\n          if (target.checked) {\r\n            this.selectedFeatures.add(featureId);\r\n          } else {\r\n            this.selectedFeatures.delete(featureId);\r\n          }\r\n          this.updateFilters();\r\n          this.updateTriggerText();\r\n          this.updateCategoryList();\r\n        }\r\n      });\r\n    }\r\n\r\n    if (this.overlay) {\r\n      // Clear button\r\n      const clearBtn = this.overlay.querySelector('.rs-features__clear-btn');\r\n      if (clearBtn) {\r\n        clearBtn.addEventListener('click', () => {\r\n          this.clearAll();\r\n        });\r\n      }\r\n\r\n      // Done/Close button\r\n      const doneBtn = this.overlay.querySelector('.rs-features__done-btn');\r\n      if (doneBtn) {\r\n        doneBtn.addEventListener('click', () => {\r\n          this.hideModal();\r\n        });\r\n      }\r\n\r\n      // X close button\r\n      const closeBtn = this.overlay.querySelector('.rs-features__modal-close');\r\n      if (closeBtn) {\r\n        closeBtn.addEventListener('click', () => {\r\n          this.hideModal();\r\n        });\r\n      }\r\n\r\n      // Close on overlay click (not modal itself)\r\n      this.overlay.addEventListener('click', (e: Event) => {\r\n        if (e.target === this.overlay) {\r\n          this.hideModal();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Close on Escape key\r\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && this.isOpen) {\r\n        this.hideModal();\r\n      }\r\n    });\r\n  }\r\n\r\n  private toggleCategory(category: string): void {\r\n    const header = this.categoriesContainer?.querySelector(`.rs-features__category-header[data-category=\"${category}\"]`);\r\n    if (!header) return;\r\n\r\n    const categoryEl = header.parentElement;\r\n    if (!categoryEl) return;\r\n\r\n    const itemsEl = categoryEl.querySelector('.rs-features__category-items') as HTMLElement | null;\r\n    const toggleEl = categoryEl.querySelector('.rs-features__category-toggle');\r\n\r\n    if (!itemsEl || !toggleEl) return;\r\n\r\n    if (this.expandedCategories.has(category)) {\r\n      this.expandedCategories.delete(category);\r\n      categoryEl.classList.remove('rs-features__category--expanded');\r\n      itemsEl.style.display = 'none';\r\n      toggleEl.textContent = '+';\r\n    } else {\r\n      this.expandedCategories.add(category);\r\n      categoryEl.classList.add('rs-features__category--expanded');\r\n      itemsEl.style.display = 'block';\r\n      toggleEl.textContent = 'âˆ’';\r\n    }\r\n  }\r\n\r\n  private async showModal(): Promise<void> {\r\n    this.isOpen = true;\r\n    if (this.overlay) {\r\n      this.overlay.style.display = 'flex';\r\n    }\r\n    document.body.style.overflow = 'hidden'; // Prevent background scroll\r\n\r\n    // Load features on demand if not loaded yet\r\n    if (!RealtySoftState.get<boolean>('data.featuresLoaded')) {\r\n      if (this.categoriesContainer) {\r\n        this.categoriesContainer.innerHTML = '<div class=\"rs-features__loading\">Loading features...</div>';\r\n      }\r\n      await this.loadFeaturesOnDemand();\r\n      this.updateCategoryList();\r\n    }\r\n\r\n    if (this.searchInput) {\r\n      this.searchInput.focus();\r\n    }\r\n  }\r\n\r\n  private hideModal(): void {\r\n    this.isOpen = false;\r\n    if (this.overlay) {\r\n      this.overlay.style.display = 'none';\r\n    }\r\n    document.body.style.overflow = ''; // Restore scroll\r\n    this.searchTerm = '';\r\n    if (this.searchInput) {\r\n      this.searchInput.value = '';\r\n    }\r\n    this.updateCategoryList();\r\n  }\r\n\r\n  private updateFilters(): void {\r\n    const selectedArray = Array.from(this.selectedFeatures);\r\n    this.setFilter('features', selectedArray.length > 0 ? selectedArray : []);\r\n  }\r\n\r\n  private updateTriggerText(): void {\r\n    if (!this.triggerText) return;\r\n    const count = this.selectedFeatures.size;\r\n    this.triggerText.textContent = count > 0\r\n      ? (count + ' feature' + (count > 1 ? 's' : '') + ' selected')\r\n      : this.label('search_features_placeholder') || 'Select Features';\r\n  }\r\n\r\n  private clearAll(): void {\r\n    this.selectedFeatures.clear();\r\n    this.updateFilters();\r\n    this.updateTriggerText();\r\n    this.updateCategoryList();\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    this.updateTriggerText();\r\n    this.updateCategoryList();\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_features', RSFeatures as unknown as ComponentConstructor);\r\n\r\nexport { RSFeatures };\r\nexport default RSFeatures;\r\n","/**\r\n * RealtySoft Widget v3 - Reference Component\r\n * Single text input for property reference search\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSReference extends RSBaseComponent {\r\n  private lockedMode: boolean = false;\r\n  private value: string = '';\r\n  private input: HTMLInputElement | null = null;\r\n  private clearBtn: HTMLButtonElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.lockedMode = this.isLocked('ref');\r\n    this.value = this.getFilter<string>('ref') || '';\r\n\r\n    this.render();\r\n\r\n    // Apply locked styles if locked (but still show the component)\r\n    if (this.lockedMode) {\r\n      this.applyLockedStyle();\r\n    } else {\r\n      this.bindEvents();\r\n    }\r\n\r\n    this.subscribe<string>('filters.ref', (value) => {\r\n      this.value = value || '';\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-reference');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-reference__wrapper\">\r\n        <label class=\"rs-reference__label\">${this.label('search_reference')}</label>\r\n        <div class=\"rs-reference__input-wrapper\">\r\n          <input type=\"text\"\r\n                 class=\"rs-reference__input\"\r\n                 placeholder=\"${this.label('search_reference')}\"\r\n                 value=\"${this.value}\"\r\n                 autocomplete=\"off\">\r\n          ${this.value ? '<button class=\"rs-reference__clear\" type=\"button\">&times;</button>' : ''}\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.input = this.element.querySelector('.rs-reference__input');\r\n    this.clearBtn = this.element.querySelector('.rs-reference__clear');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    let debounceTimer: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    if (this.input) {\r\n      this.input.addEventListener('input', (e: Event) => {\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n          const target = e.target as HTMLInputElement;\r\n          this.setFilter('ref', target.value.trim() || '');\r\n          this.updateClearButton();\r\n        }, 300);\r\n      });\r\n\r\n      this.input.addEventListener('keydown', (e: KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n          e.preventDefault();\r\n          this.setFilter('ref', this.input!.value.trim() || '');\r\n          RealtySoft.search();\r\n        }\r\n      });\r\n    }\r\n\r\n    if (this.clearBtn) {\r\n      this.clearBtn.addEventListener('click', () => {\r\n        if (this.input) {\r\n          this.input.value = '';\r\n        }\r\n        this.setFilter('ref', '');\r\n        this.updateClearButton();\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.input) {\r\n      this.input.value = this.value;\r\n    }\r\n    this.updateClearButton();\r\n  }\r\n\r\n  private updateClearButton(): void {\r\n    let clearBtn = this.element.querySelector<HTMLButtonElement>('.rs-reference__clear');\r\n    const hasValue = this.input && this.input.value.trim();\r\n\r\n    if (hasValue && !clearBtn) {\r\n      clearBtn = document.createElement('button');\r\n      clearBtn.className = 'rs-reference__clear';\r\n      clearBtn.type = 'button';\r\n      clearBtn.innerHTML = '&times;';\r\n      clearBtn.addEventListener('click', () => {\r\n        if (this.input) {\r\n          this.input.value = '';\r\n        }\r\n        this.setFilter('ref', '');\r\n        this.updateClearButton();\r\n      });\r\n      const wrapper = this.element.querySelector('.rs-reference__input-wrapper');\r\n      if (wrapper) {\r\n        wrapper.appendChild(clearBtn);\r\n      }\r\n    } else if (!hasValue && clearBtn) {\r\n      clearBtn.remove();\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_ref', RSReference as unknown as ComponentConstructor);\r\n\r\nexport { RSReference };\r\nexport default RSReference;\r\n","/**\r\n * RealtySoft Widget v3 - Search Button Component\r\n * Shows instant property count based on current filters\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  FilterState,\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\n\r\nclass RSSearchButton extends RSBaseComponent {\r\n  private isLoading: boolean = false;\r\n  private propertyCount: number | null = null;\r\n  private countDebounce: ReturnType<typeof setTimeout> | null = null;\r\n  private button: HTMLButtonElement | null = null;\r\n  private text: HTMLElement | null = null;\r\n  private countEl: HTMLElement | null = null;\r\n  private loader: HTMLElement | null = null;\r\n  private icon: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isLoading = false;\r\n    this.propertyCount = null;\r\n    this.countDebounce = null;\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Subscribe to loading state\r\n    this.subscribe<boolean>('ui.loading', (loading) => {\r\n      this.isLoading = loading;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // Subscribe to filter changes to update count\r\n    this.subscribe<FilterState>('filters', (filters, oldValue, path) => {\r\n      console.log('[RealtySoft] Search button: filters changed', { path, filters });\r\n      this.fetchCount();\r\n    });\r\n\r\n    // Initial count fetch\r\n    this.fetchCount();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-search-button');\r\n\r\n    this.element.innerHTML = `\r\n      <button type=\"button\" class=\"rs-search-button__btn\">\r\n        <span class=\"rs-search-button__text\">${this.label('search_button')}</span>\r\n        <span class=\"rs-search-button__count\"></span>\r\n        <span class=\"rs-search-button__loader\" style=\"display: none;\">\r\n          <svg class=\"rs-search-button__spinner\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-dasharray=\"31.4 31.4\">\r\n              <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 12 12\" to=\"360 12 12\" dur=\"1s\" repeatCount=\"indefinite\"/>\r\n            </circle>\r\n          </svg>\r\n        </span>\r\n        <span class=\"rs-search-button__icon\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\r\n            <path d=\"M21 21l-4.35-4.35\"></path>\r\n          </svg>\r\n        </span>\r\n      </button>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-search-button__btn');\r\n    this.text = this.element.querySelector('.rs-search-button__text');\r\n    this.countEl = this.element.querySelector('.rs-search-button__count');\r\n    this.loader = this.element.querySelector('.rs-search-button__loader');\r\n    this.icon = this.element.querySelector('.rs-search-button__icon');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.button) {\r\n      this.button.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        if (!this.isLoading) {\r\n          RealtySoft.search();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private async fetchCount(): Promise<void> {\r\n    // Debounce count fetching\r\n    if (this.countDebounce) {\r\n      clearTimeout(this.countDebounce);\r\n    }\r\n\r\n    this.countDebounce = setTimeout(async () => {\r\n      try {\r\n        const params = RealtySoftState.getSearchParams() as unknown as Record<string, unknown>;\r\n        params.limit = 1; // Only need count, not actual results\r\n        params.page = 1;\r\n        console.log('[RealtySoft] Search button: fetching count with params', JSON.stringify(params));\r\n        const result = await RealtySoftAPI.searchProperties(params);\r\n        console.log('[RealtySoft] Search button: API result', result);\r\n\r\n        // Handle different API response formats for total count\r\n        const resultAny = result as unknown as Record<string, unknown>;\r\n        this.propertyCount =\r\n          (result.total as number) ||\r\n          (resultAny.count as number) ||\r\n          (resultAny.total_count as number) ||\r\n          (resultAny.totalCount as number) ||\r\n          (resultAny.total_results as number) ||\r\n          (result.data ? result.data.length : 0) ||\r\n          0;\r\n        console.log('[RealtySoft] Search button: count =', this.propertyCount);\r\n        this.updateCountDisplay();\r\n      } catch (e) {\r\n        console.warn('Could not fetch property count:', e);\r\n        this.propertyCount = null;\r\n        this.updateCountDisplay();\r\n      }\r\n    }, 500); // 500ms debounce to match old widget\r\n  }\r\n\r\n  private updateCountDisplay(): void {\r\n    if (this.countEl && this.propertyCount !== null && !this.isLoading) {\r\n      this.countEl.textContent = '(' + this.propertyCount + ')';\r\n      this.countEl.style.display = 'inline';\r\n    } else if (this.countEl) {\r\n      this.countEl.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.isLoading) {\r\n      if (this.button) this.button.disabled = true;\r\n      if (this.button) this.button.classList.add('rs-search-button__btn--loading');\r\n      if (this.loader) this.loader.style.display = 'inline-block';\r\n      if (this.icon) this.icon.style.display = 'none';\r\n      if (this.countEl) this.countEl.style.display = 'none';\r\n      if (this.text) this.text.textContent = this.label('results_loading');\r\n    } else {\r\n      if (this.button) this.button.disabled = false;\r\n      if (this.button) this.button.classList.remove('rs-search-button__btn--loading');\r\n      if (this.loader) this.loader.style.display = 'none';\r\n      if (this.icon) this.icon.style.display = 'inline-block';\r\n      if (this.text) this.text.textContent = this.label('search_button');\r\n      this.updateCountDisplay();\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_search_button', RSSearchButton as unknown as ComponentConstructor);\r\n\r\nexport { RSSearchButton };\r\nexport default RSSearchButton;\r\n","/**\r\n * RealtySoft Widget v3 - Reset Button Component\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSResetButton extends RSBaseComponent {\r\n  private button: HTMLButtonElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-reset-button');\r\n\r\n    this.element.innerHTML = `\r\n      <button type=\"button\" class=\"rs-reset-button__btn\">\r\n        <span class=\"rs-reset-button__icon\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\"></path>\r\n            <path d=\"M3 3v5h5\"></path>\r\n          </svg>\r\n        </span>\r\n        <span class=\"rs-reset-button__text\">${this.label('search_reset')}</span>\r\n      </button>\r\n    `;\r\n\r\n    this.button = this.element.querySelector('.rs-reset-button__btn');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.button) {\r\n      this.button.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        RealtySoft.reset();\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_reset_button', RSResetButton as unknown as ComponentConstructor);\r\n\r\nexport { RSResetButton };\r\nexport default RSResetButton;\r\n","/**\n * RealtySoft Widget v3 - AI Search Toggle Component\n * Adds AI-powered natural language search (Premium feature)\n * Shows a star icon that transforms search into AI text input\n */\n\nimport { RSBaseComponent } from '../base';\nimport type {\n  ComponentOptions,\n  ComponentConstructor,\n  RealtySoftModule,\n  RealtySoftStateModule,\n  RealtySoftAPIModule,\n  Location,\n  PropertyType,\n  Feature,\n} from '../../types/index';\n\n// Declare globals\ndeclare const RealtySoft: RealtySoftModule;\ndeclare const RealtySoftState: RealtySoftStateModule;\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\n\n// Base URL for PHP endpoints\nconst PHP_BASE_URL = 'https://realtysoft.ai/propertymanager/php';\n\n// AI Search filter response from backend\ninterface AISearchFilters {\n  location?: number | null;\n  sublocation?: number | null;\n  propertyType?: number | null;\n  listingType?: string | null;\n  bedsMin?: number | null;\n  bathsMin?: number | null;\n  priceMin?: number | null;\n  priceMax?: number | null;\n  builtMin?: number | null;\n  builtMax?: number | null;\n  plotMin?: number | null;\n  plotMax?: number | null;\n  features?: number[];\n  ref?: string | null;\n}\n\ninterface AISearchResponse {\n  success: boolean;\n  filters?: AISearchFilters;\n  interpretation?: string;\n  error?: string;\n}\n\nclass RSAISearchToggle extends RSBaseComponent {\n  private isAIMode: boolean = false;\n  private isPremium: boolean = false;\n  private isLoading: boolean = false;\n  private searchContainer: HTMLElement | null = null;\n  private searchFormElements: HTMLElement[] = [];\n  private toggleBtn: HTMLButtonElement | null = null;\n  private aiModeEl: HTMLElement | null = null;\n  private textarea: HTMLTextAreaElement | null = null;\n  private searchBtn: HTMLButtonElement | null = null;\n  private errorEl: HTMLElement | null = null;\n  private closeBtn: HTMLButtonElement | null = null;\n\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\n    super(element, options);\n    this.init();\n  }\n\n  async init(): Promise<void> {\n    // Find parent search container\n    this.searchContainer = this.element.closest('#rs_search') ||\n                           this.element.closest('.rs-search') ||\n                           this.element.closest('[class*=\"rs-template-search\"]');\n\n    if (!this.searchContainer) {\n      // Try to find any search container on the page\n      this.searchContainer = document.getElementById('rs_search') ||\n                             document.querySelector('.rs-search') ||\n                             document.querySelector('[class*=\"rs-template-search\"]');\n    }\n\n    // Find ALL search form elements to hide (rows, grids, form containers)\n    if (this.searchContainer) {\n      const selectors = [\n        '.search-grid',\n        '[class*=\"__row\"]',\n        '.rs-search__form',\n        '[class*=\"search-01__\"]',\n        '[class*=\"search-02__\"]',\n        '[class*=\"search-03__\"]'\n      ];\n\n      selectors.forEach(selector => {\n        const elements = this.searchContainer!.querySelectorAll(selector);\n        elements.forEach(el => {\n          // Don't include AI mode elements\n          if (!el.classList.contains('rs-ai-mode') && !el.closest('.rs-ai-mode')) {\n            this.searchFormElements.push(el as HTMLElement);\n          }\n        });\n      });\n\n      // Also find direct children that are form-like\n      const directChildren = this.searchContainer.children;\n      for (let i = 0; i < directChildren.length; i++) {\n        const child = directChildren[i] as HTMLElement;\n        if (child.tagName !== 'BUTTON' &&\n            !child.classList.contains('rs-ai-toggle') &&\n            !child.classList.contains('rs-ai-mode') &&\n            !child.classList.contains('rs_ai_search_toggle')) {\n          if (!this.searchFormElements.includes(child)) {\n            this.searchFormElements.push(child);\n          }\n        }\n      }\n    }\n\n    // Check premium status\n    await this.checkPremiumStatus();\n\n    if (this.isPremium) {\n      this.render();\n      this.bindEvents();\n\n      // Subscribe to language changes to update labels\n      this.subscribe<string>('config.language', () => {\n        this.updateLabels();\n      });\n\n      // Subscribe to labels being loaded/reloaded (handles initial load and language switch)\n      this.subscribe<Record<string, string>>('labels', () => {\n        this.updateLabels();\n      });\n\n      // Also update labels after a short delay to catch late label loading\n      setTimeout(() => this.updateLabels(), 500);\n    }\n  }\n\n  /**\n   * Update labels when language changes\n   */\n  private updateLabels(): void {\n    if (!this.aiModeEl) return;\n\n    // Update title\n    const titleEl = this.aiModeEl.querySelector('.rs-ai-mode__title');\n    if (titleEl) {\n      const iconHtml = titleEl.querySelector('svg')?.outerHTML || '';\n      titleEl.innerHTML = iconHtml + ' ' + this.label('ai_search_title');\n    }\n\n    // Update back button\n    const backBtn = this.aiModeEl.querySelector('.rs-ai-mode__close');\n    if (backBtn) {\n      const iconHtml = backBtn.querySelector('svg')?.outerHTML || '';\n      backBtn.innerHTML = iconHtml + ' ' + this.label('ai_search_back');\n    }\n\n    // Update placeholder\n    if (this.textarea) {\n      this.textarea.placeholder = this.label('ai_search_placeholder');\n    }\n\n    // Update search button text\n    const searchTextEl = this.aiModeEl.querySelector('.rs-ai-mode__search-text');\n    if (searchTextEl) {\n      searchTextEl.textContent = this.label('ai_search_button');\n    }\n\n    // Update \"Try:\" label\n    const tryLabel = this.aiModeEl.querySelector('.rs-ai-mode__examples-label');\n    if (tryLabel) {\n      tryLabel.textContent = this.label('ai_search_try');\n    }\n\n    // Update example buttons\n    const exampleBtns = this.aiModeEl.querySelectorAll('.rs-ai-mode__examples button');\n    const examples = [\n      this.label('ai_search_example_1'),\n      this.label('ai_search_example_2'),\n      this.label('ai_search_example_3')\n    ];\n    exampleBtns.forEach((btn, idx) => {\n      if (examples[idx]) {\n        btn.textContent = examples[idx];\n        (btn as HTMLElement).dataset.query = examples[idx];\n      }\n    });\n  }\n\n  private async checkPremiumStatus(): Promise<void> {\n    try {\n      const response = await fetch(`${PHP_BASE_URL}/ai-search.php?action=check`);\n      const data = await response.json();\n      this.isPremium = data.enabled === true;\n    } catch (e) {\n      console.warn('[RealtySoft] Could not check AI search status:', e);\n      this.isPremium = false;\n    }\n  }\n\n  render(): void {\n    // Create and insert toggle button\n    this.toggleBtn = document.createElement('button');\n    this.toggleBtn.type = 'button';\n    this.toggleBtn.className = 'rs-ai-toggle';\n    this.toggleBtn.title = 'Search with AI';\n    // SVG icon for AI search\n    const sparkleIcon = `\n      <svg class=\"rs-ai-toggle__icon\" viewBox=\"0 0 79 68\" fill=\"currentColor\">\n        <path d=\"M0 0 C1.39456867 0.00574201 2.78910972 0.01875397 4.18359375 0.03515625 C6.15380493 0.05171265 6.15380493 0.05171265 8.16381836 0.06860352 C9.30471924 0.07819092 10.44562012 0.08777832 11.62109375 0.09765625 C16.0204053 10.84812967 20.11846381 21.6894537 24.05517578 32.6171875 C25.00839336 35.25671475 25.97293794 37.89194424 26.9375 40.52734375 C27.54887421 42.21980042 28.15957686 43.91249987 28.76953125 45.60546875 C29.05694183 46.3856839 29.34435242 47.16589905 29.64047241 47.96975708 C30.03185898 49.06778152 30.03185898 49.06778152 30.43115234 50.18798828 C30.66176361 50.82447296 30.89237488 51.46095764 31.12997437 52.11672974 C31.62109375 54.09765625 31.62109375 54.09765625 31.62109375 59.09765625 C26.01109375 59.09765625 20.40109375 59.09765625 14.62109375 59.09765625 C13.96109375 56.45765625 13.30109375 53.81765625 12.62109375 51.09765625 C7.01109375 51.09765625 1.40109375 51.09765625 -4.37890625 51.09765625 C-5.03890625 53.73765625 -5.69890625 56.37765625 -6.37890625 59.09765625 C-11.65890625 59.09765625 -16.93890625 59.09765625 -22.37890625 59.09765625 C-21.81659468 52.12447215 -19.88137695 46.00512717 -17.59765625 39.4140625 C-17.22411011 38.31795151 -16.85056396 37.22184052 -16.46569824 36.09251404 C-15.67916457 33.78935657 -14.88893464 31.48745843 -14.09521484 29.18676758 C-12.87543836 25.6501013 -11.66726017 22.10963452 -10.4609375 18.56835938 C-9.69468028 16.32919774 -8.92777617 14.09025734 -8.16015625 11.8515625 C-7.79660034 10.78813126 -7.43304443 9.72470001 -7.05847168 8.62904358 C-6.72142212 7.65390305 -6.38437256 6.67876251 -6.03710938 5.67407227 C-5.74034302 4.81217789 -5.44357666 3.95028351 -5.13781738 3.06227112 C-3.87417294 -0.20896126 -3.79732017 0.10974914 0 0 Z M3.62109375 23.09765625 C3.11351513 24.51162527 2.6153445 25.92897354 2.12109375 27.34765625 C1.84265625 28.1365625 1.56421875 28.92546875 1.27734375 29.73828125 C0.44244514 32.33178363 0.44244514 32.33178363 0.62109375 36.09765625 C2.93109375 36.09765625 5.24109375 36.09765625 7.62109375 36.09765625 C7.50599714 34.68015062 7.37855717 33.26364456 7.24609375 31.84765625 C7.14167969 30.66429687 7.14167969 30.66429687 7.03515625 29.45703125 C6.60602262 27.01177925 5.83508737 25.24928722 4.62109375 23.09765625 C4.29109375 23.09765625 3.96109375 23.09765625 3.62109375 23.09765625 Z \" transform=\"translate(24.37890625,3.90234375)\"/>\n        <path d=\"M0 0 C5.28 0 10.56 0 16 0 C15.67 13.2 15.34 26.4 15 40 C10.38 40 5.76 40 1 40 C0.67 26.8 0.34 13.6 0 0 Z \" transform=\"translate(59,23)\"/>\n        <path d=\"M0 0 C2.5 1.5 2.5 1.5 4 4 C4.57277908 6.96532504 4.39362078 8.90023635 4 12 C2.22917481 14.36110026 0.9703665 14.84291198 -1.90625 15.30859375 C-5.44869064 15.52669177 -7.44858906 15.34463183 -10.5 13.4375 C-12.58392818 10.05111671 -12.55802097 7.90614682 -12 4 C-9.10088554 -0.711061 -5.09331372 -1.00196335 0 0 Z \" transform=\"translate(71,6)\"/>\n      </svg>\n    `;\n\n    this.toggleBtn.innerHTML = sparkleIcon;\n\n    // Insert toggle button into search container\n    if (this.searchContainer) {\n      this.searchContainer.style.position = 'relative';\n      this.searchContainer.appendChild(this.toggleBtn);\n    }\n\n    // Get translated labels\n    const title = this.label('ai_search_title');\n    const back = this.label('ai_search_back');\n    const placeholder = this.label('ai_search_placeholder');\n    const tryLabel = this.label('ai_search_try');\n    const searchBtn = this.label('ai_search_button');\n    const example1 = this.label('ai_search_example_1');\n    const example2 = this.label('ai_search_example_2');\n    const example3 = this.label('ai_search_example_3');\n\n    // Create AI mode overlay\n    this.aiModeEl = document.createElement('div');\n    this.aiModeEl.className = 'rs-ai-mode';\n    this.aiModeEl.style.display = 'none';\n    this.aiModeEl.innerHTML = `\n      <div class=\"rs-ai-mode__header\">\n        <span class=\"rs-ai-mode__title\">\n          <svg class=\"rs-ai-mode__title-icon\" viewBox=\"0 0 512 512\" fill=\"currentColor\" width=\"24\" height=\"24\">\n            <path d=\"M207 116c3.125.375 3.125.375 6 1 .407 1.143.815 2.285 1.234 3.462 1.55 4.34 3.114 8.676 4.68 13.011.67 1.857 1.336 3.716 1.998 5.576 7.89 22.138 16.874 41.837 32.088 59.95.625.76 1.25 1.521 1.894 2.305 5.112 6.017 10.859 10.89 17.106 15.696.877.68 1.753 1.361 2.656 2.062 19.72 14.848 42.634 22.021 65.687 30.158.99.351 1.982.703 3.004 1.065 1.315.462 1.315.462 2.66.934 2 1 2 1 3 2 .041 2 .043 4 0 6-7.937 3.3-15.937 6.355-24.029 9.252-22.028 7.896-42.65 16.484-59.908 32.806-2.062 1.941-2.062 1.941-5.125 4.316-22.932 20.492-33.373 50.783-42.758 79.078-.26.757-.519 1.513-.786 2.292-.648 1.897-1.265 3.803-1.879 5.711-1.512 2.543-1.512 2.543-4.68 3.43-.934.037-1.869.074-2.832.113-2.888-4.34-4.5-8.83-6.187-13.719-.617-1.745-1.233-3.49-1.851-5.235-.48-1.36-.48-1.36-.968-2.748-7.493-21.132-15.167-41.117-30-58.297-.785-.911-1.57-1.823-2.379-2.762-2.167-2.454-4.38-4.853-6.621-7.239-.525-.589-1.05-1.178-1.59-1.785-17.1-18.406-41.271-27.711-64.286-35.875-.68-.248-1.361-.496-2.062-.752-3.408-1.241-6.819-2.474-10.235-3.695-1.258-.453-2.515-.907-3.773-1.36-1.679-.6-1.679-.6-3.391-1.21C71 288 71 288 69 286c-.187-2.375-.187-2.375 1-5 6.85-4.182 15.263-6.3 22.812-8.972 39.813-14.151 73.785-35.85 93.106-75.027 5.396-11.743 9.498-24.088 13.776-36.27.505-1.434.505-1.434 1.019-2.894.639-1.82 1.273-3.641 1.9-5.465.285-.814.57-1.628.863-2.467.378-1.094.378-1.094.763-2.199C205 148 205 148 207 116z\"/>\n            <path d=\"M369 32c1.65 0 3.3 0 5 0 .241.67.482 1.339.731 2.029 1.122 3.098 2.258 6.191 3.394 9.283.379 1.053.758 2.105 1.148 3.19 7.313 19.806 18.447 34.976 37.907 44.188 6.3 2.888 12.812 5.172 19.44 7.184C439.711 98.543 439.711 98.543 443 100c.976 2.176.976 2.176 1 4-5.122 2.371-10.282 4.499-15.565 6.48-12.4 4.679-21.887 10.166-31.435 21.52-.628.591-1.256 1.183-1.902 1.793-9.124 9.372-13.724 22.963-17.66 35.176-.262.772-.524 1.545-.79 2.341-.221.689-.442 1.378-.67 2.088-1 1.604-1 1.604-3.103 2.334-.939.133-.939.133-1.897.27-.71-1.687-1.418-3.375-2.125-5.063-.459-1.094-.918-2.188-1.39-3.316-1.254-3.059-2.448-6.133-3.627-9.223-8.078-20.927-20.123-34.186-40.527-43.463-4.998-2.135-10.129-3.947-15.292-5.65-.772-.267-1.545-.535-2.34-.81-.689-.223-1.378-.445-2.09-.687-1.603-1-1.603-1-2.603-4 2.948-2.423 5.656-3.77 9.254-5.016 1.03-.36 2.06-.722 3.124-1.093 1.067-.378 2.135-.755 3.234-1.143 8.531-3.114 16.281-6.047 23.438-12.75.778-.602 1.556-1.204 2.359-1.824C357.736 68.457 363.91 50.308 370 32z\"/>\n            <path d=\"M370 338c1.928.127 1.928.127 4 1 1.185 2.142 1.185 2.142 2.148 4.961.366 1.03.732 2.06 1.11 3.121.369 1.087.737 2.174 1.117 3.293 7.014 20.365 17.553 35.917 37 46.125 6.636 3.234 13.472 5.739 20.492 8.016.782.267 1.565.534 2.371.81.702.228 1.404.455 2.127.69C442 407 442 407 442.735 409.105c.088.625.175 1.251.265 1.895-6.147 2.603-12.3 5.125-18.562 7.438-19.377 7.46-33.31 19.545-41.97 38.61-3.25 7.489-5.882 15.213-8.468 22.952-1.65 0-3.3 0-5 0-.211-.604-.422-1.207-.64-1.829-9.045-25.749-18.186-45.286-43.82-57.671-5.315-2.264-10.747-4.206-16.21-6.06-1.184-.413-1.184-.413-2.392-.822-.71-.239-1.419-.478-2.149-.725-1.781-.888-1.781-.888-3.781-3.888 1.416-2.832 3.005-2.91 5.961-3.953 1.03-.373 2.06-.745 3.121-1.129 1.067-.372 2.134-.743 3.232-1.125 20.766-7.52 35.026-19.135 44.488-39.16 2.912-6.448 5.27-13.107 7.613-19.777C366 339 366 339 370 338z\"/>\n          </svg>\n          ${title}\n        </span>\n        <button type=\"button\" class=\"rs-ai-mode__close\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M19 12H5M12 19l-7-7 7-7\"/>\n          </svg>\n          ${back}\n        </button>\n      </div>\n      <div class=\"rs-ai-mode__input-wrapper\">\n        <textarea class=\"rs-ai-mode__input\"\n                  placeholder=\"${placeholder}\"\n                  rows=\"3\"></textarea>\n        <button type=\"button\" class=\"rs-ai-mode__search\">\n          <span class=\"rs-ai-mode__search-text\">${searchBtn}</span>\n          <span class=\"rs-ai-mode__loader\" style=\"display:none;\">\n            <svg class=\"rs-ai-mode__spinner\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-dasharray=\"31.4 31.4\">\n                <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 12 12\" to=\"360 12 12\" dur=\"1s\" repeatCount=\"indefinite\"/>\n              </circle>\n            </svg>\n          </span>\n        </button>\n      </div>\n      <div class=\"rs-ai-mode__examples\">\n        <span class=\"rs-ai-mode__examples-label\">${tryLabel}</span>\n        <button type=\"button\" data-query=\"${example1}\">${example1}</button>\n        <button type=\"button\" data-query=\"${example2}\">${example2}</button>\n        <button type=\"button\" data-query=\"${example3}\">${example3}</button>\n      </div>\n      <div class=\"rs-ai-mode__error\" style=\"display: none;\"></div>\n    `;\n\n    // Insert AI mode into search container\n    if (this.searchContainer) {\n      this.searchContainer.appendChild(this.aiModeEl);\n    }\n\n    // Cache DOM references\n    this.textarea = this.aiModeEl.querySelector('.rs-ai-mode__input');\n    this.searchBtn = this.aiModeEl.querySelector('.rs-ai-mode__search');\n    this.errorEl = this.aiModeEl.querySelector('.rs-ai-mode__error');\n    this.closeBtn = this.aiModeEl.querySelector('.rs-ai-mode__close');\n  }\n\n  bindEvents(): void {\n    // Toggle button click\n    this.toggleBtn?.addEventListener('click', () => this.toggleMode());\n\n    // Close button click\n    this.closeBtn?.addEventListener('click', () => this.toggleMode());\n\n    // Search button click\n    this.searchBtn?.addEventListener('click', () => this.search());\n\n    // Enter key in textarea (Shift+Enter for new line)\n    this.textarea?.addEventListener('keydown', (e: KeyboardEvent) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        this.search();\n      }\n    });\n\n    // Example buttons\n    const exampleBtns = this.aiModeEl?.querySelectorAll('.rs-ai-mode__examples button');\n    exampleBtns?.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const query = (btn as HTMLElement).dataset.query;\n        if (query && this.textarea) {\n          this.textarea.value = query;\n          this.textarea.focus();\n        }\n      });\n    });\n  }\n\n  private toggleMode(): void {\n    this.isAIMode = !this.isAIMode;\n\n    if (this.isAIMode) {\n      // Hide all search form elements\n      this.searchFormElements.forEach(el => {\n        el.style.display = 'none';\n      });\n      // Show AI mode\n      if (this.aiModeEl) {\n        this.aiModeEl.style.display = 'block';\n      }\n      this.toggleBtn?.classList.add('rs-ai-toggle--active');\n      this.textarea?.focus();\n      this.hideError();\n    } else {\n      // Show all search form elements\n      this.searchFormElements.forEach(el => {\n        el.style.display = '';\n      });\n      // Hide AI mode\n      if (this.aiModeEl) {\n        this.aiModeEl.style.display = 'none';\n      }\n      this.toggleBtn?.classList.remove('rs-ai-toggle--active');\n    }\n  }\n\n  private async search(): Promise<void> {\n    const query = this.textarea?.value.trim();\n    if (!query) {\n      this.showError(this.label('ai_search_empty'));\n      return;\n    }\n\n    this.setLoading(true);\n    this.hideError();\n\n    try {\n      // Gather context data from state\n      const language = RealtySoftState.get<string>('config.language') || 'en_US';\n      const locations = RealtySoftState.get<Location[]>('data.locations') || [];\n      const propertyTypes = RealtySoftState.get<PropertyType[]>('data.propertyTypes') || [];\n\n      // Load features on demand if not already loaded\n      let featuresRaw = RealtySoftState.get<Array<{id: number; name: string; value_ids?: Array<{id: number; name: string}>}>>('data.features') || [];\n      if (!featuresRaw || featuresRaw.length === 0) {\n        try {\n          const featuresResult = await RealtySoftAPI.getFeatures();\n          if (featuresResult.data) {\n            RealtySoftState.set('data.features', featuresResult.data);\n            featuresRaw = featuresResult.data as Array<{id: number; name: string; value_ids?: Array<{id: number; name: string}>}>;\n          }\n        } catch (e) {\n          console.warn('[RealtySoft] Could not load features for AI search:', e);\n        }\n      }\n\n      // Features are stored as categories with value_ids, flatten them\n      const features: Array<{id: number; name: string; category?: string}> = [];\n      featuresRaw.forEach(category => {\n        if (category.value_ids && Array.isArray(category.value_ids)) {\n          category.value_ids.forEach(feat => {\n            features.push({\n              id: feat.id,\n              name: feat.name,\n              category: category.name\n            });\n          });\n        }\n      });\n\n      const response = await fetch(`${PHP_BASE_URL}/ai-search.php`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          query,\n          language,\n          locations,\n          propertyTypes,\n          features\n        })\n      });\n\n      const result: AISearchResponse = await response.json();\n\n      if (result.success && result.filters) {\n        // Build URL params from filters\n        const params = this.buildURLParams(result.filters);\n\n        // Get results page URL from config\n        const resultsPage = RealtySoftState.get<string>('config.resultsPage') || '/properties/';\n\n        // Redirect to results page with filters\n        const queryString = params.toString();\n        window.location.href = queryString ? `${resultsPage}?${queryString}` : resultsPage;\n      } else {\n        this.showError(result.error || this.label('ai_search_error'));\n      }\n    } catch (e) {\n      console.error('[RealtySoft] AI search error:', e);\n      this.showError(this.label('ai_search_error'));\n    } finally {\n      this.setLoading(false);\n    }\n  }\n\n  private buildURLParams(filters: AISearchFilters): URLSearchParams {\n    const params = new URLSearchParams();\n\n    // Map AI response to URL params (matching parseURLFilters in controller.ts)\n    if (filters.location != null) params.set('location', String(filters.location));\n    if (filters.sublocation != null) params.set('sublocation', String(filters.sublocation));\n    if (filters.propertyType != null) params.set('type', String(filters.propertyType));\n    if (filters.listingType) params.set('listing', filters.listingType);\n    if (filters.bedsMin != null) params.set('beds', String(filters.bedsMin));\n    if (filters.bathsMin != null) params.set('baths', String(filters.bathsMin));\n    if (filters.priceMin != null) params.set('price_min', String(filters.priceMin));\n    if (filters.priceMax != null) params.set('price_max', String(filters.priceMax));\n    if (filters.builtMin != null) params.set('built_min', String(filters.builtMin));\n    if (filters.builtMax != null) params.set('built_max', String(filters.builtMax));\n    if (filters.plotMin != null) params.set('plot_min', String(filters.plotMin));\n    if (filters.plotMax != null) params.set('plot_max', String(filters.plotMax));\n    if (filters.ref) params.set('ref', filters.ref);\n    if (filters.features?.length) params.set('features', filters.features.join(','));\n\n    return params;\n  }\n\n  private setLoading(loading: boolean): void {\n    this.isLoading = loading;\n\n    if (this.searchBtn) {\n      this.searchBtn.disabled = loading;\n      const textEl = this.searchBtn.querySelector('.rs-ai-mode__search-text');\n      const loaderEl = this.searchBtn.querySelector('.rs-ai-mode__loader');\n\n      if (textEl) (textEl as HTMLElement).style.display = loading ? 'none' : 'inline';\n      if (loaderEl) (loaderEl as HTMLElement).style.display = loading ? 'inline-flex' : 'none';\n    }\n\n    if (this.textarea) {\n      this.textarea.disabled = loading;\n    }\n  }\n\n  private showError(message: string): void {\n    if (this.errorEl) {\n      this.errorEl.textContent = message;\n      this.errorEl.style.display = 'block';\n    }\n  }\n\n  private hideError(): void {\n    if (this.errorEl) {\n      this.errorEl.style.display = 'none';\n    }\n  }\n}\n\n// Register component\nRealtySoft.registerComponent('rs_ai_search_toggle', RSAISearchToggle as unknown as ComponentConstructor);\n\n/**\n * Auto-initialize AI Search on all search templates\n * This runs automatically when the module loads - no placeholder needed\n */\nasync function autoInitAISearch(): Promise<void> {\n  // Check if feature is enabled first (avoid unnecessary DOM queries)\n  try {\n    const response = await fetch(`${PHP_BASE_URL}/ai-search.php?action=check`);\n    const data = await response.json();\n    if (!data.enabled) {\n      return; // Feature not enabled, skip initialization\n    }\n  } catch (e) {\n    return; // Can't check, skip initialization\n  }\n\n  // Find all search containers that don't already have AI toggle\n  const searchContainers = document.querySelectorAll<HTMLElement>(\n    '#rs_search, .rs-search, [class*=\"rs-template-search\"]'\n  );\n\n  searchContainers.forEach((container) => {\n    // Skip duplicate containers (from page builder duplication)\n    if (container.dataset?.rsTemplateDuplicate) {\n      return;\n    }\n\n    // Skip if already has AI toggle\n    if (container.querySelector('.rs-ai-toggle')) {\n      return;\n    }\n\n    // Create a hidden placeholder element and initialize the component\n    const placeholder = document.createElement('div');\n    placeholder.className = 'rs_ai_search_toggle';\n    placeholder.style.display = 'none';\n    container.appendChild(placeholder);\n\n    // Initialize the component on this placeholder\n    new RSAISearchToggle(placeholder, {});\n  });\n}\n\n/**\n * Check if labels are loaded by testing a known label key\n */\nfunction areLabelsReady(): boolean {\n  const win = window as unknown as {\n    RealtySoftLabels?: { get: (key: string) => string };\n    RealtySoftState?: { get: (key: string) => unknown };\n  };\n\n  // Check if labels module exists and has labels loaded\n  if (!win.RealtySoftLabels?.get) return false;\n\n  // Check if language is set in state\n  const language = win.RealtySoftState?.get('config.language');\n  if (!language) return false;\n\n  // Check if a known label returns something other than the key itself\n  const testLabel = win.RealtySoftLabels.get('search_button');\n  return testLabel !== 'search_button';\n}\n\n/**\n * Wait for RealtySoft to be ready, then initialize AI search\n */\nfunction initWhenReady(): void {\n  // Check if RealtySoft is available and has the onReady method\n  const win = window as unknown as { RealtySoft?: { onReady?: (cb: () => void) => void } };\n\n  if (win.RealtySoft?.onReady) {\n    // Use RealtySoft's onReady callback\n    win.RealtySoft.onReady(() => {\n      // Wait for labels to be loaded\n      const waitForLabels = (): void => {\n        if (areLabelsReady()) {\n          setTimeout(autoInitAISearch, 100);\n        } else {\n          setTimeout(waitForLabels, 200);\n        }\n      };\n      waitForLabels();\n    });\n  } else {\n    // Fallback: retry with increasing delays until search containers AND labels are found\n    let attempts = 0;\n    const maxAttempts = 15;\n    const baseDelay = 300;\n\n    const tryInit = (): void => {\n      attempts++;\n      const searchContainers = Array.from(document.querySelectorAll<HTMLElement>(\n        '#rs_search, .rs-search, [class*=\"rs-template-search\"]'\n      )).filter(el => !el.dataset?.rsTemplateDuplicate);\n\n      // Only initialize when both containers exist AND labels are ready\n      if (searchContainers.length > 0 && areLabelsReady()) {\n        // Found containers and labels are ready, initialize\n        autoInitAISearch();\n      } else if (attempts < maxAttempts) {\n        // Retry with delay\n        setTimeout(tryInit, baseDelay);\n      }\n    };\n\n    // Start first attempt after initial delay\n    setTimeout(tryInit, baseDelay);\n  }\n}\n\n// Run auto-init when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initWhenReady);\n} else {\n  // DOM already ready\n  initWhenReady();\n}\n\nexport { RSAISearchToggle };\nexport default RSAISearchToggle;\n","/**\r\n * RealtySoft Widget v3 - Property Grid Component\r\n * Displays property cards in grid or list layout\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAnalyticsModule,\r\n  Property,\r\n  ImageWithSizes\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\n// Declare external managers\r\ndeclare const WishlistManager: {\r\n  has: (refNo: string | number) => boolean;\r\n  add: (property: Record<string, unknown>) => boolean;\r\n  remove: (refNo: string | number) => void;\r\n} | undefined;\r\n\r\ndeclare const RealtySoftToast: {\r\n  success: (message: string) => void;\r\n  error: (message: string) => void;\r\n} | undefined;\r\n\r\ndeclare const RealtySoftRouter: {\r\n  isEnabled: () => boolean;\r\n  navigateToProperty: (property: import('../../types/index').Property, url: string) => void;\r\n} | undefined;\r\n\r\nclass RSPropertyGrid extends RSBaseComponent {\r\n  private properties: Property[] = [];\r\n  private view: string = 'grid';\r\n  private loading: boolean = false;\r\n  private isStandalone: boolean = false;\r\n  private cardTemplate: HTMLElement | null = null;\r\n  private imageObserver: IntersectionObserver | null = null;\r\n  private prefetchedIds: Set<string | number> = new Set();\r\n  private container: HTMLElement | null = null;\r\n  private loader: HTMLElement | null = null;\r\n  private empty: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.properties = [];\r\n    this.view = RealtySoftState.get<string>('ui.view') || 'grid';\r\n    this.loading = false;\r\n    this.cardTemplate = this.extractCardTemplate();\r\n    this.imageObserver = null;\r\n    this.prefetchedIds = new Set();\r\n\r\n    // Check if parent listing container is standalone (independent data, no global filter interaction)\r\n    const listingParent = this.element.closest('#rs_listing, [class*=\"rs-listing-template-\"]');\r\n    this.isStandalone = !!listingParent?.hasAttribute('data-rs-standalone');\r\n\r\n    // Set up IntersectionObserver for lazy loading images\r\n    this.setupImageObserver();\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Subscribe to results changes (skip for standalone â€” data injected via setStandaloneProperties)\r\n    if (!this.isStandalone) {\r\n      this.subscribe<Property[]>('results.properties', (properties) => {\r\n        this.properties = properties || [];\r\n        this.renderProperties();\r\n      });\r\n    }\r\n\r\n    // Subscribe to view changes\r\n    this.subscribe<string>('ui.view', (view) => {\r\n      this.view = view;\r\n      this.updateViewClass();\r\n    });\r\n\r\n    // Subscribe to loading state\r\n    this.subscribe<boolean>('ui.loading', (loading) => {\r\n      this.loading = loading;\r\n      this.updateLoadingState();\r\n    });\r\n    // Initialize loading state immediately from current state\r\n    this.loading = RealtySoftState.get<boolean>('ui.loading') ?? true;\r\n    this.updateLoadingState();\r\n\r\n    // Subscribe to language changes - ensure re-render with translated content\r\n    // Note: Properties will be refetched by controller's setLanguage(), this ensures\r\n    // any label-based rendering is updated when new properties arrive\r\n    this.subscribe('config.language', () => {\r\n      if (this.properties.length > 0) {\r\n        this.renderProperties();\r\n      }\r\n    });\r\n\r\n    // Note: Initial search is triggered by the controller after all components init\r\n  }\r\n\r\n  /**\r\n   * Inject properties directly (used by standalone listings).\r\n   * Bypasses global results state â€” the grid shows only these properties.\r\n   */\r\n  public setStandaloneProperties(properties: Property[]): void {\r\n    this.properties = properties;\r\n    this.renderProperties();\r\n  }\r\n\r\n  private extractCardTemplate(): HTMLElement | null {\r\n    // Check if there's a custom card template inside\r\n    const customCard = this.element.querySelector('.rs_card');\r\n    console.log('[RSPropertyGrid] extractCardTemplate - element:', this.element.className);\r\n    console.log('[RSPropertyGrid] extractCardTemplate - found .rs_card:', !!customCard);\r\n    if (customCard) {\r\n      console.log('[RSPropertyGrid] extractCardTemplate - card classes:', customCard.className);\r\n      const template = customCard.cloneNode(true) as HTMLElement;\r\n      customCard.remove();\r\n      return template;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Generate URL for property detail page\r\n   * Stays on client's website with SEO-friendly format\r\n   * Format: /{propertyPageSlug}/{title-slug}-{REFERENCE}\r\n   */\r\n  private generatePropertyUrl(property: Property): string {\r\n    // If property already has a URL, use it\r\n    if (property.url) return property.url;\r\n\r\n    // Get config from state\r\n    const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n    const ref = property.ref || property.id;\r\n    const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      // /property?ref=V12345\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      // /property/V12345\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    // Default 'seo': /property/luxury-villa-marbella-V12345\r\n    const title = property.title || '';\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '') // Remove accents\r\n      .replace(/[^a-z0-9\\s-]/g, '') // Remove special chars\r\n      .replace(/\\s+/g, '-') // Replace spaces with dashes\r\n      .replace(/-+/g, '-') // Replace multiple dashes with single\r\n      .replace(/^-|-$/g, '') // Remove leading/trailing dashes\r\n      .substring(0, 80); // Limit length\r\n\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-property-grid', `rs-property-grid--${this.view}`);\r\n\r\n    // Check for columns setting from element or parent container\r\n    const columns = this.element.dataset.rsColumns ||\r\n                    this.element.closest('[data-rs-columns]')?.getAttribute('data-rs-columns');\r\n    if (columns && ['1', '2', '3', '4'].includes(columns)) {\r\n      this.element.classList.add(`rs-property-grid--cols-${columns}`);\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-grid__container\">\r\n        <div class=\"rs-property-grid__loader\" style=\"display: none;\">\r\n          <div class=\"rs-property-grid__spinner\"></div>\r\n          <span>${this.label('results_loading')}</span>\r\n        </div>\r\n        <div class=\"rs-property-grid__empty\" style=\"display: none;\">\r\n          <p>${this.label('results_count_zero')}</p>\r\n        </div>\r\n        <div class=\"rs-property-grid__items\"></div>\r\n      </div>\r\n    `;\r\n\r\n    this.container = this.element.querySelector('.rs-property-grid__items');\r\n    this.loader = this.element.querySelector('.rs-property-grid__loader');\r\n    this.empty = this.element.querySelector('.rs-property-grid__empty');\r\n\r\n    // Re-render existing properties if we have them (e.g., after language change)\r\n    if (this.properties.length > 0) {\r\n      this.renderProperties();\r\n    }\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (!this.container) return;\r\n\r\n    // Prefetch on hover for instant detail page loading\r\n    let prefetchTimeout: ReturnType<typeof setTimeout>;\r\n    this.container.addEventListener('mouseenter', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const card = target.closest('.rs-card') as HTMLElement | null;\r\n      if (!card) return;\r\n\r\n      const propertyId = card.dataset.propertyId;\r\n      const property = this.properties.find(p => String(p.id) === propertyId);\r\n      if (!property) return;\r\n\r\n      // Debounce prefetch to avoid too many requests on fast mouse movements\r\n      clearTimeout(prefetchTimeout);\r\n      prefetchTimeout = setTimeout(() => {\r\n        // Prefetch by ref if available (more reliable), otherwise by ID\r\n        if (property.ref) {\r\n          RealtySoftAPI.prefetchProperty(property.ref, true);\r\n        } else if (propertyId) {\r\n          RealtySoftAPI.prefetchProperty(propertyId, false);\r\n        }\r\n      }, 100); // 100ms delay to avoid prefetching on quick hovers\r\n    }, true);\r\n\r\n    this.container.addEventListener('mouseleave', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const card = target.closest('.rs-card');\r\n      if (card) {\r\n        clearTimeout(prefetchTimeout);\r\n      }\r\n    }, true);\r\n\r\n    // Card click events are delegated\r\n    this.container.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const card = target.closest('.rs-card') as HTMLElement | null;\r\n      if (!card) return;\r\n\r\n      const propertyId = card.dataset.propertyId;\r\n      const property = this.properties.find(p => String(p.id) === propertyId);\r\n\r\n      // Check if clicked on wishlist button\r\n      if (target.closest('.rs_card_wishlist')) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const totalImages = parseInt(card.dataset.totalImages || '0') || 0;\r\n        const wishlistBtn = target.closest('.rs_card_wishlist') as HTMLElement;\r\n        if (propertyId) {\r\n          this.toggleWishlist(propertyId, wishlistBtn, totalImages);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Check if clicked on a link\r\n      if (target.closest('.rs_card_link')) {\r\n        if (property) {\r\n          RealtySoftAnalytics.trackCardClick(property);\r\n\r\n          // SPA navigation: intercept if router is enabled and no modifier keys\r\n          const mouseEvent = e as MouseEvent;\r\n          if (typeof RealtySoftRouter !== 'undefined' && RealtySoftRouter.isEnabled() &&\r\n              !mouseEvent.ctrlKey && !mouseEvent.metaKey && !mouseEvent.shiftKey) {\r\n            e.preventDefault();\r\n            const url = this.generatePropertyUrl(property);\r\n            RealtySoftRouter.navigateToProperty(property, url);\r\n          }\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Track card click\r\n      if (property) {\r\n        RealtySoftAnalytics.trackCardClick(property);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up IntersectionObserver for lazy loading images\r\n   * This is more efficient than native loading=\"lazy\" for carousel images\r\n   */\r\n  private setupImageObserver(): void {\r\n    // Check if IntersectionObserver is supported\r\n    if (!('IntersectionObserver' in window)) {\r\n      console.log('[RSPropertyGrid] IntersectionObserver not supported, using fallback');\r\n      return;\r\n    }\r\n\r\n    // Clean up existing observer\r\n    if (this.imageObserver) {\r\n      this.imageObserver.disconnect();\r\n    }\r\n\r\n    // Create observer for lazy loading images\r\n    this.imageObserver = new IntersectionObserver((entries) => {\r\n      entries.forEach(entry => {\r\n        if (entry.isIntersecting) {\r\n          const img = entry.target as HTMLImageElement;\r\n\r\n          // Load the image\r\n          if (img.dataset.src) {\r\n            img.src = img.dataset.src;\r\n            delete img.dataset.src;\r\n          }\r\n          if (img.dataset.srcset) {\r\n            img.srcset = img.dataset.srcset;\r\n            delete img.dataset.srcset;\r\n          }\r\n          if (img.dataset.sizes) {\r\n            img.sizes = img.dataset.sizes;\r\n            delete img.dataset.sizes;\r\n          }\r\n\r\n          // Stop observing once loaded\r\n          this.imageObserver?.unobserve(img);\r\n        }\r\n      });\r\n    }, {\r\n      // Start loading when image is 200px from viewport\r\n      rootMargin: '200px 0px',\r\n      threshold: 0.01\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Observe images for lazy loading\r\n   */\r\n  private observeImages(): void {\r\n    if (!this.imageObserver || !this.container) return;\r\n\r\n    // Find all images with data-src (lazy load candidates)\r\n    const lazyImages = this.container.querySelectorAll<HTMLImageElement>('img[data-src]');\r\n    lazyImages.forEach(img => {\r\n      this.imageObserver?.observe(img);\r\n    });\r\n  }\r\n\r\n  private renderProperties(): void {\r\n    if (!this.container) return;\r\n    this.container.innerHTML = '';\r\n\r\n    if (this.properties.length === 0) {\r\n      if (this.empty) this.empty.style.display = 'block';\r\n      return;\r\n    }\r\n\r\n    if (this.empty) this.empty.style.display = 'none';\r\n\r\n    // Add preload hint for LCP image (first image of first property)\r\n    this.addLcpPreloadHint();\r\n\r\n    this.properties.forEach(property => {\r\n      const card = this.createCard(property);\r\n      this.container?.appendChild(card);\r\n    });\r\n\r\n    // Set up lazy loading observer for images\r\n    this.observeImages();\r\n  }\r\n\r\n  /**\r\n   * Add preload link for LCP (Largest Contentful Paint) image\r\n   * Helps browser prioritize loading the first visible image\r\n   */\r\n  private addLcpPreloadHint(): void {\r\n    // Remove any existing preload hint we added\r\n    const existingPreload = document.head.querySelector('link[data-rs-lcp-preload]');\r\n    if (existingPreload) {\r\n      existingPreload.remove();\r\n    }\r\n\r\n    // Get first property's first image\r\n    if (this.properties.length === 0) return;\r\n    const firstProperty = this.properties[0];\r\n    const firstImage = firstProperty.images?.[0];\r\n    if (!firstImage) return;\r\n\r\n    // Create preload link\r\n    const preload = document.createElement('link');\r\n    preload.rel = 'preload';\r\n    preload.as = 'image';\r\n    preload.href = firstImage;\r\n    (preload as HTMLLinkElement & { fetchPriority?: string }).fetchPriority = 'high';\r\n    preload.dataset.rsLcpPreload = 'true';\r\n\r\n    // Add responsive srcset to preload if available\r\n    const imagesWithSizes = (firstProperty as Property & { imagesWithSizes?: ImageWithSizes[] }).imagesWithSizes;\r\n    const imgWithSizes = imagesWithSizes?.[0];\r\n    if (imgWithSizes?.sizes) {\r\n      const srcsetParts: string[] = [];\r\n      if (imgWithSizes.sizes[256]) srcsetParts.push(`${imgWithSizes.sizes[256]} 256w`);\r\n      if (imgWithSizes.sizes[512]) srcsetParts.push(`${imgWithSizes.sizes[512]} 512w`);\r\n      if (imgWithSizes.sizes[768]) srcsetParts.push(`${imgWithSizes.sizes[768]} 768w`);\r\n      if (srcsetParts.length > 0) {\r\n        (preload as HTMLLinkElement & { imageSrcset?: string; imageSizes?: string }).imageSrcset = srcsetParts.join(', ');\r\n        (preload as HTMLLinkElement & { imageSrcset?: string; imageSizes?: string }).imageSizes = '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw';\r\n      }\r\n    }\r\n\r\n    document.head.appendChild(preload);\r\n  }\r\n\r\n  private createCard(property: Property): HTMLElement {\r\n    console.log('[RSPropertyGrid] createCard - has cardTemplate:', !!this.cardTemplate);\r\n    if (this.cardTemplate) {\r\n      console.log('[RSPropertyGrid] createCard - using CUSTOM card template');\r\n      return this.createCustomCard(property);\r\n    }\r\n    console.log('[RSPropertyGrid] createCard - using DEFAULT card');\r\n    return this.createDefaultCard(property);\r\n  }\r\n\r\n  private createDefaultCard(property: Property): HTMLElement {\r\n    const card = document.createElement('div');\r\n    card.className = 'rs-card';\r\n    card.dataset.propertyId = String(property.id);\r\n\r\n    // Generate SEO-friendly URL\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n\r\n    // Limit images to 5 for performance\r\n    const allImages = property.images || [];\r\n    const images = allImages.slice(0, 5);\r\n    const imagesWithSizes = ((property as Property & { imagesWithSizes?: ImageWithSizes[] }).imagesWithSizes || []).slice(0, 5);\r\n    const totalImageCount = property.total_images || allImages.length;\r\n    card.dataset.totalImages = String(totalImageCount);\r\n    const mainImage = images[0] || '/realtysoft/assets/placeholder.jpg';\r\n    const price = RealtySoftLabels.formatPrice(property.price);\r\n    // Check wishlist using WishlistManager (ref) with fallback to RealtySoftState (id)\r\n    const refNo = property.ref || property.id;\r\n    const isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager?.has(refNo)) || RealtySoftState.isInWishlist(property.id);\r\n\r\n    // Build property tags (listing type, featured, own)\r\n    const tags = this.buildPropertyTags(property);\r\n\r\n    // Build image section - always use carousel placeholder if images exist\r\n    const imageContent = images.length > 0\r\n      ? '<div class=\"rs-card__carousel-placeholder\"></div>'\r\n      : `<img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-card__image\" loading=\"eager\" fetchpriority=\"high\">`;\r\n\r\n    // Image counter\r\n    const imageCounter = totalImageCount > 0 ? `\r\n      <div class=\"rs-card__image-count\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n          <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n          <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n        </svg>\r\n        <span>${totalImageCount}</span>\r\n      </div>\r\n    ` : '';\r\n\r\n    card.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-card__image-link rs_card_link\">\r\n        <div class=\"rs-card__image-wrapper\">\r\n          ${imageContent}\r\n          ${tags}\r\n          ${imageCounter}\r\n        </div>\r\n      </a>\r\n      <button class=\"rs-card__wishlist rs_card_wishlist ${isInWishlist ? 'rs-card__wishlist--active' : ''}\" type=\"button\" aria-label=\"${this.label('wishlist_add')}\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"${isInWishlist ? 'currentColor' : 'none'}\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n        </svg>\r\n      </button>\r\n      <div class=\"rs-card__content\">\r\n        <a href=\"${propertyUrl}\" class=\"rs-card__price-link rs_card_link\">\r\n          <div class=\"rs-card__price rs_card_price\">${price}</div>\r\n        </a>\r\n        <a href=\"${propertyUrl}\" class=\"rs-card__title-link rs_card_link\">\r\n          <h3 class=\"rs-card__title rs_card_title\">${this.escapeHtml(property.title || '')}</h3>\r\n        </a>\r\n        <div class=\"rs-card__location rs_card_location\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n            <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n          </svg>\r\n          ${this.escapeHtml(String(property.location || ''))}\r\n        </div>\r\n        <div class=\"rs-card__specs\">\r\n          ${property.beds && property.beds > 0 ? `\r\n            <span class=\"rs-card__spec rs_card_beds\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M2 4v16\"></path>\r\n                <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n                <path d=\"M2 17h20\"></path>\r\n                <path d=\"M6 8v9\"></path>\r\n              </svg>\r\n              ${property.beds} ${property.beds === 1 ? this.label('card_bed') : this.label('card_beds')}\r\n            </span>\r\n          ` : ''}\r\n          ${property.baths && property.baths > 0 ? `\r\n            <span class=\"rs-card__spec rs_card_baths\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n                <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n                <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n                <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n                <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n              </svg>\r\n              ${property.baths} ${property.baths === 1 ? this.label('card_bath') : this.label('card_baths')}\r\n            </span>\r\n          ` : ''}\r\n          ${property.built_area && property.built_area > 0 ? `\r\n            <span class=\"rs-card__spec rs_card_built\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n              </svg>\r\n              ${property.built_area} ${this.label('card_built')}\r\n            </span>\r\n          ` : ''}\r\n          ${property.plot_size && property.plot_size > 0 ? `\r\n            <span class=\"rs-card__spec rs_card_plot\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n                <path d=\"M12 2v20\"></path>\r\n                <path d=\"M3 6l9 4 9-4\"></path>\r\n              </svg>\r\n              ${property.plot_size} ${this.label('card_plot')}\r\n            </span>\r\n          ` : ''}\r\n        </div>\r\n        <div class=\"rs-card__footer\">\r\n          <span class=\"rs-card__ref rs_card_ref\">${this.label('card_ref')} ${this.escapeHtml(property.ref || '')}</span>\r\n          <a href=\"${propertyUrl}\" class=\"rs-card__link rs_card_link\">${this.label('card_view')}</a>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Insert carousel if images exist (replaces placeholder)\r\n    if (images.length > 0) {\r\n      const placeholder = card.querySelector('.rs-card__carousel-placeholder');\r\n      if (placeholder) {\r\n        const carousel = this.createCarousel(images, property.id, totalImageCount, imagesWithSizes);\r\n        placeholder.parentNode?.replaceChild(carousel, placeholder);\r\n      }\r\n    }\r\n\r\n    return card;\r\n  }\r\n\r\n  private buildPropertyTags(property: Property): string {\r\n    const tags: string[] = [];\r\n\r\n    // Listing type tag\r\n    const listingType = property.listing_type;\r\n    if (listingType) {\r\n      const classMap: Record<string, string> = {\r\n        'resale': 'rs-card__tag--sale', 'sale': 'rs-card__tag--sale',\r\n        'development': 'rs-card__tag--development', 'new_development': 'rs-card__tag--development',\r\n        'long_rental': 'rs-card__tag--rental', 'rent': 'rs-card__tag--rental',\r\n        'short_rental': 'rs-card__tag--holiday', 'holiday': 'rs-card__tag--holiday'\r\n      };\r\n      const labelKeyMap: Record<string, string> = {\r\n        'resale': 'listing_type_sale', 'sale': 'listing_type_sale',\r\n        'development': 'listing_type_new', 'new_development': 'listing_type_new',\r\n        'long_rental': 'listing_type_long_rental', 'rent': 'listing_type_long_rental',\r\n        'short_rental': 'listing_type_short_rental', 'holiday': 'listing_type_short_rental'\r\n      };\r\n      const typeKey = listingType.toLowerCase();\r\n      const cssClass = classMap[typeKey] || 'rs-card__tag--sale';\r\n      const labelKey = labelKeyMap[typeKey];\r\n      const typeLabel = labelKey ? this.label(labelKey) : listingType;\r\n      tags.push(`<span class=\"rs-card__tag ${cssClass}\">${typeLabel}</span>`);\r\n    }\r\n\r\n    // Featured tag\r\n    if (property.is_featured) {\r\n      tags.push(`<span class=\"rs-card__tag rs-card__tag--featured\">${this.label('featured')}</span>`);\r\n    }\r\n\r\n    // Own tag\r\n    if (property.is_own) {\r\n      tags.push(`<span class=\"rs-card__tag rs-card__tag--own\">${this.label('own')}</span>`);\r\n    }\r\n\r\n    return tags.length > 0 ? `<div class=\"rs-card__tags\">${tags.join('')}</div>` : '';\r\n  }\r\n\r\n  private createCustomCard(property: Property): HTMLElement {\r\n    if (!this.cardTemplate) {\r\n      return this.createDefaultCard(property);\r\n    }\r\n\r\n    const card = this.cardTemplate.cloneNode(true) as HTMLElement;\r\n    card.classList.add('rs-card');\r\n    card.dataset.propertyId = String(property.id);\r\n\r\n    // Generate SEO-friendly URL\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n\r\n    // Limit images to 5 for performance\r\n    const allImages = property.images || [];\r\n    const images = allImages.slice(0, 5);\r\n    const imagesWithSizes = ((property as Property & { imagesWithSizes?: ImageWithSizes[] }).imagesWithSizes || []).slice(0, 5);\r\n    const totalImageCount = property.total_images || allImages.length;\r\n    card.dataset.totalImages = String(totalImageCount);\r\n    // Check wishlist using WishlistManager (ref) with fallback to RealtySoftState (id)\r\n    const refNo = property.ref || property.id;\r\n    const isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager?.has(refNo)) || RealtySoftState.isInWishlist(property.id);\r\n\r\n    // Handle carousel\r\n    const carouselEl = card.querySelector('.rs_card_carousel');\r\n    if (carouselEl) {\r\n      carouselEl.innerHTML = '';\r\n      if (images.length > 0) {\r\n        const carousel = this.createCarousel(images, property.id, totalImageCount, imagesWithSizes);\r\n        carouselEl.appendChild(carousel);\r\n      }\r\n    }\r\n\r\n    // Handle single image (if no carousel)\r\n    const imageEl = card.querySelector('.rs_card_image') as HTMLImageElement | HTMLElement | null;\r\n    if (imageEl) {\r\n      const mainImage = images[0] || '/realtysoft/assets/placeholder.jpg';\r\n      if (imageEl.tagName === 'IMG') {\r\n        (imageEl as HTMLImageElement).src = mainImage;\r\n        (imageEl as HTMLImageElement).alt = this.escapeHtml(property.title || '');\r\n        (imageEl as HTMLImageElement).loading = 'eager';\r\n        (imageEl as HTMLImageElement & { fetchPriority?: string }).fetchPriority = 'high';\r\n      } else {\r\n        imageEl.innerHTML = `<img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" loading=\"eager\" fetchpriority=\"high\">`;\r\n      }\r\n    }\r\n\r\n    // Handle status/listing type badge\r\n    const statusEl = card.querySelector('.rs_card_status');\r\n    if (statusEl) {\r\n      const listingType = property.listing_type;\r\n      if (listingType) {\r\n        const classMap: Record<string, string> = {\r\n          'resale': 'rs-card__tag--sale', 'sale': 'rs-card__tag--sale',\r\n          'development': 'rs-card__tag--development', 'new_development': 'rs-card__tag--development',\r\n          'long_rental': 'rs-card__tag--rental', 'rent': 'rs-card__tag--rental',\r\n          'short_rental': 'rs-card__tag--holiday', 'holiday': 'rs-card__tag--holiday'\r\n        };\r\n        const labelKeyMap: Record<string, string> = {\r\n          'resale': 'listing_type_sale', 'sale': 'listing_type_sale',\r\n          'development': 'listing_type_new', 'new_development': 'listing_type_new',\r\n          'long_rental': 'listing_type_long_rental', 'rent': 'listing_type_long_rental',\r\n          'short_rental': 'listing_type_short_rental', 'holiday': 'listing_type_short_rental'\r\n        };\r\n        const typeKey = listingType.toLowerCase();\r\n        const cssClass = classMap[typeKey] || 'rs-card__tag--sale';\r\n        const labelKey = labelKeyMap[typeKey];\r\n        const typeLabel = labelKey ? this.label(labelKey) : listingType;\r\n        statusEl.innerHTML = `<span class=\"rs-card__tag ${cssClass}\">${typeLabel}</span>`;\r\n\r\n        // Add featured/own badges\r\n        if (property.is_featured) {\r\n          statusEl.innerHTML += `<span class=\"rs-card__tag rs-card__tag--featured\">${this.label('featured')}</span>`;\r\n        }\r\n        if (property.is_own) {\r\n          statusEl.innerHTML += `<span class=\"rs-card__tag rs-card__tag--own\">${this.label('own')}</span>`;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Handle wishlist button\r\n    const wishlistBtn = card.querySelector('.rs_card_wishlist') as HTMLButtonElement | null;\r\n    if (wishlistBtn) {\r\n      wishlistBtn.classList.add('rs-card__wishlist');\r\n      wishlistBtn.classList.toggle('rs-card__wishlist--active', isInWishlist);\r\n      wishlistBtn.type = 'button';\r\n      wishlistBtn.setAttribute('aria-label', this.label('wishlist_add'));\r\n      wishlistBtn.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"${isInWishlist ? 'currentColor' : 'none'}\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n        </svg>\r\n      `;\r\n    }\r\n\r\n    // Handle price\r\n    const priceEl = card.querySelector('.rs_card_price');\r\n    if (priceEl) {\r\n      priceEl.textContent = RealtySoftLabels.formatPrice(property.price);\r\n    }\r\n\r\n    // Handle title\r\n    const titleEl = card.querySelector('.rs_card_title');\r\n    if (titleEl) {\r\n      titleEl.textContent = property.title || '';\r\n    }\r\n\r\n    // Handle location\r\n    const locationEl = card.querySelector('.rs_card_location');\r\n    if (locationEl) {\r\n      locationEl.textContent = String(property.location || '');\r\n    }\r\n\r\n    // Handle beds\r\n    const bedsEl = card.querySelector('.rs_card_beds') as HTMLElement | null;\r\n    if (bedsEl) {\r\n      if (property.beds && property.beds > 0) {\r\n        bedsEl.textContent = `${property.beds} ${property.beds === 1 ? this.label('card_bed') : this.label('card_beds')}`;\r\n      } else {\r\n        bedsEl.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    // Handle baths\r\n    const bathsEl = card.querySelector('.rs_card_baths') as HTMLElement | null;\r\n    if (bathsEl) {\r\n      if (property.baths && property.baths > 0) {\r\n        bathsEl.textContent = `${property.baths} ${property.baths === 1 ? this.label('card_bath') : this.label('card_baths')}`;\r\n      } else {\r\n        bathsEl.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    // Handle built area\r\n    const builtEl = card.querySelector('.rs_card_built') as HTMLElement | null;\r\n    if (builtEl) {\r\n      if (property.built_area && property.built_area > 0) {\r\n        builtEl.textContent = `${property.built_area} ${this.label('card_built')}`;\r\n      } else {\r\n        builtEl.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    // Handle plot size\r\n    const plotEl = card.querySelector('.rs_card_plot') as HTMLElement | null;\r\n    if (plotEl) {\r\n      if (property.plot_size && property.plot_size > 0) {\r\n        plotEl.textContent = `${property.plot_size} ${this.label('card_plot')}`;\r\n      } else {\r\n        plotEl.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    // Handle description\r\n    const descEl = card.querySelector('.rs_card_description');\r\n    if (descEl) {\r\n      descEl.textContent = property.short_description || property.description || '';\r\n    }\r\n\r\n    // Handle reference\r\n    const refEl = card.querySelector('.rs_card_ref');\r\n    if (refEl) {\r\n      refEl.textContent = property.ref || '';\r\n    }\r\n\r\n    // Handle property type\r\n    const typeEl = card.querySelector('.rs_card_type');\r\n    if (typeEl) {\r\n      typeEl.textContent = property.type || '';\r\n    }\r\n\r\n    // Handle all links (carousel, title, price, button)\r\n    const linkEls = card.querySelectorAll<HTMLAnchorElement>('.rs_card_link');\r\n    linkEls.forEach(linkEl => {\r\n      if (linkEl.tagName === 'A') {\r\n        linkEl.href = propertyUrl;\r\n      }\r\n    });\r\n\r\n    // Handle image counter\r\n    const imageCountEl = card.querySelector('.rs_card_image_count');\r\n    if (imageCountEl) {\r\n      imageCountEl.textContent = String(totalImageCount);\r\n    }\r\n\r\n    return card;\r\n  }\r\n\r\n  private createCarousel(images: string[], propertyId: string | number, totalImageCount: number, imagesWithSizes: ImageWithSizes[] = []): HTMLElement {\r\n    if (!images || images.length === 0) {\r\n      const empty = document.createElement('div');\r\n      empty.className = 'rs-card__carousel';\r\n      return empty;\r\n    }\r\n\r\n    // Helper to build srcset from image sizes\r\n    const buildSrcset = (imgData: ImageWithSizes | undefined): string => {\r\n      if (!imgData || !imgData.sizes) return '';\r\n      const srcsetParts: string[] = [];\r\n      if (imgData.sizes[256]) srcsetParts.push(`${imgData.sizes[256]} 256w`);\r\n      if (imgData.sizes[512]) srcsetParts.push(`${imgData.sizes[512]} 512w`);\r\n      if (imgData.sizes[768]) srcsetParts.push(`${imgData.sizes[768]} 768w`);\r\n      return srcsetParts.length > 0 ? srcsetParts.join(', ') : '';\r\n    };\r\n\r\n    // Responsive sizes attribute for different viewport widths\r\n    const sizesAttr = '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw';\r\n\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'rs-card__carousel';\r\n    wrapper.innerHTML = `\r\n      <div class=\"rs-card__carousel-track\">\r\n        ${images.map((img, i) => {\r\n          const imgData = imagesWithSizes[i];\r\n          const srcset = buildSrcset(imgData);\r\n          const srcsetAttr = srcset ? `srcset=\"${srcset}\" sizes=\"${sizesAttr}\"` : '';\r\n\r\n          if (i === 0) {\r\n            // First image: eager load with high priority and srcset\r\n            return `<div class=\"rs-card__carousel-slide rs-card__carousel-slide--active\">\r\n              <img src=\"${img}\" ${srcsetAttr} loading=\"eager\" fetchpriority=\"high\" alt=\"\">\r\n            </div>`;\r\n          } else {\r\n            // Other images: lazy load with data-src and data-srcset\r\n            const dataSrcset = srcset ? `data-srcset=\"${srcset}\" data-sizes=\"${sizesAttr}\"` : '';\r\n            return `<div class=\"rs-card__carousel-slide\">\r\n              <img data-src=\"${img}\" ${dataSrcset} loading=\"lazy\" alt=\"\">\r\n            </div>`;\r\n          }\r\n        }).join('')}\r\n      </div>\r\n      ${images.length > 1 ? `\r\n        <button class=\"rs-card__carousel-prev\" type=\"button\" aria-label=\"Previous\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n        <button class=\"rs-card__carousel-next\" type=\"button\" aria-label=\"Next\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n        <div class=\"rs-card__carousel-dots\">\r\n          ${images.map((_, i) => `\r\n            <span class=\"rs-card__carousel-dot ${i === 0 ? 'rs-card__carousel-dot--active' : ''}\" data-index=\"${i}\"></span>\r\n          `).join('')}\r\n        </div>\r\n      ` : ''}\r\n    `;\r\n\r\n    // Add carousel navigation\r\n    let currentIndex = 0;\r\n    const slides = wrapper.querySelectorAll('.rs-card__carousel-slide');\r\n    const dots = wrapper.querySelectorAll('.rs-card__carousel-dot');\r\n\r\n    const goToSlide = (index: number): void => {\r\n      if (index < 0) index = images.length - 1;\r\n      if (index >= images.length) index = 0;\r\n\r\n      slides.forEach((s, i) => s.classList.toggle('rs-card__carousel-slide--active', i === index));\r\n      dots.forEach((d, i) => d.classList.toggle('rs-card__carousel-dot--active', i === index));\r\n      currentIndex = index;\r\n\r\n      // Lazy load image if using data-src\r\n      const activeSlide = slides[index];\r\n      const img = activeSlide.querySelector('img') as HTMLImageElement | null;\r\n      if (img && img.dataset.src && !img.src) {\r\n        img.src = img.dataset.src;\r\n        // Also apply srcset and sizes if available\r\n        if (img.dataset.srcset) {\r\n          img.srcset = img.dataset.srcset;\r\n          img.sizes = img.dataset.sizes || '';\r\n        }\r\n      }\r\n    };\r\n\r\n    wrapper.querySelector('.rs-card__carousel-prev')?.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      goToSlide(currentIndex - 1);\r\n    });\r\n\r\n    wrapper.querySelector('.rs-card__carousel-next')?.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      goToSlide(currentIndex + 1);\r\n    });\r\n\r\n    dots.forEach(dot => {\r\n      dot.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        goToSlide(parseInt((dot as HTMLElement).dataset.index || '0'));\r\n      });\r\n    });\r\n\r\n    return wrapper;\r\n  }\r\n\r\n  private toggleWishlist(propertyId: string, button: HTMLElement, totalImages: number = 0): void {\r\n    try {\r\n      // Find the full property object\r\n      const property = this.properties.find(p => String(p.id) === propertyId);\r\n      if (!property) {\r\n        console.warn('[PropertyGrid] Property not found for wishlist toggle:', propertyId);\r\n        return;\r\n      }\r\n\r\n      // Use WishlistManager for full property storage\r\n      const refNo = property.ref || property.id;\r\n      const wmAvailable = typeof WishlistManager !== 'undefined' && WishlistManager;\r\n\r\n      if (wmAvailable && WishlistManager!.has(refNo)) {\r\n        WishlistManager!.remove(refNo);\r\n        button.classList.remove('rs-card__wishlist--active');\r\n        const svg = button.querySelector('svg');\r\n        if (svg) svg.setAttribute('fill', 'none');\r\n\r\n        try { RealtySoftAnalytics.trackWishlistRemove(property.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n        // Show toast\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_removed') || 'Removed from wishlist');\r\n        }\r\n      } else {\r\n        // Add property data to WishlistManager\r\n        let addSuccess = false;\r\n        if (wmAvailable) {\r\n          addSuccess = WishlistManager!.add({\r\n            id: property.id,\r\n            ref_no: refNo,\r\n            title: property.title,\r\n            price: property.price,\r\n            location: property.location,\r\n            type: property.type,\r\n            beds: property.beds,\r\n            baths: property.baths,\r\n            built: property.built_area,\r\n            plot: property.plot_size,\r\n            images: property.images || [],\r\n            total_images: totalImages || property.total_images || (property.images || []).length,\r\n            listing_type: property.listing_type,\r\n            is_featured: property.is_featured || false\r\n          });\r\n        }\r\n\r\n        if (addSuccess) {\r\n          button.classList.add('rs-card__wishlist--active');\r\n          const svg = button.querySelector('svg');\r\n          if (svg) svg.setAttribute('fill', 'currentColor');\r\n\r\n          try { RealtySoftAnalytics.trackWishlistAdd(property.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n          // Show toast\r\n          if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n            RealtySoftToast.success(this.label('wishlist_add') || 'Added to wishlist');\r\n          }\r\n        } else {\r\n          console.error('[PropertyGrid] Failed to add to wishlist. WishlistManager available:', !!wmAvailable);\r\n          if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n            RealtySoftToast.error(this.label('wishlist_error') || 'Could not add to wishlist.');\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      // Note: WishlistManager.add/remove already syncs with RealtySoftState via notifyChange()\r\n    } catch (err) {\r\n      console.error('[PropertyGrid] Wishlist toggle error:', err);\r\n    }\r\n  }\r\n\r\n  private updateViewClass(): void {\r\n    this.element.classList.remove('rs-property-grid--grid', 'rs-property-grid--list', 'rs-property-grid--map');\r\n    this.element.classList.add(`rs-property-grid--${this.view}`);\r\n\r\n    // Hide grid when map view is active (map component handles display)\r\n    if (this.view === 'map') {\r\n      this.element.style.display = 'none';\r\n    } else {\r\n      this.element.style.display = '';\r\n    }\r\n  }\r\n\r\n  private updateLoadingState(): void {\r\n    if (this.loading) {\r\n      // If no properties yet, show skeleton cards for instant perceived performance\r\n      if (this.properties.length === 0 && this.container) {\r\n        if (this.loader) this.loader.style.display = 'none';\r\n        this.container.innerHTML = this.createSkeletonCards(6);\r\n      } else {\r\n        // If we have properties, just dim them\r\n        if (this.loader) this.loader.style.display = 'flex';\r\n        if (this.container) this.container.style.opacity = '0.5';\r\n      }\r\n    } else {\r\n      if (this.loader) this.loader.style.display = 'none';\r\n      if (this.container) this.container.style.opacity = '1';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create skeleton card placeholders for loading state\r\n   */\r\n  private createSkeletonCards(count: number = 6): string {\r\n    const skeletonStyle = `\r\n      <style>\r\n        .rs-card--skeleton {\r\n          background: #fff;\r\n          border-radius: 8px;\r\n          overflow: hidden;\r\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__pulse {\r\n          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\r\n          background-size: 200% 100%;\r\n          animation: rs-skeleton-pulse 1.5s infinite;\r\n        }\r\n        @keyframes rs-skeleton-pulse {\r\n          0% { background-position: 200% 0; }\r\n          100% { background-position: -200% 0; }\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__image {\r\n          height: 200px;\r\n          background: #e0e0e0;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__content {\r\n          padding: 15px;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__price {\r\n          height: 24px;\r\n          width: 40%;\r\n          margin-bottom: 10px;\r\n          border-radius: 4px;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__title {\r\n          height: 18px;\r\n          width: 80%;\r\n          margin-bottom: 8px;\r\n          border-radius: 4px;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__location {\r\n          height: 14px;\r\n          width: 60%;\r\n          margin-bottom: 12px;\r\n          border-radius: 4px;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__specs {\r\n          display: flex;\r\n          gap: 15px;\r\n        }\r\n        .rs-card--skeleton .rs-skeleton__spec {\r\n          height: 14px;\r\n          width: 50px;\r\n          border-radius: 4px;\r\n        }\r\n      </style>\r\n    `;\r\n\r\n    const skeletonCard = `\r\n      <div class=\"rs-card rs-card--skeleton\">\r\n        <div class=\"rs-skeleton__image rs-skeleton__pulse\"></div>\r\n        <div class=\"rs-skeleton__content\">\r\n          <div class=\"rs-skeleton__price rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__title rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__location rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__specs\">\r\n            <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n            <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n            <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    return skeletonStyle + Array(count).fill(skeletonCard).join('');\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_property_grid', RSPropertyGrid as unknown as ComponentConstructor);\r\n\r\nexport { RSPropertyGrid };\r\nexport default RSPropertyGrid;\r\n","/**\r\n * RealtySoft Widget v3 - Property Carousel Component\r\n * Center Focus Carousel with 5 visible cards\r\n * Based on: https://codepen.io/andyNroses/pen/KaENLb\r\n *\r\n * IMPORTANT: This component works INDEPENDENTLY from listing/search filters.\r\n * It makes its own API calls and does not affect or get affected by page filters.\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  RealtySoftLabelsModule,\r\n  Property\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\ninterface VisibleItem {\r\n  property: Property;\r\n  level: number;\r\n  index: number;\r\n}\r\n\r\ninterface TransformOptions {\r\n  offsetFromActive: number;\r\n  absOffsetFromActive: number;\r\n  isActive: boolean;\r\n  isVisible: boolean;\r\n}\r\n\r\nclass RSPropertyCarousel extends RSBaseComponent {\r\n  private properties: Property[] = [];\r\n  private active: number = 0;\r\n  private isAnimating: boolean = false;\r\n  private v2Initialized: boolean = false;\r\n  private v3Initialized: boolean = false;\r\n  private autoPlayTimer: ReturnType<typeof setInterval> | null = null;\r\n  private touchStartX: number = 0;\r\n  private touchEndX: number = 0;\r\n  private autoPlay: boolean = false;\r\n  private autoPlayInterval: number = 5000;\r\n  private limit: number = 10;\r\n  private featured: boolean = false;\r\n  private own: boolean = false;\r\n  private ownFirst: boolean = false;\r\n  private location: string | null = null;\r\n  private listingType: string | null = null;\r\n  private propertyType: string | null = null;\r\n  private minPrice: string | null = null;\r\n  private maxPrice: string | null = null;\r\n  private minBeds: string | null = null;\r\n  private track: HTMLElement | null = null;\r\n  private itemsContainer: HTMLElement | null = null;\r\n  private dotsContainer: HTMLElement | null = null;\r\n  private loader: HTMLElement | null = null;\r\n  private emptyState: HTMLElement | null = null;\r\n  private leftArrow: HTMLElement | null = null;\r\n  private rightArrow: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    console.log('[RSPropertyCarousel] Initializing...');\r\n\r\n    this.properties = (this.options as { properties?: Property[] }).properties || [];\r\n    this.active = 0;\r\n    this.isAnimating = false;\r\n    this.v2Initialized = false;\r\n    this.v3Initialized = false;\r\n    this.variation = this.options.variation || this.element.dataset.rsVariation || '1';\r\n    this.autoPlayTimer = null;\r\n    this.touchStartX = 0;\r\n    this.touchEndX = 0;\r\n\r\n    // Config from data attributes\r\n    this.autoPlay = this.element.dataset.rsAutoplay === 'true';\r\n    this.autoPlayInterval = parseInt(this.element.dataset.rsInterval || '5000') || 5000;\r\n    this.limit = parseInt(this.element.dataset.rsLimit || '10') || 10;\r\n\r\n    // Filter options - carousel works INDEPENDENTLY from page filters\r\n    this.featured = this.element.dataset.rsFeatured === 'true';\r\n    this.own = this.element.dataset.rsOwn === 'true';\r\n    this.ownFirst = this.element.dataset.rsOwnFirst === 'true';\r\n    this.location = this.element.dataset.rsLocation || null;\r\n    this.listingType = this.element.dataset.rsListingType || null;\r\n    this.propertyType = this.element.dataset.rsPropertyType || null;\r\n    this.minPrice = this.element.dataset.rsMinPrice || null;\r\n    this.maxPrice = this.element.dataset.rsMaxPrice || null;\r\n    this.minBeds = this.element.dataset.rsMinBeds || null;\r\n\r\n    console.log('[RSPropertyCarousel] Config:', {\r\n      autoPlay: this.autoPlay,\r\n      interval: this.autoPlayInterval,\r\n      limit: this.limit,\r\n      featured: this.featured,\r\n      own: this.own,\r\n      location: this.location,\r\n      listingType: this.listingType,\r\n      variation: this.variation\r\n    });\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Load properties if not provided\r\n    if (this.properties.length === 0) {\r\n      this.loadProperties();\r\n    } else {\r\n      this.renderItems();\r\n      this.startAutoPlay();\r\n    }\r\n\r\n    // Subscribe to language changes - reload properties with translated content\r\n    // Carousel is independent and makes its own API calls, so we need to refetch\r\n    this.subscribe('config.language', () => {\r\n      console.log('[RSPropertyCarousel] Language changed, reloading properties...');\r\n      // Reset and reload properties with new language\r\n      this.properties = [];\r\n      this.active = 0;\r\n      this.v2Initialized = false;\r\n      this.v3Initialized = false;\r\n      this.stopAutoPlay();\r\n      this.loadProperties();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generate URL for property detail page\r\n   */\r\n  private generatePropertyUrl(property: Property): string {\r\n    if (property.url) return property.url;\r\n\r\n    const pageSlug = (typeof RealtySoftState !== 'undefined' && RealtySoftState.get<string>('config.propertyPageSlug')) || 'property';\r\n    const ref = property.ref || property.id;\r\n    const urlFormat = (typeof RealtySoftState !== 'undefined' && RealtySoftState.get<string>('config.propertyUrlFormat')) || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    const title = property.title || '';\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9\\s-]/g, '')\r\n      .replace(/\\s+/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '')\r\n      .substring(0, 80);\r\n\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-property-carousel', `rs-property-carousel--v${this.variation}`);\r\n\r\n    const prevLabel = this.label('carousel_prev') || 'Previous';\r\n    const nextLabel = this.label('carousel_next') || 'Next';\r\n\r\n    // V4 has special navigation panels\r\n    if (this.variation === '4') {\r\n      this.element.innerHTML = `\r\n        <button class=\"rs-property-carousel__arrow rs-property-carousel__arrow--left\" type=\"button\" aria-label=\"${prevLabel}\">\r\n          <span class=\"rs-property-carousel__arrow-label\">Prev</span>\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line>\r\n            <polyline points=\"12 19 5 12 12 5\"></polyline>\r\n          </svg>\r\n        </button>\r\n\r\n        <div class=\"rs-property-carousel__track\">\r\n          <div class=\"rs-property-carousel__loader\">\r\n            <div class=\"rs-property-carousel__spinner\"></div>\r\n            <span class=\"rs-property-carousel__loader-text\">Loading properties...</span>\r\n          </div>\r\n          <div class=\"rs-property-carousel__empty\" style=\"display: none;\">\r\n            <p>No properties found</p>\r\n          </div>\r\n          <div class=\"rs-property-carousel__items\"></div>\r\n        </div>\r\n\r\n        <button class=\"rs-property-carousel__arrow rs-property-carousel__arrow--right\" type=\"button\" aria-label=\"${nextLabel}\">\r\n          <span class=\"rs-property-carousel__arrow-label\">Next</span>\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n            <polyline points=\"12 5 19 12 12 19\"></polyline>\r\n          </svg>\r\n        </button>\r\n      `;\r\n    } else {\r\n      this.element.innerHTML = `\r\n        <button class=\"rs-property-carousel__arrow rs-property-carousel__arrow--left\" type=\"button\" aria-label=\"${prevLabel}\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n\r\n        <div class=\"rs-property-carousel__track\">\r\n          <div class=\"rs-property-carousel__loader\">\r\n            <div class=\"rs-property-carousel__spinner\"></div>\r\n            <span class=\"rs-property-carousel__loader-text\">Loading properties...</span>\r\n          </div>\r\n          <div class=\"rs-property-carousel__empty\" style=\"display: none;\">\r\n            <p>No properties found</p>\r\n          </div>\r\n          <div class=\"rs-property-carousel__items\"></div>\r\n        </div>\r\n\r\n        <button class=\"rs-property-carousel__arrow rs-property-carousel__arrow--right\" type=\"button\" aria-label=\"${nextLabel}\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n\r\n        <div class=\"rs-property-carousel__dots\"></div>\r\n      `;\r\n    }\r\n\r\n    this.track = this.element.querySelector('.rs-property-carousel__track');\r\n    this.itemsContainer = this.element.querySelector('.rs-property-carousel__items');\r\n    this.dotsContainer = this.element.querySelector('.rs-property-carousel__dots');\r\n    this.loader = this.element.querySelector('.rs-property-carousel__loader');\r\n    this.emptyState = this.element.querySelector('.rs-property-carousel__empty');\r\n    this.leftArrow = this.element.querySelector('.rs-property-carousel__arrow--left');\r\n    this.rightArrow = this.element.querySelector('.rs-property-carousel__arrow--right');\r\n\r\n    // If properties are already loaded (e.g., after language change re-render),\r\n    // re-render the items with updated labels\r\n    if (this.properties.length > 0) {\r\n      // Reset V2/V3 initialized flags so items are recreated with new labels\r\n      this.v2Initialized = false;\r\n      this.v3Initialized = false;\r\n      this.hideLoader();\r\n      this.renderItems();\r\n    }\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Arrow navigation\r\n    this.leftArrow?.addEventListener('click', () => this.moveLeft());\r\n    this.rightArrow?.addEventListener('click', () => this.moveRight());\r\n\r\n    // Keyboard navigation\r\n    this.element.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (e.key === 'ArrowLeft') {\r\n        e.preventDefault();\r\n        this.moveLeft();\r\n      } else if (e.key === 'ArrowRight') {\r\n        e.preventDefault();\r\n        this.moveRight();\r\n      }\r\n    });\r\n\r\n    // Touch swipe support\r\n    this.track?.addEventListener('touchstart', (e: TouchEvent) => {\r\n      this.touchStartX = e.changedTouches[0].screenX;\r\n      this.stopAutoPlay();\r\n    }, { passive: true });\r\n\r\n    this.track?.addEventListener('touchend', (e: TouchEvent) => {\r\n      this.touchEndX = e.changedTouches[0].screenX;\r\n      this.handleSwipe();\r\n      this.startAutoPlay();\r\n    }, { passive: true });\r\n\r\n    // Pause autoplay on hover\r\n    this.element.addEventListener('mouseenter', () => this.stopAutoPlay());\r\n    this.element.addEventListener('mouseleave', () => this.startAutoPlay());\r\n\r\n    // Re-render on resize for responsive transforms (debounced)\r\n    let resizeTimeout: ReturnType<typeof setTimeout>;\r\n    window.addEventListener('resize', () => {\r\n      clearTimeout(resizeTimeout);\r\n      resizeTimeout = setTimeout(() => {\r\n        if (this.properties.length > 0) {\r\n          this.renderItems();\r\n        }\r\n      }, 250);\r\n    });\r\n\r\n    // Dot navigation (not used in V4)\r\n    if (this.dotsContainer) {\r\n      this.dotsContainer.addEventListener('click', (e: Event) => {\r\n        const target = e.target as HTMLElement;\r\n        const dot = target.closest('.rs-property-carousel__dot') as HTMLElement | null;\r\n        if (dot) {\r\n          const index = parseInt(dot.dataset.index || '0');\r\n          this.goToSlide(index);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Click on side cards to navigate\r\n    this.itemsContainer?.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const item = target.closest('.rs-property-carousel__item') as HTMLElement | null;\r\n      if (!item) return;\r\n\r\n      const level = this.getItemLevel(item);\r\n\r\n      // If clicking side cards, navigate carousel (prevent link)\r\n      if (level === -2 || level === -1) {\r\n        e.preventDefault();\r\n        this.moveLeft();\r\n      } else if (level === 1 || level === 2) {\r\n        e.preventDefault();\r\n        this.moveRight();\r\n      }\r\n      // Center card (level 0) - let the link work\r\n    });\r\n\r\n    // View button click delegation (replaces inline onclick)\r\n    this.element.addEventListener('click', (e: Event) => {\r\n      const target = e.target as HTMLElement;\r\n      const viewBtn = target.closest('[data-rs-property-url]') as HTMLElement | null;\r\n      if (!viewBtn) return;\r\n\r\n      const url = viewBtn.dataset.rsPropertyUrl;\r\n      if (!url) return;\r\n\r\n      // Try SPA navigation if router is available\r\n      const me = e as MouseEvent;\r\n      if (typeof (window as any).RealtySoftRouter !== 'undefined' &&\r\n          (window as any).RealtySoftRouter.isEnabled() &&\r\n          !me.ctrlKey && !me.metaKey && !me.shiftKey) {\r\n        // Find the property for this URL\r\n        const prop = this.properties.find(p => this.generatePropertyUrl(p) === url);\r\n        if (prop) {\r\n          e.preventDefault();\r\n          (window as any).RealtySoftRouter.navigateToProperty(prop, url);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Fallback: standard navigation\r\n      window.location.href = url;\r\n    });\r\n  }\r\n\r\n  private getItemLevel(item: HTMLElement): number | null {\r\n    if (item.classList.contains('rs-property-carousel__item--level-2')) return -2;\r\n    if (item.classList.contains('rs-property-carousel__item--level-1')) return -1;\r\n    if (item.classList.contains('rs-property-carousel__item--level0')) return 0;\r\n    if (item.classList.contains('rs-property-carousel__item--level1')) return 1;\r\n    if (item.classList.contains('rs-property-carousel__item--level2')) return 2;\r\n    return null;\r\n  }\r\n\r\n  private handleSwipe(): void {\r\n    const swipeThreshold = 50;\r\n    const diff = this.touchStartX - this.touchEndX;\r\n\r\n    if (Math.abs(diff) > swipeThreshold) {\r\n      if (diff > 0) {\r\n        this.moveRight();\r\n      } else {\r\n        this.moveLeft();\r\n      }\r\n    }\r\n  }\r\n\r\n  private async loadProperties(): Promise<void> {\r\n    console.log('[RSPropertyCarousel] Loading properties...');\r\n    this.showLoader();\r\n\r\n    try {\r\n      if (typeof RealtySoftAPI === 'undefined') {\r\n        throw new Error('RealtySoftAPI is not available');\r\n      }\r\n\r\n      // Build params - these are INDEPENDENT from page filters\r\n      const params: Record<string, unknown> = {\r\n        per_page: this.limit,\r\n        page: 1\r\n      };\r\n\r\n      // Apply carousel-specific filters\r\n      if (this.featured) params.is_featured = 1;\r\n      if (this.own) params.is_own = 1;\r\n      if (this.location) params.location_id = this.location;\r\n      if (this.listingType) params.listing_type = this.listingType;\r\n      if (this.propertyType) params.type_id = this.propertyType;\r\n      if (this.minPrice) params.price_min = this.minPrice;\r\n      if (this.maxPrice) params.price_max = this.maxPrice;\r\n      if (this.minBeds) params.bedrooms_min = this.minBeds;\r\n\r\n      console.log('[RSPropertyCarousel] API params:', params);\r\n      const result = await RealtySoftAPI.searchProperties(params);\r\n      console.log('[RSPropertyCarousel] API result:', result);\r\n\r\n      if (result && result.data && result.data.length > 0) {\r\n        this.properties = result.data;\r\n\r\n        // Sort own properties first if ownFirst is enabled\r\n        if (this.ownFirst) {\r\n          this.properties.sort((a, b) => {\r\n            const aOwn = a.is_own ? 1 : 0;\r\n            const bOwn = b.is_own ? 1 : 0;\r\n            return bOwn - aOwn; // Own properties first\r\n          });\r\n          console.log('[RSPropertyCarousel] Sorted with own properties first');\r\n        }\r\n\r\n        console.log('[RSPropertyCarousel] Loaded', this.properties.length, 'properties');\r\n\r\n        // For template 2 and 3, start at index 2 to show cards on both sides\r\n        if ((this.variation === '2' || this.variation === '3') && this.properties.length > 4) {\r\n          this.active = 2;\r\n        }\r\n\r\n        this.hideLoader();\r\n        this.renderItems();\r\n        this.startAutoPlay();\r\n      } else {\r\n        console.log('[RSPropertyCarousel] No properties returned');\r\n        this.showEmptyState();\r\n      }\r\n    } catch (error) {\r\n      console.error('[RSPropertyCarousel] Failed to load properties:', error);\r\n      this.showEmptyState('Failed to load properties');\r\n    }\r\n  }\r\n\r\n  private showLoader(): void {\r\n    if (this.loader) this.loader.style.display = 'flex';\r\n    if (this.emptyState) this.emptyState.style.display = 'none';\r\n    if (this.itemsContainer) this.itemsContainer.style.opacity = '0';\r\n  }\r\n\r\n  private hideLoader(): void {\r\n    if (this.loader) this.loader.style.display = 'none';\r\n    if (this.itemsContainer) this.itemsContainer.style.opacity = '1';\r\n  }\r\n\r\n  private showEmptyState(message?: string): void {\r\n    if (this.loader) this.loader.style.display = 'none';\r\n    if (this.emptyState) {\r\n      this.emptyState.style.display = 'flex';\r\n      if (message) {\r\n        const p = this.emptyState.querySelector('p');\r\n        if (p) p.textContent = message;\r\n      }\r\n    }\r\n    if (this.leftArrow) this.leftArrow.style.display = 'none';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Generate 5 visible items based on active index\r\n   */\r\n  private generateVisibleItems(): VisibleItem[] {\r\n    const items: VisibleItem[] = [];\r\n    const total = this.properties.length;\r\n\r\n    if (total === 0) return items;\r\n\r\n    // Handle small datasets\r\n    if (total < 5) {\r\n      for (let i = 0; i < total; i++) {\r\n        const offset = i - Math.floor(total / 2);\r\n        items.push({\r\n          property: this.properties[i],\r\n          level: offset,\r\n          index: i\r\n        });\r\n      }\r\n      return items;\r\n    }\r\n\r\n    // Generate 5 items centered on active\r\n    for (let offset = -2; offset <= 2; offset++) {\r\n      let index = this.active + offset;\r\n      if (index < 0) index = total + index;\r\n      else if (index >= total) index = index % total;\r\n\r\n      items.push({\r\n        property: this.properties[index],\r\n        level: offset,\r\n        index\r\n      });\r\n    }\r\n\r\n    return items;\r\n  }\r\n\r\n  private renderItems(): void {\r\n    // For template 2, 3, and 4, we render all items with transforms\r\n    if (this.variation === '2') {\r\n      this.renderItemsV2();\r\n      return;\r\n    }\r\n\r\n    if (this.variation === '3') {\r\n      this.renderItemsV3();\r\n      return;\r\n    }\r\n\r\n    if (this.variation === '4') {\r\n      this.renderItemsV4();\r\n      return;\r\n    }\r\n\r\n    if (this.variation === '5') {\r\n      this.renderItemsV5();\r\n      return;\r\n    }\r\n\r\n    if (this.variation === '6') {\r\n      this.renderItemsV6();\r\n      return;\r\n    }\r\n\r\n    console.log('[RSPropertyCarousel] Rendering V1 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // Generate visible items and render\r\n    const visibleItems = this.generateVisibleItems();\r\n    if (this.itemsContainer) this.itemsContainer.innerHTML = '';\r\n\r\n    visibleItems.forEach(({ property, level, index }) => {\r\n      const item = this.createCarouselItem(property, level, index);\r\n      this.itemsContainer?.appendChild(item);\r\n    });\r\n\r\n    this.renderDots();\r\n\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  /**\r\n   * Render items for Template 2 (3D Perspective)\r\n   * Applies 3D transforms directly via inline styles\r\n   */\r\n  private renderItemsV2(): void {\r\n    const maxVisibility = 3;\r\n    console.log('[RSPropertyCarousel] Rendering V2 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // First render - create all items\r\n    if (!this.v2Initialized && this.itemsContainer) {\r\n      this.itemsContainer.innerHTML = '';\r\n      this.properties.forEach((property, index) => {\r\n        const item = this.createCarouselItemV2(property, index);\r\n        this.itemsContainer?.appendChild(item);\r\n      });\r\n      this.v2Initialized = true;\r\n    }\r\n\r\n    // Update transforms for all items\r\n    const items = this.itemsContainer?.querySelectorAll('.rs-property-carousel__item') || [];\r\n    const total = this.properties.length;\r\n\r\n    items.forEach((item, index) => {\r\n      let offsetFromActive = this.active - index;\r\n\r\n      // Wrap offset for infinite looping\r\n      if (offsetFromActive > total / 2) {\r\n        offsetFromActive -= total;\r\n      } else if (offsetFromActive < -total / 2) {\r\n        offsetFromActive += total;\r\n      }\r\n\r\n      const absOffsetFromActive = Math.abs(offsetFromActive);\r\n      const isActive = offsetFromActive === 0;\r\n      const isVisible = absOffsetFromActive < maxVisibility;\r\n\r\n      this.updateCarouselItemV2Transform(item as HTMLElement, {\r\n        offsetFromActive,\r\n        absOffsetFromActive,\r\n        isActive,\r\n        isVisible\r\n      });\r\n    });\r\n\r\n    this.renderDots();\r\n\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  private createCarouselItemV2(property: Property, index: number): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = 'rs-property-carousel__item';\r\n    item.dataset.index = String(index);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    const bedIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds}</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths}</span>`;\r\n    }\r\n\r\n    const viewLabel = this.label('card_view') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n        <div class=\"rs-property-carousel__card-overlay\">\r\n          <h3 class=\"rs-property-carousel__card-title\">${this.escapeHtml(property.title || '')}</h3>\r\n          ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n          <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n          <span class=\"rs-property-carousel__card-link\">${viewLabel} &rarr;</span>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  private updateCarouselItemV2Transform(item: HTMLElement, { offsetFromActive, absOffsetFromActive, isActive, isVisible }: TransformOptions): void {\r\n    // Get responsive values based on screen width\r\n    const screenWidth = window.innerWidth;\r\n    let translateXMultiplier = 120;\r\n    let translateZMultiplier = -100;\r\n    let rotateMultiplier = -15;\r\n    let blurMultiplier = 4;\r\n\r\n    if (screenWidth <= 400) {\r\n      translateXMultiplier = 70;\r\n      translateZMultiplier = -60;\r\n      rotateMultiplier = -10;\r\n      blurMultiplier = 3;\r\n    } else if (screenWidth <= 600) {\r\n      translateXMultiplier = 90;\r\n      translateZMultiplier = -80;\r\n      rotateMultiplier = -12;\r\n      blurMultiplier = 3;\r\n    } else if (screenWidth <= 900) {\r\n      translateXMultiplier = 100;\r\n      translateZMultiplier = -90;\r\n      rotateMultiplier = -12;\r\n    }\r\n\r\n    // Calculate 3D transform values\r\n    const rotateY = offsetFromActive * rotateMultiplier;\r\n    const scale = isActive ? 1 : Math.max(0.7, 1 - absOffsetFromActive * 0.15);\r\n    const translateZ = absOffsetFromActive * translateZMultiplier;\r\n    const translateX = offsetFromActive * translateXMultiplier;\r\n    const blur = isActive ? 0 : Math.min(absOffsetFromActive * blurMultiplier, 10);\r\n\r\n    // Apply transforms - CSS will animate these\r\n    item.style.transform = `translateX(${translateX}px) translateZ(${translateZ}px) rotateY(${rotateY}deg) scale(${scale})`;\r\n    item.style.filter = blur > 0 ? `blur(${blur}px)` : 'none';\r\n    item.style.pointerEvents = isActive ? 'auto' : 'none';\r\n    item.style.zIndex = String(10 - absOffsetFromActive);\r\n    item.style.opacity = isVisible ? (isActive ? '1' : '0.95') : '0';\r\n\r\n    // Update overlay opacity\r\n    const overlay = item.querySelector('.rs-property-carousel__card-overlay') as HTMLElement | null;\r\n    if (overlay) {\r\n      overlay.style.opacity = isActive ? '1' : '0';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render items for Template 3 (Coverflow)\r\n   * Cards rotate to face center, with faded/greyscale effect on sides\r\n   */\r\n  private renderItemsV3(): void {\r\n    const maxVisibility = 3;\r\n    console.log('[RSPropertyCarousel] Rendering V3 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // First render - create all items\r\n    if (!this.v3Initialized && this.itemsContainer) {\r\n      this.itemsContainer.innerHTML = '';\r\n      this.properties.forEach((property, index) => {\r\n        const item = this.createCarouselItemV3(property, index);\r\n        this.itemsContainer?.appendChild(item);\r\n      });\r\n      this.v3Initialized = true;\r\n    }\r\n\r\n    // Update transforms for all items\r\n    const items = this.itemsContainer?.querySelectorAll('.rs-property-carousel__item') || [];\r\n    const total = this.properties.length;\r\n\r\n    items.forEach((item, index) => {\r\n      let offsetFromActive = this.active - index;\r\n\r\n      // Wrap offset for infinite looping\r\n      if (offsetFromActive > total / 2) {\r\n        offsetFromActive -= total;\r\n      } else if (offsetFromActive < -total / 2) {\r\n        offsetFromActive += total;\r\n      }\r\n\r\n      const absOffsetFromActive = Math.abs(offsetFromActive);\r\n      const isActive = offsetFromActive === 0;\r\n      const isVisible = absOffsetFromActive < maxVisibility;\r\n\r\n      this.updateCarouselItemV3Transform(item as HTMLElement, {\r\n        offsetFromActive,\r\n        absOffsetFromActive,\r\n        isActive,\r\n        isVisible\r\n      });\r\n    });\r\n\r\n    this.renderDots();\r\n\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  private createCarouselItemV3(property: Property, index: number): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = 'rs-property-carousel__item';\r\n    item.dataset.index = String(index);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    const bedIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds}</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths}</span>`;\r\n    }\r\n\r\n    const viewLabel = this.label('card_view') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n        <div class=\"rs-property-carousel__card-overlay\">\r\n          <h3 class=\"rs-property-carousel__card-title\">${this.escapeHtml(property.title || '')}</h3>\r\n          ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n          <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n          <span class=\"rs-property-carousel__card-link\">${viewLabel} &rarr;</span>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  private updateCarouselItemV3Transform(item: HTMLElement, { offsetFromActive, absOffsetFromActive, isActive, isVisible }: TransformOptions): void {\r\n    // Get responsive values based on screen width\r\n    const screenWidth = window.innerWidth;\r\n    let translateXMultiplier = 240;\r\n    let rotateMultiplier = 45;\r\n    let scaleBase = 0.85;\r\n    let zDepth = 100;\r\n\r\n    if (screenWidth <= 400) {\r\n      translateXMultiplier = 120;\r\n      rotateMultiplier = 40;\r\n      scaleBase = 0.8;\r\n      zDepth = 60;\r\n    } else if (screenWidth <= 600) {\r\n      translateXMultiplier = 160;\r\n      rotateMultiplier = 42;\r\n      scaleBase = 0.82;\r\n      zDepth = 80;\r\n    } else if (screenWidth <= 900) {\r\n      translateXMultiplier = 200;\r\n      rotateMultiplier = 44;\r\n      scaleBase = 0.83;\r\n      zDepth = 90;\r\n    }\r\n\r\n    // Calculate transforms - cards rotate INWARD to face center\r\n    const rotateY = isActive ? 0 : (offsetFromActive > 0 ? rotateMultiplier : -rotateMultiplier);\r\n    const scale = isActive ? 1 : Math.max(0.7, scaleBase - absOffsetFromActive * 0.05);\r\n    const translateX = -offsetFromActive * translateXMultiplier;\r\n    const translateZ = isActive ? 100 : -zDepth * absOffsetFromActive;\r\n\r\n    // Greyscale/saturation effect for side cards\r\n    const saturation = isActive ? 100 : Math.max(20, 100 - absOffsetFromActive * 35);\r\n    const brightness = isActive ? 100 : Math.max(70, 100 - absOffsetFromActive * 12);\r\n\r\n    // On mobile (600px and below), only show center card\r\n    const mobileOnly = screenWidth <= 600;\r\n    const shouldShow = mobileOnly ? isActive : isVisible;\r\n\r\n    // Apply transforms\r\n    item.style.transform = `translateX(${translateX}px) translateZ(${translateZ}px) rotateY(${rotateY}deg) scale(${scale})`;\r\n    item.style.filter = isActive ? 'none' : `saturate(${saturation}%) brightness(${brightness}%)`;\r\n    item.style.pointerEvents = isActive ? 'auto' : 'none';\r\n    item.style.zIndex = String(10 - absOffsetFromActive);\r\n    item.style.opacity = shouldShow ? '1' : '0';\r\n\r\n    // Update overlay opacity\r\n    const overlay = item.querySelector('.rs-property-carousel__card-overlay') as HTMLElement | null;\r\n    if (overlay) {\r\n      overlay.style.opacity = isActive ? '1' : '0';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render items for Template 4 (Fullwidth Image with Side Navigation)\r\n   */\r\n  private renderItemsV4(): void {\r\n    console.log('[RSPropertyCarousel] Rendering V4 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // Render current active item only\r\n    const property = this.properties[this.active];\r\n    if (this.itemsContainer) this.itemsContainer.innerHTML = '';\r\n\r\n    const item = this.createCarouselItemV4(property, this.active);\r\n    this.itemsContainer?.appendChild(item);\r\n\r\n    // Update page counter\r\n    this.updatePageCounter();\r\n\r\n    // Show custom navigation\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  private createCarouselItemV4(property: Property, index: number): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = 'rs-property-carousel__item';\r\n    item.dataset.index = String(index);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    const bedIcon = `<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds}</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths}</span>`;\r\n    }\r\n\r\n    const viewLabel = this.label('card_view') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n        <div class=\"rs-property-carousel__card-overlay\">\r\n          <h3 class=\"rs-property-carousel__card-title\">${this.escapeHtml(property.title || '')}</h3>\r\n          ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n          <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n          <span class=\"rs-property-carousel__card-link\">${viewLabel} &rarr;</span>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  private updatePageCounter(): void {\r\n    if (this.variation !== '4') return;\r\n\r\n    let counter = this.element.querySelector('.rs-property-carousel__counter') as HTMLElement | null;\r\n    if (!counter) {\r\n      counter = document.createElement('div');\r\n      counter.className = 'rs-property-carousel__counter';\r\n      this.element.appendChild(counter);\r\n    }\r\n    counter.innerHTML = `<span class=\"rs-property-carousel__counter-current\">${this.active + 1}</span>/<span class=\"rs-property-carousel__counter-total\">${this.properties.length}</span>`;\r\n  }\r\n\r\n  /**\r\n   * Render items for Template 5 (Tilted/Skewed Images)\r\n   */\r\n  private renderItemsV5(): void {\r\n    console.log('[RSPropertyCarousel] Rendering V5 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // Show 3 items at a time\r\n    if (this.itemsContainer) this.itemsContainer.innerHTML = '';\r\n    const visibleCount = Math.min(3, this.properties.length);\r\n\r\n    for (let i = 0; i < visibleCount; i++) {\r\n      const index = (this.active + i) % this.properties.length;\r\n      const property = this.properties[index];\r\n      const item = this.createCarouselItemV5(property, index);\r\n      this.itemsContainer?.appendChild(item);\r\n    }\r\n\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  private createCarouselItemV5(property: Property, index: number): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = 'rs-property-carousel__item';\r\n    item.dataset.index = String(index);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    const bedIcon = `<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds}</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths}</span>`;\r\n    }\r\n\r\n    const viewLabel = this.label('card_view') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <div class=\"rs-property-carousel__card-inner\">\r\n          <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n          <div class=\"rs-property-carousel__card-overlay\">\r\n            <h3 class=\"rs-property-carousel__card-title\">${this.escapeHtml(property.title || '')}</h3>\r\n            ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n            <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n            <span class=\"rs-property-carousel__card-link\">${viewLabel} &rarr;</span>\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  /**\r\n   * Render items for Template 6 (Dark Cards with Numbers)\r\n   */\r\n  private renderItemsV6(): void {\r\n    console.log('[RSPropertyCarousel] Rendering V6 with', this.properties.length, 'items, active:', this.active);\r\n\r\n    if (this.properties.length === 0) {\r\n      this.showEmptyState();\r\n      return;\r\n    }\r\n\r\n    // Show 3 items at a time\r\n    if (this.itemsContainer) this.itemsContainer.innerHTML = '';\r\n    const visibleCount = Math.min(3, this.properties.length);\r\n\r\n    for (let i = 0; i < visibleCount; i++) {\r\n      const index = (this.active + i) % this.properties.length;\r\n      const property = this.properties[index];\r\n      const isFirst = i === 0;\r\n      const displayNumber = String(index + 1).padStart(2, '0');\r\n      const item = this.createCarouselItemV6(property, index, displayNumber, isFirst);\r\n      this.itemsContainer?.appendChild(item);\r\n    }\r\n\r\n    if (this.leftArrow) this.leftArrow.style.display = 'flex';\r\n    if (this.rightArrow) this.rightArrow.style.display = 'flex';\r\n  }\r\n\r\n  private createCarouselItemV6(property: Property, index: number, displayNumber: string, isActive: boolean): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = `rs-property-carousel__item ${isActive ? 'rs-property-carousel__item--active' : ''}`;\r\n    item.dataset.index = String(index);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    // Get location - try multiple possible fields\r\n    const location = (property.location as { name?: string })?.name || property.location || '';\r\n\r\n    const bedIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds} Beds</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths} Bath</span>`;\r\n    }\r\n\r\n    const propertyType = property.type || 'Apartment';\r\n    const viewDetailLabel = this.label('view_details') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <span class=\"rs-property-carousel__card-number\">${displayNumber}</span>\r\n      <p class=\"rs-property-carousel__card-type\">${this.escapeHtml(propertyType)}</p>\r\n      ${location ? `<p class=\"rs-property-carousel__card-location\">${this.escapeHtml(String(location))}</p>` : ''}\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <div class=\"rs-property-carousel__card-image-wrapper\">\r\n          <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n          ${property.is_featured ? '<span class=\"rs-property-carousel__card-badge\">POPULAR</span>' : ''}\r\n        </div>\r\n      </a>\r\n      <div class=\"rs-property-carousel__card-info\">\r\n        <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n        ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n      </div>\r\n      <button class=\"rs-property-carousel__card-view-btn\" data-rs-property-url=\"${propertyUrl}\">${viewDetailLabel}</button>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  private createCarouselItem(property: Property, level: number, index: number): HTMLElement {\r\n    const item = document.createElement('div');\r\n    item.className = `rs-property-carousel__item rs-property-carousel__item--level${level < 0 ? level : (level > 0 ? level : '0')}`;\r\n    item.dataset.index = String(index);\r\n    item.dataset.level = String(level);\r\n\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const mainImage = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n\r\n    let price = '';\r\n    if (typeof RealtySoftLabels !== 'undefined' && RealtySoftLabels.formatPrice) {\r\n      price = RealtySoftLabels.formatPrice(property.price);\r\n    } else {\r\n      price = property.price ? `â‚¬${property.price.toLocaleString()}` : '';\r\n    }\r\n\r\n    const bedIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M2 4v16\"></path>\r\n      <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n      <path d=\"M2 17h20\"></path>\r\n      <path d=\"M6 8v9\"></path>\r\n    </svg>`;\r\n\r\n    const bathIcon = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path>\r\n      <line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line>\r\n      <line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line>\r\n      <line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line>\r\n      <line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line>\r\n    </svg>`;\r\n\r\n    let specsHtml = '';\r\n    if (property.beds && property.beds > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bedIcon} ${property.beds}</span>`;\r\n    }\r\n    if (property.baths && property.baths > 0) {\r\n      specsHtml += `<span class=\"rs-property-carousel__card-spec\">${bathIcon} ${property.baths}</span>`;\r\n    }\r\n\r\n    const viewLabel = this.label('card_view') || 'View Details';\r\n\r\n    item.innerHTML = `\r\n      <a href=\"${propertyUrl}\" class=\"rs-property-carousel__card\">\r\n        <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title || '')}\" class=\"rs-property-carousel__card-image\" loading=\"lazy\">\r\n        <div class=\"rs-property-carousel__card-overlay\">\r\n          <h3 class=\"rs-property-carousel__card-title\">${this.escapeHtml(property.title || '')}</h3>\r\n          ${specsHtml ? `<div class=\"rs-property-carousel__card-specs\">${specsHtml}</div>` : ''}\r\n          <p class=\"rs-property-carousel__card-price\">${price}</p>\r\n          <span class=\"rs-property-carousel__card-link\">${viewLabel} &rarr;</span>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    return item;\r\n  }\r\n\r\n  private renderDots(): void {\r\n    if (!this.dotsContainer) return;\r\n\r\n    if (this.properties.length <= 1) {\r\n      this.dotsContainer.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.dotsContainer.style.display = 'flex';\r\n    this.dotsContainer.innerHTML = '';\r\n\r\n    this.properties.forEach((_, index) => {\r\n      const dot = document.createElement('button');\r\n      dot.className = `rs-property-carousel__dot ${index === this.active ? 'rs-property-carousel__dot--active' : ''}`;\r\n      dot.dataset.index = String(index);\r\n      dot.type = 'button';\r\n      dot.setAttribute('aria-label', `Go to slide ${index + 1}`);\r\n      this.dotsContainer?.appendChild(dot);\r\n    });\r\n  }\r\n\r\n  private updateDots(): void {\r\n    if (!this.dotsContainer) return;\r\n    const dots = this.dotsContainer.querySelectorAll('.rs-property-carousel__dot');\r\n    dots.forEach((dot, index) => {\r\n      dot.classList.toggle('rs-property-carousel__dot--active', index === this.active);\r\n    });\r\n  }\r\n\r\n  private moveLeft(): void {\r\n    if (this.properties.length <= 1 || this.isAnimating) return;\r\n\r\n    this.isAnimating = true;\r\n    this.active = this.active - 1 < 0 ? this.properties.length - 1 : this.active - 1;\r\n\r\n    // Simple re-render - CSS transitions handle the animation\r\n    this.renderItems();\r\n    this.updateDots();\r\n\r\n    // Debounce to prevent rapid clicking\r\n    setTimeout(() => {\r\n      this.isAnimating = false;\r\n    }, 400);\r\n  }\r\n\r\n  private moveRight(): void {\r\n    if (this.properties.length <= 1 || this.isAnimating) return;\r\n\r\n    this.isAnimating = true;\r\n    this.active = (this.active + 1) % this.properties.length;\r\n\r\n    // Simple re-render - CSS transitions handle the animation\r\n    this.renderItems();\r\n    this.updateDots();\r\n\r\n    // Debounce to prevent rapid clicking\r\n    setTimeout(() => {\r\n      this.isAnimating = false;\r\n    }, 400);\r\n  }\r\n\r\n  private goToSlide(index: number): void {\r\n    if (index === this.active || index < 0 || index >= this.properties.length || this.isAnimating) return;\r\n\r\n    this.isAnimating = true;\r\n    this.active = index;\r\n\r\n    this.renderItems();\r\n    this.updateDots();\r\n\r\n    setTimeout(() => {\r\n      this.isAnimating = false;\r\n    }, 400);\r\n  }\r\n\r\n  private startAutoPlay(): void {\r\n    if (!this.autoPlay || this.properties.length <= 1) return;\r\n\r\n    this.stopAutoPlay();\r\n    this.autoPlayTimer = setInterval(() => {\r\n      this.moveRight();\r\n    }, this.autoPlayInterval);\r\n  }\r\n\r\n  private stopAutoPlay(): void {\r\n    if (this.autoPlayTimer) {\r\n      clearInterval(this.autoPlayTimer);\r\n      this.autoPlayTimer = null;\r\n    }\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.stopAutoPlay();\r\n    super.destroy();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_property_carousel', RSPropertyCarousel as unknown as ComponentConstructor);\r\n\r\nexport { RSPropertyCarousel };\r\nexport default RSPropertyCarousel;\r\n","/**\r\n * RealtySoft Widget v3 - Pagination Component\r\n * Page navigation with numbers and prev/next\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSPagination extends RSBaseComponent {\r\n  private currentPage: number = 1;\r\n  private totalPages: number = 0;\r\n  private loading: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.currentPage = 1;\r\n    this.totalPages = 0;\r\n    this.loading = false;\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    this.subscribe<number>('results.page', (page) => {\r\n      this.currentPage = page;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    this.subscribe<number>('results.totalPages', (total) => {\r\n      this.totalPages = total;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    this.subscribe<boolean>('ui.loading', (loading) => {\r\n      this.loading = loading;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-pagination');\r\n    this.updateDisplay();\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.element.addEventListener('click', (e: Event) => {\r\n      if (this.loading) return;\r\n\r\n      const target = e.target as HTMLElement;\r\n      const button = target.closest('button');\r\n      if (!button) return;\r\n\r\n      e.preventDefault();\r\n\r\n      if (button.classList.contains('rs-pagination__prev')) {\r\n        this.goToPage(this.currentPage - 1);\r\n      } else if (button.classList.contains('rs-pagination__next')) {\r\n        this.goToPage(this.currentPage + 1);\r\n      } else if (button.classList.contains('rs-pagination__page')) {\r\n        this.goToPage(parseInt(button.dataset.page || '1'));\r\n      } else if (button.classList.contains('rs-pagination__load-more')) {\r\n        // Load more functionality\r\n        this.loadMore();\r\n      }\r\n    });\r\n  }\r\n\r\n  private goToPage(page: number): void {\r\n    if (page < 1 || page > this.totalPages || page === this.currentPage) return;\r\n    RealtySoft.goToPage(page);\r\n\r\n    // Scroll to top of results\r\n    const grid = document.querySelector('.rs_property_grid');\r\n    if (grid) {\r\n      grid.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n    }\r\n  }\r\n\r\n  private loadMore(): void {\r\n    // For \"load more\" style pagination\r\n    if (this.currentPage < this.totalPages) {\r\n      // This would append results instead of replacing\r\n      RealtySoft.goToPage(this.currentPage + 1);\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.totalPages <= 1) {\r\n      this.element.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    const pages = this.getPageNumbers();\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-pagination__wrapper\">\r\n        <button type=\"button\"\r\n                class=\"rs-pagination__btn rs-pagination__prev\"\r\n                ${this.currentPage === 1 || this.loading ? 'disabled' : ''}>\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n          </svg>\r\n          <span>${this.label('pagination_prev')}</span>\r\n        </button>\r\n\r\n        <div class=\"rs-pagination__pages\">\r\n          ${pages.map(page => {\r\n            if (page === '...') {\r\n              return '<span class=\"rs-pagination__ellipsis\">...</span>';\r\n            }\r\n            return `\r\n              <button type=\"button\"\r\n                      class=\"rs-pagination__btn rs-pagination__page ${page === this.currentPage ? 'rs-pagination__page--active' : ''}\"\r\n                      data-page=\"${page}\"\r\n                      ${this.loading ? 'disabled' : ''}>\r\n                ${page}\r\n              </button>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-pagination__btn rs-pagination__next\"\r\n                ${this.currentPage === this.totalPages || this.loading ? 'disabled' : ''}>\r\n          <span>${this.label('pagination_next')}</span>\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"rs-pagination__info\">\r\n        ${this.label('pagination_page')}&nbsp;${this.currentPage}&nbsp;${this.label('pagination_of')}&nbsp;${this.totalPages}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private getPageNumbers(): (number | string)[] {\r\n    const pages: (number | string)[] = [];\r\n    const current = this.currentPage;\r\n    const total = this.totalPages;\r\n    const delta = 2; // Pages to show on each side of current\r\n\r\n    // Always show first page\r\n    pages.push(1);\r\n\r\n    // Calculate start and end of page range\r\n    const start = Math.max(2, current - delta);\r\n    const end = Math.min(total - 1, current + delta);\r\n\r\n    // Add ellipsis after first page if needed\r\n    if (start > 2) {\r\n      pages.push('...');\r\n    }\r\n\r\n    // Add page numbers\r\n    for (let i = start; i <= end; i++) {\r\n      pages.push(i);\r\n    }\r\n\r\n    // Add ellipsis before last page if needed\r\n    if (end < total - 1) {\r\n      pages.push('...');\r\n    }\r\n\r\n    // Always show last page if more than 1 page\r\n    if (total > 1) {\r\n      pages.push(total);\r\n    }\r\n\r\n    return pages;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_pagination', RSPagination as unknown as ComponentConstructor);\r\n\r\nexport { RSPagination };\r\nexport default RSPagination;\r\n","/**\r\n * RealtySoft Widget v3 - Sort Component\r\n * Dropdown for sorting results\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\ninterface SortOption {\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\nclass RSSort extends RSBaseComponent {\r\n  private currentSort: string = 'create_date_desc';\r\n  private sortOptions: SortOption[] = [];\r\n  private select: HTMLSelectElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.currentSort = (window as unknown as { RealtySoftState: { get: (key: string) => string | null } }).RealtySoftState.get('ui.sort') || 'create_date_desc';\r\n    this.buildSortOptions();\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    this.subscribe<string>('ui.sort', (sort) => {\r\n      this.currentSort = sort;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // Subscribe to language changes to rebuild options with new translations\r\n    this.subscribe<string>('config.language', () => {\r\n      this.buildSortOptions();\r\n      this.render();\r\n      this.bindEvents();\r\n    });\r\n  }\r\n\r\n  private buildSortOptions(): void {\r\n    // Full sort options matching API - rebuilt on language change\r\n    this.sortOptions = [\r\n      { value: 'create_date_desc', label: this.label('sort_newest') || 'Newest Listings' },\r\n      { value: 'create_date', label: this.label('sort_oldest') || 'Oldest Listings' },\r\n      { value: 'last_date_desc', label: this.label('sort_updated') || 'Recently Updated' },\r\n      { value: 'last_date', label: this.label('sort_oldest_updated') || 'Oldest Updated' },\r\n      { value: 'list_price', label: this.label('sort_price_asc') || 'Price: Low to High' },\r\n      { value: 'list_price_desc', label: this.label('sort_price_desc') || 'Price: High to Low' },\r\n      { value: 'is_featured_desc', label: this.label('sort_featured') || 'Featured First' },\r\n      { value: 'location_id', label: this.label('sort_location') || 'By Location' },\r\n      { value: 'is_own_desc', label: this.label('sort_own') || 'Own Properties First' }\r\n    ];\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-sort');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-sort__wrapper\">\r\n        <label class=\"rs-sort__label\">${this.label('results_sort')}</label>\r\n        <div class=\"rs-sort__select-wrapper\">\r\n          <select class=\"rs-sort__select\">\r\n            ${this.sortOptions.map(opt => `\r\n              <option value=\"${opt.value}\" ${this.currentSort === opt.value ? 'selected' : ''}>\r\n                ${opt.label}\r\n              </option>\r\n            `).join('')}\r\n          </select>\r\n          <span class=\"rs-sort__icon\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n            </svg>\r\n          </span>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.select = this.element.querySelector('.rs-sort__select');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.select) {\r\n      this.select.addEventListener('change', (e: Event) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        RealtySoft.setSort(target.value);\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.select) {\r\n      this.select.value = this.currentSort;\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_sort', RSSort as unknown as ComponentConstructor);\r\n\r\nexport { RSSort };\r\nexport default RSSort;\r\n","/**\r\n * RealtySoft Widget v3 - Results Count Component\r\n * Displays \"X properties found\"\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSResultsCount extends RSBaseComponent {\r\n  private total: number = 0;\r\n  private loading: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.total = 0;\r\n    this.loading = false;\r\n\r\n    this.render();\r\n\r\n    this.subscribe<number>('results.total', (total) => {\r\n      this.total = total;\r\n      this.updateDisplay();\r\n    });\r\n\r\n    this.subscribe<boolean>('ui.loading', (loading) => {\r\n      this.loading = loading;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-results-count');\r\n    this.updateDisplay();\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.loading) {\r\n      this.element.innerHTML = `<span class=\"rs-results-count__text rs-results-count__text--loading\">${this.label('results_loading')}</span>`;\r\n      return;\r\n    }\r\n\r\n    let text: string;\r\n    if (this.total === 0) {\r\n      text = this.label('results_count_zero');\r\n    } else if (this.total === 1) {\r\n      text = this.label('results_count_one');\r\n    } else {\r\n      text = this.label('results_count', { count: this.total.toLocaleString() });\r\n    }\r\n\r\n    this.element.innerHTML = `<span class=\"rs-results-count__text\">${text}</span>`;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_results_count', RSResultsCount as unknown as ComponentConstructor);\r\n\r\nexport { RSResultsCount };\r\nexport default RSResultsCount;\r\n","/**\r\n * RealtySoft Widget v3 - Active Filters Component\r\n * Displays active filters as read-only informational tags\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAPIModule,\r\n  FilterState,\r\n  Feature,\r\n  Location,\r\n  PropertyType\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\n\r\ninterface ActiveFilter {\r\n  name: string;\r\n  label: string;\r\n  value: string;\r\n}\r\n\r\nclass RSActiveFilters extends RSBaseComponent {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.render();\r\n\r\n    // Subscribe to all filter changes\r\n    this.subscribe<FilterState>('filters', () => {\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // Subscribe to features data changes (for resolving feature names)\r\n    this.subscribe<Feature[]>('data.features', () => {\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // If there are feature filters but no features data, load features on demand\r\n    this.loadFeaturesIfNeeded();\r\n  }\r\n\r\n  private async loadFeaturesIfNeeded(): Promise<void> {\r\n    const filters = RealtySoftState.get<FilterState>('filters');\r\n    const featuresData = RealtySoftState.get<Feature[]>('data.features');\r\n\r\n    // If there are feature filters but no features data loaded, fetch features\r\n    if (filters?.features && filters.features.length > 0 && (!featuresData || featuresData.length === 0)) {\r\n      try {\r\n        const result = await RealtySoftAPI.getFeatures();\r\n        if (result.data) {\r\n          RealtySoftState.set('data.features', result.data);\r\n          // updateDisplay will be called by the subscription\r\n        }\r\n      } catch (e) {\r\n        console.warn('[RealtySoft] Could not load features for active filters:', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-active-filters');\r\n    this.updateDisplay();\r\n  }\r\n\r\n  /**\r\n   * Resolve a location ID to its name by searching through\r\n   * the locations tree (including children).\r\n   */\r\n  private resolveLocationName(id: number): string {\r\n    const locations = RealtySoftState.get<Location[]>('data.locations') || [];\r\n\r\n    const findInTree = (list: Location[]): string | null => {\r\n      for (const loc of list) {\r\n        if (loc.id === id) return loc.name;\r\n        if (loc.children) {\r\n          const found = findInTree(loc.children);\r\n          if (found) return found;\r\n        }\r\n      }\r\n      return null;\r\n    };\r\n\r\n    return findInTree(locations) || String(id);\r\n  }\r\n\r\n  /**\r\n   * Resolve a property type ID to its name from the flat\r\n   * property types list.\r\n   */\r\n  private resolvePropertyTypeName(id: number): string {\r\n    const types = RealtySoftState.get<PropertyType[]>('data.propertyTypes') || [];\r\n    const found = types.find(t => t.id === id);\r\n    return found ? found.name : String(id);\r\n  }\r\n\r\n  /**\r\n   * Resolve one or more IDs to display names using the given resolver.\r\n   */\r\n  private resolveIds(\r\n    ids: number | number[],\r\n    resolver: (id: number) => string\r\n  ): string {\r\n    if (Array.isArray(ids)) {\r\n      return ids.map(resolver).join(', ');\r\n    }\r\n    return resolver(ids);\r\n  }\r\n\r\n  /**\r\n   * Resolve a feature ID to its name by searching through\r\n   * the nested features structure (categories with value_ids).\r\n   */\r\n  private resolveFeatureName(id: number): string {\r\n    const featuresData = RealtySoftState.get<Array<{id: number; name: string; value_ids?: Array<{id: number; name: string}>}>>('data.features') || [];\r\n\r\n    for (const category of featuresData) {\r\n      // Check if feature is in value_ids (nested structure)\r\n      if (category.value_ids && Array.isArray(category.value_ids)) {\r\n        const found = category.value_ids.find(f => f.id === id);\r\n        if (found) return found.name;\r\n      }\r\n      // Also check top-level id (flat structure fallback)\r\n      if (category.id === id && category.name) {\r\n        return category.name;\r\n      }\r\n    }\r\n\r\n    return String(id);\r\n  }\r\n\r\n  private getActiveFilters(): ActiveFilter[] {\r\n    const filters = RealtySoftState.get<FilterState>('filters');\r\n    const active: ActiveFilter[] = [];\r\n\r\n    if (!filters) return active;\r\n\r\n    // Location â€” resolve ID(s) to name(s)\r\n    // The location filter can be a number, number[], or comma-separated string of IDs\r\n    if (filters.location && !RealtySoftState.isFilterLocked('location')) {\r\n      let displayValue = filters.locationName || '';\r\n      if (!displayValue) {\r\n        const loc = filters.location;\r\n        let ids: number[];\r\n        if (typeof loc === 'string') {\r\n          ids = loc.split(',').map(s => parseInt(s.trim(), 10)).filter(n => !isNaN(n));\r\n        } else if (Array.isArray(loc)) {\r\n          ids = loc;\r\n        } else {\r\n          ids = [loc];\r\n        }\r\n        displayValue = ids.map(id => this.resolveLocationName(id)).join(', ');\r\n      }\r\n      active.push({\r\n        name: 'location',\r\n        label: this.label('search_location'),\r\n        value: displayValue\r\n      });\r\n    }\r\n\r\n    // Listing type\r\n    if (filters.listingType && !RealtySoftState.isFilterLocked('listingType')) {\r\n      const listingTypeLabels: Record<string, string> = {\r\n        'resale': this.label('listing_type_sale') || 'ReSale',\r\n        'development': this.label('listing_type_new') || 'New Development',\r\n        'long_rental': this.label('listing_type_long_rental') || 'Long Term Rental',\r\n        'short_rental': this.label('listing_type_short_rental') || 'Holiday Rental'\r\n      };\r\n      const displayValue = Array.isArray(filters.listingType)\r\n        ? filters.listingType.map(t => listingTypeLabels[t] || t).join(', ')\r\n        : listingTypeLabels[filters.listingType] || filters.listingType;\r\n      active.push({\r\n        name: 'listingType',\r\n        label: this.label('search_listing_type'),\r\n        value: displayValue\r\n      });\r\n    }\r\n\r\n    // Property type â€” resolve ID(s) to name(s)\r\n    if (filters.propertyType && !RealtySoftState.isFilterLocked('propertyType')) {\r\n      const displayValue = filters.propertyTypeName\r\n        || this.resolveIds(\r\n            filters.propertyType as number | number[],\r\n            (id) => this.resolvePropertyTypeName(id)\r\n          );\r\n      active.push({\r\n        name: 'propertyType',\r\n        label: this.label('search_property_type'),\r\n        value: displayValue\r\n      });\r\n    }\r\n\r\n    // Bedrooms\r\n    if ((filters.bedsMin || filters.bedsMax) && !RealtySoftState.isFilterLocked('bedsMin')) {\r\n      let value = '';\r\n      if (filters.bedsMin && filters.bedsMax) {\r\n        value = `${filters.bedsMin} - ${filters.bedsMax}`;\r\n      } else if (filters.bedsMin) {\r\n        value = `${filters.bedsMin}+`;\r\n      } else {\r\n        value = `â‰¤ ${filters.bedsMax}`;\r\n      }\r\n      active.push({\r\n        name: 'beds',\r\n        label: this.label('search_bedrooms'),\r\n        value: value\r\n      });\r\n    }\r\n\r\n    // Bathrooms\r\n    if ((filters.bathsMin || filters.bathsMax) && !RealtySoftState.isFilterLocked('bathsMin')) {\r\n      let value = '';\r\n      if (filters.bathsMin && filters.bathsMax) {\r\n        value = `${filters.bathsMin} - ${filters.bathsMax}`;\r\n      } else if (filters.bathsMin) {\r\n        value = `${filters.bathsMin}+`;\r\n      } else {\r\n        value = `â‰¤ ${filters.bathsMax}`;\r\n      }\r\n      active.push({\r\n        name: 'baths',\r\n        label: this.label('search_bathrooms'),\r\n        value: value\r\n      });\r\n    }\r\n\r\n    // Price\r\n    if ((filters.priceMin || filters.priceMax) && !RealtySoftState.isFilterLocked('priceMin')) {\r\n      let value = '';\r\n      if (filters.priceMin && filters.priceMax) {\r\n        value = `${RealtySoftLabels.formatPrice(filters.priceMin)} - ${RealtySoftLabels.formatPrice(filters.priceMax)}`;\r\n      } else if (filters.priceMin) {\r\n        value = `â‰¥ ${RealtySoftLabels.formatPrice(filters.priceMin)}`;\r\n      } else if (filters.priceMax) {\r\n        value = `â‰¤ ${RealtySoftLabels.formatPrice(filters.priceMax)}`;\r\n      }\r\n      active.push({\r\n        name: 'price',\r\n        label: this.label('search_price'),\r\n        value: value\r\n      });\r\n    }\r\n\r\n    // Built area\r\n    if ((filters.builtMin || filters.builtMax) && !RealtySoftState.isFilterLocked('builtMin')) {\r\n      let value = '';\r\n      if (filters.builtMin && filters.builtMax) {\r\n        value = `${filters.builtMin} - ${filters.builtMax} mÂ²`;\r\n      } else if (filters.builtMin) {\r\n        value = `â‰¥ ${filters.builtMin} mÂ²`;\r\n      } else if (filters.builtMax) {\r\n        value = `â‰¤ ${filters.builtMax} mÂ²`;\r\n      }\r\n      active.push({\r\n        name: 'built',\r\n        label: this.label('search_built_area'),\r\n        value: value\r\n      });\r\n    }\r\n\r\n    // Plot size\r\n    if ((filters.plotMin || filters.plotMax) && !RealtySoftState.isFilterLocked('plotMin')) {\r\n      let value = '';\r\n      if (filters.plotMin && filters.plotMax) {\r\n        value = `${filters.plotMin} - ${filters.plotMax} mÂ²`;\r\n      } else if (filters.plotMin) {\r\n        value = `â‰¥ ${filters.plotMin} mÂ²`;\r\n      } else if (filters.plotMax) {\r\n        value = `â‰¤ ${filters.plotMax} mÂ²`;\r\n      }\r\n      active.push({\r\n        name: 'plot',\r\n        label: this.label('search_plot_size'),\r\n        value: value\r\n      });\r\n    }\r\n\r\n    // Features\r\n    if (filters.features && filters.features.length && !RealtySoftState.isFilterLocked('features')) {\r\n      const featureNames = filters.features.map(id => this.resolveFeatureName(id));\r\n      active.push({\r\n        name: 'features',\r\n        label: this.label('search_features'),\r\n        value: featureNames.join(', ')\r\n      });\r\n    }\r\n\r\n    // Reference\r\n    if (filters.ref && !RealtySoftState.isFilterLocked('ref')) {\r\n      active.push({\r\n        name: 'ref',\r\n        label: this.label('search_reference'),\r\n        value: filters.ref\r\n      });\r\n    }\r\n\r\n    return active;\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    const active = this.getActiveFilters();\r\n\r\n    if (active.length === 0) {\r\n      this.element.innerHTML = '';\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.style.display = 'block';\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-active-filters__wrapper\">\r\n        <div class=\"rs-active-filters__tags\">\r\n          ${active.map(filter => `\r\n            <span class=\"rs-active-filters__tag\">\r\n              <span class=\"rs-active-filters__tag-label\">${filter.label}:</span>\r\n              <span class=\"rs-active-filters__tag-value\">${this.escapeHtml(filter.value)}</span>\r\n            </span>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_active_filters', RSActiveFilters as unknown as ComponentConstructor);\r\n\r\nexport { RSActiveFilters };\r\nexport default RSActiveFilters;\r\n","/**\r\n * RealtySoft Widget v3 - View Toggle Component\r\n * Grid/List/Map view switch\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, ComponentConstructor, RealtySoftModule, RealtySoftStateModule } from '../../types/index';\r\n\r\n// Declare global RealtySoft\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\nclass RSViewToggle extends RSBaseComponent {\r\n  private currentView: string = 'grid';\r\n  private enableMapView: boolean = true;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.currentView = RealtySoftState.get<string>('ui.view') || 'grid';\r\n\r\n    // Check if map view is enabled (default: true)\r\n    const globalConfig = (window as any).RealtySoftConfig || {};\r\n    this.enableMapView = globalConfig.enableMapView !== false;\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    this.subscribe<string>('ui.view', (view) => {\r\n      this.currentView = view;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-view-toggle');\r\n\r\n    const mapButton = this.enableMapView ? `\r\n        <button type=\"button\"\r\n                class=\"rs-view-toggle__btn rs-view-toggle__btn--map ${this.currentView === 'map' ? 'rs-view-toggle__btn--active' : ''}\"\r\n                data-view=\"map\"\r\n                aria-label=\"${this.label('results_view_map') || 'Map View'}\"\r\n                title=\"${this.label('results_view_map') || 'Map View'}\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polygon points=\"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6\"></polygon>\r\n            <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"18\"></line>\r\n            <line x1=\"16\" y1=\"6\" x2=\"16\" y2=\"22\"></line>\r\n          </svg>\r\n        </button>\r\n    ` : '';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-view-toggle__wrapper\">\r\n        <button type=\"button\"\r\n                class=\"rs-view-toggle__btn rs-view-toggle__btn--grid ${this.currentView === 'grid' ? 'rs-view-toggle__btn--active' : ''}\"\r\n                data-view=\"grid\"\r\n                aria-label=\"${this.label('results_view_grid')}\"\r\n                title=\"${this.label('results_view_grid')}\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n            <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n            <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n            <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n          </svg>\r\n        </button>\r\n        <button type=\"button\"\r\n                class=\"rs-view-toggle__btn rs-view-toggle__btn--list ${this.currentView === 'list' ? 'rs-view-toggle__btn--active' : ''}\"\r\n                data-view=\"list\"\r\n                aria-label=\"${this.label('results_view_list')}\"\r\n                title=\"${this.label('results_view_list')}\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\r\n            <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"></line>\r\n            <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"></line>\r\n            <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"></line>\r\n            <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"></line>\r\n            <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"></line>\r\n          </svg>\r\n        </button>\r\n        ${mapButton}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-view-toggle__btn').forEach(btn => {\r\n      btn.addEventListener('click', (e: Event) => {\r\n        const target = e.currentTarget as HTMLButtonElement;\r\n        const view = target.dataset.view;\r\n        if (view) {\r\n          RealtySoft.setView(view);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-view-toggle__btn').forEach(btn => {\r\n      btn.classList.toggle('rs-view-toggle__btn--active', btn.dataset.view === this.currentView);\r\n    });\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_view_toggle', RSViewToggle as unknown as ComponentConstructor);\r\n\r\nexport { RSViewToggle };\r\nexport default RSViewToggle;\r\n","/**\r\n * RealtySoft Widget v3 - Map View Component\r\n * Interactive map view with property markers and bounds-based filtering\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAnalyticsModule,\r\n  Property,\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\ndeclare const RealtySoftRouter: {\r\n  isEnabled: () => boolean;\r\n  navigateToProperty: (property: Property, url: string) => void;\r\n} | undefined;\r\n\r\n// Leaflet type declarations (loaded dynamically from CDN)\r\ninterface LeafletLatLngBounds {\r\n  getNorthEast(): { lat: number; lng: number };\r\n  getSouthWest(): { lat: number; lng: number };\r\n  contains(latlng: { lat: number; lng: number }): boolean;\r\n  extend(latlng: { lat: number; lng: number }): LeafletLatLngBounds;\r\n  isValid(): boolean;\r\n}\r\n\r\ninterface LeafletMap {\r\n  setView(center: [number, number], zoom: number): LeafletMap;\r\n  fitBounds(bounds: LeafletLatLngBounds, options?: Record<string, unknown>): LeafletMap;\r\n  getBounds(): LeafletLatLngBounds;\r\n  getZoom(): number;\r\n  getCenter(): { lat: number; lng: number };\r\n  invalidateSize(): void;\r\n  remove(): void;\r\n  on(event: string, handler: (e: any) => void): LeafletMap;\r\n  off(event: string, handler?: (e: any) => void): LeafletMap;\r\n  addLayer(layer: any): LeafletMap;\r\n  removeLayer(layer: any): LeafletMap;\r\n  hasLayer(layer: any): boolean;\r\n}\r\n\r\ninterface LeafletMarker {\r\n  addTo(map: LeafletMap): LeafletMarker;\r\n  bindPopup(html: string | HTMLElement, options?: Record<string, unknown>): LeafletMarker;\r\n  openPopup(): LeafletMarker;\r\n  closePopup(): LeafletMarker;\r\n  getLatLng(): { lat: number; lng: number };\r\n  setIcon(icon: any): LeafletMarker;\r\n  on(event: string, handler: (e: any) => void): LeafletMarker;\r\n  remove(): void;\r\n}\r\n\r\ninterface LeafletMarkerClusterGroup {\r\n  addTo(map: LeafletMap): LeafletMarkerClusterGroup;\r\n  addLayer(marker: LeafletMarker): LeafletMarkerClusterGroup;\r\n  addLayers(markers: LeafletMarker[]): LeafletMarkerClusterGroup;\r\n  removeLayer(marker: LeafletMarker): LeafletMarkerClusterGroup;\r\n  clearLayers(): LeafletMarkerClusterGroup;\r\n  getBounds(): LeafletLatLngBounds;\r\n  remove(): void;\r\n}\r\n\r\ninterface LeafletIcon {\r\n  options: Record<string, unknown>;\r\n}\r\n\r\ninterface LeafletStatic {\r\n  map(el: HTMLElement, options?: Record<string, unknown>): LeafletMap;\r\n  tileLayer(url: string, opts: Record<string, unknown>): { addTo(map: LeafletMap): void };\r\n  marker(coords: [number, number], options?: Record<string, unknown>): LeafletMarker;\r\n  latLngBounds(corner1?: [number, number], corner2?: [number, number]): LeafletLatLngBounds;\r\n  divIcon(options: Record<string, unknown>): LeafletIcon;\r\n  icon(options: Record<string, unknown>): LeafletIcon;\r\n  markerClusterGroup?(options?: Record<string, unknown>): LeafletMarkerClusterGroup;\r\n}\r\n\r\n// Leaflet is loaded dynamically - window.L is declared in detail/map.ts\r\n// We reference it through window directly to avoid type conflicts\r\n\r\nclass RSMapView extends RSBaseComponent {\r\n  private properties: Property[] = [];\r\n  private filteredProperties: Property[] = [];\r\n  private map: LeafletMap | null = null;\r\n  private markerCluster: LeafletMarkerClusterGroup | null = null;\r\n  private markers: Map<number, LeafletMarker> = new Map();\r\n  private mapContainerId: string = '';\r\n  private isMapReady: boolean = false;\r\n  private boundsFilterDebounce: ReturnType<typeof setTimeout> | null = null;\r\n  private isVisible: boolean = false;\r\n  private initialBoundsSet: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.mapContainerId = `rs-map-view-${Date.now()}`;\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Subscribe to results changes\r\n    this.subscribe<Property[]>('results.properties', (properties) => {\r\n      this.properties = properties || [];\r\n      if (this.isVisible && this.isMapReady) {\r\n        this.updateMarkers();\r\n      }\r\n    });\r\n\r\n    // Subscribe to view changes\r\n    this.subscribe<string>('ui.view', (view) => {\r\n      const wasVisible = this.isVisible;\r\n      this.isVisible = view === 'map';\r\n\r\n      if (this.isVisible && !wasVisible) {\r\n        // Switched to map view\r\n        this.showMap();\r\n      } else if (!this.isVisible && wasVisible) {\r\n        // Switched away from map view\r\n        this.hideMap();\r\n      }\r\n    });\r\n\r\n    // Check initial view\r\n    const currentView = RealtySoftState.get<string>('ui.view');\r\n    this.isVisible = currentView === 'map';\r\n\r\n    if (this.isVisible) {\r\n      this.loadLeafletAndInit();\r\n    }\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-map-view');\r\n    this.element.style.display = 'none';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-map-view__container\">\r\n        <div class=\"rs-map-view__loading\" id=\"${this.mapContainerId}-loading\">\r\n          <div class=\"rs-map-view__spinner\"></div>\r\n          <p>${this.label('map_loading') || 'Loading map...'}</p>\r\n        </div>\r\n        <div class=\"rs-map-view__map\" id=\"${this.mapContainerId}\"></div>\r\n        <div class=\"rs-map-view__info\">\r\n          <span class=\"rs-map-view__count\"></span>\r\n          <button type=\"button\" class=\"rs-map-view__reset-bounds\" style=\"display: none;\">\r\n            ${this.label('map_reset_view') || 'Reset View'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Reset bounds button\r\n    const resetBtn = this.element.querySelector('.rs-map-view__reset-bounds');\r\n    if (resetBtn) {\r\n      resetBtn.addEventListener('click', () => {\r\n        this.fitBoundsToMarkers();\r\n        (resetBtn as HTMLElement).style.display = 'none';\r\n      });\r\n    }\r\n  }\r\n\r\n  private showMap(): void {\r\n    this.element.style.display = 'block';\r\n\r\n    if (!this.isMapReady) {\r\n      this.loadLeafletAndInit();\r\n    } else if (this.map) {\r\n      // Map already initialized, just invalidate size and update markers\r\n      setTimeout(() => {\r\n        this.map?.invalidateSize();\r\n        this.updateMarkers();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  private hideMap(): void {\r\n    this.element.style.display = 'none';\r\n  }\r\n\r\n  private async loadLeafletAndInit(): Promise<void> {\r\n    try {\r\n      await this.loadLeaflet();\r\n      await this.loadMarkerCluster();\r\n      await this.initMap();\r\n    } catch (err) {\r\n      console.error('[RealtySoft MapView] Map init failed:', err);\r\n      this.showError();\r\n    }\r\n  }\r\n\r\n  private loadLeaflet(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      // Already loaded\r\n      if (window.L) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      // Load CSS\r\n      if (!document.querySelector('link[href*=\"leaflet\"]')) {\r\n        const css = document.createElement('link');\r\n        css.rel = 'stylesheet';\r\n        css.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\r\n        css.crossOrigin = '';\r\n        document.head.appendChild(css);\r\n      }\r\n\r\n      // Load JS\r\n      if (!document.querySelector('script[src*=\"leaflet.js\"]')) {\r\n        const script = document.createElement('script');\r\n        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\r\n        script.crossOrigin = '';\r\n        script.onload = () => resolve();\r\n        script.onerror = () => reject(new Error('Failed to load Leaflet'));\r\n        document.head.appendChild(script);\r\n      } else {\r\n        // Script tag exists but L not ready yet - wait\r\n        const check = setInterval(() => {\r\n          if (window.L) {\r\n            clearInterval(check);\r\n            resolve();\r\n          }\r\n        }, 50);\r\n        setTimeout(() => {\r\n          clearInterval(check);\r\n          reject(new Error('Leaflet load timeout'));\r\n        }, 10000);\r\n      }\r\n    });\r\n  }\r\n\r\n  private loadMarkerCluster(): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      const L = window.L;\r\n      if (!L) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      // Check if already loaded\r\n      if (L.markerClusterGroup) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      // Load MarkerCluster CSS\r\n      if (!document.querySelector('link[href*=\"MarkerCluster\"]')) {\r\n        const css1 = document.createElement('link');\r\n        css1.rel = 'stylesheet';\r\n        css1.href = 'https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css';\r\n        document.head.appendChild(css1);\r\n\r\n        const css2 = document.createElement('link');\r\n        css2.rel = 'stylesheet';\r\n        css2.href = 'https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css';\r\n        document.head.appendChild(css2);\r\n      }\r\n\r\n      // Load MarkerCluster JS\r\n      if (!document.querySelector('script[src*=\"leaflet.markercluster\"]')) {\r\n        const script = document.createElement('script');\r\n        script.src = 'https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js';\r\n        script.crossOrigin = '';\r\n        script.onload = () => resolve();\r\n        script.onerror = () => {\r\n          console.warn('[RealtySoft MapView] MarkerCluster failed to load, continuing without clustering');\r\n          resolve();\r\n        };\r\n        document.head.appendChild(script);\r\n      } else {\r\n        // Wait for it to load\r\n        const check = setInterval(() => {\r\n          if (L.markerClusterGroup) {\r\n            clearInterval(check);\r\n            resolve();\r\n          }\r\n        }, 50);\r\n        setTimeout(() => {\r\n          clearInterval(check);\r\n          resolve();\r\n        }, 5000);\r\n      }\r\n    });\r\n  }\r\n\r\n  private async initMap(): Promise<void> {\r\n    const L = window.L;\r\n    if (!L) return;\r\n\r\n    const container = document.getElementById(this.mapContainerId);\r\n    const loadingEl = document.getElementById(`${this.mapContainerId}-loading`);\r\n    if (!container) return;\r\n\r\n    // Create map\r\n    this.map = L.map(container, {\r\n      scrollWheelZoom: true,\r\n      zoomControl: true,\r\n    });\r\n\r\n    // Add tile layer (OpenStreetMap)\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n      maxZoom: 19,\r\n    }).addTo(this.map);\r\n\r\n    // Initialize marker cluster group if available\r\n    if (L.markerClusterGroup) {\r\n      this.markerCluster = L.markerClusterGroup({\r\n        showCoverageOnHover: false,\r\n        maxClusterRadius: 50,\r\n        spiderfyOnMaxZoom: true,\r\n        disableClusteringAtZoom: 17,\r\n      });\r\n      this.map.addLayer(this.markerCluster);\r\n    }\r\n\r\n    // Set default view (will be overridden when markers are added)\r\n    this.map.setView([40.0, -3.7], 6); // Default: Spain\r\n\r\n    // Listen for map events\r\n    this.map.on('moveend', () => this.onMapMoveEnd());\r\n    this.map.on('zoomend', () => this.onMapMoveEnd());\r\n\r\n    this.isMapReady = true;\r\n\r\n    // Hide loading\r\n    if (loadingEl) loadingEl.style.display = 'none';\r\n\r\n    // Update markers with current properties\r\n    this.updateMarkers();\r\n\r\n    // Ensure map renders correctly\r\n    setTimeout(() => this.map?.invalidateSize(), 200);\r\n  }\r\n\r\n  private updateMarkers(): void {\r\n    if (!this.map || !this.isMapReady) return;\r\n\r\n    const L = window.L;\r\n    if (!L) return;\r\n\r\n    // Get properties with valid coordinates\r\n    const propertiesWithCoords = this.properties.filter(\r\n      (p) => p.latitude && p.longitude && p.latitude !== 0 && p.longitude !== 0\r\n    );\r\n\r\n    // Clear existing markers\r\n    if (this.markerCluster) {\r\n      this.markerCluster.clearLayers();\r\n    } else {\r\n      this.markers.forEach((marker) => marker.remove());\r\n    }\r\n    this.markers.clear();\r\n\r\n    // Create new markers\r\n    const newMarkers: LeafletMarker[] = [];\r\n\r\n    propertiesWithCoords.forEach((property) => {\r\n      const marker = this.createMarker(property);\r\n      if (marker) {\r\n        this.markers.set(property.id, marker);\r\n        newMarkers.push(marker);\r\n      }\r\n    });\r\n\r\n    // Add markers to cluster or map\r\n    if (this.markerCluster && newMarkers.length > 0) {\r\n      this.markerCluster.addLayers(newMarkers);\r\n    } else {\r\n      newMarkers.forEach((marker) => marker.addTo(this.map!));\r\n    }\r\n\r\n    // Update count display\r\n    this.updateCountDisplay(propertiesWithCoords.length, this.properties.length);\r\n\r\n    // Fit bounds to markers on first load\r\n    if (!this.initialBoundsSet && propertiesWithCoords.length > 0) {\r\n      this.fitBoundsToMarkers();\r\n      this.initialBoundsSet = true;\r\n    }\r\n  }\r\n\r\n  private createMarker(property: Property): LeafletMarker | null {\r\n    const L = window.L;\r\n    if (!L || !property.latitude || !property.longitude) return null;\r\n\r\n    // Create custom icon\r\n    const icon = L.divIcon({\r\n      className: 'rs-map-marker',\r\n      html: `\r\n        <div class=\"rs-map-marker__pin\">\r\n          <span class=\"rs-map-marker__price\">${this.formatShortPrice(property.price)}</span>\r\n        </div>\r\n      `,\r\n      iconSize: [80, 36],\r\n      iconAnchor: [40, 36],\r\n      popupAnchor: [0, -36],\r\n    });\r\n\r\n    const marker = L.marker([property.latitude, property.longitude], { icon });\r\n\r\n    // Create popup content\r\n    const popupContent = this.createPopupContent(property);\r\n    marker.bindPopup(popupContent, {\r\n      maxWidth: 300,\r\n      minWidth: 250,\r\n      className: 'rs-map-popup',\r\n    });\r\n\r\n    // Track marker click\r\n    marker.on('click', () => {\r\n      try {\r\n        RealtySoftAnalytics.trackCardClick(property);\r\n      } catch (_) { /* non-critical */ }\r\n    });\r\n\r\n    return marker;\r\n  }\r\n\r\n  private createPopupContent(property: Property): HTMLElement {\r\n    const container = document.createElement('div');\r\n    container.className = 'rs-map-popup__content';\r\n\r\n    const image = property.images?.[0] || '/realtysoft/assets/placeholder.jpg';\r\n    const price = RealtySoftLabels.formatPrice(property.price);\r\n    const url = this.generatePropertyUrl(property);\r\n\r\n    container.innerHTML = `\r\n      <a href=\"${url}\" class=\"rs-map-popup__link\">\r\n        <div class=\"rs-map-popup__image\">\r\n          <img src=\"${image}\" alt=\"${this.escapeHtml(property.title || '')}\" loading=\"lazy\">\r\n        </div>\r\n        <div class=\"rs-map-popup__details\">\r\n          <div class=\"rs-map-popup__price\">${price}</div>\r\n          <h4 class=\"rs-map-popup__title\">${this.escapeHtml(property.title || '')}</h4>\r\n          <p class=\"rs-map-popup__location\">${this.escapeHtml(String(property.location || ''))}</p>\r\n          <div class=\"rs-map-popup__specs\">\r\n            ${property.beds ? `<span><svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 7v11a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7\"/><path d=\"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2\"/><path d=\"M3 11h18\"/></svg> ${property.beds}</span>` : ''}\r\n            ${property.baths ? `<span><svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"/><path d=\"M6 12V5a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2\"/></svg> ${property.baths}</span>` : ''}\r\n            ${property.built_area ? `<span><svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><path d=\"M3 9h18\"/><path d=\"M9 21V9\"/></svg> ${property.built_area} mÂ²</span>` : ''}\r\n          </div>\r\n          <span class=\"rs-map-popup__view\">${this.label('card_view') || 'View Details'}</span>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n    // Handle click with SPA navigation\r\n    const link = container.querySelector('.rs-map-popup__link') as HTMLAnchorElement;\r\n    if (link) {\r\n      link.addEventListener('click', (e) => {\r\n        if (typeof RealtySoftRouter !== 'undefined' && RealtySoftRouter.isEnabled()) {\r\n          const mouseEvent = e as MouseEvent;\r\n          if (!mouseEvent.ctrlKey && !mouseEvent.metaKey && !mouseEvent.shiftKey) {\r\n            e.preventDefault();\r\n            RealtySoftRouter.navigateToProperty(property, url);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    return container;\r\n  }\r\n\r\n  private generatePropertyUrl(property: Property): string {\r\n    if (property.url) return property.url;\r\n\r\n    const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n    const ref = property.ref || property.id;\r\n    const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    // Default 'seo' format\r\n    const title = property.title || '';\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9\\s-]/g, '')\r\n      .replace(/\\s+/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '')\r\n      .substring(0, 80);\r\n\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  private formatShortPrice(price: number | null | undefined): string {\r\n    if (!price) return '-';\r\n\r\n    if (price >= 1000000) {\r\n      return `${(price / 1000000).toFixed(1)}M`;\r\n    } else if (price >= 1000) {\r\n      return `${Math.round(price / 1000)}K`;\r\n    }\r\n    return String(price);\r\n  }\r\n\r\n  private onMapMoveEnd(): void {\r\n    if (!this.map || !this.isVisible) return;\r\n\r\n    // Debounce bounds filtering\r\n    if (this.boundsFilterDebounce) {\r\n      clearTimeout(this.boundsFilterDebounce);\r\n    }\r\n\r\n    this.boundsFilterDebounce = setTimeout(() => {\r\n      this.filterByBounds();\r\n\r\n      // Show reset button after user has moved the map\r\n      if (this.initialBoundsSet) {\r\n        const resetBtn = this.element.querySelector('.rs-map-view__reset-bounds') as HTMLElement;\r\n        if (resetBtn) {\r\n          resetBtn.style.display = 'inline-block';\r\n        }\r\n      }\r\n    }, 300);\r\n  }\r\n\r\n  private filterByBounds(): void {\r\n    if (!this.map) return;\r\n\r\n    const bounds = this.map.getBounds();\r\n    const ne = bounds.getNorthEast();\r\n    const sw = bounds.getSouthWest();\r\n\r\n    // Update state with current bounds\r\n    RealtySoftState.set('map.bounds', {\r\n      ne: [ne.lat, ne.lng],\r\n      sw: [sw.lat, sw.lng],\r\n    });\r\n    RealtySoftState.set('map.zoom', this.map.getZoom());\r\n    const center = this.map.getCenter();\r\n    RealtySoftState.set('map.center', [center.lat, center.lng]);\r\n\r\n    // Filter properties by bounds (client-side)\r\n    this.filteredProperties = this.properties.filter((p) => {\r\n      if (!p.latitude || !p.longitude) return false;\r\n      return bounds.contains({ lat: p.latitude, lng: p.longitude });\r\n    });\r\n\r\n    // Update count display\r\n    this.updateCountDisplay(this.filteredProperties.length, this.properties.length);\r\n  }\r\n\r\n  private fitBoundsToMarkers(): void {\r\n    if (!this.map) return;\r\n\r\n    const L = window.L;\r\n    if (!L) return;\r\n\r\n    const bounds = L.latLngBounds();\r\n    let hasValidBounds = false;\r\n\r\n    this.markers.forEach((marker) => {\r\n      const latlng = marker.getLatLng();\r\n      bounds.extend({ lat: latlng.lat, lng: latlng.lng });\r\n      hasValidBounds = true;\r\n    });\r\n\r\n    if (hasValidBounds && bounds.isValid()) {\r\n      this.map.fitBounds(bounds, { padding: [50, 50], maxZoom: 14 });\r\n    }\r\n  }\r\n\r\n  private updateCountDisplay(visible: number, total: number): void {\r\n    const countEl = this.element.querySelector('.rs-map-view__count');\r\n    if (countEl) {\r\n      const propertiesWithCoords = this.properties.filter(\r\n        (p) => p.latitude && p.longitude && p.latitude !== 0 && p.longitude !== 0\r\n      ).length;\r\n\r\n      if (visible < propertiesWithCoords) {\r\n        countEl.textContent = `${visible} of ${propertiesWithCoords} ${this.label('results_properties') || 'properties'} in view`;\r\n      } else {\r\n        countEl.textContent = `${propertiesWithCoords} ${this.label('results_properties') || 'properties'}`;\r\n      }\r\n\r\n      // Note if some properties don't have coordinates\r\n      const withoutCoords = total - propertiesWithCoords;\r\n      if (withoutCoords > 0) {\r\n        countEl.textContent += ` (${withoutCoords} without location)`;\r\n      }\r\n    }\r\n  }\r\n\r\n  private showError(): void {\r\n    const loadingEl = document.getElementById(`${this.mapContainerId}-loading`);\r\n    if (loadingEl) {\r\n      loadingEl.innerHTML = `\r\n        <p class=\"rs-map-view__error\">${this.label('map_error') || 'Unable to load map'}</p>\r\n      `;\r\n    }\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  destroy(): void {\r\n    if (this.boundsFilterDebounce) {\r\n      clearTimeout(this.boundsFilterDebounce);\r\n    }\r\n\r\n    if (this.markerCluster) {\r\n      this.markerCluster.clearLayers();\r\n      this.markerCluster.remove();\r\n    }\r\n\r\n    this.markers.forEach((marker) => marker.remove());\r\n    this.markers.clear();\r\n\r\n    if (this.map) {\r\n      this.map.remove();\r\n      this.map = null;\r\n    }\r\n\r\n    super.destroy();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_map_view', RSMapView as unknown as ComponentConstructor);\r\n\r\nexport { RSMapView };\r\nexport default RSMapView;\r\n","/**\r\n * RealtySoft Widget v3 - Card Sub-Component Utilities\r\n * Shared helpers for standalone card sub-components\r\n */\r\n\r\nimport type {\r\n  Property,\r\n  RealtySoftAPIModule,\r\n  RealtySoftStateModule,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\n// Cache for in-flight requests to deduplicate concurrent calls\r\nconst pendingRequests = new Map<string, Promise<Property | null>>();\r\n\r\n// ---------------------------------------------------------------------------\r\n// Lazy-loading: shared IntersectionObserver for card sub-components\r\n// ---------------------------------------------------------------------------\r\n\r\nlet lazyObserver: IntersectionObserver | null = null;\r\nconst lazyCallbacks = new WeakMap<Element, () => void>();\r\n\r\nfunction getLazyObserver(): IntersectionObserver | null {\r\n  if (lazyObserver) return lazyObserver;\r\n  if (typeof IntersectionObserver === 'undefined') return null;\r\n\r\n  lazyObserver = new IntersectionObserver((entries) => {\r\n    entries.forEach(entry => {\r\n      if (entry.isIntersecting) {\r\n        const cb = lazyCallbacks.get(entry.target);\r\n        if (cb) {\r\n          cb();\r\n          lazyCallbacks.delete(entry.target);\r\n          lazyObserver?.unobserve(entry.target);\r\n        }\r\n      }\r\n    });\r\n  }, {\r\n    rootMargin: '200px 0px',\r\n    threshold: 0.01,\r\n  });\r\n\r\n  return lazyObserver;\r\n}\r\n\r\n/**\r\n * Defer a callback until the element enters (or is near) the viewport.\r\n *\r\n * - Default behaviour: lazy (uses IntersectionObserver with 200 px margin).\r\n * - Opt-out:  set `data-rs-lazy=\"false\"` on the element to load eagerly.\r\n * - Fallback: if IntersectionObserver is not supported, runs immediately.\r\n */\r\nexport function onElementVisible(element: HTMLElement, callback: () => void): void {\r\n  if (element.dataset.rsLazy === 'false') {\r\n    callback();\r\n    return;\r\n  }\r\n\r\n  const observer = getLazyObserver();\r\n  if (!observer) {\r\n    callback();\r\n    return;\r\n  }\r\n\r\n  lazyCallbacks.set(element, callback);\r\n  observer.observe(element);\r\n}\r\n\r\n/**\r\n * Get a property by reading data-rs-property-ref or data-rs-property-id\r\n * from the element itself or an ancestor. Deduplicates concurrent requests.\r\n */\r\nexport async function getCardProperty(element: HTMLElement): Promise<Property | null> {\r\n  const ref = element.dataset.rsPropertyRef\r\n    || element.closest('[data-rs-property-ref]')?.getAttribute('data-rs-property-ref');\r\n  const id = element.dataset.rsPropertyId\r\n    || element.closest('[data-rs-property-id]')?.getAttribute('data-rs-property-id');\r\n\r\n  if (!ref && !id) return null;\r\n\r\n  const cacheKey = ref ? `ref:${ref}` : `id:${id}`;\r\n\r\n  // Deduplicate concurrent requests for the same property\r\n  if (pendingRequests.has(cacheKey)) {\r\n    return pendingRequests.get(cacheKey)!;\r\n  }\r\n\r\n  const promise = (async (): Promise<Property | null> => {\r\n    try {\r\n      if (ref) {\r\n        const result = await RealtySoftAPI.getPropertyByRef(ref);\r\n        return result.data;\r\n      } else if (id) {\r\n        const result = await RealtySoftAPI.getProperty(Number(id));\r\n        return result.data;\r\n      }\r\n      return null;\r\n    } catch {\r\n      return null;\r\n    } finally {\r\n      pendingRequests.delete(cacheKey);\r\n    }\r\n  })();\r\n\r\n  pendingRequests.set(cacheKey, promise);\r\n  return promise;\r\n}\r\n\r\n/**\r\n * XSS-safe text escaping\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  if (!text) return '';\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Generate SEO-friendly property URL\r\n * Format: /{propertyPageSlug}/{title-slug}-{REFERENCE}\r\n */\r\nexport function generatePropertyUrl(property: Property): string {\r\n  if (property.url) return property.url;\r\n\r\n  const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n  const ref = property.ref || property.id;\r\n  const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n  if (urlFormat === 'query') {\r\n    // /property?ref=V12345\r\n    return `/${pageSlug}?ref=${ref}`;\r\n  }\r\n\r\n  if (urlFormat === 'ref') {\r\n    // /property/V12345\r\n    return `/${pageSlug}/${ref}`;\r\n  }\r\n\r\n  // Default 'seo': /property/luxury-villa-marbella-V12345\r\n  const title = property.title || '';\r\n  const titleSlug = title\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/[^a-z0-9\\s-]/g, '')\r\n    .replace(/\\s+/g, '-')\r\n    .replace(/-+/g, '-')\r\n    .replace(/^-|-$/g, '')\r\n    .substring(0, 80);\r\n\r\n  return `/${pageSlug}/${titleSlug}-${ref}`;\r\n}\r\n\r\n/**\r\n * SVG icons for card sub-components\r\n */\r\nexport const SVG_ICONS = {\r\n  mapPin: '<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path><circle cx=\"12\" cy=\"10\" r=\"3\"></circle></svg>',\r\n  bed: '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M2 4v16\"></path><path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path><path d=\"M2 17h20\"></path><path d=\"M6 8v9\"></path></svg>',\r\n  bath: '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5\"></path><line x1=\"10\" x2=\"8\" y1=\"5\" y2=\"7\"></line><line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"></line><line x1=\"7\" x2=\"7\" y1=\"19\" y2=\"21\"></line><line x1=\"17\" x2=\"17\" y1=\"19\" y2=\"21\"></line></svg>',\r\n  builtArea: '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect></svg>',\r\n  plotSize: '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path><path d=\"M12 2v20\"></path><path d=\"M3 6l9 4 9-4\"></path></svg>',\r\n  heart: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path></svg>',\r\n  heartFilled: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path></svg>',\r\n};\r\n","/**\r\n * RealtySoft Widget v3 - Card Image Sub-Component\r\n * Renders image carousel with nav/dots/lazy-load, or single image.\r\n * Supports data-rs-max-images attribute.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, escapeHtml, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n  ImageWithSizes,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardImage extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const maxImages = parseInt(this.element.dataset.rsMaxImages || '5') || 5;\r\n    const allImages = this.property.images || [];\r\n    const images = allImages.slice(0, maxImages);\r\n    const imagesWithSizes = ((this.property as Property & { imagesWithSizes?: ImageWithSizes[] }).imagesWithSizes || []).slice(0, maxImages);\r\n\r\n    if (images.length === 0) {\r\n      this.element.innerHTML = `<img src=\"/realtysoft/assets/placeholder.jpg\" alt=\"${escapeHtml(this.property.title || '')}\" loading=\"eager\">`;\r\n      return;\r\n    }\r\n\r\n    if (images.length === 1) {\r\n      const imgData = imagesWithSizes[0];\r\n      const srcset = this.buildSrcset(imgData);\r\n      const srcsetAttr = srcset ? ` srcset=\"${srcset}\" sizes=\"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw\"` : '';\r\n      this.element.innerHTML = `<img src=\"${images[0]}\"${srcsetAttr} alt=\"${escapeHtml(this.property.title || '')}\" loading=\"eager\">`;\r\n      return;\r\n    }\r\n\r\n    // Build carousel\r\n    const sizesAttr = '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw';\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-card__carousel\">\r\n        <div class=\"rs-card__carousel-track\">\r\n          ${images.map((img, i) => {\r\n            const imgData = imagesWithSizes[i];\r\n            const srcset = this.buildSrcset(imgData);\r\n            if (i === 0) {\r\n              const srcsetAttr = srcset ? ` srcset=\"${srcset}\" sizes=\"${sizesAttr}\"` : '';\r\n              return `<div class=\"rs-card__carousel-slide rs-card__carousel-slide--active\">\r\n                <img src=\"${img}\"${srcsetAttr} loading=\"eager\" fetchpriority=\"high\" alt=\"\">\r\n              </div>`;\r\n            } else {\r\n              const dataSrcset = srcset ? ` data-srcset=\"${srcset}\" data-sizes=\"${sizesAttr}\"` : '';\r\n              return `<div class=\"rs-card__carousel-slide\">\r\n                <img data-src=\"${img}\"${dataSrcset} loading=\"lazy\" alt=\"\">\r\n              </div>`;\r\n            }\r\n          }).join('')}\r\n        </div>\r\n        <button class=\"rs-card__carousel-prev\" type=\"button\" aria-label=\"Previous\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n        <button class=\"rs-card__carousel-next\" type=\"button\" aria-label=\"Next\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n          </svg>\r\n        </button>\r\n        <div class=\"rs-card__carousel-dots\">\r\n          ${images.map((_, i) => `<span class=\"rs-card__carousel-dot ${i === 0 ? 'rs-card__carousel-dot--active' : ''}\" data-index=\"${i}\"></span>`).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    const carousel = this.element.querySelector('.rs-card__carousel');\r\n    if (!carousel) return;\r\n\r\n    const slides = carousel.querySelectorAll('.rs-card__carousel-slide');\r\n    const dots = carousel.querySelectorAll('.rs-card__carousel-dot');\r\n    const imageCount = slides.length;\r\n    let currentIndex = 0;\r\n\r\n    const goToSlide = (index: number): void => {\r\n      if (index < 0) index = imageCount - 1;\r\n      if (index >= imageCount) index = 0;\r\n\r\n      slides.forEach((s, i) => s.classList.toggle('rs-card__carousel-slide--active', i === index));\r\n      dots.forEach((d, i) => d.classList.toggle('rs-card__carousel-dot--active', i === index));\r\n      currentIndex = index;\r\n\r\n      // Lazy load image\r\n      const img = slides[index].querySelector('img') as HTMLImageElement | null;\r\n      if (img && img.dataset.src && !img.src) {\r\n        img.src = img.dataset.src;\r\n        if (img.dataset.srcset) {\r\n          img.srcset = img.dataset.srcset;\r\n          img.sizes = img.dataset.sizes || '';\r\n        }\r\n      }\r\n    };\r\n\r\n    carousel.querySelector('.rs-card__carousel-prev')?.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      goToSlide(currentIndex - 1);\r\n    });\r\n\r\n    carousel.querySelector('.rs-card__carousel-next')?.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      goToSlide(currentIndex + 1);\r\n    });\r\n\r\n    dots.forEach(dot => {\r\n      dot.addEventListener('click', (e: Event) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        goToSlide(parseInt((dot as HTMLElement).dataset.index || '0'));\r\n      });\r\n    });\r\n  }\r\n\r\n  private buildSrcset(imgData: ImageWithSizes | undefined): string {\r\n    if (!imgData?.sizes) return '';\r\n    const parts: string[] = [];\r\n    if (imgData.sizes[256]) parts.push(`${imgData.sizes[256]} 256w`);\r\n    if (imgData.sizes[512]) parts.push(`${imgData.sizes[512]} 512w`);\r\n    if (imgData.sizes[768]) parts.push(`${imgData.sizes[768]} 768w`);\r\n    return parts.join(', ');\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_image', RSCardImage as unknown as ComponentConstructor);\r\n\r\nexport { RSCardImage };\r\nexport default RSCardImage;\r\n","/**\r\n * RealtySoft Widget v3 - Card Price Sub-Component\r\n * Renders formatted price via RealtySoftLabels.formatPrice(), or \"Price on Request\"\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftLabelsModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\nclass RSCardPrice extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    if (this.property.price_on_request || (!this.property.price && this.property.price !== 0)) {\r\n      this.element.textContent = this.label('detail_price_on_request') || 'Price on Request';\r\n    } else {\r\n      this.element.textContent = RealtySoftLabels.formatPrice(this.property.price);\r\n    }\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_price', RSCardPrice as unknown as ComponentConstructor);\r\n\r\nexport { RSCardPrice };\r\nexport default RSCardPrice;\r\n","/**\r\n * RealtySoft Widget v3 - Card Title Sub-Component\r\n * Renders property title (textContent, XSS-safe)\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardTitle extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n    this.element.textContent = this.property.title || '';\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_title', RSCardTitle as unknown as ComponentConstructor);\r\n\r\nexport { RSCardTitle };\r\nexport default RSCardTitle;\r\n","/**\r\n * RealtySoft Widget v3 - Card Location Sub-Component\r\n * Renders map pin SVG icon + location text. Supports data-rs-show-icon attribute.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardLocation extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const location = String(this.property.location || '');\r\n    if (!location) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const showIcon = this.element.dataset.rsShowIcon !== 'false';\r\n    if (showIcon) {\r\n      this.element.innerHTML = `${SVG_ICONS.mapPin} ${this.escapeText(location)}`;\r\n    } else {\r\n      this.element.textContent = location;\r\n    }\r\n  }\r\n\r\n  private escapeText(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_location', RSCardLocation as unknown as ComponentConstructor);\r\n\r\nexport { RSCardLocation };\r\nexport default RSCardLocation;\r\n","/**\r\n * RealtySoft Widget v3 - Card Beds Sub-Component\r\n * Renders bed SVG icon + count + singular/plural label. Hidden if 0.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardBeds extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property || !this.property.beds || this.property.beds <= 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const bedLabel = this.property.beds === 1 ? this.label('card_bed') : this.label('card_beds');\r\n    this.element.innerHTML = `${SVG_ICONS.bed} ${this.property.beds} ${bedLabel}`;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_beds', RSCardBeds as unknown as ComponentConstructor);\r\n\r\nexport { RSCardBeds };\r\nexport default RSCardBeds;\r\n","/**\r\n * RealtySoft Widget v3 - Card Baths Sub-Component\r\n * Renders bath SVG icon + count + singular/plural label. Hidden if 0.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardBaths extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property || !this.property.baths || this.property.baths <= 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const bathLabel = this.property.baths === 1 ? this.label('card_bath') : this.label('card_baths');\r\n    this.element.innerHTML = `${SVG_ICONS.bath} ${this.property.baths} ${bathLabel}`;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_baths', RSCardBaths as unknown as ComponentConstructor);\r\n\r\nexport { RSCardBaths };\r\nexport default RSCardBaths;\r\n","/**\r\n * RealtySoft Widget v3 - Card Built Area Sub-Component\r\n * Renders area SVG icon + value + m2 label. Hidden if 0.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardBuilt extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property || !this.property.built_area || this.property.built_area <= 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `${SVG_ICONS.builtArea} ${this.property.built_area} ${this.label('card_built')}`;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_built', RSCardBuilt as unknown as ComponentConstructor);\r\n\r\nexport { RSCardBuilt };\r\nexport default RSCardBuilt;\r\n","/**\r\n * RealtySoft Widget v3 - Card Plot Size Sub-Component\r\n * Renders plot SVG icon + value + m2 label. Hidden if 0.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardPlot extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property || !this.property.plot_size || this.property.plot_size <= 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `${SVG_ICONS.plotSize} ${this.property.plot_size} ${this.label('card_plot')}`;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_plot', RSCardPlot as unknown as ComponentConstructor);\r\n\r\nexport { RSCardPlot };\r\nexport default RSCardPlot;\r\n","/**\r\n * RealtySoft Widget v3 - Card Reference Sub-Component\r\n * Renders \"Ref:\" prefix + reference number\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardRef extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const ref = this.property.ref || '';\r\n    if (!ref) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.textContent = `${this.label('card_ref')} ${ref}`;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_ref', RSCardRef as unknown as ComponentConstructor);\r\n\r\nexport { RSCardRef };\r\nexport default RSCardRef;\r\n","/**\r\n * RealtySoft Widget v3 - Card Type Sub-Component\r\n * Renders property type text (e.g., \"Villa\"). Hidden if empty.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardType extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property || !this.property.type) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.textContent = this.property.type;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_type', RSCardType as unknown as ComponentConstructor);\r\n\r\nexport { RSCardType };\r\nexport default RSCardType;\r\n","/**\r\n * RealtySoft Widget v3 - Card Status Sub-Component\r\n * Renders listing type badges (sale/rental/development) + featured/own badges\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\n// CSS class mapping for listing types (labels are resolved dynamically)\r\nconst LISTING_TYPE_CLASS: Record<string, string> = {\r\n  'resale': 'rs-card__tag--sale',\r\n  'sale': 'rs-card__tag--sale',\r\n  'development': 'rs-card__tag--development',\r\n  'new_development': 'rs-card__tag--development',\r\n  'long_rental': 'rs-card__tag--rental',\r\n  'rent': 'rs-card__tag--rental',\r\n  'short_rental': 'rs-card__tag--holiday',\r\n  'holiday': 'rs-card__tag--holiday',\r\n};\r\n\r\n// Listing type â†’ label key mapping\r\nconst LISTING_TYPE_LABEL_KEY: Record<string, string> = {\r\n  'resale': 'listing_type_sale',\r\n  'sale': 'listing_type_sale',\r\n  'development': 'listing_type_new',\r\n  'new_development': 'listing_type_new',\r\n  'long_rental': 'listing_type_long_rental',\r\n  'rent': 'listing_type_long_rental',\r\n  'short_rental': 'listing_type_short_rental',\r\n  'holiday': 'listing_type_short_rental',\r\n};\r\n\r\nclass RSCardStatus extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const tags: string[] = [];\r\n    const listingType = this.property.listing_type;\r\n\r\n    if (listingType) {\r\n      const typeKey = listingType.toLowerCase();\r\n      const cssClass = LISTING_TYPE_CLASS[typeKey] || 'rs-card__tag--sale';\r\n      const labelKey = LISTING_TYPE_LABEL_KEY[typeKey];\r\n      const typeLabel = labelKey ? this.label(labelKey) : listingType;\r\n      tags.push(`<span class=\"rs-card__tag ${cssClass}\">${typeLabel}</span>`);\r\n    }\r\n\r\n    if (this.property.is_featured) {\r\n      tags.push(`<span class=\"rs-card__tag rs-card__tag--featured\">${this.label('featured')}</span>`);\r\n    }\r\n\r\n    if (this.property.is_own) {\r\n      tags.push(`<span class=\"rs-card__tag rs-card__tag--own\">${this.label('own')}</span>`);\r\n    }\r\n\r\n    if (tags.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = tags.join('');\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_status', RSCardStatus as unknown as ComponentConstructor);\r\n\r\nexport { RSCardStatus };\r\nexport default RSCardStatus;\r\n","/**\r\n * RealtySoft Widget v3 - Card Wishlist Sub-Component\r\n * Heart toggle button. Uses WishlistManager + analytics tracking.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, SVG_ICONS, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAnalyticsModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\ndeclare const WishlistManager: {\r\n  has: (refNo: string | number) => boolean;\r\n  add: (property: Record<string, unknown>) => boolean;\r\n  remove: (refNo: string | number) => void;\r\n} | undefined;\r\n\r\ndeclare const RealtySoftToast: {\r\n  success: (message: string) => void;\r\n  error: (message: string) => void;\r\n} | undefined;\r\n\r\nclass RSCardWishlist extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const refNo = this.property.ref || this.property.id;\r\n    const isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager?.has(refNo))\r\n      || RealtySoftState.isInWishlist(this.property.id);\r\n\r\n    this.element.classList.add('rs-card__wishlist');\r\n    this.element.classList.toggle('rs-card__wishlist--active', isInWishlist);\r\n    if (this.element.tagName !== 'BUTTON') {\r\n      this.element.setAttribute('role', 'button');\r\n    }\r\n    this.element.setAttribute('aria-label', this.label('wishlist_add'));\r\n    this.element.innerHTML = isInWishlist ? SVG_ICONS.heartFilled : SVG_ICONS.heart;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.element.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.toggleWishlist();\r\n    });\r\n  }\r\n\r\n  private toggleWishlist(): void {\r\n    if (!this.property) return;\r\n\r\n    try {\r\n      const refNo = this.property.ref || this.property.id;\r\n      const wmAvailable = typeof WishlistManager !== 'undefined' && WishlistManager;\r\n\r\n      if (wmAvailable && WishlistManager!.has(refNo)) {\r\n        WishlistManager!.remove(refNo);\r\n        this.element.classList.remove('rs-card__wishlist--active');\r\n        this.element.innerHTML = SVG_ICONS.heart;\r\n\r\n        try { RealtySoftAnalytics.trackWishlistRemove(this.property.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_removed') || 'Removed from wishlist');\r\n        }\r\n      } else {\r\n        let addSuccess = false;\r\n        if (wmAvailable) {\r\n          addSuccess = WishlistManager!.add({\r\n            id: this.property.id,\r\n            ref_no: refNo,\r\n            title: this.property.title,\r\n            price: this.property.price,\r\n            location: this.property.location,\r\n            type: this.property.type,\r\n            beds: this.property.beds,\r\n            baths: this.property.baths,\r\n            built: this.property.built_area,\r\n            plot: this.property.plot_size,\r\n            images: this.property.images || [],\r\n            total_images: this.property.total_images || (this.property.images || []).length,\r\n            listing_type: this.property.listing_type,\r\n            is_featured: this.property.is_featured || false,\r\n          });\r\n        }\r\n\r\n        if (addSuccess) {\r\n          this.element.classList.add('rs-card__wishlist--active');\r\n          this.element.innerHTML = SVG_ICONS.heartFilled;\r\n\r\n          try { RealtySoftAnalytics.trackWishlistAdd(this.property.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n          if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n            RealtySoftToast.success(this.label('wishlist_add') || 'Added to wishlist');\r\n          }\r\n        } else {\r\n          console.error('[CardWishlist] Failed to add to wishlist. WishlistManager available:', !!wmAvailable);\r\n          if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n            RealtySoftToast.error(this.label('wishlist_error') || 'Could not add to wishlist.');\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      // Note: WishlistManager.add/remove already syncs with RealtySoftState via notifyChange()\r\n    } catch (err) {\r\n      console.error('[CardWishlist] Wishlist toggle error:', err);\r\n    }\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_wishlist', RSCardWishlist as unknown as ComponentConstructor);\r\n\r\nexport { RSCardWishlist };\r\nexport default RSCardWishlist;\r\n","/**\r\n * RealtySoft Widget v3 - Card Link Sub-Component\r\n * Anchor to property detail page. SEO-friendly URL generation.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, generatePropertyUrl, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\ndeclare const RealtySoftRouter: {\r\n  isEnabled: () => boolean;\r\n  navigateToProperty: (property: Property, url: string) => void;\r\n} | undefined;\r\n\r\nclass RSCardLink extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    const url = generatePropertyUrl(this.property);\r\n    const property = this.property;\r\n\r\n    if (this.element.tagName === 'A') {\r\n      (this.element as HTMLAnchorElement).href = url;\r\n      // SPA navigation intercept for anchor elements\r\n      this.element.addEventListener('click', (e: Event) => {\r\n        const me = e as MouseEvent;\r\n        if (typeof RealtySoftRouter !== 'undefined' && RealtySoftRouter.isEnabled() &&\r\n            !me.ctrlKey && !me.metaKey && !me.shiftKey) {\r\n          e.preventDefault();\r\n          RealtySoftRouter.navigateToProperty(property, url);\r\n        }\r\n      });\r\n    } else {\r\n      this.element.setAttribute('data-rs-href', url);\r\n      this.element.style.cursor = 'pointer';\r\n      this.element.addEventListener('click', () => {\r\n        if (typeof RealtySoftRouter !== 'undefined' && RealtySoftRouter.isEnabled()) {\r\n          RealtySoftRouter.navigateToProperty(property, url);\r\n        } else {\r\n          window.location.href = url;\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_link', RSCardLink as unknown as ComponentConstructor);\r\n\r\nexport { RSCardLink };\r\nexport default RSCardLink;\r\n","/**\r\n * RealtySoft Widget v3 - Card Description Sub-Component\r\n * Short description text. Supports data-rs-max-length truncation.\r\n */\r\n\r\nimport { RSBaseComponent } from '../../base';\r\nimport { getCardProperty, onElementVisible } from './card-utils';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  Property,\r\n} from '../../../types/index';\r\n\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSCardDescription extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    if (this.element.closest('.rs_property_grid')) return;\r\n    onElementVisible(this.element, () => this.loadAndRender());\r\n  }\r\n\r\n  private async loadAndRender(): Promise<void> {\r\n    this.property = await getCardProperty(this.element);\r\n    if (!this.property) return;\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    if (!this.property) return;\r\n\r\n    let text = this.property.short_description || this.property.description || '';\r\n    if (!text) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const maxLength = parseInt(this.element.dataset.rsMaxLength || '0') || 0;\r\n    if (maxLength > 0 && text.length > maxLength) {\r\n      text = text.substring(0, maxLength).trimEnd() + '...';\r\n    }\r\n\r\n    this.element.textContent = text;\r\n  }\r\n}\r\n\r\nRealtySoft.registerComponent('rs_card_description', RSCardDescription as unknown as ComponentConstructor);\r\n\r\nexport { RSCardDescription };\r\nexport default RSCardDescription;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Back Button Component\r\n * Back to search results button\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftRouterModule } from '../../types/index';\r\n\r\ndeclare const RealtySoftRouter: RealtySoftRouterModule | undefined;\r\n\r\nclass RSDetailBackButton extends RSBaseComponent {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-detail-back');\r\n\r\n    // Try to get the search URL from various sources\r\n    const searchUrl = this.getSearchUrl();\r\n\r\n    this.element.innerHTML = `\r\n      <a href=\"${searchUrl}\" class=\"rs-detail-back__btn\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n        </svg>\r\n        <span>${this.label('detail_back_to_search') || 'Back to Search'}</span>\r\n      </a>\r\n    `;\r\n  }\r\n\r\n  private getSearchUrl(): string {\r\n    // Check for referrer from search page\r\n    const referrer = document.referrer;\r\n    if (referrer && referrer.includes(window.location.hostname)) {\r\n      // Check if referrer is a search/listing page\r\n      if (referrer.includes('search') || referrer.includes('listing') ||\r\n        referrer.includes('properties') || referrer.includes('property-list')) {\r\n        return referrer;\r\n      }\r\n    }\r\n\r\n    // Check session storage for last search URL\r\n    const lastSearch = sessionStorage.getItem('rs_last_search_url');\r\n    if (lastSearch) {\r\n      return lastSearch;\r\n    }\r\n\r\n    // Check for data attribute\r\n    if (this.element.dataset.searchUrl) {\r\n      return this.element.dataset.searchUrl;\r\n    }\r\n\r\n    // Default fallback - use history back\r\n    return 'javascript:history.back()';\r\n  }\r\n\r\n  bindEvents(): void {\r\n    const btn = this.element.querySelector('.rs-detail-back__btn') as HTMLAnchorElement | null;\r\n    if (!btn) return;\r\n\r\n    const href = btn.getAttribute('href');\r\n\r\n    btn.addEventListener('click', (e: Event) => {\r\n      // SPA router: navigate back to listing without page reload\r\n      if (typeof RealtySoftRouter !== 'undefined' && RealtySoftRouter.canGoBackToListing()) {\r\n        e.preventDefault();\r\n        RealtySoftRouter.navigateToListing();\r\n        return;\r\n      }\r\n\r\n      // If using history.back(), handle it with JS\r\n      if (href === 'javascript:history.back()') {\r\n        e.preventDefault();\r\n        if (window.history.length > 1) {\r\n          window.history.back();\r\n        } else {\r\n          // Fallback to home or search page\r\n          window.location.href = '/';\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailBackButton };\r\nexport default RSDetailBackButton;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Gallery Component\r\n * Image carousel with lightbox\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftAnalyticsModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\nclass RSDetailGallery extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private images: string[] = [];\r\n  private currentIndex: number = 0;\r\n  private lightboxOpen: boolean = false;\r\n  private mainImage: HTMLImageElement | null = null;\r\n  private counter: HTMLElement | null = null;\r\n  private thumbs: NodeListOf<HTMLButtonElement> = document.querySelectorAll('.nonexistent');\r\n  private lightbox: HTMLElement | null = null;\r\n  private lightboxImage: HTMLImageElement | null = null;\r\n  private lightboxCounter: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    // Get property from options (set before super() calls init())\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Use full-size images for gallery, fallback to regular images\r\n    this.images = this.property.imagesFull || this.property.images || [];\r\n    this.currentIndex = 0;\r\n    this.lightboxOpen = false;\r\n\r\n    if (this.images.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-detail-gallery');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-detail-gallery__main\">\r\n        <div class=\"rs-detail-gallery__main-image\">\r\n          <img src=\"${this.images[0]}\" alt=\"\" class=\"rs-detail-gallery__image\" loading=\"eager\" fetchpriority=\"high\">\r\n          <button class=\"rs-detail-gallery__fullscreen\" type=\"button\" aria-label=\"Fullscreen\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"15 3 21 3 21 9\"></polyline>\r\n              <polyline points=\"9 21 3 21 3 15\"></polyline>\r\n              <line x1=\"21\" y1=\"3\" x2=\"14\" y2=\"10\"></line>\r\n              <line x1=\"3\" y1=\"21\" x2=\"10\" y2=\"14\"></line>\r\n            </svg>\r\n          </button>\r\n          ${this.images.length > 1 ? `\r\n            <button class=\"rs-detail-gallery__nav rs-detail-gallery__nav--prev\" type=\"button\">\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n              </svg>\r\n            </button>\r\n            <button class=\"rs-detail-gallery__nav rs-detail-gallery__nav--next\" type=\"button\">\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n              </svg>\r\n            </button>\r\n          ` : ''}\r\n          <div class=\"rs-detail-gallery__counter\">${this.currentIndex + 1} / ${this.images.length}</div>\r\n        </div>\r\n      </div>\r\n      ${this.images.length > 1 ? `\r\n        <div class=\"rs-detail-gallery__thumbs\">\r\n          ${this.images.map((img, i) => `\r\n            <button class=\"rs-detail-gallery__thumb ${i === 0 ? 'rs-detail-gallery__thumb--active' : ''}\"\r\n                    type=\"button\"\r\n                    data-index=\"${i}\">\r\n              <img src=\"${img}\" alt=\"\" loading=\"lazy\">\r\n            </button>\r\n          `).join('')}\r\n        </div>\r\n      ` : ''}\r\n\r\n      <div class=\"rs-detail-gallery__lightbox\" style=\"display: none;\">\r\n        <div class=\"rs-detail-gallery__lightbox-backdrop\"></div>\r\n        <div class=\"rs-detail-gallery__lightbox-content\">\r\n          <button class=\"rs-detail-gallery__lightbox-close\" type=\"button\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n            </svg>\r\n          </button>\r\n          <img src=\"\" alt=\"\" class=\"rs-detail-gallery__lightbox-image\">\r\n          ${this.images.length > 1 ? `\r\n            <button class=\"rs-detail-gallery__lightbox-nav rs-detail-gallery__lightbox-nav--prev\" type=\"button\">\r\n              <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"15 18 9 12 15 6\"></polyline>\r\n              </svg>\r\n            </button>\r\n            <button class=\"rs-detail-gallery__lightbox-nav rs-detail-gallery__lightbox-nav--next\" type=\"button\">\r\n              <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n              </svg>\r\n            </button>\r\n          ` : ''}\r\n          <div class=\"rs-detail-gallery__lightbox-counter\">${this.currentIndex + 1} / ${this.images.length}</div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.mainImage = this.element.querySelector('.rs-detail-gallery__image');\r\n    this.counter = this.element.querySelector('.rs-detail-gallery__counter');\r\n    this.thumbs = this.element.querySelectorAll('.rs-detail-gallery__thumb');\r\n    this.lightbox = this.element.querySelector('.rs-detail-gallery__lightbox');\r\n    this.lightboxImage = this.element.querySelector('.rs-detail-gallery__lightbox-image');\r\n    this.lightboxCounter = this.element.querySelector('.rs-detail-gallery__lightbox-counter');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Main navigation\r\n    this.element.querySelector('.rs-detail-gallery__nav--prev')?.addEventListener('click', () => this.prev());\r\n    this.element.querySelector('.rs-detail-gallery__nav--next')?.addEventListener('click', () => this.next());\r\n\r\n    // Thumbnails\r\n    this.thumbs.forEach(thumb => {\r\n      thumb.addEventListener('click', () => {\r\n        this.goToImage(parseInt(thumb.dataset.index || '0'));\r\n      });\r\n    });\r\n\r\n    // Fullscreen / Lightbox\r\n    this.element.querySelector('.rs-detail-gallery__fullscreen')?.addEventListener('click', () => this.openLightbox());\r\n    this.mainImage?.addEventListener('click', () => this.openLightbox());\r\n\r\n    // Lightbox navigation\r\n    this.element.querySelector('.rs-detail-gallery__lightbox-nav--prev')?.addEventListener('click', () => this.prev());\r\n    this.element.querySelector('.rs-detail-gallery__lightbox-nav--next')?.addEventListener('click', () => this.next());\r\n    this.element.querySelector('.rs-detail-gallery__lightbox-close')?.addEventListener('click', () => this.closeLightbox());\r\n    this.element.querySelector('.rs-detail-gallery__lightbox-backdrop')?.addEventListener('click', () => this.closeLightbox());\r\n\r\n    // Keyboard navigation\r\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (!this.lightboxOpen) return;\r\n\r\n      if (e.key === 'ArrowLeft') this.prev();\r\n      else if (e.key === 'ArrowRight') this.next();\r\n      else if (e.key === 'Escape') this.closeLightbox();\r\n    });\r\n\r\n    // Touch swipe\r\n    let touchStartX = 0;\r\n    this.element.addEventListener('touchstart', (e: TouchEvent) => {\r\n      touchStartX = e.touches[0].clientX;\r\n    });\r\n\r\n    this.element.addEventListener('touchend', (e: TouchEvent) => {\r\n      const touchEndX = e.changedTouches[0].clientX;\r\n      const diff = touchStartX - touchEndX;\r\n\r\n      if (Math.abs(diff) > 50) {\r\n        if (diff > 0) this.next();\r\n        else this.prev();\r\n      }\r\n    });\r\n  }\r\n\r\n  private goToImage(index: number): void {\r\n    if (index < 0) index = this.images.length - 1;\r\n    if (index >= this.images.length) index = 0;\r\n\r\n    this.currentIndex = index;\r\n\r\n    // Update main image\r\n    if (this.mainImage) {\r\n      this.mainImage.src = this.images[index];\r\n    }\r\n\r\n    // Update counter\r\n    if (this.counter) {\r\n      this.counter.textContent = `${index + 1} / ${this.images.length}`;\r\n    }\r\n\r\n    // Update thumbnails\r\n    this.thumbs.forEach((thumb, i) => {\r\n      thumb.classList.toggle('rs-detail-gallery__thumb--active', i === index);\r\n    });\r\n\r\n    // Update lightbox if open\r\n    if (this.lightboxOpen) {\r\n      if (this.lightboxImage) {\r\n        this.lightboxImage.src = this.images[index];\r\n      }\r\n      if (this.lightboxCounter) {\r\n        this.lightboxCounter.textContent = `${index + 1} / ${this.images.length}`;\r\n      }\r\n    }\r\n\r\n    // Track gallery view\r\n    RealtySoftAnalytics.trackGalleryView(this.property!.id, index);\r\n  }\r\n\r\n  private prev(): void {\r\n    this.goToImage(this.currentIndex - 1);\r\n  }\r\n\r\n  private next(): void {\r\n    this.goToImage(this.currentIndex + 1);\r\n  }\r\n\r\n  private openLightbox(): void {\r\n    this.lightboxOpen = true;\r\n    if (this.lightbox) this.lightbox.style.display = 'flex';\r\n    if (this.lightboxImage) this.lightboxImage.src = this.images[this.currentIndex];\r\n    if (this.lightboxCounter) {\r\n      this.lightboxCounter.textContent = `${this.currentIndex + 1} / ${this.images.length}`;\r\n    }\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  private closeLightbox(): void {\r\n    this.lightboxOpen = false;\r\n    if (this.lightbox) this.lightbox.style.display = 'none';\r\n    document.body.style.overflow = '';\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailGallery };\r\nexport default RSDetailGallery;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Features Component\r\n * Displays property features in two modes:\r\n * - 'button' (default): Compact button that opens modal with tabular layout\r\n * - 'inline': Traditional inline list grouped by category (accordion style)\r\n *\r\n * Usage:\r\n *   <div class=\"rs_detail_features\"></div>                     <!-- Button/popup mode (default) -->\r\n *   <div class=\"rs_detail_features\" data-mode=\"button\"></div>  <!-- Button/popup mode -->\r\n *   <div class=\"rs_detail_features\" data-mode=\"inline\"></div>  <!-- Inline/accordion mode -->\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, PropertyFeature } from '../../types/index';\r\n\r\ntype FeaturesMode = 'button' | 'inline';\r\n\r\nclass RSDetailFeatures extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private features: (string | PropertyFeature)[] = [];\r\n  private modal: HTMLElement | null = null;\r\n  private hasInitiallyRendered: boolean = false;\r\n  private mode: FeaturesMode = 'button';\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.features = (this.property.features as unknown as (string | PropertyFeature)[]) || [];\r\n\r\n    if (this.features.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Get mode from data attribute (default: 'button')\r\n    const modeAttr = this.element.dataset.mode as FeaturesMode;\r\n    this.mode = (modeAttr === 'inline') ? 'inline' : 'button';\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Listen for language changes\r\n    this.subscribe('config.language', () => {\r\n      this.updateLabelsInPlace();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    this.hasInitiallyRendered = true;\r\n    this.element.classList.add('rs-detail-features');\r\n    this.element.classList.add(`rs-detail-features--${this.mode}`);\r\n\r\n    if (this.mode === 'inline') {\r\n      this.renderInlineMode();\r\n    } else {\r\n      this.renderButtonMode();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Button mode: Compact button that opens modal\r\n   */\r\n  private renderButtonMode(): void {\r\n    const grouped = this.groupFeatures();\r\n    const totalFeatures = this.features.length;\r\n\r\n    this.element.innerHTML = `\r\n      <button type=\"button\" class=\"rs-detail-features__btn\">\r\n        <span class=\"rs-detail-features__btn-icon\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"9 11 12 14 22 4\"></polyline>\r\n            <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\r\n          </svg>\r\n        </span>\r\n        <span class=\"rs-detail-features__btn-label\">${this.label('detail_features') || 'Features'}</span>\r\n        <span class=\"rs-detail-features__btn-count\">${totalFeatures}</span>\r\n      </button>\r\n\r\n      <div class=\"rs-detail-features__modal\" style=\"display: none;\">\r\n        <div class=\"rs-detail-features__modal-backdrop\"></div>\r\n        <div class=\"rs-detail-features__modal-content\">\r\n          <div class=\"rs-detail-features__modal-header\">\r\n            <h3 class=\"rs-detail-features__modal-title\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"9 11 12 14 22 4\"></polyline>\r\n                <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\r\n              </svg>\r\n              ${this.label('detail_features') || 'Features'}\r\n              <span class=\"rs-detail-features__modal-count\">(${totalFeatures})</span>\r\n            </h3>\r\n            <button type=\"button\" class=\"rs-detail-features__modal-close\">&times;</button>\r\n          </div>\r\n          <div class=\"rs-detail-features__modal-body\">\r\n            ${this.renderFeaturesGrid(grouped)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.modal = this.element.querySelector('.rs-detail-features__modal');\r\n  }\r\n\r\n  /**\r\n   * Inline mode: Traditional list grouped by category (original behavior)\r\n   */\r\n  private renderInlineMode(): void {\r\n    const grouped = this.groupFeatures();\r\n\r\n    const html = Object.entries(grouped).map(([category, items]) => `\r\n      <div class=\"rs-detail-features__group\">\r\n        <h3 class=\"rs-detail-features__title\">${this.escapeHtml(category)}</h3>\r\n        <ul class=\"rs-detail-features__list\">\r\n          ${items.map(name => `\r\n            <li class=\"rs-detail-features__item\">\r\n              <svg class=\"rs-detail-features__icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n              </svg>\r\n              <span class=\"rs-detail-features__text\">${this.escapeHtml(name)}</span>\r\n            </li>\r\n          `).join('')}\r\n        </ul>\r\n      </div>\r\n    `).join('');\r\n\r\n    this.element.innerHTML = html;\r\n  }\r\n\r\n  private groupFeatures(): Record<string, string[]> {\r\n    const grouped: Record<string, string[]> = {};\r\n\r\n    this.features.forEach(feature => {\r\n      const name = typeof feature === 'string' ? feature : feature.name;\r\n      const category = (typeof feature === 'object' && feature.category) ? feature.category : 'General';\r\n      if (!grouped[category]) grouped[category] = [];\r\n      grouped[category].push(name);\r\n    });\r\n\r\n    return grouped;\r\n  }\r\n\r\n  private renderFeaturesGrid(grouped: Record<string, string[]>): string {\r\n    const categories = Object.keys(grouped);\r\n\r\n    // If only one category or no categories, show simple grid\r\n    if (categories.length <= 1) {\r\n      const allFeatures = categories.length === 1 ? grouped[categories[0]] : [];\r\n      return `\r\n        <div class=\"rs-detail-features__grid\">\r\n          ${allFeatures.map(name => `\r\n            <div class=\"rs-detail-features__grid-item\">\r\n              <svg class=\"rs-detail-features__check\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n              </svg>\r\n              <span>${this.escapeHtml(name)}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Multiple categories - show tabular layout with category headers\r\n    return categories.map(category => `\r\n      <div class=\"rs-detail-features__category\">\r\n        <h4 class=\"rs-detail-features__category-title\">${this.escapeHtml(category)}</h4>\r\n        <div class=\"rs-detail-features__grid\">\r\n          ${grouped[category].map(name => `\r\n            <div class=\"rs-detail-features__grid-item\">\r\n              <svg class=\"rs-detail-features__check\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n              </svg>\r\n              <span>${this.escapeHtml(name)}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.mode !== 'button') return;\r\n\r\n    // Open modal button\r\n    this.element.querySelector('.rs-detail-features__btn')?.addEventListener('click', () => {\r\n      this.openModal();\r\n    });\r\n\r\n    // Close handlers (use event delegation for dynamically created modal)\r\n    this.element.addEventListener('click', (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('.rs-detail-features__modal-close') ||\r\n          target.closest('.rs-detail-features__modal-backdrop')) {\r\n        this.closeModal();\r\n      }\r\n    });\r\n\r\n    // ESC key\r\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && this.modal && this.modal.style.display !== 'none') {\r\n        this.closeModal();\r\n      }\r\n    });\r\n  }\r\n\r\n  private openModal(): void {\r\n    if (this.modal) {\r\n      this.modal.style.display = 'flex';\r\n      document.body.style.overflow = 'hidden';\r\n    }\r\n  }\r\n\r\n  private closeModal(): void {\r\n    if (this.modal) {\r\n      this.modal.style.display = 'none';\r\n      document.body.style.overflow = '';\r\n    }\r\n  }\r\n\r\n  private updateLabelsInPlace(): void {\r\n    if (this.mode === 'button') {\r\n      // Update button label\r\n      const btnLabel = this.element.querySelector('.rs-detail-features__btn-label');\r\n      if (btnLabel) {\r\n        btnLabel.textContent = this.label('detail_features') || 'Features';\r\n      }\r\n\r\n      // Update modal title (preserve SVG and count)\r\n      const modalTitle = this.element.querySelector('.rs-detail-features__modal-title');\r\n      if (modalTitle) {\r\n        const svg = modalTitle.querySelector('svg');\r\n        const count = modalTitle.querySelector('.rs-detail-features__modal-count');\r\n        if (svg && count) {\r\n          modalTitle.innerHTML = '';\r\n          modalTitle.appendChild(svg);\r\n          modalTitle.appendChild(document.createTextNode(' ' + (this.label('detail_features') || 'Features') + ' '));\r\n          modalTitle.appendChild(count);\r\n        }\r\n      }\r\n    }\r\n    // Inline mode: titles are category names, not labels - no update needed\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailFeatures };\r\nexport default RSDetailFeatures;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Map Component\r\n * Interactive location map with multiple precision levels using Leaflet + Nominatim.\r\n * Municipality/zipcode modes show area boundary polygons.\r\n *\r\n * Variations (data-variation attribute):\r\n * 0 = Auto-detect (best available: pinpoint > zipcode > municipality)\r\n * 1 = Municipality (default) - shows municipality/area boundary polygon\r\n * 2 = Pinpoint - exact location with marker via lat/lng\r\n * 3 = Zipcode - postal code area boundary polygon\r\n *\r\n * Usage: <div class=\"rs_detail_map\" data-variation=\"0\"></div>\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property } from '../../types/index';\r\n\r\ntype MapMode = 'pinpoint' | 'zipcode' | 'municipality';\r\n\r\n// Leaflet type declarations (loaded dynamically from CDN)\r\ninterface LeafletMap {\r\n  setView(center: [number, number], zoom: number): LeafletMap;\r\n  fitBounds(bounds: [[number, number], [number, number]], options?: Record<string, unknown>): LeafletMap;\r\n  invalidateSize(): void;\r\n  remove(): void;\r\n}\r\n\r\ninterface LeafletMarker {\r\n  addTo(map: LeafletMap): LeafletMarker;\r\n  bindPopup(html: string): LeafletMarker;\r\n  openPopup(): LeafletMarker;\r\n}\r\n\r\ninterface LeafletGeoJSONLayer {\r\n  addTo(map: LeafletMap): LeafletGeoJSONLayer;\r\n  getBounds(): [[number, number], [number, number]];\r\n}\r\n\r\ninterface LeafletStatic {\r\n  map(el: HTMLElement): LeafletMap;\r\n  tileLayer(url: string, opts: Record<string, unknown>): { addTo(map: LeafletMap): void };\r\n  marker(coords: [number, number]): LeafletMarker;\r\n  geoJSON(data: unknown, opts?: Record<string, unknown>): LeafletGeoJSONLayer;\r\n  circleMarker(coords: [number, number], opts: Record<string, unknown>): { addTo(map: LeafletMap): void };\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    L?: LeafletStatic;\r\n  }\r\n}\r\n\r\nclass RSDetailMap extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private lat: string | number | null = null;\r\n  private lng: string | number | null = null;\r\n  private hasCoords: boolean = false;\r\n  private locationName: string = '';\r\n  private municipality: string = '';\r\n  private province: string = '';\r\n  private zipcode: string = '';\r\n  private country: string = 'Spain';\r\n  private displayLocation: string = '';\r\n  private currentMode: MapMode = 'municipality';\r\n  private mapContainerId: string = '';\r\n  private hasInitiallyRendered: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Extract location data\r\n    const p = this.property;\r\n    const orig = (p._original || {}) as Record<string, unknown>;\r\n\r\n    // Get coordinates\r\n    this.lat = p.latitude || (orig.latitude as string | number) || (orig.lat as string | number) || null;\r\n    this.lng = p.longitude || (orig.longitude as string | number) || (orig.lng as string | number) || null;\r\n    this.hasCoords = this.hasValidCoordinates();\r\n\r\n    // Get location info\r\n    const locationId = orig.location_id as { name?: string } | undefined;\r\n    const municipalityId = orig.municipality_id as { name?: string } | undefined;\r\n    const provinceId = orig.province_id as { name?: string } | undefined;\r\n\r\n    this.locationName = locationId?.name || p.location || '';\r\n    this.municipality = municipalityId?.name || (orig.municipality as string) || '';\r\n    this.province = provinceId?.name || (orig.province as string) || '';\r\n    this.zipcode = p.postal_code || (orig.zipcode as string) || (orig.postal_code as string) || '';\r\n    this.country = (orig.country as string) || 'Spain';\r\n\r\n    // Build display location string\r\n    this.displayLocation = this.buildDisplayLocation();\r\n\r\n    // Check if we have any location data\r\n    const hasLocation = this.locationName || this.municipality || this.province || this.zipcode || this.hasCoords;\r\n\r\n    if (!hasLocation) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Get variation from data attribute\r\n    const variationAttr = this.element.dataset.variation;\r\n    const variationNum = parseInt(variationAttr || '');\r\n    const finalVariation = (!variationAttr || isNaN(variationNum)) ? 1 : variationNum;\r\n    this.currentMode = this.getVariationMode(finalVariation);\r\n\r\n    this.mapContainerId = `rs-leaflet-map-${Date.now()}`;\r\n    this.render();\r\n\r\n    // Listen for language changes to update labels\r\n    this.subscribe('config.language', () => {\r\n      this.updateLabelsInPlace();\r\n    });\r\n  }\r\n\r\n  private hasValidCoordinates(): boolean {\r\n    const lat = parseFloat(String(this.lat));\r\n    const lng = parseFloat(String(this.lng));\r\n    return !isNaN(lat) && !isNaN(lng) && lat !== 0 && lng !== 0;\r\n  }\r\n\r\n  private buildDisplayLocation(): string {\r\n    const parts = [\r\n      this.locationName || this.municipality,\r\n      this.province\r\n    ].filter(Boolean);\r\n    return parts.join(', ');\r\n  }\r\n\r\n  private getVariationMode(num: number): MapMode {\r\n    switch (num) {\r\n      case 0:\r\n        // Auto-detect: prefer area boundary (more useful for real estate)\r\n        // Only use pinpoint if no location name/municipality available\r\n        if (this.locationName || this.municipality) return 'municipality';\r\n        if (this.zipcode) return 'zipcode';\r\n        if (this.hasCoords) return 'pinpoint';\r\n        return 'municipality';\r\n      case 2:\r\n        return this.hasCoords ? 'pinpoint' : 'municipality';\r\n      case 3:\r\n        return this.zipcode ? 'zipcode' : 'municipality';\r\n      case 1:\r\n      default:\r\n        return 'municipality';\r\n    }\r\n  }\r\n\r\n  render(): void {\r\n    // If already rendered, just update labels (language change scenario)\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    // First-time render: build full HTML structure\r\n    this.hasInitiallyRendered = true;\r\n\r\n    this.element.classList.add('rs-detail-map');\r\n\r\n    const directionsUrl = this.buildDirectionsUrl();\r\n    const largerMapUrl = this.buildLargerMapUrl();\r\n\r\n    const showActions = directionsUrl || largerMapUrl;\r\n    const actionsHtml = showActions ? `\r\n      <div class=\"rs-detail-map__actions\">\r\n        ${largerMapUrl ? `\r\n          <a href=\"${largerMapUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"rs-detail-map__action\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7\"/>\r\n            </svg>\r\n            ${this.label('detail_view_larger_map') || 'View Larger Map'}\r\n          </a>\r\n        ` : ''}\r\n        ${directionsUrl ? `\r\n          <a href=\"${directionsUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"rs-detail-map__action\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M3 11l19-9-9 19-2-8-8-2z\"/>\r\n            </svg>\r\n            ${this.label('detail_get_directions') || 'Get Directions'}\r\n          </a>\r\n        ` : ''}\r\n      </div>\r\n    ` : '';\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-detail-map__header\">\r\n        <h3 class=\"rs-detail-map__title\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n            <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n          </svg>\r\n          ${this.label('detail_location') || 'Location'}\r\n        </h3>\r\n        ${this.displayLocation ? `<p class=\"rs-detail-map__address\">${this.displayLocation}</p>` : ''}\r\n      </div>\r\n      <div class=\"rs-detail-map__container rs-detail-map__container--fullwidth\">\r\n        <div class=\"rs-detail-map__loading\" id=\"${this.mapContainerId}-loading\">\r\n          <div class=\"rs-detail-map__spinner\"></div>\r\n          <p>${this.label('detail_loading_map') || 'Loading map...'}</p>\r\n        </div>\r\n        <div class=\"rs-detail-map__leaflet\" id=\"${this.mapContainerId}\"></div>\r\n      </div>\r\n      ${actionsHtml}\r\n    `;\r\n\r\n    this.loadLeafletAndInit();\r\n  }\r\n\r\n  /**\r\n   * Dynamically load Leaflet CSS + JS from CDN, then initialize the map\r\n   */\r\n  private async loadLeafletAndInit(): Promise<void> {\r\n    try {\r\n      await this.loadLeaflet();\r\n      await this.initLeafletMap();\r\n    } catch (err) {\r\n      console.error('[RealtySoft] Map init failed:', err);\r\n      // Fallback: show Google Maps iframe\r\n      this.fallbackToIframe();\r\n    }\r\n  }\r\n\r\n  private loadLeaflet(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      // Already loaded\r\n      if (window.L) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      // Load CSS\r\n      if (!document.querySelector('link[href*=\"leaflet\"]')) {\r\n        const css = document.createElement('link');\r\n        css.rel = 'stylesheet';\r\n        css.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\r\n        css.crossOrigin = '';\r\n        document.head.appendChild(css);\r\n      }\r\n\r\n      // Load JS\r\n      if (!document.querySelector('script[src*=\"leaflet\"]')) {\r\n        const script = document.createElement('script');\r\n        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\r\n        script.crossOrigin = '';\r\n        script.onload = () => resolve();\r\n        script.onerror = () => reject(new Error('Failed to load Leaflet'));\r\n        document.head.appendChild(script);\r\n      } else {\r\n        // Script tag exists but L not ready yet - wait\r\n        const check = setInterval(() => {\r\n          if (window.L) {\r\n            clearInterval(check);\r\n            resolve();\r\n          }\r\n        }, 50);\r\n        setTimeout(() => {\r\n          clearInterval(check);\r\n          reject(new Error('Leaflet load timeout'));\r\n        }, 10000);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize Leaflet map based on current mode\r\n   */\r\n  private async initLeafletMap(): Promise<void> {\r\n    const L = window.L;\r\n    if (!L) return;\r\n\r\n    const container = document.getElementById(this.mapContainerId);\r\n    const loadingEl = document.getElementById(`${this.mapContainerId}-loading`);\r\n    if (!container) return;\r\n\r\n    // Create map\r\n    const map = L.map(container);\r\n\r\n    // Add tile layer (OpenStreetMap)\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n      maxZoom: 19\r\n    }).addTo(map);\r\n\r\n    if (this.currentMode === 'pinpoint' && this.hasCoords) {\r\n      // Pinpoint mode: marker at exact coordinates\r\n      const lat = parseFloat(String(this.lat));\r\n      const lng = parseFloat(String(this.lng));\r\n      map.setView([lat, lng], 14);\r\n      const marker = L.marker([lat, lng]).addTo(map);\r\n      if (this.displayLocation) {\r\n        marker.bindPopup(`<strong>${this.displayLocation}</strong>`).openPopup();\r\n      }\r\n      if (loadingEl) loadingEl.style.display = 'none';\r\n    } else {\r\n      // Municipality or Zipcode mode: fetch boundary from Nominatim\r\n      const query = this.buildNominatimQuery();\r\n      try {\r\n        const response = await fetch(\r\n          `https://nominatim.openstreetmap.org/search?format=json&polygon_geojson=1&limit=1&q=${encodeURIComponent(query)}`,\r\n          { headers: { 'Accept': 'application/json' } }\r\n        );\r\n        const data = await response.json();\r\n\r\n        if (data && data.length > 0 && data[0].geojson) {\r\n          const result = data[0];\r\n          const geojson = result.geojson;\r\n          const geomType = geojson.type;\r\n\r\n          // Check if the geometry is actually a polygon (not a Point)\r\n          // Nominatim can return Point geometry for small locations\r\n          const isPolygon = geomType === 'Polygon' || geomType === 'MultiPolygon';\r\n\r\n          if (isPolygon) {\r\n            // Add boundary polygon\r\n            const layer = L.geoJSON(geojson, {\r\n              style: () => ({\r\n                color: '#0066cc',\r\n                weight: 3,\r\n                opacity: 0.8,\r\n                fillColor: '#0066cc',\r\n                fillOpacity: 0.1\r\n              })\r\n            });\r\n            layer.addTo(map);\r\n\r\n            // Fit map to boundary bounds\r\n            const bounds = layer.getBounds();\r\n            map.fitBounds(bounds, { padding: [30, 30] });\r\n          } else {\r\n            // geoJSON is a Point or other non-polygon type - use circleMarker\r\n            const lat = parseFloat(result.lat);\r\n            const lng = parseFloat(result.lon);\r\n            map.setView([lat, lng], 14);\r\n            L.circleMarker([lat, lng], {\r\n              radius: 10,\r\n              color: '#0066cc',\r\n              fillColor: '#0066cc',\r\n              fillOpacity: 0.2,\r\n              weight: 2\r\n            }).addTo(map);\r\n          }\r\n        } else if (data && data.length > 0) {\r\n          // No polygon, but have coordinates - center on point\r\n          const lat = parseFloat(data[0].lat);\r\n          const lng = parseFloat(data[0].lon);\r\n          map.setView([lat, lng], 12);\r\n          L.circleMarker([lat, lng], {\r\n            radius: 8,\r\n            color: '#0066cc',\r\n            fillColor: '#0066cc',\r\n            fillOpacity: 0.3,\r\n            weight: 2\r\n          }).addTo(map);\r\n        } else {\r\n          // Nominatim returned nothing - use fallback coordinates or default\r\n          this.setFallbackView(map);\r\n        }\r\n      } catch (err) {\r\n        console.warn('[RealtySoft] Nominatim boundary fetch failed:', err);\r\n        this.setFallbackView(map);\r\n      }\r\n\r\n      if (loadingEl) loadingEl.style.display = 'none';\r\n    }\r\n\r\n    // Ensure map renders correctly after container is visible\r\n    setTimeout(() => map.invalidateSize(), 200);\r\n  }\r\n\r\n  /**\r\n   * Build query string for Nominatim search (municipality-first for polygon boundaries)\r\n   */\r\n  private buildNominatimQuery(useMunicipality: boolean = true): string {\r\n    if (this.currentMode === 'zipcode' && this.zipcode) {\r\n      const parts = [this.zipcode];\r\n      if (this.province) parts.push(this.province);\r\n      parts.push(this.country);\r\n      return parts.join(', ');\r\n    }\r\n\r\n    // Municipality mode: prioritize municipality for polygon boundaries\r\n    // Neighborhoods (locationName) often don't have polygon boundaries in Nominatim\r\n    const parts: string[] = [];\r\n\r\n    if (useMunicipality && this.municipality) {\r\n      // Use municipality (e.g., \"Torremolinos\") - more likely to have polygon\r\n      parts.push(this.municipality);\r\n    } else if (this.locationName) {\r\n      // Use location name (e.g., \"Torremolinos Centro\")\r\n      parts.push(this.locationName);\r\n    } else if (this.municipality) {\r\n      // Fallback to municipality if no location name\r\n      parts.push(this.municipality);\r\n    } else if (this.province) {\r\n      // Use province as last resort\r\n      parts.push(this.province);\r\n    }\r\n\r\n    if (this.province && parts[0] !== this.province) {\r\n      parts.push(this.province);\r\n    }\r\n    parts.push(this.country);\r\n    return parts.join(', ');\r\n  }\r\n\r\n  /**\r\n   * Set a fallback map view when Nominatim returns no results\r\n   */\r\n  private setFallbackView(map: LeafletMap): void {\r\n    if (this.hasCoords) {\r\n      const lat = parseFloat(String(this.lat));\r\n      const lng = parseFloat(String(this.lng));\r\n      map.setView([lat, lng], 12);\r\n    } else {\r\n      // Default: center of Spain\r\n      map.setView([40.0, -3.7], 6);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fallback to Google Maps iframe if Leaflet fails to load\r\n   */\r\n  private fallbackToIframe(): void {\r\n    const container = document.getElementById(this.mapContainerId);\r\n    const loadingEl = document.getElementById(`${this.mapContainerId}-loading`);\r\n    if (!container) return;\r\n\r\n    const areaParts: string[] = [];\r\n    if (this.locationName || this.municipality) {\r\n      areaParts.push(this.locationName || this.municipality);\r\n    }\r\n    if (this.province) areaParts.push(this.province);\r\n    areaParts.push(this.country);\r\n    const query = areaParts.join(', ');\r\n    const mapUrl = `https://maps.google.com/maps?q=${encodeURIComponent(query)}&z=12&output=embed`;\r\n\r\n    container.style.display = 'none';\r\n    const iframe = document.createElement('iframe');\r\n    iframe.className = 'rs-detail-map__iframe';\r\n    iframe.src = mapUrl;\r\n    iframe.loading = 'lazy';\r\n    iframe.allowFullscreen = true;\r\n    iframe.referrerPolicy = 'no-referrer-when-downgrade';\r\n    iframe.onload = () => { if (loadingEl) loadingEl.style.display = 'none'; };\r\n    container.parentElement?.appendChild(iframe);\r\n  }\r\n\r\n  /**\r\n   * Build Google Maps directions URL\r\n   */\r\n  private buildDirectionsUrl(): string | null {\r\n    let destination = '';\r\n\r\n    if (this.currentMode === 'pinpoint' && this.hasCoords) {\r\n      destination = `${this.lat},${this.lng}`;\r\n    } else {\r\n      const parts = [\r\n        this.locationName || this.municipality,\r\n        this.province,\r\n        this.country\r\n      ].filter(Boolean);\r\n      destination = parts.join(', ');\r\n    }\r\n\r\n    if (!destination) return null;\r\n\r\n    return `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(destination)}`;\r\n  }\r\n\r\n  /**\r\n   * Build \"View Larger Map\" URL\r\n   */\r\n  private buildLargerMapUrl(): string | null {\r\n    if (this.currentMode === 'pinpoint' && this.hasCoords) {\r\n      return `https://www.google.com/maps?q=${this.lat},${this.lng}&z=15`;\r\n    }\r\n\r\n    let query = '';\r\n    if (this.zipcode) {\r\n      query = [this.zipcode, this.locationName || this.municipality, this.province].filter(Boolean).join(' ');\r\n    } else {\r\n      query = [this.locationName || this.municipality, this.province, this.country].filter(Boolean).join(' ');\r\n    }\r\n\r\n    if (!query) return null;\r\n\r\n    return `https://www.google.com/maps/search/${encodeURIComponent(query)}`;\r\n  }\r\n\r\n  /**\r\n   * Update only label text nodes on language change (preserves map itself)\r\n   */\r\n  private updateLabelsInPlace(): void {\r\n    // Update title (preserve SVG icon)\r\n    const titleEl = this.element.querySelector('.rs-detail-map__title');\r\n    if (titleEl) {\r\n      const svg = titleEl.querySelector('svg');\r\n      if (svg) {\r\n        titleEl.innerHTML = '';\r\n        titleEl.appendChild(svg);\r\n        titleEl.appendChild(document.createTextNode(' ' + (this.label('detail_location') || 'Location')));\r\n      }\r\n    }\r\n\r\n    // Update loading text\r\n    const loadingText = this.element.querySelector('.rs-detail-map__loading p');\r\n    if (loadingText) {\r\n      loadingText.textContent = this.label('detail_loading_map') || 'Loading map...';\r\n    }\r\n\r\n    // Update action links (preserve SVGs)\r\n    const actions = this.element.querySelectorAll('.rs-detail-map__action');\r\n    actions.forEach((action, index) => {\r\n      const svg = action.querySelector('svg');\r\n      if (svg) {\r\n        const labelKey = index === 0 ? 'detail_view_larger_map' : 'detail_get_directions';\r\n        const defaultText = index === 0 ? 'View Larger Map' : 'Get Directions';\r\n        action.innerHTML = '';\r\n        action.appendChild(svg);\r\n        action.appendChild(document.createTextNode(' ' + (this.label(labelKey) || defaultText)));\r\n      }\r\n    });\r\n  }\r\n\r\n  getMapMode(): MapMode {\r\n    return this.currentMode;\r\n  }\r\n\r\n  isExactLocation(): boolean {\r\n    return this.currentMode === 'pinpoint' && this.hasCoords;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailMap };\r\nexport default RSDetailMap;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Inquiry Form Component\r\n * Contact form for property inquiries with country code selector\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  Property,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAPIModule,\r\n  RealtySoftAnalyticsModule,\r\n  WidgetConfig\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\ninterface CountryCode {\r\n  code: string;\r\n  country: string;\r\n  flag: string;\r\n  name: string;\r\n}\r\n\r\nclass RSDetailInquiryForm extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private submitting: boolean = false;\r\n  private submitted: boolean = false;\r\n  private hasInitiallyRendered: boolean = false;\r\n  private lastDefaultMessage: string = '';\r\n  private countryCodes: CountryCode[] = [];\r\n  private popularCountries: string[] = [];\r\n  private form: HTMLFormElement | null = null;\r\n  private submitBtn: HTMLButtonElement | null = null;\r\n  private submitText: HTMLElement | null = null;\r\n  private submitLoader: HTMLElement | null = null;\r\n  private errorDiv: HTMLElement | null = null;\r\n  private successDiv: HTMLElement | null = null;\r\n  private countryBtn: HTMLButtonElement | null = null;\r\n  private countryDropdown: HTMLElement | null = null;\r\n  private countryCodeInput: HTMLInputElement | null = null;\r\n  private countrySearch: HTMLInputElement | null = null;\r\n  private countryList: HTMLElement | null = null;\r\n  private thankYouMessage: string = '';\r\n  private thankYouRedirect: string | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    // Get property from options (set before super() calls init())\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    // Don't render if no property data\r\n    if (!this.property) {\r\n      console.warn('[RealtySoft] Inquiry form: No property data available');\r\n      return;\r\n    }\r\n\r\n    this.submitting = false;\r\n    this.submitted = false;\r\n\r\n    // Complete list of country codes (sorted by name)\r\n    this.countryCodes = [\r\n      { code: '+93', country: 'AF', flag: '\\u{1F1E6}\\u{1F1EB}', name: 'Afghanistan' },\r\n      { code: '+355', country: 'AL', flag: '\\u{1F1E6}\\u{1F1F1}', name: 'Albania' },\r\n      { code: '+213', country: 'DZ', flag: '\\u{1F1E9}\\u{1F1FF}', name: 'Algeria' },\r\n      { code: '+376', country: 'AD', flag: '\\u{1F1E6}\\u{1F1E9}', name: 'Andorra' },\r\n      { code: '+244', country: 'AO', flag: '\\u{1F1E6}\\u{1F1F4}', name: 'Angola' },\r\n      { code: '+54', country: 'AR', flag: '\\u{1F1E6}\\u{1F1F7}', name: 'Argentina' },\r\n      { code: '+374', country: 'AM', flag: '\\u{1F1E6}\\u{1F1F2}', name: 'Armenia' },\r\n      { code: '+61', country: 'AU', flag: '\\u{1F1E6}\\u{1F1FA}', name: 'Australia' },\r\n      { code: '+43', country: 'AT', flag: '\\u{1F1E6}\\u{1F1F9}', name: 'Austria' },\r\n      { code: '+994', country: 'AZ', flag: '\\u{1F1E6}\\u{1F1FF}', name: 'Azerbaijan' },\r\n      { code: '+973', country: 'BH', flag: '\\u{1F1E7}\\u{1F1ED}', name: 'Bahrain' },\r\n      { code: '+880', country: 'BD', flag: '\\u{1F1E7}\\u{1F1E9}', name: 'Bangladesh' },\r\n      { code: '+375', country: 'BY', flag: '\\u{1F1E7}\\u{1F1FE}', name: 'Belarus' },\r\n      { code: '+32', country: 'BE', flag: '\\u{1F1E7}\\u{1F1EA}', name: 'Belgium' },\r\n      { code: '+501', country: 'BZ', flag: '\\u{1F1E7}\\u{1F1FF}', name: 'Belize' },\r\n      { code: '+229', country: 'BJ', flag: '\\u{1F1E7}\\u{1F1EF}', name: 'Benin' },\r\n      { code: '+975', country: 'BT', flag: '\\u{1F1E7}\\u{1F1F9}', name: 'Bhutan' },\r\n      { code: '+591', country: 'BO', flag: '\\u{1F1E7}\\u{1F1F4}', name: 'Bolivia' },\r\n      { code: '+387', country: 'BA', flag: '\\u{1F1E7}\\u{1F1E6}', name: 'Bosnia' },\r\n      { code: '+267', country: 'BW', flag: '\\u{1F1E7}\\u{1F1FC}', name: 'Botswana' },\r\n      { code: '+55', country: 'BR', flag: '\\u{1F1E7}\\u{1F1F7}', name: 'Brazil' },\r\n      { code: '+673', country: 'BN', flag: '\\u{1F1E7}\\u{1F1F3}', name: 'Brunei' },\r\n      { code: '+359', country: 'BG', flag: '\\u{1F1E7}\\u{1F1EC}', name: 'Bulgaria' },\r\n      { code: '+855', country: 'KH', flag: '\\u{1F1F0}\\u{1F1ED}', name: 'Cambodia' },\r\n      { code: '+237', country: 'CM', flag: '\\u{1F1E8}\\u{1F1F2}', name: 'Cameroon' },\r\n      { code: '+1', country: 'CA', flag: '\\u{1F1E8}\\u{1F1E6}', name: 'Canada' },\r\n      { code: '+56', country: 'CL', flag: '\\u{1F1E8}\\u{1F1F1}', name: 'Chile' },\r\n      { code: '+86', country: 'CN', flag: '\\u{1F1E8}\\u{1F1F3}', name: 'China' },\r\n      { code: '+57', country: 'CO', flag: '\\u{1F1E8}\\u{1F1F4}', name: 'Colombia' },\r\n      { code: '+506', country: 'CR', flag: '\\u{1F1E8}\\u{1F1F7}', name: 'Costa Rica' },\r\n      { code: '+385', country: 'HR', flag: '\\u{1F1ED}\\u{1F1F7}', name: 'Croatia' },\r\n      { code: '+53', country: 'CU', flag: '\\u{1F1E8}\\u{1F1FA}', name: 'Cuba' },\r\n      { code: '+357', country: 'CY', flag: '\\u{1F1E8}\\u{1F1FE}', name: 'Cyprus' },\r\n      { code: '+420', country: 'CZ', flag: '\\u{1F1E8}\\u{1F1FF}', name: 'Czech Republic' },\r\n      { code: '+45', country: 'DK', flag: '\\u{1F1E9}\\u{1F1F0}', name: 'Denmark' },\r\n      { code: '+253', country: 'DJ', flag: '\\u{1F1E9}\\u{1F1EF}', name: 'Djibouti' },\r\n      { code: '+593', country: 'EC', flag: '\\u{1F1EA}\\u{1F1E8}', name: 'Ecuador' },\r\n      { code: '+20', country: 'EG', flag: '\\u{1F1EA}\\u{1F1EC}', name: 'Egypt' },\r\n      { code: '+503', country: 'SV', flag: '\\u{1F1F8}\\u{1F1FB}', name: 'El Salvador' },\r\n      { code: '+372', country: 'EE', flag: '\\u{1F1EA}\\u{1F1EA}', name: 'Estonia' },\r\n      { code: '+251', country: 'ET', flag: '\\u{1F1EA}\\u{1F1F9}', name: 'Ethiopia' },\r\n      { code: '+679', country: 'FJ', flag: '\\u{1F1EB}\\u{1F1EF}', name: 'Fiji' },\r\n      { code: '+358', country: 'FI', flag: '\\u{1F1EB}\\u{1F1EE}', name: 'Finland' },\r\n      { code: '+33', country: 'FR', flag: '\\u{1F1EB}\\u{1F1F7}', name: 'France' },\r\n      { code: '+995', country: 'GE', flag: '\\u{1F1EC}\\u{1F1EA}', name: 'Georgia' },\r\n      { code: '+49', country: 'DE', flag: '\\u{1F1E9}\\u{1F1EA}', name: 'Germany' },\r\n      { code: '+233', country: 'GH', flag: '\\u{1F1EC}\\u{1F1ED}', name: 'Ghana' },\r\n      { code: '+30', country: 'GR', flag: '\\u{1F1EC}\\u{1F1F7}', name: 'Greece' },\r\n      { code: '+502', country: 'GT', flag: '\\u{1F1EC}\\u{1F1F9}', name: 'Guatemala' },\r\n      { code: '+504', country: 'HN', flag: '\\u{1F1ED}\\u{1F1F3}', name: 'Honduras' },\r\n      { code: '+852', country: 'HK', flag: '\\u{1F1ED}\\u{1F1F0}', name: 'Hong Kong' },\r\n      { code: '+36', country: 'HU', flag: '\\u{1F1ED}\\u{1F1FA}', name: 'Hungary' },\r\n      { code: '+354', country: 'IS', flag: '\\u{1F1EE}\\u{1F1F8}', name: 'Iceland' },\r\n      { code: '+91', country: 'IN', flag: '\\u{1F1EE}\\u{1F1F3}', name: 'India' },\r\n      { code: '+62', country: 'ID', flag: '\\u{1F1EE}\\u{1F1E9}', name: 'Indonesia' },\r\n      { code: '+98', country: 'IR', flag: '\\u{1F1EE}\\u{1F1F7}', name: 'Iran' },\r\n      { code: '+964', country: 'IQ', flag: '\\u{1F1EE}\\u{1F1F6}', name: 'Iraq' },\r\n      { code: '+353', country: 'IE', flag: '\\u{1F1EE}\\u{1F1EA}', name: 'Ireland' },\r\n      { code: '+972', country: 'IL', flag: '\\u{1F1EE}\\u{1F1F1}', name: 'Israel' },\r\n      { code: '+39', country: 'IT', flag: '\\u{1F1EE}\\u{1F1F9}', name: 'Italy' },\r\n      { code: '+1876', country: 'JM', flag: '\\u{1F1EF}\\u{1F1F2}', name: 'Jamaica' },\r\n      { code: '+81', country: 'JP', flag: '\\u{1F1EF}\\u{1F1F5}', name: 'Japan' },\r\n      { code: '+962', country: 'JO', flag: '\\u{1F1EF}\\u{1F1F4}', name: 'Jordan' },\r\n      { code: '+7', country: 'KZ', flag: '\\u{1F1F0}\\u{1F1FF}', name: 'Kazakhstan' },\r\n      { code: '+254', country: 'KE', flag: '\\u{1F1F0}\\u{1F1EA}', name: 'Kenya' },\r\n      { code: '+965', country: 'KW', flag: '\\u{1F1F0}\\u{1F1FC}', name: 'Kuwait' },\r\n      { code: '+996', country: 'KG', flag: '\\u{1F1F0}\\u{1F1EC}', name: 'Kyrgyzstan' },\r\n      { code: '+856', country: 'LA', flag: '\\u{1F1F1}\\u{1F1E6}', name: 'Laos' },\r\n      { code: '+371', country: 'LV', flag: '\\u{1F1F1}\\u{1F1FB}', name: 'Latvia' },\r\n      { code: '+961', country: 'LB', flag: '\\u{1F1F1}\\u{1F1E7}', name: 'Lebanon' },\r\n      { code: '+218', country: 'LY', flag: '\\u{1F1F1}\\u{1F1FE}', name: 'Libya' },\r\n      { code: '+423', country: 'LI', flag: '\\u{1F1F1}\\u{1F1EE}', name: 'Liechtenstein' },\r\n      { code: '+370', country: 'LT', flag: '\\u{1F1F1}\\u{1F1F9}', name: 'Lithuania' },\r\n      { code: '+352', country: 'LU', flag: '\\u{1F1F1}\\u{1F1FA}', name: 'Luxembourg' },\r\n      { code: '+853', country: 'MO', flag: '\\u{1F1F2}\\u{1F1F4}', name: 'Macau' },\r\n      { code: '+60', country: 'MY', flag: '\\u{1F1F2}\\u{1F1FE}', name: 'Malaysia' },\r\n      { code: '+960', country: 'MV', flag: '\\u{1F1F2}\\u{1F1FB}', name: 'Maldives' },\r\n      { code: '+356', country: 'MT', flag: '\\u{1F1F2}\\u{1F1F9}', name: 'Malta' },\r\n      { code: '+230', country: 'MU', flag: '\\u{1F1F2}\\u{1F1FA}', name: 'Mauritius' },\r\n      { code: '+52', country: 'MX', flag: '\\u{1F1F2}\\u{1F1FD}', name: 'Mexico' },\r\n      { code: '+373', country: 'MD', flag: '\\u{1F1F2}\\u{1F1E9}', name: 'Moldova' },\r\n      { code: '+377', country: 'MC', flag: '\\u{1F1F2}\\u{1F1E8}', name: 'Monaco' },\r\n      { code: '+976', country: 'MN', flag: '\\u{1F1F2}\\u{1F1F3}', name: 'Mongolia' },\r\n      { code: '+382', country: 'ME', flag: '\\u{1F1F2}\\u{1F1EA}', name: 'Montenegro' },\r\n      { code: '+212', country: 'MA', flag: '\\u{1F1F2}\\u{1F1E6}', name: 'Morocco' },\r\n      { code: '+258', country: 'MZ', flag: '\\u{1F1F2}\\u{1F1FF}', name: 'Mozambique' },\r\n      { code: '+95', country: 'MM', flag: '\\u{1F1F2}\\u{1F1F2}', name: 'Myanmar' },\r\n      { code: '+264', country: 'NA', flag: '\\u{1F1F3}\\u{1F1E6}', name: 'Namibia' },\r\n      { code: '+977', country: 'NP', flag: '\\u{1F1F3}\\u{1F1F5}', name: 'Nepal' },\r\n      { code: '+31', country: 'NL', flag: '\\u{1F1F3}\\u{1F1F1}', name: 'Netherlands' },\r\n      { code: '+64', country: 'NZ', flag: '\\u{1F1F3}\\u{1F1FF}', name: 'New Zealand' },\r\n      { code: '+505', country: 'NI', flag: '\\u{1F1F3}\\u{1F1EE}', name: 'Nicaragua' },\r\n      { code: '+234', country: 'NG', flag: '\\u{1F1F3}\\u{1F1EC}', name: 'Nigeria' },\r\n      { code: '+389', country: 'MK', flag: '\\u{1F1F2}\\u{1F1F0}', name: 'North Macedonia' },\r\n      { code: '+47', country: 'NO', flag: '\\u{1F1F3}\\u{1F1F4}', name: 'Norway' },\r\n      { code: '+968', country: 'OM', flag: '\\u{1F1F4}\\u{1F1F2}', name: 'Oman' },\r\n      { code: '+92', country: 'PK', flag: '\\u{1F1F5}\\u{1F1F0}', name: 'Pakistan' },\r\n      { code: '+507', country: 'PA', flag: '\\u{1F1F5}\\u{1F1E6}', name: 'Panama' },\r\n      { code: '+595', country: 'PY', flag: '\\u{1F1F5}\\u{1F1FE}', name: 'Paraguay' },\r\n      { code: '+51', country: 'PE', flag: '\\u{1F1F5}\\u{1F1EA}', name: 'Peru' },\r\n      { code: '+63', country: 'PH', flag: '\\u{1F1F5}\\u{1F1ED}', name: 'Philippines' },\r\n      { code: '+48', country: 'PL', flag: '\\u{1F1F5}\\u{1F1F1}', name: 'Poland' },\r\n      { code: '+351', country: 'PT', flag: '\\u{1F1F5}\\u{1F1F9}', name: 'Portugal' },\r\n      { code: '+1787', country: 'PR', flag: '\\u{1F1F5}\\u{1F1F7}', name: 'Puerto Rico' },\r\n      { code: '+974', country: 'QA', flag: '\\u{1F1F6}\\u{1F1E6}', name: 'Qatar' },\r\n      { code: '+40', country: 'RO', flag: '\\u{1F1F7}\\u{1F1F4}', name: 'Romania' },\r\n      { code: '+7', country: 'RU', flag: '\\u{1F1F7}\\u{1F1FA}', name: 'Russia' },\r\n      { code: '+966', country: 'SA', flag: '\\u{1F1F8}\\u{1F1E6}', name: 'Saudi Arabia' },\r\n      { code: '+221', country: 'SN', flag: '\\u{1F1F8}\\u{1F1F3}', name: 'Senegal' },\r\n      { code: '+381', country: 'RS', flag: '\\u{1F1F7}\\u{1F1F8}', name: 'Serbia' },\r\n      { code: '+65', country: 'SG', flag: '\\u{1F1F8}\\u{1F1EC}', name: 'Singapore' },\r\n      { code: '+421', country: 'SK', flag: '\\u{1F1F8}\\u{1F1F0}', name: 'Slovakia' },\r\n      { code: '+386', country: 'SI', flag: '\\u{1F1F8}\\u{1F1EE}', name: 'Slovenia' },\r\n      { code: '+27', country: 'ZA', flag: '\\u{1F1FF}\\u{1F1E6}', name: 'South Africa' },\r\n      { code: '+82', country: 'KR', flag: '\\u{1F1F0}\\u{1F1F7}', name: 'South Korea' },\r\n      { code: '+34', country: 'ES', flag: '\\u{1F1EA}\\u{1F1F8}', name: 'Spain' },\r\n      { code: '+94', country: 'LK', flag: '\\u{1F1F1}\\u{1F1F0}', name: 'Sri Lanka' },\r\n      { code: '+46', country: 'SE', flag: '\\u{1F1F8}\\u{1F1EA}', name: 'Sweden' },\r\n      { code: '+41', country: 'CH', flag: '\\u{1F1E8}\\u{1F1ED}', name: 'Switzerland' },\r\n      { code: '+886', country: 'TW', flag: '\\u{1F1F9}\\u{1F1FC}', name: 'Taiwan' },\r\n      { code: '+992', country: 'TJ', flag: '\\u{1F1F9}\\u{1F1EF}', name: 'Tajikistan' },\r\n      { code: '+255', country: 'TZ', flag: '\\u{1F1F9}\\u{1F1FF}', name: 'Tanzania' },\r\n      { code: '+66', country: 'TH', flag: '\\u{1F1F9}\\u{1F1ED}', name: 'Thailand' },\r\n      { code: '+216', country: 'TN', flag: '\\u{1F1F9}\\u{1F1F3}', name: 'Tunisia' },\r\n      { code: '+90', country: 'TR', flag: '\\u{1F1F9}\\u{1F1F7}', name: 'Turkey' },\r\n      { code: '+993', country: 'TM', flag: '\\u{1F1F9}\\u{1F1F2}', name: 'Turkmenistan' },\r\n      { code: '+256', country: 'UG', flag: '\\u{1F1FA}\\u{1F1EC}', name: 'Uganda' },\r\n      { code: '+380', country: 'UA', flag: '\\u{1F1FA}\\u{1F1E6}', name: 'Ukraine' },\r\n      { code: '+971', country: 'AE', flag: '\\u{1F1E6}\\u{1F1EA}', name: 'UAE' },\r\n      { code: '+44', country: 'GB', flag: '\\u{1F1EC}\\u{1F1E7}', name: 'United Kingdom' },\r\n      { code: '+1', country: 'US', flag: '\\u{1F1FA}\\u{1F1F8}', name: 'United States' },\r\n      { code: '+598', country: 'UY', flag: '\\u{1F1FA}\\u{1F1FE}', name: 'Uruguay' },\r\n      { code: '+998', country: 'UZ', flag: '\\u{1F1FA}\\u{1F1FF}', name: 'Uzbekistan' },\r\n      { code: '+58', country: 'VE', flag: '\\u{1F1FB}\\u{1F1EA}', name: 'Venezuela' },\r\n      { code: '+84', country: 'VN', flag: '\\u{1F1FB}\\u{1F1F3}', name: 'Vietnam' },\r\n      { code: '+967', country: 'YE', flag: '\\u{1F1FE}\\u{1F1EA}', name: 'Yemen' },\r\n      { code: '+260', country: 'ZM', flag: '\\u{1F1FF}\\u{1F1F2}', name: 'Zambia' },\r\n      { code: '+263', country: 'ZW', flag: '\\u{1F1FF}\\u{1F1FC}', name: 'Zimbabwe' }\r\n    ];\r\n\r\n    // Popular countries to show at top\r\n    this.popularCountries = ['ES', 'GB', 'DE', 'FR', 'NL', 'BE', 'US', 'AE', 'CH', 'SE'];\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n    this.detectCountry();\r\n\r\n    // Listen for language changes to update labels\r\n    this.subscribe('config.language', () => {\r\n      this.updateLabelsInPlace();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Auto-detect user's country from browser timezone\r\n   */\r\n  private detectCountry(): void {\r\n    if (!this.countryBtn || !this.countryCodeInput) return;\r\n\r\n    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n    const timezoneToDialCode: Record<string, string> = {\r\n      'Europe/Madrid': '+34',\r\n      'Europe/London': '+44',\r\n      'Europe/Berlin': '+49',\r\n      'Europe/Paris': '+33',\r\n      'Europe/Amsterdam': '+31',\r\n      'Europe/Brussels': '+32',\r\n      'Europe/Stockholm': '+46',\r\n      'Europe/Oslo': '+47',\r\n      'Europe/Copenhagen': '+45',\r\n      'Europe/Helsinki': '+358',\r\n      'Europe/Zurich': '+41',\r\n      'Europe/Vienna': '+43',\r\n      'Europe/Rome': '+39',\r\n      'Europe/Lisbon': '+351',\r\n      'Europe/Dublin': '+353',\r\n      'Europe/Warsaw': '+48',\r\n      'Europe/Prague': '+420',\r\n      'Europe/Athens': '+30',\r\n      'Europe/Moscow': '+7',\r\n      'America/New_York': '+1',\r\n      'America/Los_Angeles': '+1',\r\n      'America/Chicago': '+1',\r\n      'America/Toronto': '+1',\r\n      'America/Mexico_City': '+52',\r\n      'America/Sao_Paulo': '+55',\r\n      'Asia/Dubai': '+971',\r\n      'Asia/Riyadh': '+966',\r\n      'Asia/Shanghai': '+86',\r\n      'Asia/Tokyo': '+81',\r\n      'Asia/Singapore': '+65',\r\n      'Asia/Hong_Kong': '+852',\r\n      'Asia/Kolkata': '+91',\r\n      'Australia/Sydney': '+61',\r\n      'Pacific/Auckland': '+64',\r\n      'Africa/Johannesburg': '+27'\r\n    };\r\n\r\n    const detectedDialCode = timezoneToDialCode[timezone];\r\n    if (detectedDialCode) {\r\n      const found = this.countryCodes.find(c => c.code === detectedDialCode);\r\n      if (found) {\r\n        this.setCountry(found);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the selected country\r\n   */\r\n  private setCountry(country: CountryCode): void {\r\n    if (!this.countryCodeInput || !this.countryBtn) return;\r\n\r\n    this.countryCodeInput.value = country.code;\r\n    const flagEl = this.countryBtn.querySelector('.rs-detail-inquiry__country-flag');\r\n    const codeEl = this.countryBtn.querySelector('.rs-detail-inquiry__country-code');\r\n    if (flagEl) flagEl.textContent = country.flag;\r\n    if (codeEl) codeEl.textContent = country.code;\r\n  }\r\n\r\n  render(): void {\r\n    // If already rendered, just update labels (language change scenario)\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    // First-time render: build full HTML structure\r\n    this.hasInitiallyRendered = true;\r\n\r\n    this.element.classList.add('rs-detail-inquiry');\r\n\r\n    const config = (RealtySoftState.get<Partial<WidgetConfig>>('config') || {}) as Partial<WidgetConfig>;\r\n    const privacyUrl = config.privacyPolicyUrl || '/privacy';\r\n    const defaultCountry = config.defaultCountryCode || '+34';\r\n\r\n    // Configurable thank you message and redirect\r\n    this.thankYouMessage = config.inquiryThankYouMessage || this.label('inquiry_success');\r\n    this.thankYouRedirect = config.inquiryThankYouUrl || null;\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-inquiry__title\">${this.label('detail_contact')}</h3>\r\n      <form class=\"rs-detail-inquiry__form\">\r\n        <div class=\"rs-detail-inquiry__row\">\r\n          <div class=\"rs-detail-inquiry__field rs-detail-inquiry__field--half\">\r\n            <label class=\"rs-detail-inquiry__label\" for=\"rs-inquiry-firstname\">${this.label('inquiry_first_name')} *</label>\r\n            <input type=\"text\"\r\n                   id=\"rs-inquiry-firstname\"\r\n                   name=\"first_name\"\r\n                   class=\"rs-detail-inquiry__input\"\r\n                   autocomplete=\"given-name\"\r\n                   required>\r\n          </div>\r\n\r\n          <div class=\"rs-detail-inquiry__field rs-detail-inquiry__field--half\">\r\n            <label class=\"rs-detail-inquiry__label\" for=\"rs-inquiry-lastname\">${this.label('inquiry_last_name')} *</label>\r\n            <input type=\"text\"\r\n                   id=\"rs-inquiry-lastname\"\r\n                   name=\"last_name\"\r\n                   class=\"rs-detail-inquiry__input\"\r\n                   autocomplete=\"family-name\"\r\n                   required>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"rs-detail-inquiry__field\">\r\n          <label class=\"rs-detail-inquiry__label\" for=\"rs-inquiry-email\">${this.label('inquiry_email')} *</label>\r\n          <input type=\"email\"\r\n                 id=\"rs-inquiry-email\"\r\n                 name=\"email\"\r\n                 class=\"rs-detail-inquiry__input\"\r\n                 autocomplete=\"email\"\r\n                 required>\r\n        </div>\r\n\r\n        <div class=\"rs-detail-inquiry__field\">\r\n          <label class=\"rs-detail-inquiry__label\" for=\"rs-inquiry-phone\">${this.label('inquiry_phone')}</label>\r\n          <div class=\"rs-detail-inquiry__phone-group\">\r\n            <div class=\"rs-detail-inquiry__country-select\">\r\n              <button type=\"button\" class=\"rs-detail-inquiry__country-btn\">\r\n                <span class=\"rs-detail-inquiry__country-flag\">${this.getFlag(defaultCountry)}</span>\r\n                <span class=\"rs-detail-inquiry__country-code\">${defaultCountry}</span>\r\n                <svg class=\"rs-detail-inquiry__country-arrow\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n                </svg>\r\n              </button>\r\n              <input type=\"hidden\" name=\"country_code\" value=\"${defaultCountry}\">\r\n              <div class=\"rs-detail-inquiry__country-dropdown\" style=\"display: none;\">\r\n                <div class=\"rs-detail-inquiry__country-search\">\r\n                  <input type=\"text\"\r\n                         class=\"rs-detail-inquiry__country-search-input\"\r\n                         placeholder=\"Search country...\">\r\n                </div>\r\n                <div class=\"rs-detail-inquiry__country-list\">\r\n                  ${this.renderCountryOptions()}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <input type=\"tel\"\r\n                   id=\"rs-inquiry-phone\"\r\n                   name=\"phone\"\r\n                   class=\"rs-detail-inquiry__input rs-detail-inquiry__input--phone\"\r\n                   autocomplete=\"tel-national\"\r\n                   placeholder=\"600 000 000\">\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"rs-detail-inquiry__field\">\r\n          <label class=\"rs-detail-inquiry__label\" for=\"rs-inquiry-message\">${this.label('inquiry_message')} *</label>\r\n          <textarea id=\"rs-inquiry-message\"\r\n                    name=\"message\"\r\n                    class=\"rs-detail-inquiry__textarea\"\r\n                    rows=\"4\"\r\n                    required>${this.getDefaultMessage()}</textarea>\r\n        </div>\r\n\r\n        <div class=\"rs-detail-inquiry__field rs-detail-inquiry__field--checkbox\">\r\n          <label class=\"rs-detail-inquiry__checkbox-label\">\r\n            <input type=\"checkbox\"\r\n                   name=\"privacy\"\r\n                   class=\"rs-detail-inquiry__checkbox\"\r\n                   required>\r\n            <span class=\"rs-detail-inquiry__checkbox-text\">\r\n              ${this.label('inquiry_privacy_accept')}\r\n              <a href=\"${privacyUrl}\" target=\"_blank\" rel=\"noopener\">${this.label('inquiry_privacy_policy')}</a>\r\n            </span>\r\n          </label>\r\n        </div>\r\n\r\n        <div class=\"rs-detail-inquiry__error\" style=\"display: none;\"></div>\r\n\r\n        <button type=\"submit\" class=\"rs-detail-inquiry__submit\">\r\n          <span class=\"rs-detail-inquiry__submit-text\">${this.label('inquiry_submit')}</span>\r\n          <span class=\"rs-detail-inquiry__submit-loader\" style=\"display: none;\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-dasharray=\"31.4 31.4\">\r\n                <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 12 12\" to=\"360 12 12\" dur=\"1s\" repeatCount=\"indefinite\"/>\r\n              </circle>\r\n            </svg>\r\n          </span>\r\n        </button>\r\n      </form>\r\n      <div class=\"rs-detail-inquiry__success\" style=\"display: none;\">\r\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\r\n          <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\r\n        </svg>\r\n        <span class=\"rs-detail-inquiry__success-message\">${this.thankYouMessage}</span>\r\n      </div>\r\n    `;\r\n\r\n    this.form = this.element.querySelector('.rs-detail-inquiry__form');\r\n    this.submitBtn = this.element.querySelector('.rs-detail-inquiry__submit');\r\n    this.submitText = this.element.querySelector('.rs-detail-inquiry__submit-text');\r\n    this.submitLoader = this.element.querySelector('.rs-detail-inquiry__submit-loader');\r\n    this.errorDiv = this.element.querySelector('.rs-detail-inquiry__error');\r\n    this.successDiv = this.element.querySelector('.rs-detail-inquiry__success');\r\n    this.countryBtn = this.element.querySelector('.rs-detail-inquiry__country-btn');\r\n    this.countryDropdown = this.element.querySelector('.rs-detail-inquiry__country-dropdown');\r\n    this.countryCodeInput = this.element.querySelector('input[name=\"country_code\"]');\r\n    this.countrySearch = this.element.querySelector('.rs-detail-inquiry__country-search-input');\r\n    this.countryList = this.element.querySelector('.rs-detail-inquiry__country-list');\r\n\r\n    // Store the initial default message for comparison on language change\r\n    this.lastDefaultMessage = this.getDefaultMessage();\r\n  }\r\n\r\n  /**\r\n   * Render country options with popular countries at top\r\n   */\r\n  private renderCountryOptions(filter: string = ''): string {\r\n    const filterLower = filter.toLowerCase();\r\n\r\n    // Get popular countries\r\n    const popular = this.popularCountries\r\n      .map(code => this.countryCodes.find(c => c.country === code))\r\n      .filter((c): c is CountryCode => !!c);\r\n\r\n    // Get all other countries\r\n    const others = this.countryCodes.filter(c => !this.popularCountries.includes(c.country));\r\n\r\n    // Filter if search term provided\r\n    const filterCountry = (c: CountryCode): boolean => {\r\n      if (!filter) return true;\r\n      return c.name.toLowerCase().includes(filterLower) ||\r\n             c.code.includes(filter) ||\r\n             c.country.toLowerCase().includes(filterLower);\r\n    };\r\n\r\n    const filteredPopular = popular.filter(filterCountry);\r\n    const filteredOthers = others.filter(filterCountry);\r\n\r\n    let html = '';\r\n\r\n    // Popular section\r\n    if (filteredPopular.length > 0 && !filter) {\r\n      html += `<div class=\"rs-detail-inquiry__country-section\">\r\n        <div class=\"rs-detail-inquiry__country-section-title\">Popular</div>\r\n        ${filteredPopular.map(c => this.renderCountryOption(c)).join('')}\r\n      </div>`;\r\n    }\r\n\r\n    // All countries section\r\n    const allCountries = filter ? [...filteredPopular, ...filteredOthers] : filteredOthers;\r\n    if (allCountries.length > 0) {\r\n      if (!filter) {\r\n        html += `<div class=\"rs-detail-inquiry__country-section\">\r\n          <div class=\"rs-detail-inquiry__country-section-title\">All Countries</div>\r\n          ${allCountries.map(c => this.renderCountryOption(c)).join('')}\r\n        </div>`;\r\n      } else {\r\n        html += allCountries.map(c => this.renderCountryOption(c)).join('');\r\n      }\r\n    }\r\n\r\n    if (!html) {\r\n      html = `<div class=\"rs-detail-inquiry__country-empty\">No country found</div>`;\r\n    }\r\n\r\n    return html;\r\n  }\r\n\r\n  private renderCountryOption(c: CountryCode): string {\r\n    return `<button type=\"button\"\r\n                    class=\"rs-detail-inquiry__country-option\"\r\n                    data-code=\"${c.code}\"\r\n                    data-flag=\"${c.flag}\"\r\n                    data-country=\"${c.country}\">\r\n                <span class=\"rs-detail-inquiry__country-flag\">${c.flag}</span>\r\n                <span class=\"rs-detail-inquiry__country-name\">${c.name}</span>\r\n                <span class=\"rs-detail-inquiry__country-code\">${c.code}</span>\r\n            </button>`;\r\n  }\r\n\r\n  private getFlag(code: string): string {\r\n    const country = this.countryCodes.find(c => c.code === code);\r\n    return country ? country.flag : '\\u{1F30D}';\r\n  }\r\n\r\n  private getDefaultMessage(): string {\r\n    const p = this.property;\r\n    if (!p) return '';\r\n    const title = p.title || 'this property';\r\n    const ref = p.ref ? ` (Ref: ${p.ref})` : '';\r\n\r\n    // Try to get translated template, with safe fallback\r\n    const labelKey = 'inquiry_default_message';\r\n    const translatedTemplate = this.label(labelKey);\r\n\r\n    // Only use translation if it exists and is not the key itself\r\n    const template = (translatedTemplate && translatedTemplate !== labelKey && !translatedTemplate.includes('{%'))\r\n      ? translatedTemplate\r\n      : 'I am interested in the property \"{title}\"{ref}. Please contact me with more information.';\r\n\r\n    return template\r\n      .replace('{title}', title)\r\n      .replace('{ref}', ref);\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Form submit\r\n    if (this.form) {\r\n      this.form.addEventListener('submit', async (e: Event) => {\r\n        e.preventDefault();\r\n\r\n        if (this.submitting || this.submitted) return;\r\n\r\n        await this.submitForm();\r\n      });\r\n    }\r\n\r\n    // Country code dropdown toggle\r\n    this.countryBtn?.addEventListener('click', (e: Event) => {\r\n      e.stopPropagation();\r\n      if (!this.countryDropdown) return;\r\n      const isOpen = this.countryDropdown.style.display !== 'none';\r\n      if (isOpen) {\r\n        this.closeCountryDropdown();\r\n      } else {\r\n        this.openCountryDropdown();\r\n      }\r\n    });\r\n\r\n    // Country search input\r\n    this.countrySearch?.addEventListener('input', (e: Event) => {\r\n      const target = e.target as HTMLInputElement;\r\n      const filter = target.value.trim();\r\n      if (this.countryList) {\r\n        this.countryList.innerHTML = this.renderCountryOptions(filter);\r\n        this.bindCountryOptions();\r\n      }\r\n    });\r\n\r\n    // Prevent dropdown close when clicking inside\r\n    this.countryDropdown?.addEventListener('click', (e: Event) => {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    // Bind initial country options\r\n    this.bindCountryOptions();\r\n\r\n    // Close dropdown on outside click\r\n    document.addEventListener('click', () => {\r\n      this.closeCountryDropdown();\r\n    });\r\n  }\r\n\r\n  private openCountryDropdown(): void {\r\n    if (!this.countryDropdown) return;\r\n    this.countryDropdown.style.display = 'block';\r\n    // Reset search and focus\r\n    if (this.countrySearch && this.countryList) {\r\n      this.countrySearch.value = '';\r\n      this.countryList.innerHTML = this.renderCountryOptions('');\r\n      this.bindCountryOptions();\r\n      setTimeout(() => this.countrySearch!.focus(), 10);\r\n    }\r\n  }\r\n\r\n  private closeCountryDropdown(): void {\r\n    if (this.countryDropdown) {\r\n      this.countryDropdown.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private bindCountryOptions(): void {\r\n    this.countryList?.querySelectorAll<HTMLButtonElement>('.rs-detail-inquiry__country-option').forEach(option => {\r\n      option.addEventListener('click', () => {\r\n        const code = option.dataset.code || '';\r\n        const flag = option.dataset.flag || '';\r\n\r\n        if (this.countryCodeInput) this.countryCodeInput.value = code;\r\n        if (this.countryBtn) {\r\n          const flagEl = this.countryBtn.querySelector('.rs-detail-inquiry__country-flag');\r\n          const codeEl = this.countryBtn.querySelector('.rs-detail-inquiry__country-code');\r\n          if (flagEl) flagEl.textContent = flag;\r\n          if (codeEl) codeEl.textContent = code;\r\n        }\r\n        this.closeCountryDropdown();\r\n      });\r\n    });\r\n  }\r\n\r\n  private async submitForm(): Promise<void> {\r\n    if (!this.form || !this.property) return;\r\n\r\n    this.submitting = true;\r\n    this.showLoading();\r\n    this.hideError();\r\n\r\n    const formData = new FormData(this.form);\r\n    const countryCode = (formData.get('country_code') as string) || '';\r\n    const phone = (formData.get('phone') as string) || '';\r\n\r\n    // Get owner email from config\r\n    const config = (RealtySoftState.get<Partial<WidgetConfig>>('config') || {}) as Record<string, unknown>;\r\n    const ownerEmail = (config.ownerEmail as string) || this.property.agent?.email || '';\r\n\r\n    // Send data in camelCase format (compatible with old widget PHP)\r\n    const data = {\r\n      firstName: formData.get('first_name') as string,\r\n      lastName: formData.get('last_name') as string,\r\n      email: formData.get('email') as string,\r\n      phone: phone,\r\n      countryCode: countryCode,\r\n      message: formData.get('message') as string,\r\n      propertyId: this.property.id,\r\n      propertyRef: this.property.ref,\r\n      propertyTitle: this.property.title,\r\n      propertyUrl: window.location.href,\r\n      propertyPrice: this.property.price ? RealtySoftLabels.formatPrice(this.property.price) : '',\r\n      ownerEmail: ownerEmail,\r\n      sendConfirmation: (config.sendConfirmationEmail as boolean) !== false,\r\n      language: RealtySoftLabels.getLanguage(),\r\n      privacyAccepted: true\r\n    };\r\n\r\n    try {\r\n      await RealtySoftAPI.submitInquiry(data);\r\n\r\n      this.submitted = true;\r\n      this.showSuccess();\r\n      this.form.reset();\r\n\r\n      // Track inquiry\r\n      RealtySoftAnalytics.trackInquiry(this.property.id, this.property.ref);\r\n\r\n    } catch (error) {\r\n      console.error('Inquiry submission failed:', error);\r\n      const errorMsg = (error as Error).message || this.label('inquiry_error');\r\n      this.showError(errorMsg);\r\n    } finally {\r\n      this.submitting = false;\r\n      this.hideLoading();\r\n    }\r\n  }\r\n\r\n  private showLoading(): void {\r\n    if (this.submitBtn) this.submitBtn.disabled = true;\r\n    if (this.submitText) this.submitText.style.display = 'none';\r\n    if (this.submitLoader) this.submitLoader.style.display = 'inline-block';\r\n  }\r\n\r\n  private hideLoading(): void {\r\n    if (this.submitBtn) this.submitBtn.disabled = false;\r\n    if (this.submitText) this.submitText.style.display = 'inline';\r\n    if (this.submitLoader) this.submitLoader.style.display = 'none';\r\n  }\r\n\r\n  private showError(message: string): void {\r\n    if (this.errorDiv) {\r\n      this.errorDiv.textContent = message;\r\n      this.errorDiv.style.display = 'block';\r\n    }\r\n  }\r\n\r\n  private hideError(): void {\r\n    if (this.errorDiv) this.errorDiv.style.display = 'none';\r\n  }\r\n\r\n  private showSuccess(): void {\r\n    // Hide form, show success message\r\n    if (this.form) this.form.style.display = 'none';\r\n    if (this.successDiv) this.successDiv.style.display = 'flex';\r\n\r\n    // If redirect URL is configured, redirect after a short delay\r\n    if (this.thankYouRedirect) {\r\n      setTimeout(() => {\r\n        window.location.href = this.thankYouRedirect!;\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update only label text nodes on language change (preserves form state)\r\n   */\r\n  private updateLabelsInPlace(): void {\r\n    // Don't update if form submitted (preserve success state)\r\n    if (this.submitted) return;\r\n\r\n    // Update title\r\n    const title = this.element.querySelector('.rs-detail-inquiry__title');\r\n    if (title) title.textContent = this.label('detail_contact');\r\n\r\n    // Update field labels\r\n    const labelMap: Record<string, string> = {\r\n      'rs-inquiry-firstname': 'inquiry_first_name',\r\n      'rs-inquiry-lastname': 'inquiry_last_name',\r\n      'rs-inquiry-email': 'inquiry_email',\r\n      'rs-inquiry-phone': 'inquiry_phone',\r\n      'rs-inquiry-message': 'inquiry_message'\r\n    };\r\n\r\n    for (const [inputId, labelKey] of Object.entries(labelMap)) {\r\n      const label = this.element.querySelector(`label[for=\"${inputId}\"]`);\r\n      if (label) {\r\n        const isRequired = label.textContent?.includes('*');\r\n        label.textContent = this.label(labelKey) + (isRequired ? ' *' : '');\r\n      }\r\n    }\r\n\r\n    // Update submit button\r\n    if (this.submitText) {\r\n      this.submitText.textContent = this.label('inquiry_submit');\r\n    }\r\n\r\n    // Update privacy text (keep link structure intact)\r\n    const privacyLabel = this.element.querySelector('.rs-detail-inquiry__checkbox-text');\r\n    if (privacyLabel) {\r\n      const link = privacyLabel.querySelector('a');\r\n      if (link) {\r\n        // Update link text\r\n        link.textContent = this.label('inquiry_privacy_policy');\r\n        // Update the text before the link\r\n        const firstTextNode = privacyLabel.firstChild;\r\n        if (firstTextNode && firstTextNode.nodeType === Node.TEXT_NODE) {\r\n          firstTextNode.textContent = this.label('inquiry_privacy_accept') + ' ';\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update textarea default message if user hasn't modified it\r\n    const textarea = this.element.querySelector('#rs-inquiry-message') as HTMLTextAreaElement | null;\r\n    if (textarea) {\r\n      const currentValue = textarea.value.trim();\r\n      const lastDefault = this.lastDefaultMessage.trim();\r\n\r\n      // Only update if the textarea still contains the default message (not modified by user)\r\n      if (currentValue === lastDefault || currentValue === '') {\r\n        const newDefaultMessage = this.getDefaultMessage();\r\n        textarea.value = newDefaultMessage;\r\n        this.lastDefaultMessage = newDefaultMessage;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailInquiryForm };\r\nexport default RSDetailInquiryForm;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Wishlist Component\r\n * Wishlist button for detail page\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  Property,\r\n  RealtySoftStateModule,\r\n  RealtySoftAnalyticsModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\ndeclare const RealtySoftToast: { success: (msg: string) => void; error: (msg: string) => void } | undefined;\r\ndeclare const WishlistManager: {\r\n  has: (refNo: string | number) => boolean;\r\n  add: (data: Record<string, unknown>) => void;\r\n  remove: (refNo: string | number) => void;\r\n} | undefined;\r\n\r\nclass RSDetailWishlist extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private isInWishlist: boolean = false;\r\n  private btn: HTMLButtonElement | null = null;\r\n  private icon: SVGElement | null = null;\r\n  private text: HTMLSpanElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    // Get property from options (set before super() calls init())\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property || !this.property.id) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Check WishlistManager first, then fallback to RealtySoftState\r\n    const refNo = this.property.ref || this.property.id;\r\n    this.isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager)\r\n      ? WishlistManager.has(refNo)\r\n      : RealtySoftState.isInWishlist(this.property.id);\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Listen for wishlist changes from WishlistManager\r\n    window.addEventListener('wishlistChanged', () => {\r\n      const ref = this.property!.ref || this.property!.id;\r\n      this.isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager)\r\n        ? WishlistManager.has(ref)\r\n        : RealtySoftState.isInWishlist(this.property!.id);\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // Also listen to RealtySoftState for backwards compatibility\r\n    this.subscribe('wishlist', () => {\r\n      const ref = this.property!.ref || this.property!.id;\r\n      this.isInWishlist = (typeof WishlistManager !== 'undefined' && WishlistManager)\r\n        ? WishlistManager.has(ref)\r\n        : RealtySoftState.isInWishlist(this.property!.id);\r\n      this.updateDisplay();\r\n    });\r\n\r\n    // Listen for language changes to update button text\r\n    this.subscribe('language', () => {\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-detail-wishlist');\r\n\r\n    this.element.innerHTML = `\r\n      <button type=\"button\" class=\"rs-detail-wishlist__btn ${this.isInWishlist ? 'rs-detail-wishlist__btn--active' : ''}\">\r\n        <svg class=\"rs-detail-wishlist__icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\"\r\n             fill=\"${this.isInWishlist ? 'currentColor' : 'none'}\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n        </svg>\r\n        <span class=\"rs-detail-wishlist__text\">\r\n          ${this.isInWishlist ? this.label('wishlist_remove') : this.label('wishlist_add')}\r\n        </span>\r\n      </button>\r\n    `;\r\n\r\n    this.btn = this.element.querySelector('.rs-detail-wishlist__btn');\r\n    this.icon = this.element.querySelector('.rs-detail-wishlist__icon');\r\n    this.text = this.element.querySelector('.rs-detail-wishlist__text');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.btn) {\r\n      this.btn.addEventListener('click', () => {\r\n        this.toggleWishlist();\r\n      });\r\n    }\r\n  }\r\n\r\n  private toggleWishlist(): void {\r\n    try {\r\n      const p = this.property!;\r\n      const refNo = p.ref || p.id;\r\n      const wmAvailable = typeof WishlistManager !== 'undefined' && WishlistManager;\r\n\r\n      if (this.isInWishlist) {\r\n        // Remove from WishlistManager (stores full data)\r\n        if (wmAvailable) {\r\n          WishlistManager!.remove(refNo);\r\n        }\r\n        // Note: WishlistManager.remove already syncs with RealtySoftState via notifyChange()\r\n        try { RealtySoftAnalytics.trackWishlistRemove(p.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_removed') || 'Removed from wishlist');\r\n        }\r\n      } else {\r\n        // Add to WishlistManager with full property data\r\n        if (wmAvailable) {\r\n          WishlistManager!.add({\r\n            id: p.id,\r\n            ref_no: p.ref,\r\n            ref: p.ref,\r\n            name: p.title,\r\n            title: p.title,\r\n            list_price: p.price,\r\n            price: p.price,\r\n            location: p.location,\r\n            type: p.type,\r\n            bedrooms: p.beds,\r\n            beds: p.beds,\r\n            bathrooms: p.baths,\r\n            baths: p.baths,\r\n            built_area: p.built_area,\r\n            plot_size: p.plot_size,\r\n            images: p.images || [],\r\n            listing_type: p.listing_type || p.status,\r\n            is_featured: p.is_featured || false\r\n          });\r\n        }\r\n        // Note: WishlistManager.add already syncs with RealtySoftState via notifyChange()\r\n        try { RealtySoftAnalytics.trackWishlistAdd(p.id); } catch (_) { /* analytics non-critical */ }\r\n\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_add') || 'Added to wishlist!');\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('[DetailWishlist] Toggle error:', err);\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.btn) {\r\n      this.btn.classList.toggle('rs-detail-wishlist__btn--active', this.isInWishlist);\r\n    }\r\n    if (this.icon) {\r\n      this.icon.setAttribute('fill', this.isInWishlist ? 'currentColor' : 'none');\r\n    }\r\n    if (this.text) {\r\n      this.text.textContent = this.isInWishlist ? this.label('wishlist_remove') : this.label('wishlist_add');\r\n    }\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailWishlist };\r\nexport default RSDetailWishlist;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Share Component\r\n * Social sharing buttons\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftLabelsModule, RealtySoftAnalyticsModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\ndeclare const RealtySoftToast: { success: (msg: string) => void; error: (msg: string) => void } | undefined;\r\n\r\nclass RSDetailShare extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private hasInitiallyRendered: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    // Get property from options (set before super() calls init())\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Listen for language changes to update labels\r\n    this.subscribe('language', () => {\r\n      this.updateLabelsInPlace();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    // If already rendered, just update labels (language change scenario)\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    // First-time render: build full HTML structure\r\n    this.hasInitiallyRendered = true;\r\n\r\n    this.element.classList.add('rs-detail-share');\r\n\r\n    this.element.innerHTML = `\r\n      <span class=\"rs-detail-share__label\">${this.label('detail_share') || 'Share'}</span>\r\n      <div class=\"rs-detail-share__buttons\">\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--whatsapp\"\r\n                data-platform=\"whatsapp\"\r\n                title=\"WhatsApp\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--facebook\"\r\n                data-platform=\"facebook\"\r\n                title=\"Facebook\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--twitter\"\r\n                data-platform=\"twitter\"\r\n                title=\"Twitter/X\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--linkedin\"\r\n                data-platform=\"linkedin\"\r\n                title=\"LinkedIn\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"/>\r\n          </svg>\r\n        </button>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--email\"\r\n                data-platform=\"email\"\r\n                title=\"Email\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n            <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n          </svg>\r\n        </button>\r\n\r\n        <button type=\"button\"\r\n                class=\"rs-detail-share__btn rs-detail-share__btn--copy\"\r\n                data-platform=\"copy\"\r\n                title=\"Copy Link\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\r\n            <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-detail-share__btn').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        const platform = btn.dataset.platform || '';\r\n\r\n        if (platform === 'copy') {\r\n          this.copyToClipboard();\r\n        } else {\r\n          this.share(platform);\r\n        }\r\n\r\n        RealtySoftAnalytics.trackShare(platform, this.property!.id);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the URL to share.\r\n   * WordPress: shares window.location.href (OG tags served from transient cache).\r\n   * Non-WordPress: shares a share.php URL on realtysoft.ai with property data as params.\r\n   */\r\n  private getShareUrl(): string {\r\n    const config = (window as any).RealtySoftConfig || {};\r\n    if (config.wpRestUrl) {\r\n      return window.location.href; // WordPress: OG tags from transient cache\r\n    }\r\n    return this.buildSharePhpUrl(); // Non-WordPress: share.php fallback\r\n  }\r\n\r\n  /**\r\n   * Build a share.php URL on realtysoft.ai with property data as query params.\r\n   * Used as a fallback for non-WordPress platforms (Wix, Squarespace, etc.).\r\n   */\r\n  private buildSharePhpUrl(): string {\r\n    const p = this.property!;\r\n    const params = new URLSearchParams();\r\n    params.set('ref', p.ref || p.unique_ref || '');\r\n    params.set('title', p.title || '');\r\n    params.set('image', (p.imagesFull?.[0]) || (p.images?.[0]) || '');\r\n    params.set('description', (p.short_description || p.description || '').substring(0, 300));\r\n    params.set('price', RealtySoftLabels.formatPrice(p.price));\r\n    params.set('location', p.location || '');\r\n    params.set('url', window.location.href);\r\n    return `https://realtysoft.ai/propertymanager/share.php?${params.toString()}`;\r\n  }\r\n\r\n  /**\r\n   * Share to specific platform.\r\n   * Uses getShareUrl() to determine the correct URL based on platform.\r\n   */\r\n  private share(platform: string): void {\r\n    const p = this.property!;\r\n    const pageUrl = this.getShareUrl();\r\n    const text = encodeURIComponent(`${p.title} - ${RealtySoftLabels.formatPrice(p.price)}`);\r\n\r\n    let shareLink = '';\r\n\r\n    switch (platform) {\r\n      case 'whatsapp':\r\n        shareLink = `https://wa.me/?text=${encodeURIComponent(p.title + ' - ' + pageUrl)}`;\r\n        break;\r\n\r\n      case 'facebook':\r\n        shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;\r\n        break;\r\n\r\n      case 'twitter':\r\n        shareLink = `https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent(pageUrl)}`;\r\n        break;\r\n\r\n      case 'linkedin':\r\n        shareLink = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(pageUrl)}`;\r\n        break;\r\n\r\n      case 'email': {\r\n        const subject = encodeURIComponent(p.title || 'Check out this property');\r\n        const body = encodeURIComponent(`${p.title}\\n${RealtySoftLabels.formatPrice(p.price)}\\n${p.location || ''}\\n\\nView property: ${pageUrl}`);\r\n        shareLink = `mailto:?subject=${subject}&body=${body}`;\r\n        window.location.href = shareLink;\r\n        return;\r\n      }\r\n\r\n      default:\r\n        shareLink = pageUrl;\r\n    }\r\n\r\n    // Open share dialog\r\n    window.open(shareLink, '_blank', 'width=600,height=500,scrollbars=yes');\r\n  }\r\n\r\n  private async copyToClipboard(): Promise<void> {\r\n    const shareUrl = this.getShareUrl();\r\n    try {\r\n      await navigator.clipboard.writeText(shareUrl);\r\n      this.showCopiedFeedback();\r\n    } catch {\r\n      // Fallback for older browsers\r\n      const textarea = document.createElement('textarea');\r\n      textarea.value = shareUrl;\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(textarea);\r\n      this.showCopiedFeedback();\r\n    }\r\n  }\r\n\r\n  private showCopiedFeedback(): void {\r\n    const copyBtn = this.element.querySelector('.rs-detail-share__btn--copy') as HTMLButtonElement | null;\r\n    if (!copyBtn) return;\r\n\r\n    const originalTitle = copyBtn.title;\r\n    copyBtn.title = 'Copied!';\r\n    copyBtn.classList.add('rs-detail-share__btn--copied');\r\n\r\n    // Show toast notification\r\n    if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n      RealtySoftToast.success('Link copied to clipboard!');\r\n    }\r\n\r\n    setTimeout(() => {\r\n      copyBtn.title = originalTitle;\r\n      copyBtn.classList.remove('rs-detail-share__btn--copied');\r\n    }, 2000);\r\n  }\r\n\r\n  /**\r\n   * Update only label text nodes on language change\r\n   */\r\n  private updateLabelsInPlace(): void {\r\n    const label = this.element.querySelector('.rs-detail-share__label');\r\n    if (label) label.textContent = this.label('detail_share') || 'Share';\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailShare };\r\nexport default RSDetailShare;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Related Component\r\n * Shows related/similar properties\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  Property,\r\n  RealtySoftAPIModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAnalyticsModule,\r\n  RealtySoftStateModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\nclass RSDetailRelated extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private relatedProperties: Property[] = [];\r\n  private limit: number = 6;\r\n  private loader: HTMLElement | null = null;\r\n  private grid: HTMLElement | null = null;\r\n  private hasInitiallyRendered: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    // Get property from options (set before super() calls init())\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property || !this.property.id) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.relatedProperties = [];\r\n    this.limit = parseInt(this.element.dataset.limit || '6') || 6;\r\n\r\n    this.render();\r\n    this.loadRelated();\r\n\r\n    // Listen for language changes to update labels\r\n    this.subscribe('config.language', () => {\r\n      this.updateLabelsInPlace();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    // If already rendered, just update labels (language change scenario)\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    // First-time render: build full HTML structure\r\n    this.hasInitiallyRendered = true;\r\n\r\n    this.element.classList.add('rs-detail-related');\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-related__title\">${this.label('detail_related')}</h3>\r\n      <div class=\"rs-detail-related__loader\">\r\n        <div class=\"rs-detail-related__spinner\"></div>\r\n      </div>\r\n      <div class=\"rs-detail-related__grid\"></div>\r\n    `;\r\n\r\n    this.loader = this.element.querySelector('.rs-detail-related__loader');\r\n    this.grid = this.element.querySelector('.rs-detail-related__grid');\r\n  }\r\n\r\n  /**\r\n   * Update only label text nodes on language change\r\n   */\r\n  private updateLabelsInPlace(): void {\r\n    // Update title\r\n    const titleEl = this.element.querySelector('.rs-detail-related__title');\r\n    if (titleEl) titleEl.textContent = this.label('detail_related');\r\n\r\n    // Re-render property cards if we have them (they contain labels for beds/baths/price)\r\n    if (this.relatedProperties.length > 0) {\r\n      this.renderProperties();\r\n    }\r\n  }\r\n\r\n  private async loadRelated(): Promise<void> {\r\n    try {\r\n      const result = await RealtySoftAPI.getRelatedProperties(this.property!.id, this.limit);\r\n      // Ensure we only show up to the limit (API might return more)\r\n      const allProperties = (result.data || []) as Property[];\r\n      this.relatedProperties = allProperties.slice(0, this.limit);\r\n\r\n      if (this.relatedProperties.length === 0) {\r\n        this.element.style.display = 'none';\r\n        return;\r\n      }\r\n\r\n      this.renderProperties();\r\n    } catch (error) {\r\n      console.error('Failed to load related properties:', error);\r\n      this.element.style.display = 'none';\r\n    } finally {\r\n      if (this.loader) this.loader.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private renderProperties(): void {\r\n    if (!this.grid) return;\r\n\r\n    this.grid.innerHTML = this.relatedProperties.map(property => this.createCard(property)).join('');\r\n\r\n    // Bind click events\r\n    this.grid.querySelectorAll<HTMLElement>('.rs-detail-related__card').forEach(card => {\r\n      card.addEventListener('click', () => {\r\n        const propertyId = card.dataset.propertyId;\r\n        const property = this.relatedProperties.find(p => String(p.id) === propertyId);\r\n        if (property) {\r\n          RealtySoftAnalytics.trackCardClick(property);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private generatePropertyUrl(property: Property): string {\r\n    if (property.url) return property.url;\r\n    const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n    const ref = property.ref || property.id;\r\n    const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    const title = property.title || '';\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9\\s-]/g, '')\r\n      .replace(/\\s+/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '')\r\n      .substring(0, 80);\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  private createCard(property: Property): string {\r\n    const mainImage = (property.images && property.images[0]) || '/realtysoft/assets/placeholder.jpg';\r\n    const price = RealtySoftLabels.formatPrice(property.price);\r\n\r\n    return `\r\n      <a href=\"${this.generatePropertyUrl(property)}\"\r\n         class=\"rs-detail-related__card\"\r\n         data-property-id=\"${property.id}\">\r\n        <div class=\"rs-detail-related__card-image\">\r\n          <img src=\"${mainImage}\" alt=\"${this.escapeHtml(property.title)}\" loading=\"lazy\">\r\n        </div>\r\n        <div class=\"rs-detail-related__card-content\">\r\n          <div class=\"rs-detail-related__card-price\">${price}</div>\r\n          <h4 class=\"rs-detail-related__card-title\">${this.escapeHtml(property.title)}</h4>\r\n          <div class=\"rs-detail-related__card-location\">${this.escapeHtml(property.location || '')}</div>\r\n          <div class=\"rs-detail-related__card-specs\">\r\n            ${property.beds ? `<span>${property.beds} ${this.label('card_beds')}</span>` : ''}\r\n            ${property.baths ? `<span>${property.baths} ${this.label('card_baths')}</span>` : ''}\r\n            ${property.built_area ? `<span>${property.built_area} mÂ²</span>` : ''}\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailRelated };\r\nexport default RSDetailRelated;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Info Table Component\r\n * Property information table (Type, Status, Reference, etc.)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property } from '../../types/index';\r\n\r\ninterface InfoRow {\r\n  label: string;\r\n  value: string | number;\r\n}\r\n\r\nclass RSDetailInfoTable extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-info-table');\r\n\r\n    // Build rows based on available data\r\n    const rows: InfoRow[] = [];\r\n\r\n    if (p.type) {\r\n      rows.push({ label: this.label('detail_property_type'), value: p.type });\r\n    }\r\n    if (p.status) {\r\n      rows.push({ label: this.label('detail_status'), value: p.status });\r\n    }\r\n    if (p.ref) {\r\n      rows.push({ label: this.label('detail_reference'), value: p.ref });\r\n    }\r\n    if (p.unique_ref) {\r\n      rows.push({ label: this.label('detail_unique_ref'), value: p.unique_ref });\r\n    }\r\n    if (p.year_built) {\r\n      rows.push({ label: this.label('detail_year_built'), value: p.year_built });\r\n    }\r\n    if (p.postal_code) {\r\n      rows.push({ label: this.label('detail_postal_code'), value: p.postal_code });\r\n    }\r\n    if (p.floor) {\r\n      rows.push({ label: this.label('detail_floor'), value: p.floor });\r\n    }\r\n    if (p.orientation) {\r\n      rows.push({ label: this.label('detail_orientation'), value: p.orientation });\r\n    }\r\n    if (p.condition) {\r\n      rows.push({ label: this.label('detail_condition'), value: p.condition });\r\n    }\r\n    if (p.furnished) {\r\n      rows.push({ label: this.label('detail_furnished'), value: p.furnished });\r\n    }\r\n    if (p.views) {\r\n      rows.push({ label: this.label('detail_views'), value: p.views });\r\n    }\r\n    if (p.parking && p.parking > 0) {\r\n      rows.push({ label: this.label('detail_parking'), value: p.parking });\r\n    }\r\n\r\n    if (rows.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-info-table__title\">${this.label('detail_property_info')}</h3>\r\n      <table class=\"rs-detail-info-table__table\">\r\n        <tbody>\r\n          ${rows.map(row => `\r\n            <tr class=\"rs-detail-info-table__row\">\r\n              <td class=\"rs-detail-info-table__label\">${row.label}</td>\r\n              <td class=\"rs-detail-info-table__value\">${this.escapeHtml(String(row.value))}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </tbody>\r\n      </table>\r\n    `;\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailInfoTable };\r\nexport default RSDetailInfoTable;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Specs Component\r\n * Key property specifications (Beds, Baths, Built, Plot, Terrace)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property } from '../../types/index';\r\n\r\ninterface SpecItem {\r\n  icon: string;\r\n  value: string | number;\r\n  label: string;\r\n}\r\n\r\nclass RSDetailSpecs extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-specs');\r\n\r\n    // Build specs based on available data (use parseFloat to handle string \"0\")\r\n    const specs: SpecItem[] = [];\r\n\r\n    // Always show beds/baths if > 0\r\n    if (p.beds && parseFloat(String(p.beds)) > 0) {\r\n      specs.push({\r\n        icon: this.getIcon('beds'),\r\n        value: p.beds,\r\n        label: this.label('card_beds') || 'Beds'\r\n      });\r\n    }\r\n\r\n    if (p.baths && parseFloat(String(p.baths)) > 0) {\r\n      specs.push({\r\n        icon: this.getIcon('baths'),\r\n        value: p.baths,\r\n        label: this.label('card_baths') || 'Baths'\r\n      });\r\n    }\r\n\r\n    // Size specs\r\n    if (p.built_area && parseFloat(String(p.built_area)) > 0) {\r\n      specs.push({\r\n        icon: this.getIcon('built'),\r\n        value: `${p.built_area} mÂ²`,\r\n        label: this.label('detail_built_area') || 'Built'\r\n      });\r\n    }\r\n\r\n    if (p.plot_size && parseFloat(String(p.plot_size)) > 0) {\r\n      specs.push({\r\n        icon: this.getIcon('plot'),\r\n        value: `${p.plot_size} mÂ²`,\r\n        label: this.label('detail_plot_size') || 'Plot'\r\n      });\r\n    }\r\n\r\n    if (p.terrace_size && parseFloat(String(p.terrace_size)) > 0) {\r\n      specs.push({\r\n        icon: this.getIcon('terrace'),\r\n        value: `${p.terrace_size} mÂ²`,\r\n        label: this.label('detail_terrace') || 'Terrace'\r\n      });\r\n    }\r\n\r\n    if (specs.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-detail-specs__grid\">\r\n        ${specs.map(spec => `\r\n          <div class=\"rs-detail-specs__item\">\r\n            <span class=\"rs-detail-specs__icon\">${spec.icon}</span>\r\n            <span class=\"rs-detail-specs__value\">${spec.value}</span>\r\n            <span class=\"rs-detail-specs__label\">${spec.label}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private getIcon(type: string): string {\r\n    const icons: Record<string, string> = {\r\n      beds: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 7v11m0-4h18m0 4V8a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3\"/><path d=\"M7 11v-1a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1\"/></svg>',\r\n      baths: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"/><path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"/><circle cx=\"9\" cy=\"6\" r=\"1\"/></svg>',\r\n      built: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><path d=\"M3 9h18M9 21V9\"/></svg>',\r\n      plot: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 3v18h18\"/><path d=\"M7 17l4-8 4 5 5-6\"/></svg>',\r\n      terrace: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2L2 7l10 5 10-5-10-5z\"/><path d=\"M2 17l10 5 10-5\"/><path d=\"M2 12l10 5 10-5\"/></svg>'\r\n    };\r\n    return icons[type] || icons.built;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailSpecs };\r\nexport default RSDetailSpecs;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Sizes Component\r\n * Additional property sizes (Terrace, Solarium, Garden, etc.)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property } from '../../types/index';\r\n\r\ninterface SizeItem {\r\n  icon: string;\r\n  label: string;\r\n  value: string;\r\n}\r\n\r\nclass RSDetailSizes extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-sizes');\r\n\r\n    // Build size items based on available data (use parseFloat to handle string \"0\" from API)\r\n    const sizes: SizeItem[] = [];\r\n\r\n    if (p.built_area && parseFloat(String(p.built_area)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('built'),\r\n        label: this.label('detail_built_area'),\r\n        value: `${p.built_area} mÂ²`\r\n      });\r\n    }\r\n    if (p.plot_size && parseFloat(String(p.plot_size)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('plot'),\r\n        label: this.label('detail_plot_size'),\r\n        value: `${p.plot_size} mÂ²`\r\n      });\r\n    }\r\n    if (p.usable_area && parseFloat(String(p.usable_area)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('usable'),\r\n        label: this.label('detail_usable_area'),\r\n        value: `${p.usable_area} mÂ²`\r\n      });\r\n    }\r\n    if (p.terrace_size && parseFloat(String(p.terrace_size)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('terrace'),\r\n        label: this.label('detail_terrace'),\r\n        value: `${p.terrace_size} mÂ²`\r\n      });\r\n    }\r\n    if (p.solarium_size && parseFloat(String(p.solarium_size)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('solarium'),\r\n        label: this.label('detail_solarium'),\r\n        value: `${p.solarium_size} mÂ²`\r\n      });\r\n    }\r\n    if (p.garden_size && parseFloat(String(p.garden_size)) > 0) {\r\n      sizes.push({\r\n        icon: this.getIcon('garden'),\r\n        label: this.label('detail_garden'),\r\n        value: `${p.garden_size} mÂ²`\r\n      });\r\n    }\r\n\r\n    if (sizes.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-sizes__title\">${this.label('detail_sizes')}</h3>\r\n      <div class=\"rs-detail-sizes__grid\">\r\n        ${sizes.map(size => `\r\n          <div class=\"rs-detail-sizes__item\">\r\n            <div class=\"rs-detail-sizes__icon\">${size.icon}</div>\r\n            <div class=\"rs-detail-sizes__content\">\r\n              <span class=\"rs-detail-sizes__label\">${size.label}</span>\r\n              <span class=\"rs-detail-sizes__value\">${size.value}</span>\r\n            </div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private getIcon(type: string): string {\r\n    const icons: Record<string, string> = {\r\n      built: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><path d=\"M3 9h18M9 21V9\"/></svg>',\r\n      plot: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 3v18h18\"/><path d=\"M7 17l4-8 4 5 5-6\"/></svg>',\r\n      usable: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\"/><path d=\"M9 9h6v6H9z\"/></svg>',\r\n      terrace: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2L2 7l10 5 10-5-10-5z\"/><path d=\"M2 17l10 5 10-5\"/><path d=\"M2 12l10 5 10-5\"/></svg>',\r\n      solarium: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"4\"/><path d=\"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41\"/></svg>',\r\n      garden: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 22V12\"/><path d=\"M12 12c-2.5 0-4.5-2-4.5-4.5S9.5 3 12 3s4.5 2 4.5 4.5S14.5 12 12 12z\"/><path d=\"M7 22h10\"/></svg>'\r\n    };\r\n    return icons[type] || icons.built;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailSizes };\r\nexport default RSDetailSizes;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Taxes Component\r\n * Property taxes and fees (Community, IBI, Basura)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftLabelsModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\ninterface TaxItem {\r\n  label: string;\r\n  value: string;\r\n  period: string;\r\n}\r\n\r\nclass RSDetailTaxes extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-taxes');\r\n\r\n    // Build tax items based on available data (use parseFloat to handle string \"0\" from API)\r\n    const taxes: TaxItem[] = [];\r\n\r\n    if (p.community_fees && parseFloat(String(p.community_fees)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_community_fees'),\r\n        value: RealtySoftLabels.formatPrice(p.community_fees),\r\n        period: this.label('detail_per_month')\r\n      });\r\n    }\r\n    if (p.ibi_tax && parseFloat(String(p.ibi_tax)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_ibi_tax'),\r\n        value: RealtySoftLabels.formatPrice(p.ibi_tax),\r\n        period: this.label('detail_per_year')\r\n      });\r\n    }\r\n    if (p.basura_tax && parseFloat(String(p.basura_tax)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_basura_tax'),\r\n        value: RealtySoftLabels.formatPrice(p.basura_tax),\r\n        period: this.label('detail_per_year')\r\n      });\r\n    }\r\n\r\n    if (taxes.length === 0) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-taxes__title\">${this.label('detail_taxes_fees')}</h3>\r\n      <div class=\"rs-detail-taxes__list\">\r\n        ${taxes.map(tax => `\r\n          <div class=\"rs-detail-taxes__item\">\r\n            <span class=\"rs-detail-taxes__label\">${tax.label}</span>\r\n            <span class=\"rs-detail-taxes__value\">\r\n              ${tax.value}\r\n              <span class=\"rs-detail-taxes__period\">${tax.period}</span>\r\n            </span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailTaxes };\r\nexport default RSDetailTaxes;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Energy Component\r\n * Energy certificate display (Rating, CO2, Image)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftStateModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\ninterface ColorSet {\r\n  [key: string]: string;\r\n}\r\n\r\nclass RSDetailEnergy extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const p = this.property;\r\n    // Check if we have any energy data\r\n    if (!p.energy_rating && !p.co2_rating && !p.energy_certificate_image) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-energy');\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-energy__title\">${this.label('detail_energy_certificate')}</h3>\r\n      <div class=\"rs-detail-energy__content\">\r\n        ${p.energy_rating ? this.renderRatingScale('energy', p.energy_rating, this.label('detail_energy_rating')) : ''}\r\n        ${p.co2_rating ? this.renderRatingScale('co2', p.co2_rating, this.label('detail_co2_rating')) : ''}\r\n        ${p.energy_consumption ? `\r\n          <div class=\"rs-detail-energy__consumption\">\r\n            <span class=\"rs-detail-energy__consumption-label\">${this.label('detail_energy_consumption')}</span>\r\n            <span class=\"rs-detail-energy__consumption-value\">${p.energy_consumption}</span>\r\n          </div>\r\n        ` : ''}\r\n        ${p.energy_certificate_image ? `\r\n          <div class=\"rs-detail-energy__image\">\r\n            <img src=\"${this.getAbsoluteImageUrl(p.energy_certificate_image)}\" alt=\"${this.label('detail_energy_certificate')}\" loading=\"lazy\">\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderRatingScale(type: string, rating: string, label: string): string {\r\n    const ratings = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];\r\n    const colors: Record<string, ColorSet> = {\r\n      energy: {\r\n        A: '#00a651', B: '#4cb848', C: '#8dc63f', D: '#fff200',\r\n        E: '#f7941d', F: '#f26522', G: '#ed1c24'\r\n      },\r\n      co2: {\r\n        A: '#9e7cc3', B: '#b18fcf', C: '#c4a2db', D: '#d7b5e7',\r\n        E: '#eac8f3', F: '#f5dbff', G: '#ffe0ff'\r\n      }\r\n    };\r\n\r\n    const currentRating = rating.toUpperCase().charAt(0);\r\n    const colorSet = colors[type] || colors.energy;\r\n\r\n    return `\r\n      <div class=\"rs-detail-energy__scale rs-detail-energy__scale--${type}\">\r\n        <span class=\"rs-detail-energy__scale-label\">${label}</span>\r\n        <div class=\"rs-detail-energy__scale-bars\">\r\n          ${ratings.map(r => {\r\n            const isActive = r === currentRating;\r\n            const color = colorSet[r] || '#ccc';\r\n            return `\r\n              <div class=\"rs-detail-energy__scale-bar ${isActive ? 'rs-detail-energy__scale-bar--active' : ''}\"\r\n                   style=\"background-color: ${color}\">\r\n                <span class=\"rs-detail-energy__scale-letter\">${r}</span>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n        <span class=\"rs-detail-energy__scale-value\">${rating}</span>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private getAbsoluteImageUrl(url: string): string {\r\n    if (!url) return '';\r\n    if (url.startsWith('http')) return url;\r\n\r\n    // If relative URL, prepend API base URL\r\n    const apiUrl = RealtySoftState.get<string>('config.apiUrl') || '';\r\n    if (apiUrl) {\r\n      const baseUrl = apiUrl.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\r\n      return baseUrl + (url.startsWith('/') ? '' : '/') + url;\r\n    }\r\n    return url;\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailEnergy };\r\nexport default RSDetailEnergy;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Resources Component\r\n * Additional resources (Video Tour, Virtual Tour, PDF Download)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftAnalyticsModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\ninterface ResourceItem {\r\n  type: string;\r\n  url: string;\r\n  icon: string;\r\n  label: string;\r\n  isEmbed: boolean;\r\n}\r\n\r\nclass RSDetailResources extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private modal: HTMLElement | null = null;\r\n  private modalBody: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const p = this.property;\r\n    // Check if we have any resources\r\n    if (!p.video_url && !p.virtual_tour_url && !p.pdf_url) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    const p = this.property!;\r\n    this.element.classList.add('rs-detail-resources');\r\n\r\n    const resources: ResourceItem[] = [];\r\n\r\n    if (p.video_url) {\r\n      resources.push({\r\n        type: 'video',\r\n        url: p.video_url,\r\n        icon: this.getIcon('video'),\r\n        label: this.label('detail_video_tour'),\r\n        isEmbed: this.isEmbeddable(p.video_url)\r\n      });\r\n    }\r\n\r\n    if (p.virtual_tour_url) {\r\n      resources.push({\r\n        type: 'tour',\r\n        url: p.virtual_tour_url,\r\n        icon: this.getIcon('tour'),\r\n        label: this.label('detail_virtual_tour'),\r\n        isEmbed: true\r\n      });\r\n    }\r\n\r\n    if (p.pdf_url) {\r\n      resources.push({\r\n        type: 'pdf',\r\n        url: p.pdf_url,\r\n        icon: this.getIcon('pdf'),\r\n        label: this.label('detail_download_pdf'),\r\n        isEmbed: false\r\n      });\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <h3 class=\"rs-detail-resources__title\">${this.label('detail_additional_resources')}</h3>\r\n      <div class=\"rs-detail-resources__grid\">\r\n        ${resources.map(r => `\r\n          <button type=\"button\"\r\n                  class=\"rs-detail-resources__btn rs-detail-resources__btn--${r.type}\"\r\n                  data-type=\"${r.type}\"\r\n                  data-url=\"${this.escapeAttr(r.url)}\"\r\n                  data-embed=\"${r.isEmbed}\">\r\n            <span class=\"rs-detail-resources__btn-icon\">${r.icon}</span>\r\n            <span class=\"rs-detail-resources__btn-label\">${r.label}</span>\r\n          </button>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"rs-detail-resources__modal\" style=\"display: none;\">\r\n        <div class=\"rs-detail-resources__modal-backdrop\"></div>\r\n        <div class=\"rs-detail-resources__modal-content\">\r\n          <button type=\"button\" class=\"rs-detail-resources__modal-close\">&times;</button>\r\n          <div class=\"rs-detail-resources__modal-body\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.modal = this.element.querySelector('.rs-detail-resources__modal');\r\n    this.modalBody = this.element.querySelector('.rs-detail-resources__modal-body');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Resource buttons\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-detail-resources__btn').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        const type = btn.dataset.type || '';\r\n        const url = btn.dataset.url || '';\r\n        const isEmbed = btn.dataset.embed === 'true';\r\n\r\n        if (type === 'pdf') {\r\n          window.open(url, '_blank');\r\n          RealtySoftAnalytics.trackResourceClick('pdf', this.property!.id);\r\n        } else if (isEmbed) {\r\n          this.openModal(type, url);\r\n          RealtySoftAnalytics.trackResourceClick(type, this.property!.id);\r\n        } else {\r\n          window.open(url, '_blank');\r\n          RealtySoftAnalytics.trackResourceClick(type, this.property!.id);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Modal close\r\n    if (this.modal) {\r\n      this.modal.querySelector('.rs-detail-resources__modal-close')?.addEventListener('click', () => {\r\n        this.closeModal();\r\n      });\r\n      this.modal.querySelector('.rs-detail-resources__modal-backdrop')?.addEventListener('click', () => {\r\n        this.closeModal();\r\n      });\r\n    }\r\n\r\n    // ESC key\r\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && this.modal && this.modal.style.display !== 'none') {\r\n        this.closeModal();\r\n      }\r\n    });\r\n  }\r\n\r\n  private openModal(type: string, url: string): void {\r\n    let embedHtml = '';\r\n\r\n    if (type === 'video') {\r\n      const embedUrl = this.getVideoEmbedUrl(url);\r\n      embedHtml = `<iframe src=\"${embedUrl}\" frameborder=\"0\" allow=\"autoplay; fullscreen\" allowfullscreen></iframe>`;\r\n    } else if (type === 'tour') {\r\n      embedHtml = `<iframe src=\"${url}\" frameborder=\"0\" allowfullscreen></iframe>`;\r\n    }\r\n\r\n    if (this.modalBody) this.modalBody.innerHTML = embedHtml;\r\n    if (this.modal) this.modal.style.display = 'flex';\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  private closeModal(): void {\r\n    if (this.modal) this.modal.style.display = 'none';\r\n    if (this.modalBody) this.modalBody.innerHTML = '';\r\n    document.body.style.overflow = '';\r\n  }\r\n\r\n  private getVideoEmbedUrl(url: string): string {\r\n    // YouTube\r\n    const ytMatch = url.match(/(?:youtube\\.com\\/(?:watch\\?v=|embed\\/)|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/);\r\n    if (ytMatch) {\r\n      return `https://www.youtube.com/embed/${ytMatch[1]}?autoplay=1`;\r\n    }\r\n\r\n    // Vimeo\r\n    const vimeoMatch = url.match(/vimeo\\.com\\/(\\d+)/);\r\n    if (vimeoMatch) {\r\n      return `https://player.vimeo.com/video/${vimeoMatch[1]}?autoplay=1`;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private isEmbeddable(url: string): boolean {\r\n    return url.includes('youtube') || url.includes('youtu.be') || url.includes('vimeo');\r\n  }\r\n\r\n  private getIcon(type: string): string {\r\n    const icons: Record<string, string> = {\r\n      video: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polygon points=\"5 3 19 12 5 21 5 3\"/></svg>',\r\n      tour: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20\"/><path d=\"M2 12h20\"/></svg>',\r\n      pdf: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/><path d=\"M14 2v6h6\"/><path d=\"M12 18v-6\"/><path d=\"M9 15l3 3 3-3\"/></svg>'\r\n    };\r\n    return icons[type] || icons.pdf;\r\n  }\r\n\r\n  private escapeAttr(text: string): string {\r\n    if (!text) return '';\r\n    return text.replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailResources };\r\nexport default RSDetailResources;\r\n","/**\r\n * RealtySoft Widget v3 - Detail PDF Button Component\r\n * Standalone PDF download button\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property, RealtySoftAnalyticsModule } from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\nclass RSDetailPdfButton extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private pdfUrl: string | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    // Get PDF URL from multiple possible locations\r\n    const p = this.property;\r\n    const orig = (p._original || {}) as Record<string, unknown>;\r\n\r\n    this.pdfUrl = p.pdf_url || (orig.pdf_url as string) || (orig.pdf as string) ||\r\n                  (orig.brochure_url as string) || (orig.brochure as string) ||\r\n                  (orig.pdf_link as string) || (orig.document_url as string) ||\r\n                  (orig.flyer_url as string) || (orig.flyer as string) ||\r\n                  null;\r\n\r\n    if (!this.pdfUrl) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-detail-pdf');\r\n\r\n    this.element.innerHTML = `\r\n      <a href=\"${this.pdfUrl}\" target=\"_blank\" class=\"rs-detail-pdf__btn\" rel=\"noopener\">\r\n        <svg class=\"rs-detail-pdf__icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/>\r\n          <path d=\"M14 2v6h6\"/>\r\n          <path d=\"M12 18v-6\"/>\r\n          <path d=\"M9 15l3 3 3-3\"/>\r\n        </svg>\r\n        <span class=\"rs-detail-pdf__text\">${this.label('detail_download_pdf') || 'Download PDF'}</span>\r\n      </a>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    const btn = this.element.querySelector('.rs-detail-pdf__btn');\r\n    if (btn && this.property) {\r\n      btn.addEventListener('click', () => {\r\n        RealtySoftAnalytics.trackResourceClick('pdf', this.property!.id);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailPdfButton };\r\nexport default RSDetailPdfButton;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Video Embed Component\r\n * Displays embedded video (YouTube/Vimeo) directly on the page\r\n *\r\n * Usage: <div class=\"rs_detail_video_embed\"></div>\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type { ComponentOptions, Property } from '../../types/index';\r\n\r\nclass RSDetailVideoEmbed extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private videoUrl: string = '';\r\n  private embedUrl: string = '';\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = this.options?.property as Property | null;\r\n\r\n    if (!this.property) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.videoUrl = this.property.video_url || '';\r\n\r\n    if (!this.videoUrl) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.embedUrl = this.getEmbedUrl(this.videoUrl);\r\n\r\n    if (!this.embedUrl) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-detail-video-embed');\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-detail-video-embed__header\">\r\n        <h3 class=\"rs-detail-video-embed__title\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polygon points=\"5 3 19 12 5 21 5 3\"></polygon>\r\n          </svg>\r\n          ${this.label('detail_video_tour') || 'Video Tour'}\r\n        </h3>\r\n      </div>\r\n      <div class=\"rs-detail-video-embed__container\">\r\n        <iframe\r\n          src=\"${this.embedUrl}\"\r\n          frameborder=\"0\"\r\n          allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n          allowfullscreen\r\n          loading=\"lazy\"\r\n          class=\"rs-detail-video-embed__iframe\"\r\n        ></iframe>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private getEmbedUrl(url: string): string {\r\n    // YouTube - various URL formats\r\n    const ytMatch = url.match(/(?:youtube\\.com\\/(?:watch\\?v=|embed\\/|v\\/)|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/);\r\n    if (ytMatch) {\r\n      return `https://www.youtube.com/embed/${ytMatch[1]}?rel=0&modestbranding=1`;\r\n    }\r\n\r\n    // Vimeo\r\n    const vimeoMatch = url.match(/vimeo\\.com\\/(\\d+)/);\r\n    if (vimeoMatch) {\r\n      return `https://player.vimeo.com/video/${vimeoMatch[1]}`;\r\n    }\r\n\r\n    // Already an embed URL\r\n    if (url.includes('youtube.com/embed') || url.includes('player.vimeo.com')) {\r\n      return url;\r\n    }\r\n\r\n    return '';\r\n  }\r\n}\r\n\r\n// Note: This component is NOT auto-registered.\r\n// It is instantiated by RSDetail.populateComponents() when property data is available.\r\n\r\nexport { RSDetailVideoEmbed };\r\nexport default RSDetailVideoEmbed;\r\n","/**\r\n * RealtySoft Widget v3 - Detail Component\r\n * Main wrapper for property detail page, loads property and populates child components\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  Property,\r\n  RealtySoftModule,\r\n  RealtySoftLabelsModule\r\n} from '../../types/index';\r\nimport { RSDetailBackButton } from './back-button';\r\nimport { RSDetailGallery } from './gallery';\r\nimport { RSDetailFeatures } from './features';\r\nimport { RSDetailMap } from './map';\r\nimport { RSDetailInquiryForm } from './inquiry-form';\r\nimport { RSDetailWishlist } from './wishlist';\r\nimport { RSDetailShare } from './share';\r\nimport { RSDetailRelated } from './related';\r\nimport { RSDetailInfoTable } from './info-table';\r\nimport { RSDetailSpecs } from './specs';\r\nimport { RSDetailSizes } from './sizes';\r\nimport { RSDetailTaxes } from './taxes';\r\nimport { RSDetailEnergy } from './energy';\r\nimport { RSDetailResources } from './resources';\r\nimport { RSDetailPdfButton } from './pdf-button';\r\nimport { RSDetailVideoEmbed } from './video-embed';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\n// Extended HTMLElement with component reference\r\ninterface RSHTMLElement extends HTMLElement {\r\n  _rsComponent?: unknown;\r\n}\r\n\r\nclass RSDetail extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private propertyId: string | null = null;\r\n  private propertyRef: string | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = null;\r\n    this.propertyId = null;\r\n    this.propertyRef = null;\r\n\r\n    // Clear stale PHP prefetch if it doesn't match the current URL\r\n    this.clearStalePrefetch();\r\n\r\n    // Priority 1: Check URL patterns first (SEO-friendly URLs)\r\n    this.propertyId = this.getPropertyIdFromUrl();\r\n    this.propertyRef = this.getPropertyRefFromUrl();\r\n\r\n    // Priority 2: Fallback to data attributes (for embedded/widget usage)\r\n    if (!this.propertyId && !this.propertyRef) {\r\n      const dataId = this.element.dataset.propertyId;\r\n      const dataRef = this.element.dataset.propertyRef;\r\n\r\n      // Auto-detect: if dataId contains letters, treat it as a reference\r\n      if (dataId) {\r\n        if (/^\\d+$/.test(dataId)) {\r\n          // Pure numeric = ID\r\n          this.propertyId = dataId;\r\n        } else {\r\n          // Contains letters = Reference\r\n          this.propertyRef = dataId;\r\n        }\r\n      }\r\n\r\n      if (dataRef) {\r\n        this.propertyRef = dataRef;\r\n      }\r\n    }\r\n\r\n    // Priority 3: Check for auto-injected reference stored globally\r\n    if (!this.propertyId && !this.propertyRef && window._rsAutoInjectedRef) {\r\n      this.propertyRef = window._rsAutoInjectedRef;\r\n    }\r\n\r\n    this.element.classList.add('rs-detail');\r\n\r\n    if (this.propertyId || this.propertyRef) {\r\n      // RACE CONDITION FIX: Use direct API return with validation\r\n      this.loadProperty().then(property => {\r\n        if (property) {\r\n          // Validate the property matches what we asked for\r\n          if (this.propertyRef && property.ref?.toLowerCase() !== this.propertyRef.toLowerCase()) {\r\n            console.warn('[RealtySoft] Property ref mismatch - expected:', this.propertyRef, 'got:', property.ref);\r\n            return;\r\n          }\r\n          this.property = property;\r\n          this.populateComponents();\r\n        }\r\n      });\r\n    } else {\r\n      console.warn('[RealtySoft] No property ID or reference found');\r\n      this.showError();\r\n    }\r\n\r\n    // Subscribe only for background updates to the SAME property\r\n    this.subscribe<Property>('currentProperty', (property) => {\r\n      // Only update if we already have a property AND it's the same ID\r\n      if (!property || !this.property) return;\r\n      if (property.id !== this.property.id) return;\r\n\r\n      this.property = property;\r\n      this.populateComponents();\r\n    });\r\n  }\r\n\r\n  private getPropertyIdFromUrl(): string | null {\r\n    // Try different URL patterns\r\n    const patterns = [\r\n      /\\/property\\/(\\d+)/,\r\n      /[?&]id=(\\d+)/,\r\n      /[?&]property_id=(\\d+)/\r\n    ];\r\n\r\n    for (const pattern of patterns) {\r\n      const match = window.location.href.match(pattern);\r\n      if (match) return match[1];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private getPropertyRefFromUrl(): string | null {\r\n    // Try query parameter first\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const queryRef = urlParams.get('ref');\r\n    if (queryRef) return queryRef.trim();\r\n\r\n    // Extract from SEO-friendly URL path\r\n    const path = window.location.pathname;\r\n    const pathParts = path.split('/').filter(p => p);\r\n    const lastPart = pathParts[pathParts.length - 1];\r\n\r\n    if (lastPart) {\r\n      const cleanPart = lastPart.replace('.html', '');\r\n\r\n      // Patterns to extract reference from URL slug\r\n      const patterns = [\r\n        /([A-Z]{1,4}\\d+)/i,\r\n        /(\\d{6,})/,\r\n        /([A-Z]{2,}\\d*-\\d+)/i,\r\n        /-([A-Z0-9]+)$/i\r\n      ];\r\n\r\n      for (const pattern of patterns) {\r\n        const match = cleanPart.match(pattern);\r\n        if (match) return match[1];\r\n      }\r\n\r\n      // If no pattern matched but it's a simple string without dashes\r\n      if (!cleanPart.includes('-')) return cleanPart;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Clear stale PHP prefetch data that doesn't match current URL\r\n   * RACE CONDITION FIX: Be aggressive - if we can't verify match, clear it\r\n   */\r\n  private clearStalePrefetch(): void {\r\n    const prefetch = (window as any).__rsPrefetch;\r\n    if (!prefetch) return;\r\n\r\n    const urlRef = this.getPropertyRefFromUrl();\r\n    const prefetchRef = prefetch.ref;\r\n\r\n    if (urlRef) {\r\n      if (!prefetchRef || urlRef.toLowerCase() !== prefetchRef.toLowerCase()) {\r\n        console.log('[RealtySoft] Clearing stale prefetch - URL ref:', urlRef, 'prefetch ref:', prefetchRef);\r\n        delete (window as any).__rsPrefetch;\r\n      }\r\n    } else {\r\n      console.log('[RealtySoft] Clearing prefetch - could not determine URL ref');\r\n      delete (window as any).__rsPrefetch;\r\n    }\r\n  }\r\n\r\n  private async loadProperty(): Promise<Property | null> {\r\n    this.element.classList.add('rs-detail--loading');\r\n\r\n    try {\r\n      let property: Property | null = null;\r\n      if (this.propertyId) {\r\n        property = await RealtySoft.loadProperty(parseInt(this.propertyId));\r\n      } else if (this.propertyRef) {\r\n        property = await RealtySoft.loadPropertyByRef(this.propertyRef);\r\n      }\r\n      return property;\r\n    } catch (error) {\r\n      console.error('[RealtySoft] Failed to load property:', error);\r\n      this.showError();\r\n      return null;\r\n    } finally {\r\n      this.element.classList.remove('rs-detail--loading');\r\n    }\r\n  }\r\n\r\n  private populateComponents(): void {\r\n    if (!this.property) return;\r\n\r\n    const p = this.property;\r\n\r\n    // Simple text components - comprehensive list of all detail fields\r\n    const textMappings: Record<string, string | number | null | undefined> = {\r\n      // Basic Info\r\n      'rs_detail_title': p.title,\r\n      'rs_detail_price': p.price_on_request ? this.label('detail_price_on_request') : RealtySoftLabels.formatPrice(p.price),\r\n      'rs_detail_ref': p.ref,\r\n      'rs_detail_unique_ref': p.unique_ref,\r\n      'rs_detail_location': p.location,\r\n      'rs_detail_address': p.address,\r\n      'rs_detail_postal_code': p.postal_code,\r\n      'rs_detail_type': p.type,\r\n      'rs_detail_status': p.status,\r\n      // Specs\r\n      'rs_detail_beds': p.beds && parseFloat(String(p.beds)) > 0 ? p.beds : '',\r\n      'rs_detail_baths': p.baths && parseFloat(String(p.baths)) > 0 ? p.baths : '',\r\n      'rs_detail_built': p.built_area && parseFloat(String(p.built_area)) > 0 ? `${p.built_area} mÂ²` : '',\r\n      'rs_detail_plot': p.plot_size && parseFloat(String(p.plot_size)) > 0 ? `${p.plot_size} mÂ²` : '',\r\n      'rs_detail_terrace': p.terrace_size && parseFloat(String(p.terrace_size)) > 0 ? `${p.terrace_size} mÂ²` : '',\r\n      'rs_detail_solarium': p.solarium_size && parseFloat(String(p.solarium_size)) > 0 ? `${p.solarium_size} mÂ²` : '',\r\n      'rs_detail_garden': p.garden_size && parseFloat(String(p.garden_size)) > 0 ? `${p.garden_size} mÂ²` : '',\r\n      'rs_detail_usable': p.usable_area && parseFloat(String(p.usable_area)) > 0 ? `${p.usable_area} mÂ²` : '',\r\n      'rs_detail_year': p.year_built,\r\n      'rs_detail_floor': p.floor,\r\n      'rs_detail_orientation': p.orientation,\r\n      'rs_detail_parking': p.parking,\r\n      'rs_detail_furnished': p.furnished,\r\n      'rs_detail_condition': p.condition,\r\n      'rs_detail_views': p.views,\r\n      // Taxes & Fees\r\n      'rs_detail_community_fees': p.community_fees && parseFloat(String(p.community_fees)) > 0 ? RealtySoftLabels.formatPrice(p.community_fees) + '/mo' : '',\r\n      'rs_detail_ibi_tax': p.ibi_tax && parseFloat(String(p.ibi_tax)) > 0 ? RealtySoftLabels.formatPrice(p.ibi_tax) + '/yr' : '',\r\n      'rs_detail_basura_tax': p.basura_tax && parseFloat(String(p.basura_tax)) > 0 ? RealtySoftLabels.formatPrice(p.basura_tax) + '/yr' : '',\r\n      // Energy\r\n      'rs_detail_energy_rating': p.energy_rating,\r\n      'rs_detail_co2_rating': p.co2_rating,\r\n      'rs_detail_energy_consumption': p.energy_consumption,\r\n      // Content\r\n      'rs_detail_description': this.formatDescription(p.description),\r\n      // Agent\r\n      'rs_detail_agent_name': p.agent?.name,\r\n      'rs_detail_agent_phone': p.agent?.phone,\r\n      'rs_detail_agent_email': p.agent?.email\r\n    };\r\n\r\n    for (const [className, value] of Object.entries(textMappings)) {\r\n      this.element.querySelectorAll<HTMLElement>(`.${className}`).forEach(el => {\r\n        if (value !== undefined && value !== null && value !== '') {\r\n          el.innerHTML = String(value);\r\n          el.style.display = '';\r\n        } else {\r\n          el.style.display = 'none';\r\n        }\r\n      });\r\n    }\r\n\r\n    // Agent card - hide entire card if no useful agent data\r\n    const hasAgentName = p.agent?.name && p.agent.name.trim() && p.agent.name.toLowerCase() !== 'undefined';\r\n    const hasAgentPhone = p.agent?.phone && p.agent.phone.trim();\r\n    const hasAgentEmail = p.agent?.email && p.agent.email.trim();\r\n    const hasAgentData = hasAgentName || hasAgentPhone || hasAgentEmail;\r\n\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_agent').forEach(el => {\r\n      el.style.display = hasAgentData ? '' : 'none';\r\n    });\r\n\r\n    // Agent phone link\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_agent_phone').forEach(el => {\r\n      if (hasAgentPhone && p.agent) {\r\n        el.textContent = p.agent.phone;\r\n        if (el.tagName === 'A') {\r\n          (el as HTMLAnchorElement).href = `tel:${p.agent.phone.replace(/\\s/g, '')}`;\r\n        }\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Agent email link\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_agent_email').forEach(el => {\r\n      if (hasAgentEmail && p.agent) {\r\n        el.textContent = p.agent.email;\r\n        if (el.tagName === 'A') {\r\n          (el as HTMLAnchorElement).href = `mailto:${p.agent.email}`;\r\n        }\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Agent photo\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_agent_photo').forEach(el => {\r\n      if (p.agent?.photo) {\r\n        el.innerHTML = `<img src=\"${p.agent.photo}\" alt=\"${this.escapeHtml(p.agent.name || '')}\">`;\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Instantiate child detail components\r\n    const componentMappings: [string, new (el: HTMLElement, opts: ComponentOptions) => RSBaseComponent][] = [\r\n      ['.rs_detail_back', RSDetailBackButton],\r\n      ['.rs_detail_gallery', RSDetailGallery],\r\n      ['.rs_detail_features', RSDetailFeatures],\r\n      ['.rs_detail_map', RSDetailMap],\r\n      ['.rs_detail_inquiry_form', RSDetailInquiryForm],\r\n      ['.rs_detail_wishlist', RSDetailWishlist],\r\n      ['.rs_detail_share', RSDetailShare],\r\n      ['.rs_detail_related', RSDetailRelated],\r\n      ['.rs_detail_info_table', RSDetailInfoTable],\r\n      ['.rs_detail_specs', RSDetailSpecs],\r\n      ['.rs_detail_sizes', RSDetailSizes],\r\n      ['.rs_detail_taxes', RSDetailTaxes],\r\n      ['.rs_detail_energy', RSDetailEnergy],\r\n      ['.rs_detail_resources', RSDetailResources],\r\n      ['.rs_detail_pdf', RSDetailPdfButton],\r\n      ['.rs_detail_video_embed', RSDetailVideoEmbed],\r\n    ];\r\n\r\n    for (const [selector, ComponentClass] of componentMappings) {\r\n      this.element.querySelectorAll<RSHTMLElement>(selector).forEach(el => {\r\n        if (!el._rsComponent) {\r\n          new ComponentClass(el, { property: p } as ComponentOptions);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Energy certificate image (standalone)\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_energy_image').forEach(el => {\r\n      if (p.energy_certificate_image) {\r\n        el.innerHTML = `<img src=\"${p.energy_certificate_image}\" alt=\"${this.label('detail_energy_certificate')}\">`;\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Video link (standalone)\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_video_link').forEach(el => {\r\n      if (p.video_url) {\r\n        if (el.tagName === 'A') {\r\n          (el as HTMLAnchorElement).href = p.video_url;\r\n          (el as HTMLAnchorElement).target = '_blank';\r\n        }\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Virtual tour link (standalone)\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_tour_link').forEach(el => {\r\n      if (p.virtual_tour_url) {\r\n        if (el.tagName === 'A') {\r\n          (el as HTMLAnchorElement).href = p.virtual_tour_url;\r\n          (el as HTMLAnchorElement).target = '_blank';\r\n        }\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // PDF link (standalone)\r\n    this.element.querySelectorAll<HTMLElement>('.rs_detail_pdf_link').forEach(el => {\r\n      if (p.pdf_url) {\r\n        if (el.tagName === 'A') {\r\n          (el as HTMLAnchorElement).href = p.pdf_url;\r\n          (el as HTMLAnchorElement).target = '_blank';\r\n        }\r\n        el.style.display = '';\r\n      } else {\r\n        el.style.display = 'none';\r\n      }\r\n    });\r\n\r\n    // Update page title\r\n    if (p.title) {\r\n      document.title = `${p.title} | ${document.title.split('|').pop()?.trim() || 'Property'}`;\r\n    }\r\n  }\r\n\r\n  private formatDescription(text: string): string {\r\n    if (!text) return '';\r\n\r\n    // Check if text already contains HTML tags\r\n    const hasHtml = /<[^>]+>/g.test(text);\r\n\r\n    if (hasHtml) {\r\n      return text;\r\n    }\r\n\r\n    // Convert plain text line breaks to HTML\r\n    const escaped = this.escapeHtml(text);\r\n    return escaped\r\n      .replace(/\\r\\n/g, '<br>')\r\n      .replace(/\\n/g, '<br>')\r\n      .replace(/\\r/g, '<br>');\r\n  }\r\n\r\n  private showError(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-detail__error\">\r\n        <p>${this.label('general_error')}</p>\r\n        <button class=\"rs-detail__retry\" onclick=\"location.reload()\">\r\n          ${this.label('general_retry')}\r\n        </button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_detail', RSDetail as unknown as ComponentConstructor);\r\n\r\nexport { RSDetail };\r\nexport default RSDetail;\r\n","/**\r\n * RealtySoft Widget v3 - Property Detail Template\r\n * Complete ready-made template for property detail page\r\n * Renders entire property detail from single container: <div id=\"property-detail-container\"></div>\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  Property,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftLabelsModule,\r\n  RealtySoftAPIModule\r\n} from '../../types/index';\r\nimport { RSDetailGallery } from './gallery';\r\nimport { RSDetailShare } from './share';\r\nimport { RSDetailWishlist } from './wishlist';\r\nimport { RSDetailMap } from './map';\r\nimport { RSDetailInquiryForm } from './inquiry-form';\r\nimport { RSDetailRelated } from './related';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\n\r\n// Extended HTMLElement with component reference\r\ninterface RSHTMLElement extends HTMLElement {\r\n  _rsComponent?: unknown;\r\n}\r\n\r\nclass RSPropertyDetailTemplate extends RSBaseComponent {\r\n  private property: Property | null = null;\r\n  private propertyId: string | null = null;\r\n  private propertyRef: string | null = null;\r\n  private hasInitiallyRendered: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.property = null;\r\n    this.propertyId = null;\r\n    this.propertyRef = null;\r\n\r\n    // Clear stale PHP prefetch if it doesn't match the current URL\r\n    this.clearStalePrefetch();\r\n\r\n    // Priority 1: Check URL patterns first (SEO-friendly URLs)\r\n    this.propertyId = this.getPropertyIdFromUrl();\r\n    this.propertyRef = this.getPropertyRefFromUrl();\r\n\r\n    // Priority 2: Fallback to data attributes (for embedded/widget usage)\r\n    if (!this.propertyId && !this.propertyRef) {\r\n      const dataId = this.element.dataset.propertyId;\r\n      const dataRef = this.element.dataset.propertyRef;\r\n\r\n      if (dataId) {\r\n        if (/^\\d+$/.test(dataId)) {\r\n          this.propertyId = dataId;\r\n        } else {\r\n          this.propertyRef = dataId;\r\n        }\r\n      }\r\n\r\n      if (dataRef) {\r\n        this.propertyRef = dataRef;\r\n      }\r\n    }\r\n\r\n    this.element.classList.add('rs-property-detail-template');\r\n\r\n    if (this.propertyId || this.propertyRef) {\r\n      // RACE CONDITION FIX: Always use direct API return, ignore cache and subscription\r\n      this.showSkeleton();\r\n      this.loadProperty().then(property => {\r\n        if (property) {\r\n          // Double-check the property ref matches what we asked for\r\n          if (this.propertyRef && property.ref?.toLowerCase() !== this.propertyRef.toLowerCase()) {\r\n            console.warn('[RealtySoft] Property ref mismatch - expected:', this.propertyRef, 'got:', property.ref);\r\n            return;\r\n          }\r\n          this.property = property;\r\n          this.render();\r\n        }\r\n      });\r\n    } else {\r\n      this.showError('No property ID or reference found');\r\n    }\r\n\r\n    // Subscribe for updates to the SAME property (after first load)\r\n    // This handles both background updates and language change reloads\r\n    this.subscribe<Property>('currentProperty', (property) => {\r\n      // Only update if we already have a property AND it's the same ID\r\n      if (!property || !this.property) return;\r\n      if (property.id !== this.property.id) return;\r\n\r\n      // Check if this is a language change reload (property data changed but same ID)\r\n      const contentChanged =\r\n        this.property.title !== property.title ||\r\n        this.property.description !== property.description;\r\n\r\n      this.property = property;\r\n\r\n      // Re-render if content changed (language switch) and we've already rendered\r\n      if (contentChanged && this.hasInitiallyRendered) {\r\n        console.log('[RSPropertyDetailTemplate] Property content changed (language switch), re-rendering...');\r\n        this.hasInitiallyRendered = false;\r\n        this.render();\r\n      }\r\n    });\r\n\r\n    // Listen for language changes to update labels\r\n    // Note: Property data will be reloaded by controller's setLanguage()\r\n    // The currentProperty subscription above will handle the re-render\r\n    this.subscribe('config.language', () => {\r\n      if (this.hasInitiallyRendered && this.property) {\r\n        // Update labels immediately while waiting for property reload\r\n        this.updateLabelsInPlace();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get cached property from localStorage\r\n   */\r\n  private getCachedProperty(): Property | null {\r\n    const idOrRef = this.propertyRef || this.propertyId;\r\n    if (!idOrRef) return null;\r\n    const isRef = !!this.propertyRef;\r\n    return RealtySoftAPI.getCachedProperty(idOrRef, isRef);\r\n  }\r\n\r\n  /**\r\n   * Validate that cached property matches what we're looking for\r\n   * Prevents showing wrong property from stale cache\r\n   */\r\n  private isCacheValid(cached: Property): boolean {\r\n    // If we have a ref from URL, cached property ref must match\r\n    if (this.propertyRef) {\r\n      const cachedRef = cached.ref || '';\r\n      return cachedRef.toLowerCase() === this.propertyRef.toLowerCase();\r\n    }\r\n    // If we have an ID, cached property ID must match\r\n    if (this.propertyId) {\r\n      return String(cached.id) === this.propertyId;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private getPropertyIdFromUrl(): string | null {\r\n    const patterns = [\r\n      /\\/property\\/(\\d+)/,\r\n      /[?&]id=(\\d+)/,\r\n      /[?&]property_id=(\\d+)/\r\n    ];\r\n    for (const pattern of patterns) {\r\n      const match = window.location.href.match(pattern);\r\n      if (match) return match[1];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private getPropertyRefFromUrl(): string | null {\r\n    const slug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n\r\n    // Query params\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const queryRef = urlParams.get('ref') || urlParams.get('reference');\r\n    if (queryRef) return queryRef.trim();\r\n\r\n    // Check URL is under property slug\r\n    const slugRegex = new RegExp(`/${slug}/(.+?)/?$`, 'i');\r\n    const slugMatch = window.location.pathname.match(slugRegex);\r\n    if (!slugMatch) return null;\r\n\r\n    const subpath = slugMatch[1];\r\n\r\n    // SEO URL: last hyphen-separated part\r\n    const parts = subpath.split('-');\r\n    if (parts.length > 1) {\r\n      const lastPart = parts[parts.length - 1];\r\n      if (/^[A-Z0-9]{3,}$/i.test(lastPart) && !/^\\d+$/.test(lastPart)) return lastPart;\r\n    }\r\n\r\n    // Direct ref\r\n    if (/^[A-Z0-9]{3,}$/i.test(subpath) && !/^\\d+$/.test(subpath)) return subpath;\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Clear stale PHP prefetch data that doesn't match current URL\r\n   * RACE CONDITION FIX: Be aggressive - if we can't verify match, clear it\r\n   */\r\n  private clearStalePrefetch(): void {\r\n    const prefetch = (window as any).__rsPrefetch;\r\n    if (!prefetch) return;\r\n\r\n    const urlRef = this.getPropertyRefFromUrl();\r\n    const prefetchRef = prefetch.ref;\r\n\r\n    // If we have a URL ref, check if prefetch matches\r\n    if (urlRef) {\r\n      if (!prefetchRef || urlRef.toLowerCase() !== prefetchRef.toLowerCase()) {\r\n        console.log('[RealtySoft] Clearing stale prefetch - URL ref:', urlRef, 'prefetch ref:', prefetchRef);\r\n        delete (window as any).__rsPrefetch;\r\n      }\r\n    } else {\r\n      // Can't determine URL ref - clear prefetch to be safe\r\n      console.log('[RealtySoft] Clearing prefetch - could not determine URL ref');\r\n      delete (window as any).__rsPrefetch;\r\n    }\r\n  }\r\n\r\n  private async loadProperty(backgroundRefresh: boolean = false): Promise<Property | null> {\r\n    try {\r\n      let property: Property | null = null;\r\n      if (this.propertyId) {\r\n        property = await RealtySoft.loadProperty(parseInt(this.propertyId));\r\n      } else if (this.propertyRef) {\r\n        property = await RealtySoft.loadPropertyByRef(this.propertyRef);\r\n      }\r\n      return property;\r\n    } catch (error) {\r\n      console.error('Failed to load property:', error);\r\n      // Only show error if we don't have cached data and not background refresh\r\n      if (!this.property && !backgroundRefresh) {\r\n        this.showError('Failed to load property details');\r\n      }\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show skeleton loader for instant perceived performance\r\n   */\r\n  private showSkeleton(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-detail-template__skeleton\">\r\n        <div class=\"rs-skeleton__gallery\">\r\n          <div class=\"rs-skeleton__image rs-skeleton__pulse\"></div>\r\n        </div>\r\n        <div class=\"rs-skeleton__header\">\r\n          <div class=\"rs-skeleton__title rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__price rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__location rs-skeleton__pulse\"></div>\r\n        </div>\r\n        <div class=\"rs-skeleton__specs\">\r\n          <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n          <div class=\"rs-skeleton__spec rs-skeleton__pulse\"></div>\r\n        </div>\r\n        <div class=\"rs-skeleton__content\">\r\n          <div class=\"rs-skeleton__main\">\r\n            <div class=\"rs-skeleton__section\">\r\n              <div class=\"rs-skeleton__section-title rs-skeleton__pulse\"></div>\r\n              <div class=\"rs-skeleton__text rs-skeleton__pulse\"></div>\r\n              <div class=\"rs-skeleton__text rs-skeleton__pulse\"></div>\r\n              <div class=\"rs-skeleton__text rs-skeleton__pulse\" style=\"width: 60%\"></div>\r\n            </div>\r\n          </div>\r\n          <div class=\"rs-skeleton__sidebar\">\r\n            <div class=\"rs-skeleton__card rs-skeleton__pulse\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <style>\r\n        .rs-property-detail-template__skeleton { padding: 20px; }\r\n        .rs-skeleton__pulse {\r\n          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\r\n          background-size: 200% 100%;\r\n          animation: rs-skeleton-pulse 1.5s infinite;\r\n          border-radius: 4px;\r\n        }\r\n        @keyframes rs-skeleton-pulse {\r\n          0% { background-position: 200% 0; }\r\n          100% { background-position: -200% 0; }\r\n        }\r\n        .rs-skeleton__gallery { height: 400px; margin-bottom: 20px; }\r\n        .rs-skeleton__image { height: 100%; }\r\n        .rs-skeleton__header { margin-bottom: 20px; }\r\n        .rs-skeleton__title { height: 32px; width: 70%; margin-bottom: 12px; }\r\n        .rs-skeleton__price { height: 28px; width: 30%; margin-bottom: 8px; }\r\n        .rs-skeleton__location { height: 20px; width: 50%; }\r\n        .rs-skeleton__specs { display: flex; gap: 20px; margin-bottom: 30px; }\r\n        .rs-skeleton__spec { height: 60px; width: 100px; }\r\n        .rs-skeleton__content { display: grid; grid-template-columns: 1fr 350px; gap: 30px; }\r\n        .rs-skeleton__section { margin-bottom: 20px; }\r\n        .rs-skeleton__section-title { height: 24px; width: 40%; margin-bottom: 15px; }\r\n        .rs-skeleton__text { height: 16px; margin-bottom: 10px; }\r\n        .rs-skeleton__card { height: 300px; }\r\n        @media (max-width: 768px) {\r\n          .rs-skeleton__content { grid-template-columns: 1fr; }\r\n          .rs-skeleton__gallery { height: 250px; }\r\n        }\r\n      </style>\r\n    `;\r\n  }\r\n\r\n  private showError(message: string): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-property-detail-template__error\">\r\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\r\n        </svg>\r\n        <p>${message}</p>\r\n        <button onclick=\"location.reload()\" class=\"rs-property-detail-template__retry-btn\">\r\n          Try Again\r\n        </button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render(): void {\r\n    // Guard: Don't render without property data\r\n    if (!this.property) return;\r\n\r\n    // If already rendered, just update labels (language change scenario)\r\n    if (this.hasInitiallyRendered) {\r\n      this.updateLabelsInPlace();\r\n      return;\r\n    }\r\n\r\n    // First-time render: build full HTML structure\r\n    this.hasInitiallyRendered = true;\r\n\r\n    const p = this.property;\r\n\r\n    // Update page title\r\n    if (p.title) {\r\n      document.title = `${p.title} | Property Details`;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <!-- Gallery Section with Wishlist Overlay -->\r\n      <div class=\"rs-template__gallery-wrapper\">\r\n        <div class=\"rs-template__gallery\" id=\"rs-template-gallery\"></div>\r\n        <div class=\"rs-template__gallery-wishlist\" id=\"rs-template-wishlist\"></div>\r\n      </div>\r\n\r\n      <!-- Header Section -->\r\n      <div class=\"rs-template__header\">\r\n        <div class=\"rs-template__header-main\">\r\n          <h1 class=\"rs-template__title\">${this.escapeHtml(p.title || '')}</h1>\r\n          <div class=\"rs-template__location\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n              <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n            </svg>\r\n            <span>${this.escapeHtml(p.location || p.address || '')}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"rs-template__header-actions\">\r\n          <div class=\"rs-template__price ${p.price_on_request ? 'rs-template__price--por' : ''}\">\r\n            ${p.price_on_request ? this.label('detail_price_on_request') : RealtySoftLabels.formatPrice(p.price)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Main Content -->\r\n      <div class=\"rs-template__content\">\r\n        <div class=\"rs-template__main\">\r\n          <!-- Property Information Grid -->\r\n          ${this.renderPropertyInfoGrid(p)}\r\n\r\n          ${p.description ? `\r\n            <div class=\"rs-template__section\">\r\n              <h2 class=\"rs-template__section-title rs-template__section-title--description\">${this.label('detail_description')}</h2>\r\n              <div class=\"rs-template__description rs-template__description--clamped\" id=\"rs-template-description\">${this.formatDescription(p.description)}</div>\r\n              <button class=\"rs-template__read-more\" id=\"rs-template-read-more\" style=\"display:none;\">\r\n                ${this.label('detail_read_more') || 'Read More'}\r\n              </button>\r\n            </div>\r\n          ` : ''}\r\n          ${this.renderResources(p)}\r\n          ${this.renderTaxes(p)}\r\n          ${this.renderEnergy(p)}\r\n        </div>\r\n\r\n        <div class=\"rs-template__sidebar\">\r\n          ${this.renderAgentCard(p)}\r\n          ${this.renderSidebarPdf(p)}\r\n          <div class=\"rs-template__inquiry-form\" id=\"rs-template-inquiry\"></div>\r\n          ${this.renderFeatures(p)}\r\n          <div class=\"rs-template__sidebar-share\" id=\"rs-template-share\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Map Section -->\r\n      <div class=\"rs-template__section rs-template__section--full rs-template__section--map\">\r\n        <div class=\"rs-template__map\" id=\"rs-template-map\" data-variation=\"1\"></div>\r\n      </div>\r\n\r\n      <!-- Related Properties -->\r\n      <div class=\"rs-template__section rs-template__section--full\">\r\n        <div class=\"rs-template__related\" id=\"rs-template-related\" data-limit=\"6\"></div>\r\n      </div>\r\n    `;\r\n\r\n    // Initialize child components\r\n    this.initChildComponents();\r\n  }\r\n\r\n  private renderKeySpecs(p: Property): string {\r\n    const specs: string[] = [];\r\n\r\n    if (p.beds && parseFloat(String(p.beds)) > 0) {\r\n      specs.push(`\r\n        <div class=\"rs-template__spec\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M2 4v16\"></path>\r\n            <path d=\"M2 8h18a2 2 0 0 1 2 2v10\"></path>\r\n            <path d=\"M2 17h20\"></path>\r\n            <path d=\"M6 8v9\"></path>\r\n          </svg>\r\n          <span class=\"rs-template__spec-value\">${p.beds}</span>\r\n          <span class=\"rs-template__spec-label\">${this.label('card_beds')}</span>\r\n        </div>\r\n      `);\r\n    }\r\n\r\n    if (p.baths && parseFloat(String(p.baths)) > 0) {\r\n      specs.push(`\r\n        <div class=\"rs-template__spec\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M4 12h16a1 1 0 0 1 1 1v3a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-3a1 1 0 0 1 1-1z\"></path>\r\n            <path d=\"M6 12V5a2 2 0 0 1 2-2h3v2.25\"></path>\r\n            <circle cx=\"12\" cy=\"5\" r=\"2\"></circle>\r\n          </svg>\r\n          <span class=\"rs-template__spec-value\">${p.baths}</span>\r\n          <span class=\"rs-template__spec-label\">${this.label('card_baths')}</span>\r\n        </div>\r\n      `);\r\n    }\r\n\r\n    if (p.built_area && parseFloat(String(p.built_area)) > 0) {\r\n      specs.push(`\r\n        <div class=\"rs-template__spec\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"></rect>\r\n            <path d=\"M3 9h18\"></path>\r\n            <path d=\"M9 21V9\"></path>\r\n          </svg>\r\n          <span class=\"rs-template__spec-value\">${p.built_area}m\\u00B2</span>\r\n          <span class=\"rs-template__spec-label\">${this.label('detail_built_area')}</span>\r\n        </div>\r\n      `);\r\n    }\r\n\r\n    if (p.plot_size && parseFloat(String(p.plot_size)) > 0) {\r\n      specs.push(`\r\n        <div class=\"rs-template__spec\">\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M3 6l9-4 9 4v12l-9 4-9-4V6z\"></path>\r\n            <path d=\"M12 2v20\"></path>\r\n          </svg>\r\n          <span class=\"rs-template__spec-value\">${p.plot_size}m\\u00B2</span>\r\n          <span class=\"rs-template__spec-label\">${this.label('detail_plot_size')}</span>\r\n        </div>\r\n      `);\r\n    }\r\n\r\n    return specs.join('');\r\n  }\r\n\r\n  /**\r\n   * Render combined property information grid (table-style cards)\r\n   * 4 columns on desktop, 2 on mobile\r\n   */\r\n  private renderPropertyInfoGrid(p: Property): string {\r\n    const items: { label: string; value: string }[] = [];\r\n\r\n    // Reference\r\n    if (p.ref) {\r\n      items.push({ label: this.label('detail_reference') || 'Reference', value: p.ref });\r\n    }\r\n\r\n    // Property Type\r\n    if (p.type) {\r\n      items.push({ label: this.label('detail_property_type') || 'Property Type', value: p.type });\r\n    }\r\n\r\n    // Bedrooms\r\n    if (p.beds && parseFloat(String(p.beds)) > 0) {\r\n      items.push({ label: this.label('card_beds') || 'Bedrooms', value: String(p.beds) });\r\n    }\r\n\r\n    // Bathrooms\r\n    if (p.baths && parseFloat(String(p.baths)) > 0) {\r\n      items.push({ label: this.label('card_baths') || 'Bathrooms', value: String(p.baths) });\r\n    }\r\n\r\n    // Plot Size\r\n    if (p.plot_size && parseFloat(String(p.plot_size)) > 0) {\r\n      items.push({ label: this.label('detail_plot_size') || 'Plot Size', value: `${p.plot_size} mÂ²` });\r\n    }\r\n\r\n    // Built Area\r\n    if (p.built_area && parseFloat(String(p.built_area)) > 0) {\r\n      items.push({ label: this.label('detail_built_area') || 'Built', value: `${p.built_area} mÂ²` });\r\n    }\r\n\r\n    // Terrace\r\n    if (p.terrace_size && parseFloat(String(p.terrace_size)) > 0) {\r\n      items.push({ label: this.label('detail_terrace') || 'Terrace', value: `${p.terrace_size} mÂ²` });\r\n    }\r\n\r\n    // Garden\r\n    if (p.garden_size && parseFloat(String(p.garden_size)) > 0) {\r\n      items.push({ label: this.label('detail_garden') || 'Garden', value: `${p.garden_size} mÂ²` });\r\n    }\r\n\r\n    // Solarium\r\n    if (p.solarium_size && parseFloat(String(p.solarium_size)) > 0) {\r\n      items.push({ label: this.label('detail_solarium') || 'Solarium', value: `${p.solarium_size} mÂ²` });\r\n    }\r\n\r\n    // Usable Area\r\n    if (p.usable_area && parseFloat(String(p.usable_area)) > 0) {\r\n      items.push({ label: this.label('detail_usable_area') || 'Usable Area', value: `${p.usable_area} mÂ²` });\r\n    }\r\n\r\n    // Year Built\r\n    if (p.year_built) {\r\n      items.push({ label: this.label('detail_year_built') || 'Year Built', value: String(p.year_built) });\r\n    }\r\n\r\n    // Status\r\n    if (p.status) {\r\n      items.push({ label: this.label('detail_status') || 'Status', value: p.status });\r\n    }\r\n\r\n    // Floor\r\n    if (p.floor) {\r\n      items.push({ label: this.label('detail_floor') || 'Floor', value: p.floor });\r\n    }\r\n\r\n    // Orientation\r\n    if (p.orientation) {\r\n      items.push({ label: this.label('detail_orientation') || 'Orientation', value: p.orientation });\r\n    }\r\n\r\n    // Condition\r\n    if (p.condition) {\r\n      items.push({ label: this.label('detail_condition') || 'Condition', value: p.condition });\r\n    }\r\n\r\n    // Furnished\r\n    if (p.furnished) {\r\n      items.push({ label: this.label('detail_furnished') || 'Furnished', value: p.furnished });\r\n    }\r\n\r\n    // Views\r\n    if (p.views) {\r\n      items.push({ label: this.label('detail_views') || 'Views', value: p.views });\r\n    }\r\n\r\n    // Parking\r\n    if (p.parking) {\r\n      items.push({ label: this.label('detail_parking') || 'Parking', value: p.parking });\r\n    }\r\n\r\n    if (items.length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--info-grid\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--info-grid\">${this.label('detail_property_info') || 'Property Information'}</h2>\r\n        <div class=\"rs-template__info-cards\">\r\n          ${items.map(item => `\r\n            <div class=\"rs-template__info-card\">\r\n              <div class=\"rs-template__info-card-label\">${this.escapeHtml(item.label)}</div>\r\n              <div class=\"rs-template__info-card-value\">${this.escapeHtml(item.value)}</div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderPropertyInfo(p: Property): string {\r\n    const rows: { label: string; value: string | number }[] = [];\r\n\r\n    if (p.type) rows.push({ label: this.label('detail_property_type'), value: p.type });\r\n    if (p.status) rows.push({ label: this.label('detail_status'), value: p.status });\r\n    if (p.year_built) rows.push({ label: this.label('detail_year_built'), value: p.year_built });\r\n    if (p.ref) rows.push({ label: this.label('detail_reference'), value: p.ref });\r\n    if (p.unique_ref) rows.push({ label: this.label('detail_unique_ref'), value: p.unique_ref });\r\n    if (p.postal_code) rows.push({ label: this.label('detail_postal_code'), value: p.postal_code });\r\n    if (p.floor) rows.push({ label: this.label('detail_floor'), value: p.floor });\r\n    if (p.orientation) rows.push({ label: this.label('detail_orientation'), value: p.orientation });\r\n    if (p.condition) rows.push({ label: this.label('detail_condition'), value: p.condition });\r\n    if (p.furnished) rows.push({ label: this.label('detail_furnished'), value: p.furnished });\r\n    if (p.views) rows.push({ label: this.label('detail_views'), value: p.views });\r\n    if (p.parking) rows.push({ label: this.label('detail_parking'), value: p.parking });\r\n\r\n    if (rows.length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--property-info\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--property-info\">${this.label('detail_property_info')}</h2>\r\n        <div class=\"rs-template__info-grid\">\r\n          ${rows.map(row => `\r\n            <div class=\"rs-template__info-row\">\r\n              <span class=\"rs-template__info-label\">${row.label}</span>\r\n              <span class=\"rs-template__info-value\">${this.escapeHtml(String(row.value))}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderAdditionalSizes(p: Property): string {\r\n    const sizes: { label: string; value: string }[] = [];\r\n\r\n    if (p.terrace_size && parseFloat(String(p.terrace_size)) > 0) {\r\n      sizes.push({ label: this.label('detail_terrace'), value: `${p.terrace_size}m\\u00B2` });\r\n    }\r\n    if (p.solarium_size && parseFloat(String(p.solarium_size)) > 0) {\r\n      sizes.push({ label: this.label('detail_solarium'), value: `${p.solarium_size}m\\u00B2` });\r\n    }\r\n    if (p.garden_size && parseFloat(String(p.garden_size)) > 0) {\r\n      sizes.push({ label: this.label('detail_garden'), value: `${p.garden_size}m\\u00B2` });\r\n    }\r\n    if (p.usable_area && parseFloat(String(p.usable_area)) > 0) {\r\n      sizes.push({ label: this.label('detail_usable_area'), value: `${p.usable_area}m\\u00B2` });\r\n    }\r\n\r\n    if (sizes.length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--sizes\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--sizes\">${this.label('detail_sizes')}</h2>\r\n        <div class=\"rs-template__info-grid\">\r\n          ${sizes.map(size => `\r\n            <div class=\"rs-template__info-row\">\r\n              <span class=\"rs-template__info-label\">${size.label}</span>\r\n              <span class=\"rs-template__info-value\">${size.value}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderResources(p: Property): string {\r\n    const sections: string[] = [];\r\n\r\n    // Embed video directly if YouTube or Vimeo\r\n    if (p.video_url) {\r\n      const embedUrl = this.getVideoEmbedUrl(p.video_url);\r\n      if (embedUrl) {\r\n        sections.push(`\r\n          <div class=\"rs-template__section rs-template__section--video\">\r\n            <h2 class=\"rs-template__section-title rs-template__section-title--video\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polygon points=\"5 3 19 12 5 21 5 3\"></polygon>\r\n              </svg>\r\n              ${this.label('detail_video_tour') || 'Video Tour'}\r\n            </h2>\r\n            <div class=\"rs-template__video-container\">\r\n              <iframe\r\n                src=\"${embedUrl}\"\r\n                frameborder=\"0\"\r\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n                allowfullscreen\r\n                loading=\"lazy\"\r\n                class=\"rs-template__video-iframe\"\r\n              ></iframe>\r\n            </div>\r\n          </div>\r\n        `);\r\n      } else {\r\n        // Fallback to link for unsupported video URLs\r\n        sections.push(`\r\n          <a href=\"${p.video_url}\" target=\"_blank\" rel=\"noopener\" class=\"rs-template__resource rs-template__resource--video\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polygon points=\"5 3 19 12 5 21 5 3\"></polygon>\r\n            </svg>\r\n            <span class=\"rs-template__resource-text\">${this.label('detail_video_tour')}</span>\r\n          </a>\r\n        `);\r\n      }\r\n    }\r\n\r\n    // Embed virtual tour directly as iframe\r\n    if (p.virtual_tour_url) {\r\n      sections.push(`\r\n        <div class=\"rs-template__section rs-template__section--virtual-tour\">\r\n          <h2 class=\"rs-template__section-title rs-template__section-title--virtual-tour\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n              <path d=\"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20\"></path>\r\n              <path d=\"M2 12h20\"></path>\r\n            </svg>\r\n            ${this.label('detail_virtual_tour') || 'Virtual Tour'}\r\n          </h2>\r\n          <div class=\"rs-template__virtual-tour-container\">\r\n            <iframe\r\n              src=\"${p.virtual_tour_url}\"\r\n              frameborder=\"0\"\r\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking\"\r\n              allowfullscreen\r\n              loading=\"lazy\"\r\n              class=\"rs-template__virtual-tour-iframe\"\r\n            ></iframe>\r\n          </div>\r\n        </div>\r\n      `);\r\n    }\r\n\r\n    if (sections.length === 0) return '';\r\n\r\n    return sections.join('');\r\n  }\r\n\r\n  /**\r\n   * Convert YouTube/Vimeo URL to embed URL\r\n   */\r\n  private getVideoEmbedUrl(url: string): string {\r\n    // YouTube - various URL formats\r\n    const ytMatch = url.match(/(?:youtube\\.com\\/(?:watch\\?v=|embed\\/|v\\/)|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/);\r\n    if (ytMatch) {\r\n      return `https://www.youtube.com/embed/${ytMatch[1]}?rel=0&modestbranding=1`;\r\n    }\r\n\r\n    // Vimeo\r\n    const vimeoMatch = url.match(/vimeo\\.com\\/(\\d+)/);\r\n    if (vimeoMatch) {\r\n      return `https://player.vimeo.com/video/${vimeoMatch[1]}`;\r\n    }\r\n\r\n    // Already an embed URL\r\n    if (url.includes('youtube.com/embed') || url.includes('player.vimeo.com')) {\r\n      return url;\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  private renderTaxes(p: Property): string {\r\n    const taxes: { label: string; value: string }[] = [];\r\n\r\n    if (p.community_fees && parseFloat(String(p.community_fees)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_community_fees'),\r\n        value: RealtySoftLabels.formatPrice(p.community_fees) + this.label('detail_per_month')\r\n      });\r\n    }\r\n    if (p.ibi_tax && parseFloat(String(p.ibi_tax)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_ibi_tax'),\r\n        value: RealtySoftLabels.formatPrice(p.ibi_tax) + this.label('detail_per_year')\r\n      });\r\n    }\r\n    if (p.basura_tax && parseFloat(String(p.basura_tax)) > 0) {\r\n      taxes.push({\r\n        label: this.label('detail_basura_tax'),\r\n        value: RealtySoftLabels.formatPrice(p.basura_tax) + this.label('detail_per_year')\r\n      });\r\n    }\r\n\r\n    if (taxes.length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--taxes\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--taxes\">${this.label('detail_taxes_fees')}</h2>\r\n        <div class=\"rs-template__taxes\">\r\n          ${taxes.map(tax => `\r\n            <div class=\"rs-template__tax-item\">\r\n              <span class=\"rs-template__tax-label\">${tax.label}</span>\r\n              <span class=\"rs-template__tax-value\">${tax.value}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderEnergy(p: Property): string {\r\n    const isEnergyRatingUrl = p.energy_rating && (\r\n      p.energy_rating.includes('http') ||\r\n      /\\.(png|jpg|jpeg|gif|webp|svg)$/i.test(p.energy_rating)\r\n    );\r\n    const isCo2RatingUrl = p.co2_rating && (\r\n      p.co2_rating.includes('http') ||\r\n      /\\.(png|jpg|jpeg|gif|webp|svg)$/i.test(p.co2_rating)\r\n    );\r\n\r\n    const energyRating = !isEnergyRatingUrl ? p.energy_rating : null;\r\n    const co2Rating = !isCo2RatingUrl ? p.co2_rating : null;\r\n\r\n    const energyImages: string[] = [];\r\n    if (isEnergyRatingUrl) energyImages.push(p.energy_rating);\r\n    if (isCo2RatingUrl) energyImages.push(p.co2_rating);\r\n    if (p.energy_certificate_image) energyImages.push(p.energy_certificate_image);\r\n\r\n    if (!energyRating && !co2Rating && energyImages.length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--energy\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--energy\">${this.label('detail_energy_certificate')}</h2>\r\n        <div class=\"rs-template__energy\">\r\n          ${energyRating ? `\r\n            <div class=\"rs-template__energy-rating\">\r\n              <span class=\"rs-template__energy-label rs-template__energy-label--rating\">${this.label('detail_energy_rating')}</span>\r\n              <span class=\"rs-template__energy-badge rs-template__energy-badge--${(energyRating || 'na').toLowerCase()}\">${energyRating || 'N/A'}</span>\r\n            </div>\r\n          ` : ''}\r\n          ${co2Rating ? `\r\n            <div class=\"rs-template__energy-rating\">\r\n              <span class=\"rs-template__energy-label rs-template__energy-label--co2\">${this.label('detail_co2_rating')}</span>\r\n              <span class=\"rs-template__energy-badge rs-template__energy-badge--${(co2Rating || 'na').toLowerCase()}\">${co2Rating || 'N/A'}</span>\r\n            </div>\r\n          ` : ''}\r\n          ${energyImages.map(imgUrl => `\r\n            <div class=\"rs-template__energy-image\">\r\n              <img src=\"${imgUrl}\" alt=\"${this.label('detail_energy_certificate')}\" loading=\"lazy\">\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderSidebarPdf(p: Property): string {\r\n    const orig = (p._original || {}) as Record<string, unknown>;\r\n    const pdfUrl = p.pdf_url || (orig.pdf_url as string) || (orig.pdf as string) ||\r\n                   (orig.brochure_url as string) || (orig.brochure as string) ||\r\n                   (orig.pdf_link as string) || (orig.document_url as string) ||\r\n                   (orig.flyer_url as string) || (orig.flyer as string) || null;\r\n\r\n    if (!pdfUrl) return '';\r\n\r\n    return `\r\n      <a href=\"${pdfUrl}\" target=\"_blank\" rel=\"noopener\" class=\"rs-template__sidebar-pdf\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n          <path d=\"M14 2v6h6\"></path>\r\n          <path d=\"M12 18v-6\"></path>\r\n          <path d=\"M9 15l3 3 3-3\"></path>\r\n        </svg>\r\n        <span class=\"rs-template__sidebar-pdf-text\">${this.label('detail_download_pdf') || 'Download PDF'}</span>\r\n      </a>\r\n    `;\r\n  }\r\n\r\n  private renderAgentCard(p: Property): string {\r\n    const agent = p.agent;\r\n    if (!agent || (!agent.name && !agent.phone && !agent.email)) return '';\r\n\r\n    return `\r\n      <div class=\"rs-template__agent-card\">\r\n        ${agent.photo ? `\r\n          <div class=\"rs-template__agent-photo\">\r\n            <img src=\"${agent.photo}\" alt=\"${this.escapeHtml(agent.name || '')}\">\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"rs-template__agent-info\">\r\n          ${agent.name ? `<div class=\"rs-template__agent-name\">${this.escapeHtml(agent.name)}</div>` : ''}\r\n          ${agent.phone ? `\r\n            <a href=\"tel:${agent.phone.replace(/\\s/g, '')}\" class=\"rs-template__agent-contact\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"></path>\r\n              </svg>\r\n              ${agent.phone}\r\n            </a>\r\n          ` : ''}\r\n          ${agent.email ? `\r\n            <a href=\"mailto:${agent.email}\" class=\"rs-template__agent-contact\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n                <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n              </svg>\r\n              ${agent.email}\r\n            </a>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private initChildComponents(): void {\r\n    const p = this.property;\r\n    if (!p) return;\r\n\r\n    const componentMappings: [string, new (el: HTMLElement, opts: ComponentOptions) => RSBaseComponent][] = [\r\n      ['#rs-template-gallery', RSDetailGallery],\r\n      ['#rs-template-share', RSDetailShare],\r\n      ['#rs-template-wishlist', RSDetailWishlist],\r\n      ['#rs-template-map', RSDetailMap],\r\n      ['#rs-template-inquiry', RSDetailInquiryForm],\r\n      ['#rs-template-related', RSDetailRelated],\r\n    ];\r\n\r\n    for (const [selector, ComponentClass] of componentMappings) {\r\n      const el = this.element.querySelector<RSHTMLElement>(selector);\r\n      if (el && !el._rsComponent) {\r\n        new ComponentClass(el, { property: p } as ComponentOptions);\r\n      }\r\n    }\r\n\r\n    // Description read-more toggle\r\n    this.initReadMore();\r\n\r\n    // Features accordion toggle\r\n    this.initFeaturesAccordion();\r\n  }\r\n\r\n  private initReadMore(): void {\r\n    const descEl = this.element.querySelector<HTMLElement>('#rs-template-description');\r\n    const btn = this.element.querySelector<HTMLButtonElement>('#rs-template-read-more');\r\n    if (!descEl || !btn) return;\r\n\r\n    // Wait for render to measure height\r\n    requestAnimationFrame(() => {\r\n      // Check if content overflows the 8-line clamp\r\n      const isOverflowing = descEl.scrollHeight > descEl.clientHeight;\r\n      if (isOverflowing) {\r\n        btn.style.display = '';\r\n        let expanded = false;\r\n        btn.addEventListener('click', () => {\r\n          expanded = !expanded;\r\n          descEl.classList.toggle('rs-template__description--clamped', !expanded);\r\n          btn.textContent = expanded\r\n            ? (this.label('detail_read_less') || 'Read Less')\r\n            : (this.label('detail_read_more') || 'Read More');\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update only label text nodes on language change (preserves DOM structure and child components)\r\n   */\r\n  private updateLabelsInPlace(): void {\r\n    if (!this.property) return;\r\n    const p = this.property;\r\n\r\n    // Update price (special case for POA)\r\n    const priceEl = this.element.querySelector('.rs-template__price');\r\n    if (priceEl) {\r\n      priceEl.textContent = p.price_on_request\r\n        ? this.label('detail_price_on_request')\r\n        : RealtySoftLabels.formatPrice(p.price);\r\n    }\r\n\r\n    // Update spec labels\r\n    const specLabels = this.element.querySelectorAll('.rs-template__spec-label');\r\n    const labelKeys = ['card_beds', 'card_baths', 'detail_built_area', 'detail_plot_size'];\r\n    specLabels.forEach((el, index) => {\r\n      if (labelKeys[index]) {\r\n        el.textContent = this.label(labelKeys[index]);\r\n      }\r\n    });\r\n\r\n    // Update all section titles\r\n    const sectionTitles: Record<string, string> = {\r\n      'description': 'detail_description',\r\n      'info-grid': 'detail_property_info',\r\n      'features': 'detail_features',\r\n      'taxes': 'detail_taxes_fees',\r\n      'energy': 'detail_energy_certificate'\r\n    };\r\n\r\n    for (const [section, labelKey] of Object.entries(sectionTitles)) {\r\n      const el = this.element.querySelector(`.rs-template__section-title--${section}`);\r\n      if (el) el.textContent = this.label(labelKey) || el.textContent;\r\n    }\r\n\r\n    // Update read more button\r\n    const readMoreBtn = this.element.querySelector('.rs-template__read-more') as HTMLButtonElement | null;\r\n    if (readMoreBtn) {\r\n      const descEl = this.element.querySelector('#rs-template-description');\r\n      const isClamped = descEl?.classList.contains('rs-template__description--clamped');\r\n      readMoreBtn.textContent = isClamped\r\n        ? (this.label('detail_read_more') || 'Read More')\r\n        : (this.label('detail_read_less') || 'Read Less');\r\n    }\r\n\r\n    // Update property info grid section (re-render content since labels are dynamic)\r\n    const infoGridSection = this.element.querySelector('.rs-template__section--info-grid');\r\n    if (infoGridSection) {\r\n      const newContent = this.renderPropertyInfoGrid(p);\r\n      if (newContent) {\r\n        const temp = document.createElement('div');\r\n        temp.innerHTML = newContent;\r\n        const newSection = temp.firstElementChild;\r\n        if (newSection) {\r\n          infoGridSection.innerHTML = newSection.innerHTML;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update taxes section (re-render content since labels are dynamic)\r\n    const taxesSection = this.element.querySelector('.rs-template__section--taxes');\r\n    if (taxesSection) {\r\n      const newContent = this.renderTaxes(p);\r\n      if (newContent) {\r\n        const temp = document.createElement('div');\r\n        temp.innerHTML = newContent;\r\n        const newSection = temp.firstElementChild;\r\n        if (newSection) {\r\n          taxesSection.innerHTML = newSection.innerHTML;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update energy labels\r\n    const energyRatingLabel = this.element.querySelector('.rs-template__energy-label--rating');\r\n    if (energyRatingLabel) {\r\n      energyRatingLabel.textContent = this.label('detail_energy_rating');\r\n    }\r\n    const co2RatingLabel = this.element.querySelector('.rs-template__energy-label--co2');\r\n    if (co2RatingLabel) {\r\n      co2RatingLabel.textContent = this.label('detail_co2_rating');\r\n    }\r\n\r\n    // Update resource links\r\n    const videoResource = this.element.querySelector('.rs-template__resource--video .rs-template__resource-text');\r\n    if (videoResource) {\r\n      videoResource.textContent = this.label('detail_video_tour');\r\n    }\r\n    const virtualResource = this.element.querySelector('.rs-template__resource--virtual .rs-template__resource-text');\r\n    if (virtualResource) {\r\n      virtualResource.textContent = this.label('detail_virtual_tour');\r\n    }\r\n\r\n    // Update PDF download link\r\n    const pdfText = this.element.querySelector('.rs-template__sidebar-pdf-text');\r\n    if (pdfText) {\r\n      pdfText.textContent = this.label('detail_download_pdf') || 'Download PDF';\r\n    }\r\n\r\n    // Update video section title (embedded video)\r\n    const videoTitle = this.element.querySelector('.rs-template__section-title--video');\r\n    if (videoTitle) {\r\n      const svg = videoTitle.querySelector('svg');\r\n      if (svg) {\r\n        videoTitle.innerHTML = '';\r\n        videoTitle.appendChild(svg);\r\n        videoTitle.appendChild(document.createTextNode(' ' + (this.label('detail_video_tour') || 'Video Tour')));\r\n      }\r\n    }\r\n\r\n    // Update virtual tour section title (embedded)\r\n    const virtualTourTitle = this.element.querySelector('.rs-template__section-title--virtual-tour');\r\n    if (virtualTourTitle) {\r\n      const svg = virtualTourTitle.querySelector('svg');\r\n      if (svg) {\r\n        virtualTourTitle.innerHTML = '';\r\n        virtualTourTitle.appendChild(svg);\r\n        virtualTourTitle.appendChild(document.createTextNode(' ' + (this.label('detail_virtual_tour') || 'Virtual Tour')));\r\n      }\r\n    }\r\n\r\n    // Update features button label (popup mode)\r\n    const featuresBtnLabel = this.element.querySelector('.rs-template__features-btn-label');\r\n    if (featuresBtnLabel) {\r\n      featuresBtnLabel.textContent = this.label('detail_features') || 'Features';\r\n    }\r\n\r\n    // Update features modal title (popup mode)\r\n    const featuresModalTitle = this.element.querySelector('.rs-template__features-modal-title');\r\n    if (featuresModalTitle) {\r\n      const svg = featuresModalTitle.querySelector('svg');\r\n      const count = featuresModalTitle.querySelector('.rs-template__features-modal-count');\r\n      if (svg && count) {\r\n        featuresModalTitle.innerHTML = '';\r\n        featuresModalTitle.appendChild(svg);\r\n        featuresModalTitle.appendChild(document.createTextNode(' ' + (this.label('detail_features') || 'Features') + ' '));\r\n        featuresModalTitle.appendChild(count);\r\n      }\r\n    }\r\n\r\n    // Note: Child components (gallery, map, inquiry form, etc.) handle their own\r\n    // label updates via the controller's render() call which triggers their render() methods\r\n  }\r\n\r\n  private renderFeatures(p: Property): string {\r\n    const features = p.features;\r\n    if (!features || features.length === 0) return '';\r\n\r\n    // Check for mode preference: 'button' (popup) or 'accordion' (inline)\r\n    // Default to 'button' (popup) for more compact display\r\n    const modeAttr = this.element.dataset.featuresMode;\r\n    const mode = modeAttr === 'accordion' ? 'accordion' : 'button';\r\n\r\n    // Group features by category\r\n    const grouped: Record<string, string[]> = {};\r\n    features.forEach((feature: { name: string; category?: string } | string) => {\r\n      const name = typeof feature === 'string' ? feature : feature.name;\r\n      const category = (typeof feature === 'object' && feature.category) ? feature.category : 'Features';\r\n      if (!grouped[category]) grouped[category] = [];\r\n      grouped[category].push(name);\r\n    });\r\n\r\n    const categories = Object.entries(grouped);\r\n    const totalFeatures = features.length;\r\n\r\n    if (mode === 'button') {\r\n      // Compact button that opens a popup modal\r\n      return `\r\n        <div class=\"rs-template__section rs-template__section--features rs-template__section--features-button\">\r\n          <button type=\"button\" class=\"rs-template__features-btn\" id=\"rs-template-features-btn\">\r\n            <span class=\"rs-template__features-btn-icon\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"9 11 12 14 22 4\"></polyline>\r\n                <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\r\n              </svg>\r\n            </span>\r\n            <span class=\"rs-template__features-btn-label\">${this.label('detail_features') || 'Features'}</span>\r\n            <span class=\"rs-template__features-btn-count\">${totalFeatures}</span>\r\n          </button>\r\n\r\n          <div class=\"rs-template__features-modal\" id=\"rs-template-features-modal\" style=\"display: none;\">\r\n            <div class=\"rs-template__features-modal-backdrop\"></div>\r\n            <div class=\"rs-template__features-modal-content\">\r\n              <div class=\"rs-template__features-modal-header\">\r\n                <h3 class=\"rs-template__features-modal-title\">\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <polyline points=\"9 11 12 14 22 4\"></polyline>\r\n                    <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\r\n                  </svg>\r\n                  ${this.label('detail_features') || 'Features'}\r\n                  <span class=\"rs-template__features-modal-count\">(${totalFeatures})</span>\r\n                </h3>\r\n                <button type=\"button\" class=\"rs-template__features-modal-close\">&times;</button>\r\n              </div>\r\n              <div class=\"rs-template__features-modal-body\">\r\n                ${this.renderFeaturesGrid(grouped, categories)}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Accordion mode (original behavior)\r\n    return `\r\n      <div class=\"rs-template__section rs-template__section--features rs-template__section--features-accordion\">\r\n        <h2 class=\"rs-template__section-title rs-template__section-title--features\">${this.label('detail_features') || 'Features & Amenities'}</h2>\r\n        <div class=\"rs-template__accordion\">\r\n          ${categories.map(([category, items], idx) => `\r\n            <div class=\"rs-template__accordion-item${idx === 0 ? ' rs-template__accordion-item--open' : ''}\">\r\n              <button class=\"rs-template__accordion-header\" type=\"button\">\r\n                <span class=\"rs-template__accordion-label\">${this.escapeHtml(category)}</span>\r\n                <span class=\"rs-template__accordion-count\">${items.length}</span>\r\n                <svg class=\"rs-template__accordion-chevron\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                  <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n                </svg>\r\n              </button>\r\n              <div class=\"rs-template__accordion-body\">\r\n                <ul class=\"rs-template__accordion-list\">\r\n                  ${items.map(name => `\r\n                    <li class=\"rs-template__accordion-feature\">\r\n                      <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                        <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n                      </svg>\r\n                      ${this.escapeHtml(name)}\r\n                    </li>\r\n                  `).join('')}\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Render features in a grid layout for popup modal\r\n   */\r\n  private renderFeaturesGrid(grouped: Record<string, string[]>, categories: [string, string[]][]): string {\r\n    // If only one category, show simple grid\r\n    if (categories.length <= 1) {\r\n      const allFeatures = categories.length === 1 ? categories[0][1] : [];\r\n      return `\r\n        <div class=\"rs-template__features-grid\">\r\n          ${allFeatures.map(name => `\r\n            <div class=\"rs-template__features-grid-item\">\r\n              <svg class=\"rs-template__features-check\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n              </svg>\r\n              <span>${this.escapeHtml(name)}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Multiple categories - show with category headers\r\n    return categories.map(([category, items]) => `\r\n      <div class=\"rs-template__features-category\">\r\n        <h4 class=\"rs-template__features-category-title\">${this.escapeHtml(category)}</h4>\r\n        <div class=\"rs-template__features-grid\">\r\n          ${items.map(name => `\r\n            <div class=\"rs-template__features-grid-item\">\r\n              <svg class=\"rs-template__features-check\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n              </svg>\r\n              <span>${this.escapeHtml(name)}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  private initFeaturesAccordion(): void {\r\n    // Accordion mode: toggle panels\r\n    const headers = this.element.querySelectorAll<HTMLButtonElement>('.rs-template__accordion-header');\r\n    headers.forEach(header => {\r\n      header.addEventListener('click', () => {\r\n        const item = header.closest('.rs-template__accordion-item');\r\n        if (item) {\r\n          item.classList.toggle('rs-template__accordion-item--open');\r\n        }\r\n      });\r\n    });\r\n\r\n    // Button/popup mode: modal open/close\r\n    const featuresBtn = this.element.querySelector<HTMLButtonElement>('#rs-template-features-btn');\r\n    const featuresModal = this.element.querySelector<HTMLElement>('#rs-template-features-modal');\r\n\r\n    if (featuresBtn && featuresModal) {\r\n      // Open modal\r\n      featuresBtn.addEventListener('click', () => {\r\n        featuresModal.style.display = 'flex';\r\n        document.body.style.overflow = 'hidden';\r\n      });\r\n\r\n      // Close modal - backdrop click\r\n      const backdrop = featuresModal.querySelector('.rs-template__features-modal-backdrop');\r\n      if (backdrop) {\r\n        backdrop.addEventListener('click', () => {\r\n          featuresModal.style.display = 'none';\r\n          document.body.style.overflow = '';\r\n        });\r\n      }\r\n\r\n      // Close modal - close button\r\n      const closeBtn = featuresModal.querySelector('.rs-template__features-modal-close');\r\n      if (closeBtn) {\r\n        closeBtn.addEventListener('click', () => {\r\n          featuresModal.style.display = 'none';\r\n          document.body.style.overflow = '';\r\n        });\r\n      }\r\n\r\n      // Close modal - ESC key\r\n      document.addEventListener('keydown', (e: KeyboardEvent) => {\r\n        if (e.key === 'Escape' && featuresModal.style.display !== 'none') {\r\n          featuresModal.style.display = 'none';\r\n          document.body.style.overflow = '';\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private formatDescription(text: string): string {\r\n    if (!text) return '';\r\n    const hasHtml = /<[^>]+>/g.test(text);\r\n    if (hasHtml) return text;\r\n    const escaped = this.escapeHtml(text);\r\n    return escaped.replace(/\\r\\n/g, '<br>').replace(/\\n/g, '<br>').replace(/\\r/g, '<br>');\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('property-detail-container', RSPropertyDetailTemplate as unknown as ComponentConstructor);\r\n\r\nexport { RSPropertyDetailTemplate };\r\nexport default RSPropertyDetailTemplate;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Button Component\r\n * Generic wishlist toggle button (requires property ID)\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAnalyticsModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\nclass RSWishlistButton extends RSBaseComponent {\r\n  private propertyId: number = 0;\r\n  private isInWishlist: boolean = false;\r\n  private btn: HTMLButtonElement | null = null;\r\n  private icon: SVGElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.propertyId = parseInt(this.element.dataset.propertyId || '0');\r\n\r\n    if (!this.propertyId) {\r\n      console.warn('Wishlist button requires data-property-id');\r\n      return;\r\n    }\r\n\r\n    this.isInWishlist = RealtySoftState.isInWishlist(this.propertyId);\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    this.subscribe('wishlist', () => {\r\n      this.isInWishlist = RealtySoftState.isInWishlist(this.propertyId);\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-button');\r\n\r\n    this.element.innerHTML = `\r\n      <button type=\"button\"\r\n              class=\"rs-wishlist-button__btn ${this.isInWishlist ? 'rs-wishlist-button__btn--active' : ''}\"\r\n              aria-label=\"${this.isInWishlist ? this.label('wishlist_remove') : this.label('wishlist_add')}\">\r\n        <svg class=\"rs-wishlist-button__icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\"\r\n             fill=\"${this.isInWishlist ? 'currentColor' : 'none'}\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n        </svg>\r\n      </button>\r\n    `;\r\n\r\n    this.btn = this.element.querySelector('.rs-wishlist-button__btn');\r\n    this.icon = this.element.querySelector('.rs-wishlist-button__icon');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.btn?.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.toggleWishlist();\r\n    });\r\n  }\r\n\r\n  private toggleWishlist(): void {\r\n    if (this.isInWishlist) {\r\n      RealtySoftState.removeFromWishlist(this.propertyId);\r\n      RealtySoftAnalytics.trackWishlistRemove(this.propertyId);\r\n    } else {\r\n      RealtySoftState.addToWishlist(this.propertyId);\r\n      RealtySoftAnalytics.trackWishlistAdd(this.propertyId);\r\n    }\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    this.btn?.classList.toggle('rs-wishlist-button__btn--active', this.isInWishlist);\r\n    this.btn?.setAttribute('aria-label', this.isInWishlist ? this.label('wishlist_remove') : this.label('wishlist_add'));\r\n    this.icon?.setAttribute('fill', this.isInWishlist ? 'currentColor' : 'none');\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_button', RSWishlistButton as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistButton };\r\nexport default RSWishlistButton;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Counter Component\r\n * Shows count of items in wishlist\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\n\r\nclass RSWishlistCounter extends RSBaseComponent {\r\n  private count: number = 0;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.count = (RealtySoftState.get<unknown[]>('wishlist') || []).length;\r\n\r\n    this.render();\r\n\r\n    this.subscribe<unknown[]>('wishlist', (wishlist) => {\r\n      this.count = wishlist.length;\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-counter');\r\n    this.updateDisplay();\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    this.element.innerHTML = `\r\n      <a href=\"${this.element.dataset.href || '/wishlist'}\" class=\"rs-wishlist-counter__link\">\r\n        <svg class=\"rs-wishlist-counter__icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"\r\n             fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n        </svg>\r\n        ${this.count > 0 ? `<span class=\"rs-wishlist-counter__badge\">${this.count}</span>` : ''}\r\n      </a>\r\n    `;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_counter', RSWishlistCounter as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistCounter };\r\nexport default RSWishlistCounter;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Header Component\r\n * Shows title and property count\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSWishlistHeader extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n  private subtitleEl: HTMLElement | null = null;\r\n  private windowEventsBound: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n      this.bindEvents();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-header');\r\n\r\n    const title = this.isSharedView\r\n      ? this.label('wishlist_shared_title') || 'Shared Wishlist'\r\n      : this.label('wishlist_title') || 'My Wishlist';\r\n\r\n    this.element.innerHTML = `\r\n      <h1 class=\"rs-wishlist-header__title\">${title}</h1>\r\n      <p class=\"rs-wishlist-header__subtitle\">${this.label('results_loading') || 'Loading...'}</p>\r\n    `;\r\n\r\n    this.subtitleEl = this.element.querySelector('.rs-wishlist-header__subtitle');\r\n    this.updateCount();\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Only bind window events once to prevent duplicates on language change\r\n    if (this.windowEventsBound) return;\r\n\r\n    // Listen for wishlist changes\r\n    window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n      this.updateCount();\r\n    });\r\n\r\n    this.windowEventsBound = true;\r\n  }\r\n\r\n  private updateCount(): void {\r\n    let count: number;\r\n\r\n    if (this.isSharedView) {\r\n      const sharedRefs = WishlistManager.loadSharedWishlist();\r\n      count = sharedRefs ? sharedRefs.length : 0;\r\n    } else {\r\n      count = WishlistManager.count();\r\n    }\r\n\r\n    if (!this.subtitleEl) return;\r\n\r\n    if (count === 0) {\r\n      this.subtitleEl.textContent = this.label('wishlist_no_properties') || 'No properties saved';\r\n    } else {\r\n      const propertyLabel = count === 1\r\n        ? this.label('property') || 'property'\r\n        : this.label('properties') || 'properties';\r\n      const savedLabel = this.label('saved') || 'saved';\r\n      this.subtitleEl.textContent = `${count} ${propertyLabel} ${savedLabel}`;\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_header', RSWishlistHeader as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistHeader };\r\nexport default RSWishlistHeader;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Empty Component\r\n * Shows empty state when wishlist is empty\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSWishlistEmpty extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n  private titleEl: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.render();\r\n    this.bindEvents();\r\n    this.updateVisibility();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n      this.updateVisibility();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-empty');\r\n\r\n    const emptyTitle = this.isSharedView\r\n      ? this.label('wishlist_shared_empty') || 'No properties in shared wishlist'\r\n      : this.label('wishlist_empty') || 'Your wishlist is empty';\r\n\r\n    const emptyDesc = this.isSharedView\r\n      ? this.label('wishlist_shared_empty_desc') || 'The shared link may be invalid or expired'\r\n      : this.label('wishlist_empty_desc') || 'Start adding properties by clicking the heart icon';\r\n\r\n    this.element.innerHTML = `\r\n      <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\">\r\n        <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path>\r\n      </svg>\r\n      <h2 class=\"rs-wishlist-empty__title\">${emptyTitle}</h2>\r\n      <p class=\"rs-wishlist-empty__desc\">${emptyDesc}</p>\r\n      ${!this.isSharedView ? `\r\n        <a href=\"/\" class=\"rs-wishlist-btn rs-wishlist-btn--primary rs-wishlist-empty__browse\">\r\n          ${this.label('wishlist_browse') || 'Browse Properties'}\r\n        </a>\r\n      ` : ''}\r\n    `;\r\n\r\n    this.titleEl = this.element.querySelector('.rs-wishlist-empty__title');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Listen for wishlist changes\r\n    window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n      this.updateVisibility();\r\n    });\r\n  }\r\n\r\n  private updateVisibility(): void {\r\n    let isEmpty: boolean;\r\n\r\n    if (this.isSharedView) {\r\n      const sharedRefs = WishlistManager.loadSharedWishlist();\r\n      isEmpty = !sharedRefs || sharedRefs.length === 0;\r\n    } else {\r\n      isEmpty = WishlistManager.count() === 0;\r\n    }\r\n\r\n    this.element.style.display = isEmpty ? 'flex' : 'none';\r\n  }\r\n\r\n  setMessage(message: string): void {\r\n    if (this.titleEl && message) {\r\n      this.titleEl.textContent = message;\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_empty', RSWishlistEmpty as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistEmpty };\r\nexport default RSWishlistEmpty;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Shared Banner Component\r\n * Shows banner when viewing shared wishlist\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSWishlistSharedBanner extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.render();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-shared-banner');\r\n\r\n    // Hide if not shared view\r\n    if (!this.isSharedView) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <span class=\"rs-wishlist-shared-icon\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\r\n          <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\r\n        </svg>\r\n      </span>\r\n      <div class=\"rs-wishlist-shared-banner__content\">\r\n        <strong>${this.label('wishlist_shared_title') || 'Viewing Shared Wishlist'}</strong>\r\n        <p>${this.label('wishlist_shared_desc') || 'This is a read-only view of saved properties'}</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // No events needed for this static component\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_shared_banner', RSWishlistSharedBanner as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistSharedBanner };\r\nexport default RSWishlistSharedBanner;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Sort Component\r\n * Sort dropdown for wishlist\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\nclass RSWishlistSort extends RSBaseComponent {\r\n  private currentSort: string = 'addedAt-desc';\r\n  private selectEl: HTMLSelectElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.currentSort = 'addedAt-desc';\r\n    this.render();\r\n    this.bindEvents();\r\n    this.updateVisibility();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      const currentValue = this.currentSort;\r\n      this.render();\r\n      this.bindEvents();\r\n      this.setValue(currentValue);\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-sort-wrapper');\r\n\r\n    this.element.innerHTML = `\r\n      <label class=\"rs-wishlist-sort-label\" for=\"rs-wishlist-sort\">\r\n        ${this.label('sort_by') || 'Sort by:'}\r\n      </label>\r\n      <select class=\"rs-wishlist-sort\" id=\"rs-wishlist-sort\">\r\n        <option value=\"addedAt-desc\">${this.label('sort_recent') || 'Recently Added'}</option>\r\n        <option value=\"addedAt-asc\">${this.label('sort_oldest') || 'Oldest First'}</option>\r\n        <option value=\"price-desc\">${this.label('sort_price_desc') || 'Price: High to Low'}</option>\r\n        <option value=\"price-asc\">${this.label('sort_price_asc') || 'Price: Low to High'}</option>\r\n        <option value=\"title-asc\">${this.label('sort_name') || 'Name: A-Z'}</option>\r\n        <option value=\"location-asc\">${this.label('sort_location') || 'Location: A-Z'}</option>\r\n      </select>\r\n    `;\r\n\r\n    this.selectEl = this.element.querySelector('.rs-wishlist-sort');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.selectEl?.addEventListener('change', (e: Event) => {\r\n      const target = e.target as HTMLSelectElement;\r\n      this.currentSort = target.value;\r\n      const [field, order] = this.currentSort.split('-');\r\n\r\n      // Map sort fields\r\n      const sortMap: Record<string, string> = { price: 'list_price', title: 'name' };\r\n      const actualField = sortMap[field] || field;\r\n\r\n      // Update WishlistManager and dispatch event\r\n      WishlistManager.setSort(actualField, order as 'asc' | 'desc');\r\n    });\r\n\r\n    // Listen for wishlist changes to update visibility\r\n    window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n      this.updateVisibility();\r\n    });\r\n  }\r\n\r\n  private updateVisibility(): void {\r\n    const count = WishlistManager.count();\r\n    this.element.style.display = count > 0 ? '' : 'none';\r\n  }\r\n\r\n  getValue(): string {\r\n    return this.currentSort;\r\n  }\r\n\r\n  setValue(value: string): void {\r\n    this.currentSort = value;\r\n    if (this.selectEl) {\r\n      this.selectEl.value = value;\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_sort', RSWishlistSort as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistSort };\r\nexport default RSWishlistSort;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Actions Component\r\n * Back, Clear, PDF, Share, Email buttons\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\nimport type { RealtySoftToastModule } from '../../core/toast';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftToast: RealtySoftToastModule | undefined;\r\n\r\nclass RSWishlistActions extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n  private windowEventsBound: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.render();\r\n    this.bindEvents();\r\n    this.updateVisibility();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n      this.bindEvents();\r\n      this.updateVisibility();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-actions');\r\n\r\n    // Hide in shared view mode\r\n    if (this.isSharedView) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-wishlist-actions__left\">\r\n        <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--secondary rs-wishlist-back\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line>\r\n            <polyline points=\"12 19 5 12 12 5\"></polyline>\r\n          </svg>\r\n          ${this.label('detail_back') || 'Back'}\r\n        </button>\r\n        <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--danger rs-wishlist-clear\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"3 6 5 6 21 6\"></polyline>\r\n            <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path>\r\n          </svg>\r\n          ${this.label('wishlist_clear') || 'Clear All'}\r\n        </button>\r\n      </div>\r\n      <div class=\"rs-wishlist-actions__right\">\r\n        <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--warning rs-wishlist-pdf\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n            <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n            <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\r\n            <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\r\n          </svg>\r\n          ${this.label('wishlist_pdf') || 'Download PDF'}\r\n        </button>\r\n        <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--primary rs-wishlist-share\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"18\" cy=\"5\" r=\"3\"></circle>\r\n            <circle cx=\"6\" cy=\"12\" r=\"3\"></circle>\r\n            <circle cx=\"18\" cy=\"19\" r=\"3\"></circle>\r\n            <line x1=\"8.59\" y1=\"13.51\" x2=\"15.42\" y2=\"17.49\"></line>\r\n            <line x1=\"15.41\" y1=\"6.51\" x2=\"8.59\" y2=\"10.49\"></line>\r\n          </svg>\r\n          ${this.label('wishlist_share') || 'Share'}\r\n        </button>\r\n        <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--success rs-wishlist-email\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n            <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n          </svg>\r\n          ${this.label('wishlist_email') || 'Email'}\r\n        </button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.isSharedView) return;\r\n\r\n    // Back button (re-bind after render since DOM is replaced)\r\n    this.element.querySelector('.rs-wishlist-back')?.addEventListener('click', () => {\r\n      window.history.back();\r\n    });\r\n\r\n    // Clear All button\r\n    this.element.querySelector('.rs-wishlist-clear')?.addEventListener('click', () => {\r\n      this.clearWishlist();\r\n    });\r\n\r\n    // PDF button\r\n    this.element.querySelector('.rs-wishlist-pdf')?.addEventListener('click', () => {\r\n      WishlistManager.openModal('pdf');\r\n    });\r\n\r\n    // Share button\r\n    this.element.querySelector('.rs-wishlist-share')?.addEventListener('click', () => {\r\n      WishlistManager.openModal('share');\r\n    });\r\n\r\n    // Email button\r\n    this.element.querySelector('.rs-wishlist-email')?.addEventListener('click', () => {\r\n      WishlistManager.openModal('email');\r\n    });\r\n\r\n    // Only bind window events once to prevent duplicates on language change\r\n    if (!this.windowEventsBound) {\r\n      window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n        this.updateVisibility();\r\n      });\r\n      this.windowEventsBound = true;\r\n    }\r\n  }\r\n\r\n  private clearWishlist(): void {\r\n    if (confirm(this.label('wishlist_confirm_clear') || 'Are you sure you want to clear your entire wishlist?')) {\r\n      WishlistManager.clear();\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.success(this.label('wishlist_cleared') || 'Wishlist cleared');\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateVisibility(): void {\r\n    if (this.isSharedView) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    const count = WishlistManager.count();\r\n    this.element.style.display = count > 0 ? 'flex' : 'none';\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_actions', RSWishlistActions as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistActions };\r\nexport default RSWishlistActions;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Compare Button Component\r\n * Floating compare button with selection count\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\nimport type { RealtySoftToastModule } from '../../core/toast';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftToast: RealtySoftToastModule | undefined;\r\n\r\nclass RSWishlistCompareBtn extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n  private countEl: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.render();\r\n    this.bindEvents();\r\n    this.updateDisplay();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n      this.bindEvents();\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-compare-float');\r\n\r\n    // Hide in shared view\r\n    if (this.isSharedView) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.innerHTML = `\r\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n        <line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"10\"></line>\r\n        <line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"4\"></line>\r\n        <line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"14\"></line>\r\n      </svg>\r\n      <span class=\"rs-wishlist-compare-float__label\">${this.label('wishlist_compare') || 'Compare'}</span>\r\n      <span class=\"rs-wishlist-compare-count\">0</span>\r\n    `;\r\n\r\n    this.countEl = this.element.querySelector('.rs-wishlist-compare-count');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    if (this.isSharedView) return;\r\n\r\n    // Click to open compare modal\r\n    this.element.addEventListener('click', () => {\r\n      this.openCompareModal();\r\n    });\r\n\r\n    // Listen for compare selection changes\r\n    window.addEventListener(WishlistManager.EVENTS.COMPARE_CHANGED, () => {\r\n      this.updateDisplay();\r\n    });\r\n  }\r\n\r\n  private openCompareModal(): void {\r\n    const count = WishlistManager.getCompareCount();\r\n\r\n    if (count < 2) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.warning(this.label('compare_min') || 'Select at least 2 properties to compare');\r\n      }\r\n      return;\r\n    }\r\n\r\n    WishlistManager.openModal('compare');\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    if (this.isSharedView) return;\r\n\r\n    const count = WishlistManager.getCompareCount();\r\n    if (this.countEl) this.countEl.textContent = String(count);\r\n\r\n    if (count > 0) {\r\n      this.element.style.display = 'flex';\r\n      setTimeout(() => this.element.classList.add('visible'), 10);\r\n    } else {\r\n      this.element.classList.remove('visible');\r\n      setTimeout(() => {\r\n        if (WishlistManager.getCompareCount() === 0) {\r\n          this.element.style.display = 'none';\r\n        }\r\n      }, 300);\r\n    }\r\n  }\r\n\r\n  getCount(): number {\r\n    return WishlistManager.getCompareCount();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_compare_btn', RSWishlistCompareBtn as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistCompareBtn };\r\nexport default RSWishlistCompareBtn;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Grid Component\r\n * Property cards display with carousel, compare, remove functionality\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAPIModule,\r\n  RealtySoftAnalyticsModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\nimport type { WishlistItem } from '../../core/wishlist-manager';\r\nimport type { RealtySoftToastModule } from '../../core/toast';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAPI: RealtySoftAPIModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\ndeclare const RealtySoftToast: RealtySoftToastModule | undefined;\r\n\r\n// Property from shared wishlist API response\r\ninterface SharedProperty {\r\n  id: number;\r\n  ref_no?: string;\r\n  name?: string;\r\n  list_price?: number;\r\n  location_id?: { name?: string };\r\n  type_id?: { name?: string };\r\n  bedrooms?: number;\r\n  bathrooms?: number;\r\n  build_size?: number;\r\n  plot_size?: number;\r\n  images?: Array<string | { image_256?: string; src?: string }>;\r\n  listing_type?: string;\r\n  is_featured?: boolean;\r\n  is_own?: boolean;\r\n}\r\n\r\n// Extended property for grid display\r\ninterface GridProperty {\r\n  id: number;\r\n  ref_no: string;\r\n  ref: string;\r\n  name: string;\r\n  title: string;\r\n  list_price: number;\r\n  price: number;\r\n  location: string;\r\n  type: string;\r\n  bedrooms: number;\r\n  beds: number;\r\n  bathrooms: number;\r\n  baths: number;\r\n  build_size: number;\r\n  built_area: number;\r\n  built?: number;\r\n  plot_size: number;\r\n  images: Array<string | { image_256?: string; src?: string }>;\r\n  image?: string;\r\n  listing_type: string;\r\n  is_featured: boolean;\r\n  is_own: boolean;\r\n  addedAt?: number;\r\n  note?: string;\r\n  url?: string;\r\n  status?: string;\r\n  image_count?: number;\r\n  list_price_2?: number;\r\n}\r\n\r\nclass RSWishlistGrid extends RSBaseComponent {\r\n  private properties: GridProperty[] = [];\r\n  private isSharedView: boolean = false;\r\n  private sharedRefNos: string[] = [];\r\n  private isLoading: boolean = true;\r\n  private compareEnabled: boolean = false;\r\n  private template: string | null = null;\r\n  private windowEventsBound: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.properties = [];\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.sharedRefNos = this.isSharedView ? (WishlistManager.loadSharedWishlist() || []) : [];\r\n    this.isLoading = true;\r\n\r\n    // Check if compare feature is enabled (compare button exists on page)\r\n    this.compareEnabled = this.checkCompareEnabled();\r\n\r\n    // Check for template attribute (e.g., data-template=\"08\")\r\n    this.template = this.element.dataset.template || null;\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n    this.loadProperties();\r\n\r\n    // Subscribe to language changes to re-render with updated labels\r\n    this.subscribe<string>('config.language', () => {\r\n      // Re-render properties if we have them (preserves wishlist on language change)\r\n      if (this.properties.length > 0 && !this.isLoading) {\r\n        this.renderProperties();\r\n      }\r\n    });\r\n  }\r\n\r\n  private checkCompareEnabled(): boolean {\r\n    const compareBtn = document.querySelector('.rs_wishlist_compare_btn, .rs-wishlist-compare-float');\r\n    const isInsideCombined = this.element.closest('.rs_wishlist_list, .rs-wishlist-list');\r\n    return !!(compareBtn || isInsideCombined);\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-list__grid');\r\n\r\n    // Apply template class if specified\r\n    if (this.template) {\r\n      this.element.classList.add(`rs-wishlist-template-${this.template}`);\r\n    }\r\n\r\n    // Show loading initially\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-wishlist-grid__loading\">\r\n        <div class=\"rs-wishlist-list__spinner\"></div>\r\n        <p>${this.label('results_loading') || 'Loading...'}</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Only bind window events once to prevent duplicates on language change\r\n    if (!this.windowEventsBound) {\r\n      // Listen for wishlist changes\r\n      if (!this.isSharedView) {\r\n        window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n          this.loadProperties();\r\n        });\r\n      }\r\n\r\n      // Listen for sort changes\r\n      window.addEventListener(WishlistManager.EVENTS.SORTED, () => {\r\n        this.sortAndRender();\r\n      });\r\n\r\n      // Listen for compare changes to update checkboxes\r\n      window.addEventListener(WishlistManager.EVENTS.COMPARE_CHANGED, () => {\r\n        this.updateCompareCheckboxes();\r\n      });\r\n\r\n      this.windowEventsBound = true;\r\n    }\r\n\r\n    // Delegate card events (re-bind after render since DOM is replaced)\r\n    this.element.addEventListener('click', (e: MouseEvent) => this.handleCardClick(e));\r\n  }\r\n\r\n  private async loadProperties(): Promise<void> {\r\n    this.isLoading = true;\r\n\r\n    if (this.isSharedView) {\r\n      await this.loadSharedProperties();\r\n    } else {\r\n      this.loadOwnWishlist();\r\n    }\r\n  }\r\n\r\n  private loadOwnWishlist(): void {\r\n    const sort = WishlistManager.getSort();\r\n    const items = WishlistManager.getAsArray(sort.field, sort.order);\r\n    this.properties = items as unknown as GridProperty[];\r\n\r\n    if (this.properties.length === 0) {\r\n      this.element.style.display = 'none';\r\n    } else {\r\n      this.element.style.display = 'grid';\r\n      this.renderProperties();\r\n    }\r\n\r\n    this.isLoading = false;\r\n\r\n    // Track view\r\n    this.properties.forEach(p => {\r\n      RealtySoftAnalytics.track('wishlist', 'viewed', { property_id: p.ref_no });\r\n    });\r\n  }\r\n\r\n  private async loadSharedProperties(): Promise<void> {\r\n    try {\r\n      const properties: GridProperty[] = [];\r\n\r\n      for (const refNo of this.sharedRefNos) {\r\n        try {\r\n          const result = await RealtySoftAPI.request('v1/property', { ref_no: refNo }) as {\r\n            data?: SharedProperty[];\r\n          };\r\n          if (result && result.data && result.data.length > 0) {\r\n            const prop = result.data[0];\r\n            properties.push({\r\n              id: prop.id,\r\n              ref_no: prop.ref_no || refNo,\r\n              ref: prop.ref_no || refNo,\r\n              name: prop.name || 'Property',\r\n              title: prop.name || 'Property',\r\n              list_price: Number(prop.list_price) || 0,\r\n              price: Number(prop.list_price) || 0,\r\n              location: prop.location_id?.name || 'N/A',\r\n              type: prop.type_id?.name || 'N/A',\r\n              bedrooms: Number(prop.bedrooms) || 0,\r\n              beds: Number(prop.bedrooms) || 0,\r\n              bathrooms: Number(prop.bathrooms) || 0,\r\n              baths: Number(prop.bathrooms) || 0,\r\n              build_size: Number(prop.build_size) || 0,\r\n              built_area: Number(prop.build_size) || 0,\r\n              plot_size: Number(prop.plot_size) || 0,\r\n              images: prop.images || [],\r\n              listing_type: prop.listing_type || 'resale',\r\n              is_featured: prop.is_featured || false,\r\n              is_own: prop.is_own || false\r\n            });\r\n          }\r\n        } catch (err) {\r\n          console.warn(`[Wishlist] Could not load property ${refNo}:`, err);\r\n        }\r\n      }\r\n\r\n      this.properties = properties;\r\n\r\n      if (properties.length === 0) {\r\n        this.element.style.display = 'none';\r\n      } else {\r\n        this.element.style.display = 'grid';\r\n        this.renderProperties();\r\n      }\r\n\r\n      this.isLoading = false;\r\n    } catch (error) {\r\n      console.error('[Wishlist] Error loading shared wishlist:', error);\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  private sortAndRender(): void {\r\n    if (this.isSharedView) return;\r\n\r\n    const sort = WishlistManager.getSort();\r\n    const items = WishlistManager.getAsArray(sort.field, sort.order);\r\n    this.properties = items as unknown as GridProperty[];\r\n    this.renderProperties();\r\n  }\r\n\r\n  private renderProperties(): void {\r\n    this.element.innerHTML = this.properties.map(p => this.createCard(p)).join('');\r\n  }\r\n\r\n  private createCard(property: GridProperty): string {\r\n    // Handle both old format (images array) and new format (single image string)\r\n    let imageUrls: string[] = [];\r\n    if (property.images && Array.isArray(property.images)) {\r\n      imageUrls = property.images.slice(0, 5).map(img => {\r\n        if (typeof img === 'string') return img;\r\n        return (img as { image_256?: string; src?: string }).image_256 ||\r\n               (img as { image_256?: string; src?: string }).src || '';\r\n      }).filter(Boolean);\r\n    } else if (property.image) {\r\n      imageUrls = [property.image];\r\n    }\r\n    const placeholderImg = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"256\" height=\"192\"%3E%3Crect fill=\"%23ecf0f1\" width=\"256\" height=\"192\"/%3E%3Ctext x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23bdc3c7\" font-family=\"sans-serif\" font-size=\"16\"%3ENo Image%3C/text%3E%3C/svg%3E';\r\n\r\n    const price = this.formatPrice(property);\r\n    const propertyUrl = this.generatePropertyUrl(property);\r\n    const addedDate = property.addedAt ? new Date(property.addedAt).toLocaleDateString() : '';\r\n    const refNo = property.ref_no || property.ref || String(property.id);\r\n    const isCompareSelected = WishlistManager.isInCompare(refNo);\r\n\r\n    const tags = this.generateTags(property);\r\n\r\n    return `\r\n      <div class=\"rs-wishlist-card\" data-ref-no=\"${refNo}\">\r\n        <div class=\"rs-wishlist-card__carousel\">\r\n          ${tags}\r\n          ${!this.isSharedView ? `\r\n            ${this.compareEnabled ? `\r\n              <div class=\"rs-wishlist-card__compare\">\r\n                <input type=\"checkbox\" id=\"compare-${refNo}\" class=\"rs-compare-check\" ${isCompareSelected ? 'checked' : ''}>\r\n                <label for=\"compare-${refNo}\">${this.label('compare') || 'Compare'}</label>\r\n              </div>\r\n            ` : ''}\r\n            <button type=\"button\" class=\"rs-wishlist-card__heart active\" data-action=\"remove\">\r\n              <svg viewBox=\"0 0 24 24\"><path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"/></svg>\r\n            </button>\r\n          ` : ''}\r\n          <a href=\"${propertyUrl}\" class=\"rs-wishlist-card__carousel-link\">\r\n            <div class=\"rs-wishlist-card__carousel-track\">\r\n              ${imageUrls.length > 0\r\n                ? imageUrls.map((url, i) => `<img src=\"${url}\" alt=\"${this.escapeHtml(property.name || property.title)} - ${i+1}\" ${i === 0 ? 'loading=\"eager\" fetchpriority=\"high\"' : 'loading=\"lazy\"'} onerror=\"this.src='${placeholderImg}'\">`).join('')\r\n                : `<img src=\"${placeholderImg}\" alt=\"No image\">`\r\n              }\r\n            </div>\r\n          </a>\r\n          ${imageUrls.length > 1 ? `\r\n            <button type=\"button\" class=\"rs-wishlist-card__nav rs-wishlist-card__nav--prev\" data-action=\"prev\">&#8249;</button>\r\n            <button type=\"button\" class=\"rs-wishlist-card__nav rs-wishlist-card__nav--next\" data-action=\"next\">&#8250;</button>\r\n            <div class=\"rs-wishlist-card__indicators\">\r\n              ${imageUrls.map((_, i) => `<span class=\"${i === 0 ? 'active' : ''}\"></span>`).join('')}\r\n            </div>\r\n          ` : ''}\r\n          ${(property.image_count || imageUrls.length) > 0 ? `\r\n            <div class=\"rs-wishlist-card__img-count\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n                <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n              </svg>\r\n              <span>${property.image_count || imageUrls.length}</span>\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        <div class=\"rs-wishlist-card__content\">\r\n          <a href=\"${propertyUrl}\" class=\"rs-wishlist-card__title\">${this.escapeHtml(property.name || property.title)}</a>\r\n          <a href=\"${propertyUrl}\" class=\"rs-wishlist-card__price\">${price}</a>\r\n          <div class=\"rs-wishlist-card__details\">\r\n            <span>${this.escapeHtml(property.location || 'N/A')}</span>\r\n            <span>${this.escapeHtml(property.type || 'N/A')}</span>\r\n            <span>${property.beds || property.bedrooms || 0} ${this.label('card_beds') || 'beds'}</span>\r\n            <span>${property.baths || property.bathrooms || 0} ${this.label('card_baths') || 'baths'}</span>\r\n            <span>${property.built || property.build_size || property.built_area || 0}m\\u00B2</span>\r\n          </div>\r\n          ${addedDate ? `<div class=\"rs-wishlist-card__added\">${this.label('added') || 'Added'}: ${addedDate}</div>` : ''}\r\n          ${property.note ? `\r\n            <div class=\"rs-wishlist-card__note\">\r\n              <strong>\\uD83D\\uDCDD ${this.label('note') || 'Note'}:</strong> ${this.escapeHtml(property.note)}\r\n            </div>\r\n          ` : (!this.isSharedView ? `\r\n            <button type=\"button\" class=\"rs-wishlist-card__add-note\" data-action=\"addNote\">\\uD83D\\uDCDD ${this.label('wishlist_add_note') || 'Add Note'}</button>\r\n          ` : '')}\r\n          <div class=\"rs-wishlist-card__footer\">\r\n            <span class=\"rs-wishlist-card__ref\">Ref: ${refNo}</span>\r\n            <a href=\"${propertyUrl}\" class=\"rs-wishlist-card__view\">${this.label('view_details') || 'View Details'}</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private generateTags(property: GridProperty): string {\r\n    const tags: string[] = [];\r\n    const listingType = property.listing_type || property.status;\r\n\r\n    if (listingType) {\r\n      const classMap: Record<string, string> = {\r\n        resale: 'rs-tag--sale', sale: 'rs-tag--sale',\r\n        development: 'rs-tag--development', new_development: 'rs-tag--development',\r\n        long_rental: 'rs-tag--rental', rent: 'rs-tag--rental',\r\n        short_rental: 'rs-tag--holiday', holiday: 'rs-tag--holiday'\r\n      };\r\n      const labelKeyMap: Record<string, string> = {\r\n        resale: 'listing_type_sale', sale: 'listing_type_sale',\r\n        development: 'listing_type_new', new_development: 'listing_type_new',\r\n        long_rental: 'listing_type_long_rental', rent: 'listing_type_long_rental',\r\n        short_rental: 'listing_type_short_rental', holiday: 'listing_type_short_rental'\r\n      };\r\n      const typeKey = listingType.toLowerCase();\r\n      const cssClass = classMap[typeKey] || 'rs-tag--sale';\r\n      const labelKey = labelKeyMap[typeKey];\r\n      const typeLabel = labelKey ? this.label(labelKey) : listingType;\r\n      tags.push(`<span class=\"rs-tag ${cssClass}\">${typeLabel}</span>`);\r\n    }\r\n\r\n    if (property.is_featured) {\r\n      tags.push(`<span class=\"rs-tag rs-tag--featured\">${this.label('featured') || 'Featured'}</span>`);\r\n    }\r\n\r\n    if (property.is_own) {\r\n      tags.push(`<span class=\"rs-tag rs-tag--own\">${this.label('own') || 'Own'}</span>`);\r\n    }\r\n\r\n    return tags.length > 0 ? `<div class=\"rs-wishlist-card__tags\">${tags.join('')}</div>` : '';\r\n  }\r\n\r\n  private formatPrice(property: GridProperty): string {\r\n    const price1 = Number(property.list_price || property.price || 0);\r\n    const price2 = Number(property.list_price_2 || 0);\r\n\r\n    if (price2 && price1 !== price2) {\r\n      return `\\u20AC${price1.toLocaleString()} - \\u20AC${price2.toLocaleString()}`;\r\n    }\r\n    return `\\u20AC${price1.toLocaleString()}`;\r\n  }\r\n\r\n  private generatePropertyUrl(property: GridProperty): string {\r\n    if (property.url) return property.url;\r\n\r\n    const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n    const ref = property.ref_no || property.ref || String(property.id);\r\n    const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    const title = property.name || property.title || '';\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9\\s-]/g, '')\r\n      .replace(/\\s+/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '')\r\n      .substring(0, 80);\r\n\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  private handleCardClick(e: MouseEvent): void {\r\n    const card = (e.target as HTMLElement).closest('.rs-wishlist-card') as HTMLElement | null;\r\n    if (!card) return;\r\n\r\n    const refNo = card.dataset.refNo || '';\r\n    const actionEl = (e.target as HTMLElement).closest('[data-action]') as HTMLElement | null;\r\n    const action = actionEl?.dataset.action;\r\n\r\n    if (action === 'remove') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      if (confirm(this.label('wishlist_confirm_remove') || 'Remove this property from your wishlist?')) {\r\n        WishlistManager.remove(refNo);\r\n        RealtySoftAnalytics.track('wishlist', 'removed', { property_id: refNo });\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_removed') || 'Removed from wishlist');\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (action === 'addNote') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      WishlistManager.openModal('note', { refNo });\r\n      return;\r\n    }\r\n\r\n    if (action === 'prev' || action === 'next') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.navigateCarousel(card, action);\r\n      return;\r\n    }\r\n\r\n    // Compare checkbox\r\n    const compareCheck = (e.target as HTMLElement).closest('.rs-compare-check') as HTMLInputElement | null;\r\n    if (compareCheck) {\r\n      this.handleCompareToggle(refNo, compareCheck.checked);\r\n      return;\r\n    }\r\n  }\r\n\r\n  private navigateCarousel(card: HTMLElement, direction: string): void {\r\n    const track = card.querySelector('.rs-wishlist-card__carousel-track') as HTMLElement | null;\r\n    const indicators = card.querySelectorAll('.rs-wishlist-card__indicators span');\r\n    const images = track?.querySelectorAll('img');\r\n\r\n    if (!track || !images || images.length <= 1) return;\r\n\r\n    let currentIndex = Array.from(indicators).findIndex(i => i.classList.contains('active'));\r\n    if (currentIndex === -1) currentIndex = 0;\r\n\r\n    const newIndex = direction === 'next'\r\n      ? (currentIndex + 1) % images.length\r\n      : (currentIndex - 1 + images.length) % images.length;\r\n\r\n    track.style.transform = `translateX(-${newIndex * 100}%)`;\r\n\r\n    indicators.forEach((ind, i) => {\r\n      ind.classList.toggle('active', i === newIndex);\r\n    });\r\n  }\r\n\r\n  private handleCompareToggle(refNo: string, isChecked: boolean): void {\r\n    if (isChecked) {\r\n      const result = WishlistManager.addToCompare(refNo);\r\n      if (!result) {\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          const max = WishlistManager.getMaxCompare();\r\n          RealtySoftToast.warning(`${this.label('compare_max') || 'Maximum'} ${max} ${this.label('properties') || 'properties'}`);\r\n        }\r\n        // Uncheck the checkbox\r\n        const checkbox = this.element.querySelector(`#compare-${refNo}`) as HTMLInputElement | null;\r\n        if (checkbox) checkbox.checked = false;\r\n      }\r\n    } else {\r\n      WishlistManager.removeFromCompare(refNo);\r\n    }\r\n  }\r\n\r\n  private updateCompareCheckboxes(): void {\r\n    this.element.querySelectorAll<HTMLInputElement>('.rs-compare-check').forEach(checkbox => {\r\n      const refNo = checkbox.id.replace('compare-', '');\r\n      checkbox.checked = WishlistManager.isInCompare(refNo);\r\n    });\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  getProperties(): GridProperty[] {\r\n    return this.properties;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_grid', RSWishlistGrid as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistGrid };\r\nexport default RSWishlistGrid;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist Modals Component\r\n * Share, Email, Note, and Compare modals\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftStateModule,\r\n  RealtySoftAnalyticsModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\nimport type { WishlistItem } from '../../core/wishlist-manager';\r\nimport type { RealtySoftToastModule } from '../../core/toast';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftState: RealtySoftStateModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\ndeclare const RealtySoftToast: RealtySoftToastModule | undefined;\r\n\r\n// jsPDF global\r\ndeclare const jspdf: { jsPDF: new (options: Record<string, unknown>) => JsPDFInstance } | undefined;\r\n\r\ninterface JsPDFInstance {\r\n  internal: { pageSize: { getWidth: () => number; getHeight: () => number } };\r\n  setFontSize: (size: number) => void;\r\n  setTextColor: (...args: number[]) => void;\r\n  setFont: (fontName: string | undefined, style: string) => void;\r\n  setFillColor: (...args: number[]) => void;\r\n  text: (text: string | string[], x: number, y: number, options?: Record<string, unknown>) => void;\r\n  rect: (x: number, y: number, w: number, h: number, style: string) => void;\r\n  addPage: () => void;\r\n  addImage: (data: string, format: string, x: number, y: number, w: number, h: number) => void;\r\n  splitTextToSize: (text: string, maxWidth: number) => string[];\r\n  save: (filename: string) => void;\r\n}\r\n\r\n// Extended window with jspdf\r\ninterface WindowWithJsPDF extends Window {\r\n  jspdf?: typeof jspdf;\r\n}\r\n\r\nclass RSWishlistModals extends RSBaseComponent {\r\n  private currentNoteRefNo: string | null = null;\r\n  private shareModal: HTMLElement | null = null;\r\n  private emailModal: HTMLElement | null = null;\r\n  private noteModal: HTMLElement | null = null;\r\n  private compareModal: HTMLElement | null = null;\r\n  private windowEventsbound: boolean = false;\r\n  private modalOpenHandler: ((e: Event) => void) | null = null;\r\n  private modalCloseHandler: ((e: Event) => void) | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.currentNoteRefNo = null;\r\n    this.render();\r\n    this.bindEvents();\r\n\r\n    // Subscribe to language changes to update labels\r\n    this.subscribe<string>('config.language', () => {\r\n      this.render();\r\n      this.bindEvents();\r\n    });\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-wishlist-modals');\r\n\r\n    this.element.innerHTML = `\r\n      <!-- Share Modal -->\r\n      <div class=\"rs-modal\" id=\"rs-share-modal\">\r\n        <div class=\"rs-modal__backdrop\"></div>\r\n        <div class=\"rs-modal__content\">\r\n          <div class=\"rs-modal__header\">\r\n            <h3>${this.label('wishlist_share_title') || 'Share Your Wishlist'}</h3>\r\n            <button type=\"button\" class=\"rs-modal__close\">&times;</button>\r\n          </div>\r\n          <div class=\"rs-modal__body\">\r\n            <p class=\"rs-modal__desc\">${this.label('wishlist_share_desc') || 'Share this link with anyone to show them your saved properties:'}</p>\r\n            <div class=\"rs-share-link\">\r\n              <input type=\"text\" class=\"rs-share-link__input\" readonly>\r\n              <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--primary rs-share-link__copy\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\r\n                  <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\r\n                </svg>\r\n                ${this.label('copy') || 'Copy'}\r\n              </button>\r\n            </div>\r\n            <div class=\"rs-share-social\">\r\n              <button type=\"button\" class=\"rs-share-social__btn rs-share-social__btn--whatsapp\" data-platform=\"whatsapp\">\r\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                  <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z\"/>\r\n                </svg>\r\n                WhatsApp\r\n              </button>\r\n              <button type=\"button\" class=\"rs-share-social__btn rs-share-social__btn--email\" data-platform=\"email\">\r\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n                  <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n                </svg>\r\n                Email\r\n              </button>\r\n              <button type=\"button\" class=\"rs-share-social__btn rs-share-social__btn--qr\" data-platform=\"qr\">\r\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n                  <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect>\r\n                  <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n                  <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect>\r\n                </svg>\r\n                QR Code\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Email Modal -->\r\n      <div class=\"rs-modal\" id=\"rs-email-modal\">\r\n        <div class=\"rs-modal__backdrop\"></div>\r\n        <div class=\"rs-modal__content\">\r\n          <div class=\"rs-modal__header\">\r\n            <h3>${this.label('wishlist_email_title') || 'Email Your Wishlist'}</h3>\r\n            <button type=\"button\" class=\"rs-modal__close\">&times;</button>\r\n          </div>\r\n          <div class=\"rs-modal__body\">\r\n            <form class=\"rs-email-form\">\r\n              <div class=\"rs-form-group\">\r\n                <label>${this.label('wishlist_email_to') || 'Send to:'}</label>\r\n                <input type=\"email\" name=\"emailTo\" class=\"rs-input\" placeholder=\"recipient@example.com\" required>\r\n              </div>\r\n              <div class=\"rs-form-group\">\r\n                <label>${this.label('wishlist_email_from') || 'Your email (optional):'}</label>\r\n                <input type=\"email\" name=\"emailFrom\" class=\"rs-input\" placeholder=\"your@example.com\">\r\n              </div>\r\n              <div class=\"rs-form-group\">\r\n                <label>${this.label('wishlist_email_message') || 'Personal message (optional):'}</label>\r\n                <textarea name=\"message\" class=\"rs-textarea\" rows=\"4\" placeholder=\"${this.label('wishlist_email_placeholder') || 'Add a personal note...'}\"></textarea>\r\n              </div>\r\n              <div class=\"rs-form-actions\">\r\n                <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--secondary rs-email-cancel\">${this.label('cancel') || 'Cancel'}</button>\r\n                <button type=\"submit\" class=\"rs-wishlist-btn rs-wishlist-btn--success\">${this.label('wishlist_email_send') || 'Send Email'}</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Note Modal -->\r\n      <div class=\"rs-modal\" id=\"rs-note-modal\">\r\n        <div class=\"rs-modal__backdrop\"></div>\r\n        <div class=\"rs-modal__content\">\r\n          <div class=\"rs-modal__header\">\r\n            <h3>${this.label('wishlist_note_title') || 'Add Property Note'}</h3>\r\n            <button type=\"button\" class=\"rs-modal__close\">&times;</button>\r\n          </div>\r\n          <div class=\"rs-modal__body\">\r\n            <form class=\"rs-note-form\">\r\n              <input type=\"hidden\" name=\"refNo\" class=\"rs-note-refno\">\r\n              <div class=\"rs-form-group\">\r\n                <label>${this.label('property') || 'Property:'}</label>\r\n                <div class=\"rs-note-property-name\"></div>\r\n              </div>\r\n              <div class=\"rs-form-group\">\r\n                <label>${this.label('wishlist_note_label') || 'Your note:'}</label>\r\n                <textarea name=\"note\" class=\"rs-textarea rs-note-text\" rows=\"6\" placeholder=\"${this.label('wishlist_note_placeholder') || 'Add your thoughts, questions, or reminders...'}\" maxlength=\"500\"></textarea>\r\n                <div class=\"rs-char-counter\"><span class=\"rs-note-char-count\">0</span> / 500</div>\r\n              </div>\r\n              <div class=\"rs-form-actions\">\r\n                <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--secondary rs-note-cancel\">${this.label('cancel') || 'Cancel'}</button>\r\n                <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--danger rs-note-delete\" style=\"display: none;\">${this.label('delete') || 'Delete'}</button>\r\n                <button type=\"submit\" class=\"rs-wishlist-btn rs-wishlist-btn--success\">${this.label('save') || 'Save'}</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Compare Modal -->\r\n      <div class=\"rs-modal rs-modal--large\" id=\"rs-compare-modal\">\r\n        <div class=\"rs-modal__backdrop\"></div>\r\n        <div class=\"rs-modal__content\">\r\n          <div class=\"rs-modal__header\">\r\n            <h3>${this.label('wishlist_compare_title') || 'Compare Properties'}</h3>\r\n            <button type=\"button\" class=\"rs-modal__close\">&times;</button>\r\n          </div>\r\n          <div class=\"rs-modal__body\">\r\n            <div class=\"rs-compare-grid\"></div>\r\n            <div class=\"rs-compare-table-wrap\">\r\n              <table class=\"rs-compare-table\">\r\n                <thead><tr><th>${this.label('feature') || 'Feature'}</th></tr></thead>\r\n                <tbody></tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n          <div class=\"rs-modal__footer\">\r\n            <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--secondary rs-compare-close\">${this.label('close') || 'Close'}</button>\r\n            <button type=\"button\" class=\"rs-wishlist-btn rs-wishlist-btn--danger rs-compare-clear\">${this.label('wishlist_compare_clear') || 'Clear Selection'}</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Cache modal references\r\n    this.shareModal = this.element.querySelector('#rs-share-modal');\r\n    this.emailModal = this.element.querySelector('#rs-email-modal');\r\n    this.noteModal = this.element.querySelector('#rs-note-modal');\r\n    this.compareModal = this.element.querySelector('#rs-compare-modal');\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Window event listeners - only bind once to prevent duplicates on language change\r\n    if (!this.windowEventsbound) {\r\n      this.modalOpenHandler = ((e: CustomEvent) => {\r\n        this.handleModalOpen(e.detail.modalType, e.detail.data);\r\n      }) as EventListener;\r\n\r\n      this.modalCloseHandler = ((e: CustomEvent) => {\r\n        this.closeModal(e.detail.modalType);\r\n      }) as EventListener;\r\n\r\n      window.addEventListener(WishlistManager.EVENTS.MODAL_OPEN, this.modalOpenHandler);\r\n      window.addEventListener(WishlistManager.EVENTS.MODAL_CLOSE, this.modalCloseHandler);\r\n      this.windowEventsbound = true;\r\n    }\r\n\r\n    // Modal close handlers (re-bind after render since DOM is replaced)\r\n    this.element.querySelectorAll('.rs-modal__backdrop, .rs-modal__close').forEach(el => {\r\n      el.addEventListener('click', (e: Event) => {\r\n        const modal = (e.target as HTMLElement).closest('.rs-modal');\r\n        if (modal) {\r\n          (modal as HTMLElement).classList.remove('rs-modal--open');\r\n          document.body.style.overflow = '';\r\n        }\r\n      });\r\n    });\r\n\r\n    // Share modal\r\n    this.element.querySelector('.rs-share-link__copy')?.addEventListener('click', () => this.copyShareLink());\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-share-social__btn').forEach(btn => {\r\n      btn.addEventListener('click', () => this.handleSocialShare(btn.dataset.platform || ''));\r\n    });\r\n\r\n    // Email form\r\n    this.element.querySelector('.rs-email-form')?.addEventListener('submit', (e: Event) => this.handleEmailSubmit(e));\r\n    this.element.querySelector('.rs-email-cancel')?.addEventListener('click', () => this.closeModalById('rs-email-modal'));\r\n\r\n    // Note form\r\n    const noteText = this.element.querySelector('.rs-note-text') as HTMLTextAreaElement | null;\r\n    noteText?.addEventListener('input', () => {\r\n      const counter = this.element.querySelector('.rs-note-char-count');\r\n      if (counter) counter.textContent = String(noteText.value.length);\r\n    });\r\n    this.element.querySelector('.rs-note-form')?.addEventListener('submit', (e: Event) => this.handleNoteSubmit(e));\r\n    this.element.querySelector('.rs-note-cancel')?.addEventListener('click', () => this.closeModalById('rs-note-modal'));\r\n    this.element.querySelector('.rs-note-delete')?.addEventListener('click', () => this.deleteNote());\r\n\r\n    // Compare modal\r\n    this.element.querySelector('.rs-compare-close')?.addEventListener('click', () => this.closeModalById('rs-compare-modal'));\r\n    this.element.querySelector('.rs-compare-clear')?.addEventListener('click', () => this.clearCompare());\r\n  }\r\n\r\n  private handleModalOpen(modalType: string, data: Record<string, unknown> = {}): void {\r\n    switch (modalType) {\r\n      case 'share':\r\n        this.openShareModal();\r\n        break;\r\n      case 'email':\r\n        this.openEmailModal();\r\n        break;\r\n      case 'note':\r\n        this.openNoteModal(data.refNo as string);\r\n        break;\r\n      case 'compare':\r\n        this.openCompareModal();\r\n        break;\r\n      case 'pdf':\r\n        this.downloadPDF();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private closeModal(modalType: string): void {\r\n    const modalMap: Record<string, string> = {\r\n      share: 'rs-share-modal',\r\n      email: 'rs-email-modal',\r\n      note: 'rs-note-modal',\r\n      compare: 'rs-compare-modal'\r\n    };\r\n    const modalId = modalMap[modalType];\r\n    if (modalId) {\r\n      this.closeModalById(modalId);\r\n    }\r\n  }\r\n\r\n  private openModalById(modalId: string): void {\r\n    const modal = this.element.querySelector(`#${modalId}`) as HTMLElement | null;\r\n    if (modal) {\r\n      modal.classList.add('rs-modal--open');\r\n      document.body.style.overflow = 'hidden';\r\n    }\r\n  }\r\n\r\n  private closeModalById(modalId: string): void {\r\n    const modal = this.element.querySelector(`#${modalId}`) as HTMLElement | null;\r\n    if (modal) {\r\n      modal.classList.remove('rs-modal--open');\r\n      document.body.style.overflow = '';\r\n    }\r\n  }\r\n\r\n  // Share functionality\r\n  private openShareModal(): void {\r\n    const shareLink = WishlistManager.generateShareLink();\r\n    if (!shareLink) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.error(this.label('wishlist_no_share') || 'No properties to share');\r\n      }\r\n      return;\r\n    }\r\n\r\n    const input = this.element.querySelector('.rs-share-link__input') as HTMLInputElement | null;\r\n    if (input) input.value = shareLink;\r\n    this.openModalById('rs-share-modal');\r\n  }\r\n\r\n  private copyShareLink(): void {\r\n    const input = this.element.querySelector('.rs-share-link__input') as HTMLInputElement | null;\r\n    if (input) {\r\n      input.select();\r\n      document.execCommand('copy');\r\n    }\r\n\r\n    if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n      RealtySoftToast.success(this.label('copied') || 'Link copied to clipboard!');\r\n    }\r\n\r\n    RealtySoftAnalytics.track('wishlist', 'share', { method: 'copy' });\r\n  }\r\n\r\n  private handleSocialShare(platform: string): void {\r\n    const shareLink = WishlistManager.generateShareLink();\r\n\r\n    if (platform === 'whatsapp') {\r\n      const text = encodeURIComponent(`Check out my property wishlist: ${shareLink}`);\r\n      window.open(`https://wa.me/?text=${text}`, '_blank');\r\n      RealtySoftAnalytics.track('wishlist', 'share', { method: 'whatsapp' });\r\n    } else if (platform === 'email') {\r\n      this.closeModalById('rs-share-modal');\r\n      setTimeout(() => this.openEmailModal(), 300);\r\n    } else if (platform === 'qr') {\r\n      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(shareLink || '')}`;\r\n      window.open(qrUrl, '_blank');\r\n      RealtySoftAnalytics.track('wishlist', 'share', { method: 'qr' });\r\n    }\r\n  }\r\n\r\n  // Email functionality\r\n  private openEmailModal(): void {\r\n    this.openModalById('rs-email-modal');\r\n  }\r\n\r\n  private async handleEmailSubmit(e: Event): Promise<void> {\r\n    e.preventDefault();\r\n\r\n    const form = e.target as HTMLFormElement;\r\n    const emailTo = (form.elements.namedItem('emailTo') as HTMLInputElement).value.trim();\r\n    const emailFrom = (form.elements.namedItem('emailFrom') as HTMLInputElement).value.trim();\r\n    const message = (form.elements.namedItem('message') as HTMLTextAreaElement).value.trim();\r\n\r\n    if (!emailTo) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.error('Please enter recipient email');\r\n      }\r\n      return;\r\n    }\r\n\r\n    const phpBase = RealtySoftState.get<string>('config.phpBase') || 'https://realtysoft.ai/propertymanager/php';\r\n    const emailEndpoint = RealtySoftState.get<string>('config.wishlistEmailEndpoint') ||\r\n                          `${phpBase}/send-wishlist-email.php`;\r\n\r\n    const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement | null;\r\n    const originalText = submitBtn?.innerHTML || '';\r\n    if (submitBtn) {\r\n      submitBtn.disabled = true;\r\n      submitBtn.innerHTML = this.label('inquiry_sending') || 'Sending...';\r\n    }\r\n\r\n    const properties = WishlistManager.getAsArray();\r\n    const propertiesWithUrls = properties.map(p => ({\r\n      ...p,\r\n      propertyUrl: window.location.origin + this.generatePropertyUrl(p)\r\n    }));\r\n\r\n    try {\r\n      const response = await fetch(emailEndpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          emailTo,\r\n          emailFrom: emailFrom || 'noreply@realtysoft.ai',\r\n          message,\r\n          wishlist: propertiesWithUrls,\r\n          siteUrl: window.location.origin,\r\n          ownerEmail: RealtySoftState.get<string>('config.ownerEmail') || ''\r\n        })\r\n      });\r\n\r\n      const responseText = await response.text();\r\n\r\n      if (!responseText || responseText.trim() === '') {\r\n        throw new Error('Server returned empty response');\r\n      }\r\n\r\n      if (responseText.trim().startsWith('<!DOCTYPE') || responseText.trim().startsWith('<html')) {\r\n        throw new Error('Email endpoint not found');\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = JSON.parse(responseText) as { success: boolean; message?: string };\r\n\r\n      if (result.success) {\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.success(this.label('wishlist_email_sent') || 'Email sent successfully!');\r\n        }\r\n        this.closeModalById('rs-email-modal');\r\n        form.reset();\r\n\r\n        properties.forEach(p => {\r\n          RealtySoftAnalytics.track('wishlist', 'emailed', { property_id: (p as WishlistItem).ref_no });\r\n        });\r\n      } else {\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.error(result.message || this.label('wishlist_email_error') || 'Failed to send email');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('[Wishlist Email] Error:', error);\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.error('Email failed: ' + (error as Error).message);\r\n      }\r\n    } finally {\r\n      if (submitBtn) {\r\n        submitBtn.disabled = false;\r\n        submitBtn.innerHTML = originalText;\r\n      }\r\n    }\r\n  }\r\n\r\n  private generatePropertyUrl(property: WishlistItem | Record<string, unknown>): string {\r\n    const p = property as Record<string, unknown>;\r\n    if (p.url) return p.url as string;\r\n\r\n    const pageSlug = RealtySoftState.get<string>('config.propertyPageSlug') || 'property';\r\n    const ref = (p.ref_no || p.ref || p.id || '') as string;\r\n    const urlFormat = RealtySoftState.get<string>('config.propertyUrlFormat') || 'seo';\r\n\r\n    if (urlFormat === 'query') {\r\n      return `/${pageSlug}?ref=${ref}`;\r\n    }\r\n\r\n    if (urlFormat === 'ref') {\r\n      return `/${pageSlug}/${ref}`;\r\n    }\r\n\r\n    const title = (p.name || p.title || '') as string;\r\n    const titleSlug = title\r\n      .toLowerCase()\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9\\s-]/g, '')\r\n      .replace(/\\s+/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '')\r\n      .substring(0, 80);\r\n\r\n    return `/${pageSlug}/${titleSlug}-${ref}`;\r\n  }\r\n\r\n  // Note functionality\r\n  private openNoteModal(refNo: string): void {\r\n    const property = WishlistManager.get(refNo);\r\n    if (!property) return;\r\n\r\n    this.currentNoteRefNo = refNo;\r\n\r\n    if (!this.noteModal) return;\r\n    const modal = this.noteModal;\r\n    const refInput = modal.querySelector('.rs-note-refno') as HTMLInputElement | null;\r\n    if (refInput) refInput.value = refNo;\r\n    const nameEl = modal.querySelector('.rs-note-property-name');\r\n    if (nameEl) nameEl.textContent = property.title || 'Property';\r\n    const textEl = modal.querySelector('.rs-note-text') as HTMLTextAreaElement | null;\r\n    if (textEl) textEl.value = property.note || '';\r\n    const charCount = modal.querySelector('.rs-note-char-count');\r\n    if (charCount) charCount.textContent = String((property.note || '').length);\r\n    const deleteBtn = modal.querySelector('.rs-note-delete') as HTMLElement | null;\r\n    if (deleteBtn) deleteBtn.style.display = property.note ? 'inline-flex' : 'none';\r\n\r\n    this.openModalById('rs-note-modal');\r\n  }\r\n\r\n  private handleNoteSubmit(e: Event): void {\r\n    e.preventDefault();\r\n\r\n    const form = e.target as HTMLFormElement;\r\n    const refNo = (form.querySelector('.rs-note-refno') as HTMLInputElement)?.value || '';\r\n    const note = (form.querySelector('.rs-note-text') as HTMLTextAreaElement)?.value.trim() || '';\r\n\r\n    if (WishlistManager.updateNote(refNo, note)) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.success(this.label('note_saved') || 'Note saved!');\r\n      }\r\n      this.closeModalById('rs-note-modal');\r\n    }\r\n  }\r\n\r\n  private deleteNote(): void {\r\n    const refNo = (this.element.querySelector('.rs-note-refno') as HTMLInputElement)?.value || '';\r\n\r\n    if (confirm(this.label('confirm_delete_note') || 'Delete this note?')) {\r\n      WishlistManager.updateNote(refNo, '');\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.success(this.label('note_deleted') || 'Note deleted');\r\n      }\r\n      this.closeModalById('rs-note-modal');\r\n    }\r\n  }\r\n\r\n  // Compare functionality\r\n  private openCompareModal(): void {\r\n    const count = WishlistManager.getCompareCount();\r\n\r\n    if (count < 2) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.warning(this.label('compare_min') || 'Select at least 2 properties to compare');\r\n      }\r\n      return;\r\n    }\r\n\r\n    const properties = WishlistManager.getCompareProperties();\r\n\r\n    this.renderComparePreview(properties);\r\n    this.renderCompareTable(properties);\r\n    this.openModalById('rs-compare-modal');\r\n  }\r\n\r\n  private renderComparePreview(properties: WishlistItem[]): void {\r\n    const grid = this.element.querySelector('.rs-compare-grid');\r\n    if (!grid) return;\r\n\r\n    const placeholderImg = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"256\" height=\"192\"%3E%3Crect fill=\"%23ecf0f1\" width=\"256\" height=\"192\"/%3E%3Ctext x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23bdc3c7\" font-family=\"sans-serif\" font-size=\"16\"%3ENo Image%3C/text%3E%3C/svg%3E';\r\n\r\n    grid.innerHTML = properties.map(p => {\r\n      const img = p.image || placeholderImg;\r\n      return `\r\n        <div class=\"rs-compare-card\">\r\n          <button type=\"button\" class=\"rs-compare-card__remove\" data-ref=\"${p.ref_no}\">&times;</button>\r\n          <img src=\"${img}\" alt=\"${this.escapeHtml(p.title)}\" onerror=\"this.src='${placeholderImg}'\">\r\n          <div class=\"rs-compare-card__info\">\r\n            <h4>${this.escapeHtml(p.title)}</h4>\r\n            <div class=\"rs-compare-card__price\">${this.formatPrice(p)}</div>\r\n            <div class=\"rs-compare-card__location\">${this.escapeHtml(p.location)}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    grid.querySelectorAll<HTMLButtonElement>('.rs-compare-card__remove').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        const refNo = btn.dataset.ref || '';\r\n        WishlistManager.removeFromCompare(refNo);\r\n\r\n        if (WishlistManager.getCompareCount() < 2) {\r\n          this.closeModalById('rs-compare-modal');\r\n        } else {\r\n          this.openCompareModal();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private renderCompareTable(properties: WishlistItem[]): void {\r\n    const thead = this.element.querySelector('.rs-compare-table thead tr');\r\n    const tbody = this.element.querySelector('.rs-compare-table tbody');\r\n    if (!thead || !tbody) return;\r\n\r\n    thead.innerHTML = `<th>${this.label('feature') || 'Feature'}</th>`;\r\n    tbody.innerHTML = '';\r\n\r\n    properties.forEach(p => {\r\n      const th = document.createElement('th');\r\n      th.textContent = p.title || 'Property';\r\n      thead.appendChild(th);\r\n    });\r\n\r\n    const rows = [\r\n      { label: this.label('price') || 'Price', getValue: (p: WishlistItem) => this.formatPrice(p) },\r\n      { label: this.label('location') || 'Location', getValue: (p: WishlistItem) => p.location || 'N/A' },\r\n      { label: this.label('type') || 'Type', getValue: (p: WishlistItem) => (p as unknown as Record<string, unknown>).type as string || 'N/A' },\r\n      { label: this.label('bedrooms') || 'Bedrooms', getValue: (p: WishlistItem) => String(p.beds || 0) },\r\n      { label: this.label('bathrooms') || 'Bathrooms', getValue: (p: WishlistItem) => String(p.baths || 0) },\r\n      { label: this.label('build_size') || 'Build Size', getValue: (p: WishlistItem) => `${p.built || 0}m\\u00B2` },\r\n      { label: this.label('plot_size') || 'Plot Size', getValue: (p: WishlistItem) => `${p.plot || 0}m\\u00B2` },\r\n      { label: this.label('status') || 'Status', getValue: (p: WishlistItem) => p.listing_type || 'N/A' },\r\n      { label: 'Ref', getValue: (p: WishlistItem) => p.ref_no || 'N/A' }\r\n    ];\r\n\r\n    rows.forEach(row => {\r\n      const tr = document.createElement('tr');\r\n      const labelTd = document.createElement('td');\r\n      labelTd.textContent = row.label;\r\n      tr.appendChild(labelTd);\r\n\r\n      const values = properties.map(p => row.getValue(p));\r\n      const allSame = values.every(v => v === values[0]);\r\n\r\n      properties.forEach((_p, i) => {\r\n        const td = document.createElement('td');\r\n        td.textContent = String(values[i]);\r\n        if (!allSame) td.classList.add('rs-compare-highlight');\r\n        tr.appendChild(td);\r\n      });\r\n\r\n      tbody.appendChild(tr);\r\n    });\r\n  }\r\n\r\n  private clearCompare(): void {\r\n    if (confirm(this.label('compare_confirm_clear') || 'Clear all selected properties?')) {\r\n      WishlistManager.clearCompare();\r\n      this.closeModalById('rs-compare-modal');\r\n    }\r\n  }\r\n\r\n  private formatPrice(property: WishlistItem | Record<string, unknown>): string {\r\n    const p = property as Record<string, unknown>;\r\n    const price1 = Number(p.list_price || p.price || 0);\r\n    const price2 = Number(p.list_price_2 || 0);\r\n\r\n    if (price2 && price1 !== price2) {\r\n      return `\\u20AC${price1.toLocaleString()} - \\u20AC${price2.toLocaleString()}`;\r\n    }\r\n    return `\\u20AC${price1.toLocaleString()}`;\r\n  }\r\n\r\n  // PDF functionality\r\n  private async downloadPDF(): Promise<void> {\r\n    const properties = WishlistManager.getAsArray();\r\n\r\n    if (properties.length === 0) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.error(this.label('wishlist_no_share') || 'No properties to export');\r\n      }\r\n      return;\r\n    }\r\n\r\n    const win = window as unknown as WindowWithJsPDF;\r\n\r\n    if (!win.jspdf) {\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.info('Loading PDF generator...');\r\n      }\r\n\r\n      try {\r\n        await this.loadJsPDF();\r\n      } catch (error) {\r\n        console.error('[Wishlist] Failed to load jsPDF:', error);\r\n        if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n          RealtySoftToast.error('Failed to load PDF library');\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n      RealtySoftToast.info(this.label('results_loading') || 'Generating PDF...');\r\n    }\r\n\r\n    try {\r\n      const { jsPDF } = win.jspdf!;\r\n      const pdf = new jsPDF({\r\n        orientation: 'portrait',\r\n        unit: 'mm',\r\n        format: 'a4'\r\n      }) as JsPDFInstance;\r\n\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const pageHeight = pdf.internal.pageSize.getHeight();\r\n      const margin = 15;\r\n      const contentWidth = pageWidth - (margin * 2);\r\n\r\n      const primaryColor = [0, 102, 204];\r\n      const textColor = [33, 37, 41];\r\n      const lightGray = [248, 249, 250];\r\n      const successColor = [5, 150, 105];\r\n\r\n      let yPos = 40;\r\n\r\n      // Title\r\n      pdf.setFontSize(28);\r\n      pdf.setTextColor(...primaryColor);\r\n      pdf.setFont(undefined, 'bold');\r\n      pdf.text('Property Wishlist', pageWidth / 2, yPos, { align: 'center' });\r\n\r\n      // Property count\r\n      yPos += 15;\r\n      pdf.setFontSize(14);\r\n      pdf.setTextColor(...textColor);\r\n      pdf.setFont(undefined, 'normal');\r\n      const countText = `${properties.length} ${properties.length === 1 ? 'Property' : 'Properties'} Saved`;\r\n      pdf.text(countText, pageWidth / 2, yPos, { align: 'center' });\r\n\r\n      // Date\r\n      yPos += 8;\r\n      pdf.setFontSize(11);\r\n      pdf.setTextColor(128, 128, 128);\r\n      const dateText = new Date().toLocaleDateString('en-US', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      });\r\n      pdf.text(dateText, pageWidth / 2, yPos, { align: 'center' });\r\n\r\n      // Footer on first page\r\n      pdf.setFontSize(9);\r\n      pdf.setTextColor(150, 150, 150);\r\n      pdf.text('Generated by RealtySoft', pageWidth / 2, pageHeight - 15, { align: 'center' });\r\n\r\n      // Property pages\r\n      for (let i = 0; i < properties.length; i++) {\r\n        const property = properties[i] as WishlistItem;\r\n\r\n        pdf.addPage();\r\n        yPos = margin;\r\n\r\n        // Page indicator\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(`Property ${i + 1} of ${properties.length}`, margin, yPos);\r\n\r\n        yPos += 8;\r\n\r\n        // Try to add property image\r\n        const firstImage = property.image;\r\n        if (firstImage && typeof firstImage === 'string' && firstImage.startsWith('http')) {\r\n          try {\r\n            const img = await this.loadImageForPDF(firstImage);\r\n            if (img) {\r\n              const imgWidth = contentWidth;\r\n              const targetHeight = 110;\r\n\r\n              const canvas = document.createElement('canvas');\r\n              const ctx = canvas.getContext('2d')!;\r\n\r\n              const imgAspect = img.width / img.height;\r\n              const targetAspect = imgWidth / targetHeight;\r\n\r\n              let sx = 0, sy = 0, sw = img.width, sh = img.height;\r\n\r\n              if (imgAspect > targetAspect) {\r\n                sw = img.height * targetAspect;\r\n                sx = (img.width - sw) / 2;\r\n              } else {\r\n                sh = img.width / targetAspect;\r\n                sy = (img.height - sh) / 2;\r\n              }\r\n\r\n              canvas.width = 800;\r\n              canvas.height = (800 / imgWidth) * targetHeight;\r\n\r\n              ctx.drawImage(img, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);\r\n\r\n              pdf.addImage(canvas.toDataURL('image/jpeg', 0.85), 'JPEG', margin, yPos, imgWidth, targetHeight);\r\n              yPos += targetHeight + 8;\r\n            }\r\n          } catch (imgError) {\r\n            console.log('[PDF] Could not load image:', (imgError as Error).message);\r\n          }\r\n        }\r\n\r\n        // Property title\r\n        pdf.setFontSize(18);\r\n        pdf.setTextColor(...textColor);\r\n        pdf.setFont(undefined, 'bold');\r\n        const titleLines = pdf.splitTextToSize(property.title || 'Property', contentWidth);\r\n        pdf.text(titleLines, margin, yPos);\r\n        yPos += titleLines.length * 7 + 3;\r\n\r\n        // Reference\r\n        pdf.setFontSize(10);\r\n        pdf.setTextColor(128, 128, 128);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(`Ref: ${property.ref_no || ''}`, margin, yPos);\r\n\r\n        yPos += 12;\r\n\r\n        // Price\r\n        pdf.setFontSize(16);\r\n        pdf.setTextColor(...successColor);\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text(this.formatPrice(property), margin, yPos);\r\n\r\n        yPos += 12;\r\n\r\n        // Details box\r\n        pdf.setFillColor(...lightGray);\r\n        pdf.rect(margin, yPos, contentWidth, 42, 'F');\r\n\r\n        yPos += 8;\r\n        pdf.setFontSize(10);\r\n        pdf.setTextColor(...textColor);\r\n\r\n        // Location\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Location:', margin + 5, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(property.location || 'N/A', margin + 28, yPos);\r\n        yPos += 6;\r\n\r\n        // Type\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Type:', margin + 5, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text((property as unknown as Record<string, unknown>).type as string || 'N/A', margin + 28, yPos);\r\n        yPos += 6;\r\n\r\n        // Beds & Baths\r\n        const beds = property.beds || 0;\r\n        const baths = property.baths || 0;\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Bedrooms:', margin + 5, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(`${beds}`, margin + 28, yPos);\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Bathrooms:', margin + 60, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(`${baths}`, margin + 85, yPos);\r\n        yPos += 6;\r\n\r\n        // Build & Plot size\r\n        const buildSize = `${property.built || 0}m\\u00B2`;\r\n        const plotSize = `${property.plot || 0}m\\u00B2`;\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Build Size:', margin + 5, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(buildSize, margin + 28, yPos);\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Plot Size:', margin + 60, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        pdf.text(plotSize, margin + 85, yPos);\r\n        yPos += 6;\r\n\r\n        // Status\r\n        pdf.setFont(undefined, 'bold');\r\n        pdf.text('Status:', margin + 5, yPos);\r\n        pdf.setFont(undefined, 'normal');\r\n        const ltLabelMap: Record<string, string> = {\r\n          resale: 'listing_type_sale', sale: 'listing_type_sale',\r\n          development: 'listing_type_new', new_development: 'listing_type_new',\r\n          long_rental: 'listing_type_long_rental', rent: 'listing_type_long_rental',\r\n          short_rental: 'listing_type_short_rental', holiday: 'listing_type_short_rental'\r\n        };\r\n        const ltKey = (property.listing_type || '').toLowerCase();\r\n        const ltLabel = ltLabelMap[ltKey] ? this.label(ltLabelMap[ltKey]) : (property.listing_type || this.label('listing_type_sale'));\r\n        pdf.text(ltLabel, margin + 28, yPos);\r\n\r\n        yPos += 15;\r\n\r\n        // Added date\r\n        if (property.addedAt) {\r\n          pdf.setFontSize(9);\r\n          pdf.setTextColor(128, 128, 128);\r\n          const addedDate = new Date(property.addedAt).toLocaleDateString();\r\n          pdf.text(`Added to wishlist: ${addedDate}`, margin, yPos);\r\n          yPos += 8;\r\n        }\r\n\r\n        // Note\r\n        if (property.note) {\r\n          yPos += 5;\r\n          pdf.setFontSize(10);\r\n          pdf.setTextColor(...textColor);\r\n          pdf.setFont(undefined, 'bold');\r\n          pdf.text('Your Note:', margin, yPos);\r\n          yPos += 6;\r\n\r\n          pdf.setFont(undefined, 'normal');\r\n          pdf.setFontSize(9);\r\n          const noteLines = pdf.splitTextToSize(property.note, contentWidth);\r\n          pdf.text(noteLines, margin, yPos);\r\n        }\r\n\r\n        // Page footer\r\n        pdf.setFontSize(8);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(`Page ${i + 2} of ${properties.length + 1}`, pageWidth / 2, pageHeight - 10, { align: 'center' });\r\n      }\r\n\r\n      // Save PDF\r\n      const filename = `Wishlist_${new Date().toISOString().split('T')[0]}.pdf`;\r\n      pdf.save(filename);\r\n\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.success((this.label('wishlist_pdf') || 'PDF') + ' downloaded!');\r\n      }\r\n\r\n      properties.forEach(p => {\r\n        RealtySoftAnalytics.track('wishlist', 'pdf', { property_id: (p as WishlistItem).ref_no });\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[Wishlist] PDF generation error:', error);\r\n      if (typeof RealtySoftToast !== 'undefined' && RealtySoftToast) {\r\n        RealtySoftToast.error('Failed to generate PDF');\r\n      }\r\n    }\r\n  }\r\n\r\n  private loadJsPDF(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const win = window as unknown as WindowWithJsPDF;\r\n      if (win.jspdf) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement('script');\r\n      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';\r\n      script.onload = () => resolve();\r\n      script.onerror = () => reject(new Error('Failed to load jsPDF'));\r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n\r\n  private loadImageForPDF(src: string): Promise<HTMLImageElement | null> {\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n\r\n      const timeout = setTimeout(() => {\r\n        reject(new Error('Image load timeout'));\r\n      }, 5000);\r\n\r\n      img.onload = () => {\r\n        clearTimeout(timeout);\r\n        resolve(img);\r\n      };\r\n\r\n      img.onerror = () => {\r\n        clearTimeout(timeout);\r\n        reject(new Error('Image load failed'));\r\n      };\r\n\r\n      img.src = src;\r\n    });\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_modals', RSWishlistModals as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistModals };\r\nexport default RSWishlistModals;\r\n","/**\r\n * RealtySoft Widget v3 - Wishlist List Component (Combined)\r\n * Full wishlist page - backward compatible combined component\r\n * Uses modular sub-components internally\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule\r\n} from '../../types/index';\r\nimport { WishlistManager } from '../../core/wishlist-manager';\r\nimport { RSWishlistSharedBanner } from './wishlist-shared-banner';\r\nimport { RSWishlistHeader } from './wishlist-header';\r\nimport { RSWishlistActions } from './wishlist-actions';\r\nimport { RSWishlistSort } from './wishlist-sort';\r\nimport { RSWishlistEmpty } from './wishlist-empty';\r\nimport { RSWishlistGrid } from './wishlist-grid';\r\nimport { RSWishlistCompareBtn } from './wishlist-compare-btn';\r\nimport { RSWishlistModals } from './wishlist-modals';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\n\r\n// Extended HTMLElement with component reference\r\ninterface RSHTMLElement extends HTMLElement {\r\n  _rsComponent?: RSBaseComponent;\r\n}\r\n\r\n// Sub-component mapping\r\ninterface ComponentMapping {\r\n  selector: string;\r\n  Component: new (el: HTMLElement, opts: ComponentOptions) => RSBaseComponent;\r\n}\r\n\r\nclass RSWishlistList extends RSBaseComponent {\r\n  private isSharedView: boolean = false;\r\n  private sharedRefNos: string[] = [];\r\n  private subComponents: RSBaseComponent[] = [];\r\n  private loader: HTMLElement | null = null;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.isSharedView = WishlistManager.isSharedView();\r\n    this.sharedRefNos = this.isSharedView ? (WishlistManager.loadSharedWishlist() || []) : [];\r\n    this.subComponents = [];\r\n\r\n    this.renderStructure();\r\n    this.initSubComponents();\r\n  }\r\n\r\n  /**\r\n   * render() is called by the controller on language change.\r\n   * We check if DOM is already built to avoid destroying sub-components.\r\n   */\r\n  render(): void {\r\n    // If DOM is already rendered (has sub-component containers), just update loader text\r\n    const hasRendered = this.element.querySelector('.rs-wishlist-list__loader');\r\n    if (hasRendered) {\r\n      const loaderText = this.element.querySelector('.rs-wishlist-list__loader p');\r\n      if (loaderText) {\r\n        loaderText.textContent = this.label('results_loading') || 'Loading...';\r\n      }\r\n      return;\r\n    }\r\n\r\n    // If not rendered yet, do initial render\r\n    this.renderStructure();\r\n    this.initSubComponents();\r\n  }\r\n\r\n  /**\r\n   * Initial render that creates the DOM structure (only called once in init)\r\n   */\r\n  private renderStructure(): void {\r\n    this.element.classList.add('rs-wishlist-list');\r\n\r\n    // Create container structure that positions all sub-components\r\n    this.element.innerHTML = `\r\n      <!-- Shared Banner -->\r\n      <div class=\"rs_wishlist_shared_banner\"></div>\r\n\r\n      <!-- Header -->\r\n      <div class=\"rs-wishlist-list__header\">\r\n        <div class=\"rs-wishlist-list__header-left\">\r\n          <div class=\"rs_wishlist_header\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Actions Bar -->\r\n      <div class=\"rs-wishlist-actions-wrapper\">\r\n        <div class=\"rs_wishlist_actions\"></div>\r\n        <div class=\"rs_wishlist_sort\"></div>\r\n      </div>\r\n\r\n      <!-- Loading State -->\r\n      <div class=\"rs-wishlist-list__loader\">\r\n        <div class=\"rs-wishlist-list__spinner\"></div>\r\n        <p>${this.label('results_loading') || 'Loading...'}</p>\r\n      </div>\r\n\r\n      <!-- Empty State -->\r\n      <div class=\"rs_wishlist_empty\"></div>\r\n\r\n      <!-- Property Grid -->\r\n      <div class=\"rs_wishlist_grid\"></div>\r\n\r\n      <!-- Floating Compare Button -->\r\n      <div class=\"rs_wishlist_compare_btn\"></div>\r\n\r\n      <!-- Modals -->\r\n      <div class=\"rs_wishlist_modals\"></div>\r\n    `;\r\n\r\n    // Cache DOM references\r\n    this.loader = this.element.querySelector('.rs-wishlist-list__loader');\r\n\r\n    // Listen for wishlist changes to toggle loader\r\n    window.addEventListener(WishlistManager.EVENTS.CHANGED, () => {\r\n      this.hideLoader();\r\n    });\r\n\r\n    // Hide loader after short delay to let sub-components initialize\r\n    setTimeout(() => this.hideLoader(), 100);\r\n  }\r\n\r\n  private initSubComponents(): void {\r\n    // Initialize each sub-component within this combined view\r\n    const componentMappings: ComponentMapping[] = [\r\n      { selector: '.rs_wishlist_shared_banner', Component: RSWishlistSharedBanner },\r\n      { selector: '.rs_wishlist_header', Component: RSWishlistHeader },\r\n      { selector: '.rs_wishlist_actions', Component: RSWishlistActions },\r\n      { selector: '.rs_wishlist_sort', Component: RSWishlistSort },\r\n      { selector: '.rs_wishlist_empty', Component: RSWishlistEmpty },\r\n      { selector: '.rs_wishlist_grid', Component: RSWishlistGrid },\r\n      { selector: '.rs_wishlist_compare_btn', Component: RSWishlistCompareBtn },\r\n      { selector: '.rs_wishlist_modals', Component: RSWishlistModals }\r\n    ];\r\n\r\n    componentMappings.forEach(({ selector, Component }) => {\r\n      const el = this.element.querySelector<RSHTMLElement>(selector);\r\n      if (el && typeof Component !== 'undefined') {\r\n        try {\r\n          const instance = new Component(el, this.options);\r\n          this.subComponents.push(instance);\r\n          el._rsComponent = instance;\r\n        } catch (error) {\r\n          console.warn(`[Wishlist] Failed to initialize ${selector}:`, error);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private hideLoader(): void {\r\n    if (this.loader) {\r\n      this.loader.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private showLoader(): void {\r\n    if (this.loader) {\r\n      this.loader.style.display = 'flex';\r\n    }\r\n  }\r\n\r\n  bindEvents(): void {\r\n    // Events are handled by sub-components\r\n  }\r\n\r\n  // Public API for backward compatibility\r\n  getProperties(): unknown[] {\r\n    const gridEl = this.element.querySelector<RSHTMLElement>('.rs_wishlist_grid');\r\n    const gridComponent = gridEl?._rsComponent as RSWishlistGrid | undefined;\r\n    return gridComponent ? gridComponent.getProperties() : [];\r\n  }\r\n\r\n  openShareModal(): void {\r\n    WishlistManager.openModal('share');\r\n  }\r\n\r\n  openEmailModal(): void {\r\n    WishlistManager.openModal('email');\r\n  }\r\n\r\n  openNoteModal(refNo: string): void {\r\n    WishlistManager.openModal('note', { refNo });\r\n  }\r\n\r\n  openCompareModal(): void {\r\n    WishlistManager.openModal('compare');\r\n  }\r\n\r\n  downloadPDF(): void {\r\n    WishlistManager.openModal('pdf');\r\n  }\r\n\r\n  destroy(): void {\r\n    // Destroy all sub-components\r\n    this.subComponents.forEach(component => {\r\n      if (component && typeof component.destroy === 'function') {\r\n        component.destroy();\r\n      }\r\n    });\r\n    this.subComponents = [];\r\n\r\n    super.destroy();\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_wishlist_list', RSWishlistList as unknown as ComponentConstructor);\r\n\r\nexport { RSWishlistList };\r\nexport default RSWishlistList;\r\n","/**\r\n * RealtySoft Widget v3 - Language Selector Component\r\n * Language switch dropdown\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftLabelsModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftLabels: RealtySoftLabelsModule;\r\n\r\ninterface LanguageOption {\r\n  code: string;\r\n  label: string;\r\n  flag: string;\r\n}\r\n\r\nclass RSLanguageSelector extends RSBaseComponent {\r\n  private currentLanguage: string = 'en_US';\r\n  private languages: LanguageOption[] = [];\r\n  private trigger: HTMLButtonElement | null = null;\r\n  private dropdown: HTMLElement | null = null;\r\n  private isOpen: boolean = false;\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.init();\r\n  }\r\n\r\n  // Master list of all known languages with display info\r\n  private static readonly KNOWN_LANGUAGES: LanguageOption[] = [\r\n    { code: 'en_US', label: 'English', flag: '\\uD83C\\uDDEC\\uD83C\\uDDE7' },\r\n    { code: 'es_ES', label: 'Espa\\u00f1ol', flag: '\\uD83C\\uDDEA\\uD83C\\uDDF8' },\r\n    { code: 'de_DE', label: 'Deutsch', flag: '\\uD83C\\uDDE9\\uD83C\\uDDEA' },\r\n    { code: 'fr_FR', label: 'Fran\\u00e7ais', flag: '\\uD83C\\uDDEB\\uD83C\\uDDF7' },\r\n    { code: 'it_IT', label: 'Italiano', flag: '\\uD83C\\uDDEE\\uD83C\\uDDF9' },\r\n    { code: 'pt_PT', label: 'Portugu\\u00eas', flag: '\\uD83C\\uDDF5\\uD83C\\uDDF9' },\r\n    { code: 'nl_NL', label: 'Nederlands', flag: '\\uD83C\\uDDF3\\uD83C\\uDDF1' },\r\n    { code: 'pl_PL', label: 'Polski', flag: '\\uD83C\\uDDF5\\uD83C\\uDDF1' },\r\n    { code: 'ru_RU', label: '\\u0420\\u0443\\u0441\\u0441\\u043a\\u0438\\u0439', flag: '\\uD83C\\uDDF7\\uD83C\\uDDFA' },\r\n    { code: 'sv_SE', label: 'Svenska', flag: '\\uD83C\\uDDF8\\uD83C\\uDDEA' },\r\n    { code: 'no_NO', label: 'Norsk', flag: '\\uD83C\\uDDF3\\uD83C\\uDDF4' },\r\n    { code: 'da_DK', label: 'Dansk', flag: '\\uD83C\\uDDE9\\uD83C\\uDDF0' },\r\n    { code: 'fi_FI', label: 'Suomi', flag: '\\uD83C\\uDDEB\\uD83C\\uDDEE' },\r\n  ];\r\n\r\n  init(): void {\r\n    this.currentLanguage = RealtySoftLabels.getLanguage();\r\n\r\n    // Priority 1: data-languages attribute on element (explicit override)\r\n    const availableLangsAttr = this.element.dataset.languages;\r\n    if (availableLangsAttr) {\r\n      const codes = availableLangsAttr.split(',').map(c => c.trim());\r\n      this.languages = RSLanguageSelector.KNOWN_LANGUAGES.filter(l => codes.includes(l.code));\r\n    } else {\r\n      // Priority 2: Auto-populate from API (stored in state by controller)\r\n      const apiLanguages = RealtySoft.State.get('data.availableLanguages') as string[] | null;\r\n      if (apiLanguages && apiLanguages.length > 1) {\r\n        this.languages = RSLanguageSelector.KNOWN_LANGUAGES.filter(l => apiLanguages.includes(l.code));\r\n      } else {\r\n        // Fallback: show all known languages\r\n        this.languages = [...RSLanguageSelector.KNOWN_LANGUAGES];\r\n      }\r\n    }\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-language-selector');\r\n\r\n    const current = this.languages.find(l => l.code === this.currentLanguage) || this.languages[0];\r\n\r\n    this.element.innerHTML = `\r\n      <div class=\"rs-language-selector__wrapper\">\r\n        <button type=\"button\" class=\"rs-language-selector__trigger\">\r\n          <span class=\"rs-language-selector__flag\">${current.flag}</span>\r\n          <span class=\"rs-language-selector__label\">${current.label}</span>\r\n          <svg class=\"rs-language-selector__arrow\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"6 9 12 15 18 9\"></polyline>\r\n          </svg>\r\n        </button>\r\n        <div class=\"rs-language-selector__dropdown\" style=\"display: none;\">\r\n          ${this.languages.map(lang => `\r\n            <button type=\"button\"\r\n                    class=\"rs-language-selector__option ${lang.code === this.currentLanguage ? 'rs-language-selector__option--active' : ''}\"\r\n                    data-code=\"${lang.code}\">\r\n              <span class=\"rs-language-selector__flag\">${lang.flag}</span>\r\n              <span class=\"rs-language-selector__label\">${lang.label}</span>\r\n            </button>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.trigger = this.element.querySelector('.rs-language-selector__trigger');\r\n    this.dropdown = this.element.querySelector('.rs-language-selector__dropdown');\r\n    this.isOpen = false;\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.trigger?.addEventListener('click', () => this.toggleDropdown());\r\n\r\n    this.element.querySelectorAll<HTMLButtonElement>('.rs-language-selector__option').forEach(option => {\r\n      option.addEventListener('click', () => {\r\n        this.selectLanguage(option.dataset.code || '');\r\n      });\r\n    });\r\n\r\n    document.addEventListener('click', (e: MouseEvent) => {\r\n      if (!this.element.contains(e.target as Node)) {\r\n        this.closeDropdown();\r\n      }\r\n    });\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    if (this.isOpen) {\r\n      this.closeDropdown();\r\n    } else {\r\n      this.openDropdown();\r\n    }\r\n  }\r\n\r\n  private openDropdown(): void {\r\n    this.isOpen = true;\r\n    if (this.dropdown) this.dropdown.style.display = 'block';\r\n    this.trigger?.classList.add('rs-language-selector__trigger--open');\r\n  }\r\n\r\n  private closeDropdown(): void {\r\n    this.isOpen = false;\r\n    if (this.dropdown) this.dropdown.style.display = 'none';\r\n    this.trigger?.classList.remove('rs-language-selector__trigger--open');\r\n  }\r\n\r\n  private async selectLanguage(code: string): Promise<void> {\r\n    if (code === this.currentLanguage) {\r\n      this.closeDropdown();\r\n      return;\r\n    }\r\n\r\n    this.currentLanguage = code;\r\n\r\n    // Store preference in localStorage\r\n    try {\r\n      localStorage.setItem('rs_language', code);\r\n    } catch (_e) {\r\n      // Ignore storage errors\r\n    }\r\n\r\n    // Close dropdown before language change\r\n    this.closeDropdown();\r\n\r\n    // Show loading state\r\n    this.trigger?.classList.add('rs-language-selector--loading');\r\n\r\n    try {\r\n      // Use controller's setLanguage to reload labels and re-render components\r\n      await RealtySoft.setLanguage(code);\r\n\r\n      // Re-render this component with new language\r\n      this.render();\r\n      this.bindEvents();\r\n\r\n      console.log('[RealtySoft Language Selector] Language changed to:', code);\r\n    } catch (error) {\r\n      console.error('[RealtySoft Language Selector] Error changing language:', error);\r\n      // Fallback: reload page\r\n      const url = new URL(window.location.href);\r\n      url.searchParams.set('lang', code);\r\n      window.location.href = url.toString();\r\n    } finally {\r\n      this.trigger?.classList.remove('rs-language-selector--loading');\r\n    }\r\n  }\r\n}\r\n\r\n// Register component\r\nRealtySoft.registerComponent('rs_language_selector', RSLanguageSelector as unknown as ComponentConstructor);\r\n\r\nexport { RSLanguageSelector };\r\nexport default RSLanguageSelector;\r\n","/**\r\n * RealtySoft Widget v3 - Individual Share Button Components\r\n * Standalone share buttons for flexibility\r\n */\r\n\r\nimport { RSBaseComponent } from '../base';\r\nimport type {\r\n  ComponentOptions,\r\n  ComponentConstructor,\r\n  RealtySoftModule,\r\n  RealtySoftAnalyticsModule\r\n} from '../../types/index';\r\n\r\n// Declare globals\r\ndeclare const RealtySoft: RealtySoftModule;\r\ndeclare const RealtySoftAnalytics: RealtySoftAnalyticsModule;\r\n\r\n// Base share button class\r\nclass RSShareButton extends RSBaseComponent {\r\n  protected platform: string;\r\n  protected url: string = '';\r\n  protected title: string = '';\r\n  protected propertyId: string = '';\r\n\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, options);\r\n    this.platform = (options as Record<string, unknown>).platform as string || 'generic';\r\n    this.init();\r\n  }\r\n\r\n  init(): void {\r\n    this.url = this.element.dataset.url || window.location.href;\r\n    this.title = this.element.dataset.title || document.title;\r\n    this.propertyId = this.element.dataset.propertyId || '';\r\n\r\n    this.render();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render(): void {\r\n    this.element.classList.add('rs-share-btn', `rs-share-btn--${this.platform}`);\r\n  }\r\n\r\n  bindEvents(): void {\r\n    this.element.addEventListener('click', (e: Event) => {\r\n      e.preventDefault();\r\n      this.share();\r\n    });\r\n  }\r\n\r\n  protected share(): void {\r\n    // Override in subclass\r\n  }\r\n\r\n  protected trackShare(): void {\r\n    if (this.propertyId) {\r\n      RealtySoftAnalytics.trackShare(this.platform, parseInt(this.propertyId));\r\n    }\r\n  }\r\n\r\n  protected openWindow(url: string): void {\r\n    window.open(url, '_blank', 'width=600,height=400,scrollbars=yes');\r\n  }\r\n}\r\n\r\n// WhatsApp\r\nclass RSShareWhatsApp extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'whatsapp' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected share(): void {\r\n    const text = encodeURIComponent(`${this.title} ${this.url}`);\r\n    this.openWindow(`https://wa.me/?text=${text}`);\r\n    this.trackShare();\r\n  }\r\n}\r\n\r\n// Facebook\r\nclass RSShareFacebook extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'facebook' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"/>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected share(): void {\r\n    const url = encodeURIComponent(this.url);\r\n    this.openWindow(`https://www.facebook.com/sharer/sharer.php?u=${url}`);\r\n    this.trackShare();\r\n  }\r\n}\r\n\r\n// Twitter/X\r\nclass RSShareTwitter extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'twitter' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected share(): void {\r\n    const text = encodeURIComponent(this.title);\r\n    const url = encodeURIComponent(this.url);\r\n    this.openWindow(`https://twitter.com/intent/tweet?text=${text}&url=${url}`);\r\n    this.trackShare();\r\n  }\r\n}\r\n\r\n// LinkedIn\r\nclass RSShareLinkedIn extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'linkedin' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"/>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected share(): void {\r\n    const url = encodeURIComponent(this.url);\r\n    this.openWindow(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`);\r\n    this.trackShare();\r\n  }\r\n}\r\n\r\n// Email\r\nclass RSShareEmail extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'email' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path>\r\n          <polyline points=\"22,6 12,13 2,6\"></polyline>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected share(): void {\r\n    const subject = encodeURIComponent(this.title);\r\n    const body = encodeURIComponent(`Check out: ${this.url}`);\r\n    window.location.href = `mailto:?subject=${subject}&body=${body}`;\r\n    this.trackShare();\r\n  }\r\n}\r\n\r\n// Copy Link\r\nclass RSShareCopy extends RSShareButton {\r\n  constructor(element: HTMLElement, options: ComponentOptions = {}) {\r\n    super(element, { ...options, platform: 'copy' } as ComponentOptions);\r\n  }\r\n\r\n  render(): void {\r\n    super.render();\r\n    if (!this.element.innerHTML.trim()) {\r\n      this.element.innerHTML = `\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\r\n          <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\r\n        </svg>\r\n      `;\r\n    }\r\n  }\r\n\r\n  protected async share(): Promise<void> {\r\n    try {\r\n      await navigator.clipboard.writeText(this.url);\r\n      this.showFeedback('Copied!');\r\n    } catch (_err) {\r\n      // Fallback\r\n      const textarea = document.createElement('textarea');\r\n      textarea.value = this.url;\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(textarea);\r\n      this.showFeedback('Copied!');\r\n    }\r\n    this.trackShare();\r\n  }\r\n\r\n  private showFeedback(message: string): void {\r\n    this.element.classList.add('rs-share-btn--copied');\r\n    const originalContent = this.element.innerHTML;\r\n    this.element.innerHTML = `<span>${message}</span>`;\r\n\r\n    setTimeout(() => {\r\n      this.element.innerHTML = originalContent;\r\n      this.element.classList.remove('rs-share-btn--copied');\r\n    }, 2000);\r\n  }\r\n}\r\n\r\n// Register all share components\r\nRealtySoft.registerComponent('rs_share_whatsapp', RSShareWhatsApp as unknown as ComponentConstructor);\r\nRealtySoft.registerComponent('rs_share_facebook', RSShareFacebook as unknown as ComponentConstructor);\r\nRealtySoft.registerComponent('rs_share_twitter', RSShareTwitter as unknown as ComponentConstructor);\r\nRealtySoft.registerComponent('rs_share_linkedin', RSShareLinkedIn as unknown as ComponentConstructor);\r\nRealtySoft.registerComponent('rs_share_email', RSShareEmail as unknown as ComponentConstructor);\r\nRealtySoft.registerComponent('rs_share_copy', RSShareCopy as unknown as ComponentConstructor);\r\n\r\nexport {\r\n  RSShareButton,\r\n  RSShareWhatsApp,\r\n  RSShareFacebook,\r\n  RSShareTwitter,\r\n  RSShareLinkedIn,\r\n  RSShareEmail,\r\n  RSShareCopy\r\n};\r\n","/**\r\n * RealtySoft Widget v3.0.0\r\n * Main entry point for Vite IIFE build (monolithic)\r\n *\r\n * This file imports all modules and sets up global variables\r\n * for backwards compatibility with existing integrations.\r\n */\r\n\r\n// Import styles\r\nimport './styles/realtysoft.css';\r\nimport './styles/map-search.css';\r\n\r\n// Import core modules (order matters - dependencies first)\r\n// Named imports ensure Rollup keeps these variables in the IIFE scope,\r\n// so components can reference them via `declare const` (global-like access).\r\nimport { RealtySoftState } from './core/state';\r\nimport { RealtySoftAPI } from './core/api';\r\nimport { RealtySoftLabels } from './core/labels';\r\nimport { RealtySoftAnalytics } from './core/analytics';\r\nimport { RealtySoftToast } from './core/toast';\r\nimport { WishlistManager } from './core/wishlist-manager';\r\n\r\n// Import controller (main coordination module)\r\nimport { RealtySoft } from './core/controller';\r\n\r\n// Import SPA router\r\nimport { RealtySoftRouter } from './core/router';\r\n\r\n// Import base component\r\nimport { RSBaseComponent } from './components/base';\r\n\r\n// Import all component groups via barrel files (eager, monolithic)\r\nimport './components/search/index';\r\nimport './components/listing/index';\r\nimport './components/detail/index';\r\nimport './components/utility/index';\r\n\r\n// Prevent tree-shaking of modules referenced by components via `declare const`.\r\n// Without these references, Rollup may remove modules not directly used here.\r\nvoid RealtySoftState;\r\nvoid RealtySoftAPI;\r\nvoid RealtySoftLabels;\r\nvoid RealtySoftAnalytics;\r\nvoid RealtySoftToast;\r\nvoid WishlistManager;\r\nvoid RealtySoftRouter;\r\nvoid RSBaseComponent;\r\n\r\n// Default export only â€” prevents the IIFE wrapper from overriding\r\n// window.RealtySoft (which the controller sets to the correct object).\r\n// Named exports would cause Rollup to create an exports object as the\r\n// IIFE return value, overwriting window.RealtySoft with { RealtySoft, ... }.\r\n// Sub-modules are accessible via RealtySoft.State, RealtySoft.API, etc.\r\nexport default RealtySoft;\r\n\r\n// Version info\r\nconsole.log('[RealtySoft] Widget v3.0.0 loaded (Vite build)');\r\n"],"names":["RealtySoftState","state","subscribers","getState","get","path","keys","value","key","set","current","i","lastKey","oldValue","notify","setMultiple","updates","subscribe","callback","index","newValue","cb","parts","parentPath","resetFilters","defaults","locked","defaultValue","lockedValue","setLockedFilters","isFilterLocked","filterName","getSearchParams","f","params","addToWishlist","propertyId","saveWishlist","removeFromWishlist","isInWishlist","loadWishlist","stored","LRUCache","capacity","__publicField","node","existing","evicted","RealtySoftAPI","DEFAULT_CACHE_TTL","cacheConfig","memoryCache","resolveTTL","category","userValue","CacheManager","ttl","fullKey","memEntry","cached","data","timestamp","e","k","hashString","str","hash","char","pendingRequests","config","languageAliases","getApiLanguage","lang","init","options","maxEntries","request","endpoint","method","requestKey","url","requestParams","fetchOptions","requestPromise","response","error","getLocations","parentId","cacheKey","seen","uniqueData","loc","result","getParentLocations","getChildLocations","searchLocations","term","getRelevantLocations","locationId","getPropertyTypes","getFeatures","getLabels","prefetch","prefetched","getAllLabels","getTranslatedField","property","fieldName","fallbackFields","langCode","langField","translations","fullLangField","allFields","field","normalizeProperty","propRecord","images","imagesFull","imagesWithSizes","img","src","getTranslatedName","obj","langName","locationName","typeName","listingType","_a","features","rawFeatures","fRecord","translatedName","name","translatedCategory","rawAgent","agent","toBoolean","val","title","description","shortDescription","_b","_c","_d","_e","_f","_g","normalizeProperties","p","searchProperties","normalizedResult","cacheProperty","refKey","getCachedProperty","idOrRef","isRef","fetchAndCacheProperty","requestedRef","prefetchRef","prefetchedData","propData","actualRef","getProperty","id","getPropertyByRef","ref","prefetchProperty","getRelatedProperties","limit","submitInquiry","errorMsg","getWishlistProperties","ids","clearPropertyCache","prefixes","keysToRemove","prefix","memoryKeysToRemove","_","RealtySoftLabels","languageDefaults","labels","currentLanguage","languageMap","mapLanguageCode","code","converted","shortCode","isValidLanguageCode","getGTranslateLanguage","cookies","cookie","match","detectSubdomainLanguage","detectUrlLanguage","detectPlatformLanguage","weglotLang","gtranslateLang","locale","subdomainLang","urlLang","langParam","detectLanguage","platformLang","htmlLang","shortLang","language","initStatic","langDefaults","loadFromAPI","apiLabels","langDefaultCount","labelCount","isPerLanguageFormat","overrides","applyOverrides","appliedCount","defaultOverrides","langOverrides","flatOverrides","overrideCount","reloadForLanguage","newLanguage","replacements","label","placeholder","getAll","getLanguage","setLanguage","formatPrice","price","currency","formatNumber","number","formatArea","RealtySoftAnalytics","detectEndpoint","scripts","pmIdx","eventQueue","batchTimer","flush","track","action","event","getSessionId","scheduleBatch","events","err","sessionId","trackSearch","filters","trackPropertyView","trackCardClick","trackGalleryView","imageIndex","trackWishlistAdd","trackWishlistRemove","trackWishlistView","propertyIds","trackWishlistShare","trackInquiry","propertyRef","trackShare","platform","trackLinkClick","linkType","trackFilterChange","trackPagination","page","totalPages","trackSortChange","sortValue","trackViewToggle","view","trackResourceClick","resourceType","RealtySoftToast","container","toasts","toastIdCounter","defaultOptions","setPosition","position","show","message","type","opts","toast","icon","getIcon","escapeHtml","progressBar","closeBtn","dismiss","timeoutId","remainingTime","startTime","toastData","t","dismissAll","success","warning","info","icons","text","div","WishlistManager","STORAGE_KEY","EVENTS","compareSelected","maxCompare","currentSort","save","wishlist","has","refNo","add","firstImage","imageCount","item","notifyChange","remove","toggle","count","updateNote","note","clear","getAsArray","sortBy","sortOrder","items","a","b","aItem","bItem","aVal","bVal","aCompare","bCompare","getRefNos","generateShareLink","refNos","encoded","loadSharedWishlist","shared","r","exportAsJSON","dataStr","dataBlob","link","getCompareSelected","setCompareSelected","newSet","notifyCompareChange","addToCompare","removeFromCompare","toggleCompare","isInCompare","clearCompare","getCompareCount","getMaxCompare","getCompareProperties","setSort","order","getSort","openModal","modalType","closeModal","isSharedView","getEvents","syncWithState","SS_SCROLL","SS_LISTING_URL","RealtySoftRouter","_initialized","_enabled","_hiddenContainers","_onPopState","_detectListingContainers","isEnabled","navigateToProperty","navigateToListing","el","listingUrl","_getStoredListingUrl","storedScroll","_getStoredScroll","canGoBackToListing","selectors","found","sel","RealtySoft","overlay","slug","hasSubpath","hasQueryRef","style","components","componentInstances","initialized","initPromise","transformAPILabels","rawData","raw","codeMap","statusMap","pairs","pair","typeKey","typeLabel","sortMap","sortKey","sortLabel","widgetKeys","wk","extractAvailableLanguages","langCodes","samplSize","parseLockedFilters","attrMap","numericKeys","attr","datasetKey","g","v","detectMode","hasSearch","hasListing","allListings","getResultsPageURL","globalConfig","buildSearchURL","baseURL","queryString","parseURLFilters","urlParams","featuresStr","widgetMode","TEMPLATES","isInHeaderFooter","tag","className","isInMainContent","findBestElement","elements","renderTemplates","templateClass","templateHTML","bestElement","templateNum","propertyGrid","initTemplate02MoreFilters","initTemplate03Tabs","wrapper","btn","dropdown","openDropdown","closeDropdown","tabs","tab","activeTab","showLoadingSkeletons","searchContainer","listingContainer","wishlistContainer","searchSkeleton","listingSkeleton","wishlistSkeleton","hideLoadingSkeletons","registerServiceWorker","customUrl","swUrl","registration","initPlatformLanguageSync","newLang","mappedLang","currentLang","mutations","mutation","detectedLang","storedLanguage","extractPropertyRefFromUrl","isDetailPage","defaultPerPage","defaultMapPerPage","labelsMode","allLabelsPromise","apiPromises","labelsData","results","resultOffset","locations","propertyTypes","allLabelsData","availableLanguages","allLocked","listingLocked","searchLocked","dataError","initializeComponents","search","initStandaloneListings","getWidgetContainers","containerSelectors","containers","selector","GLOBAL_UTILITY_COMPONENTS","allComponentNames","globalComponents","containerComponents","globalSelectors","element","variation","instance","rsContainer","registerComponent","Component","getComponent","searchURL","resultsAny","properties","total","paramsAny","perPage","featuredOnly","ownOnly","ownFirst","aOwn","gridEl","grid","cacheOgData","headers","loadProperty","loadPropertyByRef","reset","goToPage","sort","setView","wasMapView","isMapView","listPerPage","mapPerPage","newPerPage","currentPerPage","setFilter","isReady","pathname","propertySlug","queryRef","slugRegex","slugMatch","subpath","lastPart","isLikely404Page","bodyText","titlePatterns","pattern","bodyPatterns","statusMeta","errorSelectors","autoInjectPropertyDetail","is404","mainContent","usedFallback","pageHeading","originalTitle","metaDesc","hideStyle","child","detailContainer","earlyHideStyle","loadingOverlay","shouldAutoInit","existingDetail","existingTemplate","earlyHide","loadOverlay","detailSlug","getMode","reRenderComponents","currentProperties","currentProperty","RSBaseComponent","unsubscribe","innerHTML","unsub","hasProperties","hasPropertiesOrChildren","allLocations","selfHasProperties","getAllDescendants","children","pid","descendants","anyDescendantHasProperties","d","RSLocation","zeroCount","l","undefinedCount","lockedLocation","zeroCountLocs","undefinedCountLocs","allParents","filtered","parent","matchesParent","matchesType","filteredOut","parentName","allChildren","hasProps","isDuplicateName","buildFlat","level","filter","parents","c","html","matchesFilter","childrenMatch","municipality","descendantIds","collectDescendants","city","debounceTimer","target","parentFilterDebounce","childFilterDebounce","locationIds","filterDebounce","isParent","tags","option","dd","lowerTerm","locType","clearBtn","isChild","RSListingType","selectedValue","checkbox","radio","allTypes","RSPropertyType","existingFilter","lockedId","lockedType","types","childIds","buttonText","hasSelectionClass","filterQuery","lowerQuery","parentMatches","matchingChildren","parentChecked","isExpanded","displayChildren","toggleBtn","accordion","content","typeId","parentCheckbox","typesWithProperties","selectedTypes","currentFilter","RSBedrooms","selected","buttons","active","checkboxes","checked","box","isActive","timeout","values","boxValue","RSBathrooms","RSPrice","defaultPriceRanges","priceRange","optionsHtml","buttonsHtml","checkboxesHtml","optionBtn","filterKey","filterValue","RSBuiltArea","minVal","maxVal","minInput","maxInput","minSlider","maxSlider","minLabel","maxLabel","RSPlotSize","RSFeatures","allCategories","searchLower","categoryMatches","categories","categoryKey","selectedInCategory","feature","isSelected","header","featureId","doneBtn","categoryEl","itemsEl","toggleEl","selectedArray","RSReference","hasValue","RSSearchButton","loading","resultAny","RSResetButton","PHP_BASE_URL","RSAISearchToggle","directChildren","titleEl","iconHtml","backBtn","searchTextEl","tryLabel","exampleBtns","examples","idx","sparkleIcon","back","searchBtn","example1","example2","example3","query","featuresRaw","featuresResult","feat","resultsPage","textEl","loaderEl","autoInitAISearch","areLabelsReady","win","initWhenReady","waitForLabels","attempts","maxAttempts","baseDelay","tryInit","RSPropertyGrid","listingParent","customCard","template","pageSlug","urlFormat","titleSlug","columns","prefetchTimeout","card","totalImages","wishlistBtn","mouseEvent","entries","entry","existingPreload","firstProperty","preload","imgWithSizes","srcsetParts","propertyUrl","allImages","totalImageCount","mainImage","imageContent","imageCounter","carousel","classMap","labelKeyMap","cssClass","labelKey","carouselEl","imageEl","statusEl","priceEl","locationEl","bedsEl","bathsEl","builtEl","plotEl","descEl","refEl","typeEl","linkEl","imageCountEl","empty","buildSrcset","imgData","sizesAttr","srcset","srcsetAttr","dataSrcset","currentIndex","slides","dots","goToSlide","s","dot","button","wmAvailable","svg","addSuccess","RSPropertyCarousel","prevLabel","nextLabel","resizeTimeout","viewBtn","me","prop","diff","offset","visibleItems","offsetFromActive","absOffsetFromActive","isVisible","bedIcon","bathIcon","specsHtml","viewLabel","screenWidth","translateXMultiplier","translateZMultiplier","rotateMultiplier","blurMultiplier","rotateY","scale","translateZ","translateX","blur","scaleBase","zDepth","saturation","brightness","shouldShow","counter","visibleCount","isFirst","displayNumber","location","propertyType","viewDetailLabel","RSPagination","pages","delta","start","end","RSSort","opt","RSResultsCount","RSActiveFilters","featuresData","findInTree","list","resolver","displayValue","n","listingTypeLabels","featureNames","RSViewToggle","mapButton","RSMapView","wasVisible","currentView","resetBtn","resolve","reject","css","check","script","L","css1","css2","loadingEl","propertiesWithCoords","marker","newMarkers","popupContent","image","bounds","ne","sw","center","hasValidBounds","latlng","visible","countEl","withoutCoords","lazyObserver","lazyCallbacks","getLazyObserver","onElementVisible","observer","getCardProperty","promise","generatePropertyUrl","SVG_ICONS","RSCardImage","maxImages","RSCardPrice","RSCardTitle","RSCardLocation","RSCardBeds","bedLabel","RSCardBaths","bathLabel","RSCardBuilt","RSCardPlot","RSCardRef","RSCardType","LISTING_TYPE_CLASS","LISTING_TYPE_LABEL_KEY","RSCardStatus","RSCardWishlist","RSCardLink","RSCardDescription","maxLength","RSDetailBackButton","searchUrl","referrer","lastSearch","href","RSDetailGallery","thumb","_h","touchStartX","touchEndX","RSDetailFeatures","modeAttr","grouped","totalFeatures","btnLabel","modalTitle","RSDetailMap","orig","municipalityId","provinceId","variationAttr","variationNum","finalVariation","lat","lng","num","directionsUrl","largerMapUrl","actionsHtml","map","geojson","geomType","layer","useMunicipality","areaParts","mapUrl","iframe","destination","loadingText","defaultText","RSDetailInquiryForm","timezone","detectedDialCode","country","flagEl","codeEl","privacyUrl","defaultCountry","filterLower","popular","others","filterCountry","filteredPopular","filteredOthers","allCountries","translatedTemplate","flag","formData","countryCode","phone","ownerEmail","labelMap","inputId","isRequired","privacyLabel","firstTextNode","textarea","currentValue","lastDefault","newDefaultMessage","RSDetailWishlist","RSDetailShare","pageUrl","shareLink","subject","body","shareUrl","copyBtn","RSDetailRelated","allProperties","RSDetailInfoTable","rows","row","RSDetailSpecs","specs","spec","RSDetailSizes","sizes","size","RSDetailTaxes","taxes","tax","RSDetailEnergy","rating","ratings","colors","currentRating","colorSet","color","apiUrl","RSDetailResources","resources","isEmbed","embedHtml","ytMatch","vimeoMatch","RSDetailPdfButton","RSDetailVideoEmbed","RSDetail","dataId","dataRef","patterns","pathParts","cleanPart","urlRef","textMappings","hasAgentName","hasAgentPhone","hasAgentEmail","hasAgentData","componentMappings","ComponentClass","RSPropertyDetailTemplate","contentChanged","backgroundRefresh","sections","embedUrl","isEnergyRatingUrl","isCo2RatingUrl","energyRating","co2Rating","energyImages","imgUrl","pdfUrl","expanded","specLabels","labelKeys","sectionTitles","section","readMoreBtn","isClamped","infoGridSection","newContent","temp","newSection","taxesSection","energyRatingLabel","co2RatingLabel","videoResource","virtualResource","pdfText","videoTitle","virtualTourTitle","featuresBtnLabel","featuresModalTitle","mode","featuresBtn","featuresModal","backdrop","RSWishlistButton","RSWishlistCounter","RSWishlistHeader","sharedRefs","propertyLabel","savedLabel","RSWishlistEmpty","emptyTitle","emptyDesc","isEmpty","RSWishlistSharedBanner","RSWishlistSort","actualField","RSWishlistActions","RSWishlistCompareBtn","RSWishlistGrid","compareBtn","isInsideCombined","imageUrls","placeholderImg","addedDate","isCompareSelected","price1","price2","actionEl","compareCheck","direction","indicators","newIndex","ind","isChecked","max","RSWishlistModals","modal","noteText","modalId","input","qrUrl","form","emailTo","emailFrom","phpBase","emailEndpoint","submitBtn","originalText","propertiesWithUrls","responseText","refInput","nameEl","charCount","deleteBtn","thead","tbody","th","tr","labelTd","allSame","_p","td","jsPDF","pdf","pageWidth","pageHeight","margin","contentWidth","primaryColor","textColor","lightGray","successColor","yPos","countText","dateText","imgWidth","targetHeight","canvas","ctx","imgAspect","targetAspect","sx","sy","sh","imgError","titleLines","beds","baths","buildSize","plotSize","ltLabelMap","ltKey","ltLabel","noteLines","filename","RSWishlistList","loaderText","gridComponent","component","_RSLanguageSelector","availableLangsAttr","codes","apiLanguages","RSLanguageSelector","RSShareButton","RSShareWhatsApp","RSShareFacebook","RSShareTwitter","RSShareLinkedIn","RSShareEmail","RSShareCopy","originalContent"],"mappings":"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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAyCzB,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA8HzB,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA2CzB,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA8CzB,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAwCzB,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAmBzB,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA4E1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAkE1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAyE1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAqD1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA0E1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA0D1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAqE1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAsE1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA4E1B,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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"}